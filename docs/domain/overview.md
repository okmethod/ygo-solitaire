# 遊戯王 OCG ルール概要

本アプリケーションで扱う遊戯王 OCG（オフィシャルカードゲーム）のルールを定義する。  
原則、先攻 1 ターンキルシミュレーターに必要な範囲のみを記載する。

**参考資料**

- [遊戯王 OCG 公式ルール](https://www.yugioh-card.com/japan/howto/)
- [マスタールール(2020 年 4 月 1 日改訂版)対応公式ルールブック PDF 版](https://img.yugioh-card.com/japan/howto/data/rulebook_masterrule20200401_ver1.0.pdf)

---

## Player: プレイヤー / 決闘者

自由意志を持ってゲームを操作する主体。1 ゲームにつき 2 人存在する。

- **You** : あなた / 自分
- **Opponent** : 相手プレイヤー（意思決定が必要な場合は、本アプリが代行する）

（カードの持ち主、カードのコントローラーという概念もあるが、本アプリでは今のところ考慮不要）

---

## Card: カード

モンスターカード、魔法カード、罠カードの総称。

詳細は [カードモデル](./card-model.md) を参照。

**実装箇所**: `domain/models/Card.ts`

---

## Effect: 効果

モンスター・魔法・罠が持つ、ゲームに影響を与える処理の総称。

詳細は [効果モデル](./effect-model.md) を参照。

**実装箇所**: `domain/models/ChainableAction.ts`, `domain/models/AdditionalRule.ts`

---

## Game State: ゲーム状態

1 回のゲーム（公式ルールでいう「1 回のデュエル」） は以下の要素で構成される状態を持つ。  
これらの要素をルールに従い更新しながら、ゲームを進行する。

- **Zones** : 領域
- **Turn** : ターン
- **Phase** : フェイズ
- **Nomal Summon Limit / Used** : 通常召喚権
- **Chain** : チェーン
- **Life Points** : ライフポイント
- **Game Rusult / Victory Decision** : 勝敗判定

- **Used Only Once Per Turn Effects** : カード名を指定した「1 ターンに 1 度」制限
- **Used Once Per Turn Effects** : カード名指定のない「1 ターンに 1 度」制限

**実装箇所**: `domain/models/GameState.ts`

---

## Game State Update: ゲーム状態更新

ゲーム状態を変化させる手続きをゲーム状態更新として定義し、これを処理することでゲームを進行させる。  
すべてのゲーム状態更新は、変更前のゲーム状態に対して適用可能かどうかを判定し、満たしていれば変更後のゲーム状態を返す。  
ゲーム状態更新には、プレイヤーの行動によってトリガーするものや、ルールやカード効果解決に従い自動的に処理されるものがある。

**実装箇所**: `domain/GameStateUpdate.ts`, `application/GameFacade.ts`

### Game Command: ゲーム操作コマンド

プレイヤーの行動（コマンド実行）によってトリガーし、ルールに従って処理する。  
それぞれのゲーム操作コマンドには実行条件があり、それを満たす場合のみ実行可能となる。  
直接ゲーム状態を更新するものと、カードや効果を発動し固有の効果処理（後述）を生成してから順に更新するものがある。

詳細は [ゲーム操作モデル](./game-command-model.md) を参照。

**実装箇所**: `domain/models/GameCommand.ts`, `domain/commands/`

### Effect Processing: 効果処理

カード固有のルール・手続きに従い処理する。
効果処理は発動処理・解決処理に大別され、それぞれ効果処理ステップの組み合わせとして定義される。

**実装箇所**: `domain/effects/builders/stepBuilders.ts`

詳細は [効果処理モデル](./effect-model.md) を参照。

**実装箇所**: `domain/models/EffectResolutionStep.ts`, `domain/models/effects/`

---

## Chain: チェーン（⏳ 未実装）

複数カードの効果処理をスムーズに解決するシステム。

詳細は [チェーンシステム](./chain-system.md) を参照。

**実装箇所**: TODO

---

## Zones: 領域

カードが配置される領域。ゲーム中のすべてのカードは、いずれかの領域に存在する。  
自分/相手のそれぞれに固有の領域がある。

**実装箇所**: `domain/models/Zone.ts`

### Deck: デッキ / メインデッキ / 山札

- 当該ゲームで使われるカードプールの初期位置。
- 枚数は公開情報、順番や内訳は非公開情報。

### Extra Deck: エクストラデッキ

- ルール上、メインデッキと区別して扱われるカードプール。
- 融合・シンクロ・エクシーズ・リンクモンスターが含まれる。
- 自分にとって、自分のエクストラデッキは公開情報。

### Hand: 手札

- プレイヤーが手に持っているカードが含まれる領域。
- プレイの起点となり、手札からカードを発動・召喚したり、セットしたりする。
- 自分にとって、自分の手札は公開情報。

### Field: フィールド

- カードを配置してプレイする領域。以下のゾーンの総称。
  - メインモンスターゾーン: モンスターカードを置く領域（5 枚）
  - エクストラモンスターゾーン(⏳ 未実装)
  - 魔法＆罠ゾーン: 魔法カードまたは罠カードを置く領域（5 枚）
  - フィールドゾーン: フィールド魔法カードを置く場所（1 枚）
  - ペンデュラムゾーン(⏳ 未実装)
- 自分にとって、自分フィールドは公開情報。

### Graveyard: 墓地

- 使用済みのカードが送られる場所。
- 公開情報。

### Banishment: 除外（⏳ 未実装）

- ゲームから除外された場所。別名第二の墓地。
- 公開情報。ただし裏側で除外されたカードは除く。

---

## Turn: ターン

各プレイヤーがアクションを起こすことのできる順番。  
ゲームの準備が整った後、先攻プレイヤーから第 1 ターンとして始まり、それ以降は後攻プレイヤーとで交互に行う。  
本アプリでは、基本的に `1` で、ターンプレイヤーは自分となる。

---

## Phase: フェイズ

ターンを構成する、手順を明確に区切ったもの。フェイズごとに選択可能なアクションが異なる。

**先攻 1 ターン目のフェイズ遷移:**

1. **Draw Phase** : ドローフェイズ。先行 1 ターン目はドローしない。
2. **Standby Phase** : スタンバイフェイズ。特定のカード効果を処理するためのフェイズだが、先行 1 ターン目は何もしない。
3. **Main Phase 1** : メインフェイズ 1。ターンプレイヤーがアクションできるフェイズ。このアプリの主役。
4. **End Phase** : エンドフェイズ。ターンの終了処理を行う。

2 ターン目以降は「バトルフェイズ」「メインフェイズ 2」があるが、本アプリには不要。

**実装箇所**: `domain/models/Phase.ts`, `domain/rules/PhaseRule.ts`

---

## Life Points: ライフポイント

各プレイヤーの命。初期値は 8000 ポイント。0 ポイントになると敗北する。

---

## Victory Decision: 勝敗判定

自分が勝利条件または敗北条件を満たしているかどうかの判定結果。

- **勝利条件**
  - 相手のライフポイントが 0 になる
  - 相手のデッキが 0 枚の状態で、相手がカードをドローする（⏳ 未実装）
  - 各種カードの効果による勝利（特殊勝利）
- **敗北条件**
  - 自分のライフポイントが 0 になる
  - 自分のデッキが 0 枚の状態で、自分がカードをドローする（デッキ切れ）
  - サレンダー（降参）する（⏳ 未実装）

特殊勝利のバリエーションに関する詳細は [特殊勝利条件](./victory-conditions.md) を参照。

**実装箇所**: `domain/rules/VictoryRule.ts`
