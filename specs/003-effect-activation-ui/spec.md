# Feature Specification: Effect Activation UI with Card Illustrations

**Feature Branch**: `003-effect-activation-ui`
**Created**: 2025-11-30
**Status**: Draft
**Input**: User description: "V2シミュレーターにDuelFieldコンポーネントを統合し、UIから効果発動コマンドを実行できるようにし、カードイラストを表示する"

## User Scenarios & Testing

### User Story 1 - View Card Illustrations in Hand and Field (Priority: P1)

ユーザーがシミュレーター画面でカードIDだけでなく、カードの実際のイラストを見ることができるようにする。現在のV2シミュレーターは手札とフィールドのカードをIDのみで表示しているが、これをDuelFieldコンポーネントを統合してカードイラストとして表示する。

**Why this priority**: カードゲームシミュレーターの基本的なUXとして視覚的なカード表示は最重要。カードIDの数値だけでは、ユーザーが何のカードかを瞬時に判断できず、ゲーム体験が大きく損なわれる。

**Independent Test**: シミュレーターページを開き、デッキを初期化した後、手札にドローされたカードがIDではなくイラスト画像として表示されることで独立してテスト可能。DuelFieldコンポーネントの統合のみで完結。

**Acceptance Scenarios**:

1. **Given** ユーザーがV2シミュレーターページを開いた状態、**When** ゲームを開始してカードをドローする、**Then** 手札エリアにカードIDではなくYGOPRODeck APIから取得したカードイラストが表示される
2. **Given** 手札にカードがある状態、**When** カードを選択してフィールドに配置する、**Then** フィールドエリアに配置されたカードがイラスト付きで表示される
3. **Given** 複数のカードが手札とフィールドにある状態、**When** ゲーム画面を見る、**Then** すべてのゾーン（手札、モンスターゾーン、魔法・罠ゾーン、墓地など）が適切なレイアウトでカードイラスト付きで表示される

---

### User Story 2 - Execute Card Effect Commands from UI (Priority: P2)

ユーザーが手札のカードをクリックすることで、そのカードの効果発動コマンドを実行できるようにする。現在は手札カードにActivateボタンがあるが、これをDuelFieldコンポーネント内のカードクリックイベントと統合し、GameFacadeのコマンドを呼び出す。

**Why this priority**: カードイラストが見えても操作できなければシミュレーターとして不完全。P1のビジュアル表示の次に重要な対話機能。ただし、カード表示がないと操作対象が不明確なためP1の後に実装。

**Independent Test**: 手札にSpellカードがある状態で、そのカードイラストをクリックし、効果が発動され、ゲーム状態が更新されること（例: カードが墓地に移動、LPが変化など）で独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** Main1フェイズで手札に魔法カードがある状態、**When** 手札のカードイラストをクリックする、**Then** そのカードの効果発動コマンド（gameFacade.activateSpell）が実行され、成功/失敗のトーストメッセージが表示される
2. **Given** 効果を発動できないフェーズ（例: Draw Phase）、**When** 手札のカードをクリックする、**Then** 発動できない旨のエラーメッセージが表示され、ゲーム状態は変化しない
3. **Given** 効果発動後、**When** ゲーム状態を確認する、**Then** カードが適切なゾーンに移動し（例: 手札→墓地）、カードイラスト表示も更新される

---

### User Story 3 - Interactive Card Detail Display (Priority: P3)

ユーザーがカードイラストをクリックまたはホバーした際に、カードの詳細情報（名前、効果テキスト、攻撃力/守備力など）をモーダルやツールチップで表示する。

**Why this priority**: 効果発動できればゲームプレイは可能だが、カードの詳細を確認できるとUXがさらに向上。P1/P2が完成していなくても実装可能だが、カード表示がない状態では意味がないため優先度は低い。

**Independent Test**: 任意のカードイラストをクリックし、カードの詳細情報（効果テキスト、ステータスなど）がモーダルダイアログで表示されることで独立してテスト可能。Card.svelteのshowDetailOnClick機能を利用。

**Acceptance Scenarios**:

1. **Given** フィールド上にカードがある状態、**When** カードイラストをクリックする、**Then** カードの詳細情報（名前、タイプ、効果テキスト、モンスターの場合は攻撃力/守備力/レベルなど）がモーダルで表示される
2. **Given** カード詳細モーダルが表示されている状態、**When** モーダルを閉じる操作をする、**Then** モーダルが閉じてゲーム画面に戻る
3. **Given** 墓地や除外ゾーンにカードがある状態、**When** それらのゾーンをクリックする、**Then** ゾーン内のカード一覧がダイアログで表示され、各カードの詳細を確認できる

---

### Edge Cases

- **データ未取得時の表示**: カードイラストをYGOPRODeck APIから取得中の場合、プレースホルダーやローディング表示をどうするか？（想定: 既存のCard.svelteのplaceholder機能を利用）
- **API取得失敗時の挙動**: YGOPRODeck APIからカードデータが取得できなかった場合、フォールバック表示をどうするか？（想定: カードIDのみを表示し、エラーログを出力）
- **大量カード同時表示時のパフォーマンス**: 手札・フィールド・墓地など多数のカードを同時に表示する際のレンダリングパフォーマンスは問題ないか？（想定: 現在のDeckData構造で最大40枚程度なので問題なし）
- **モバイル表示時のレイアウト**: DuelFieldコンポーネントはresponsiveだが、小画面での操作性は？（想定: 既存のTailwindCSSのresponsive classを活用）

## Requirements

### Functional Requirements

- **FR-001**: システムはGameStateのCardInstance（instanceId, cardId）からYGOPRODeck APIを使用してCardDisplayData（name, images, descriptionなど）を取得し、カードイラストを表示しなければならない
- **FR-002**: システムは手札、フィールド（モンスターゾーン、魔法・罠ゾーン）、墓地、除外ゾーンのすべてにおいてカードイラストを表示しなければならない
- **FR-003**: ユーザーは手札のカードイラストをクリックすることで、そのカードの効果発動コマンドを実行できなければならない
- **FR-004**: システムは効果発動の成功/失敗をユーザーにトーストメッセージで通知しなければならない
- **FR-005**: システムは効果発動後、ゲーム状態の変更をリアルタイムでUI（カードの位置、LP、フェーズなど）に反映しなければならない
- **FR-006**: ユーザーはカードイラストをクリックすることで、カードの詳細情報（名前、効果テキスト、ステータス）を確認できなければならない
- **FR-007**: システムはカードデータ取得中およびデータ取得失敗時に適切なフォールバック表示（プレースホルダー、エラー表示）を提供しなければならない
- **FR-008**: システムは既存のV2シミュレーターのゲームコントロール（Draw Card、Advance Phaseボタンなど）との統合を維持しなければならない

### Key Entities

- **CardInstance (Domain Layer)**: ゲーム状態内のカードインスタンス。instanceId（一意識別子）、cardId（カードID）、location（ゾーン位置）を持つ
- **CardDisplayData (Presentation Layer)**: UI表示用のカードデータ。id、name、type、description、images（イラストURL）、monsterAttributes（攻撃力、守備力など）を含む
- **GameState**: 現在のゲーム状態。zones（手札、フィールド、墓地など各ゾーンのCardInstance配列）、LP、phase、turnを管理
- **DuelField Component**: カードイラスト表示とレイアウトを担当するUIコンポーネント。props経由でカードデータを受け取り、カードクリックイベントをハンドリング

## Success Criteria

### Measurable Outcomes

- **SC-001**: ユーザーは手札、フィールド、墓地の全カードをイラスト画像として視認できる（カードIDのみの表示は0件）
- **SC-002**: ユーザーは手札のカードをクリックしてから効果発動が完了するまで1秒以内に応答を得られる
- **SC-003**: カードの効果発動操作において、90%以上のケースでユーザーが一回のクリックで目的の操作を完了できる
- **SC-004**: カードイラスト表示が実装されたことにより、ユーザーがカードを識別するまでの時間が現状（カードIDのみ表示）と比較して50%以上短縮される
- **SC-005**: システムは同時に表示される最大40枚のカード（手札5枚+フィールド11枚+墓地など）をスムーズに（フレームレート30fps以上を維持して）レンダリングできる
