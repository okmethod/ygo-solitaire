# Requirements Checklist: UX改善（自動フェーズ進行・デッキシャッフル・自動勝利判定）

**Feature**: 006-ux-automation
**Created**: 2024-12-20
**Status**: Draft

このチェックリストは、spec.mdで定義された要件が実装完了時にすべて満たされているかを確認するためのものです。

---

## Functional Requirements

### FR-001: 自動フェーズ進行（ターン1）
- [ ] ゲーム開始時（ターン1のDrawフェーズ開始時）に自動的にMain Phaseまでフェーズが進行する
- [ ] Drawフェーズがスキップされる（先行1ターン目のルールに準拠）
- [ ] Standbyフェーズがスキップされる
- [ ] Main Phaseに到達する

### FR-002: フェーズ移行時のトースト通知
- [ ] Drawフェーズへの移行時にトースト通知が表示される（「ドローフェーズに移行しました」等）
- [ ] Standbyフェーズへの移行時にトースト通知が表示される（「スタンバイフェーズに移行しました」等）
- [ ] Main Phaseへの移行時にトースト通知が表示される（「メインフェーズ1に移行しました」等）
- [ ] トースト通知が日本語で表示される

### FR-003: デッキシャッフル
- [ ] ゲーム開始時にデッキがランダムにシャッフルされる
- [ ] Fisher-Yates等の標準的なシャッフルアルゴリズムが使用されている
- [ ] シャッフルがImmer.jsを使用して不変性を保持している
- [ ] シャッフルがGameState内のdeck zoneに適用される

### FR-004: カード効果解決後の自動勝利判定
- [ ] カード効果解決が完了した後、自動的に勝利条件がチェックされる
- [ ] 強欲な壺等のドロー効果解決後に勝利判定が実行される
- [ ] 天使の施し等のカード効果解決後に勝利判定が実行される
- [ ] 効果解決のコールバック経由で勝利判定が呼ばれる

### FR-005: フェーズ移行後の自動勝利判定
- [ ] フェーズ移行が完了した後、自動的に勝利条件がチェックされる
- [ ] Drawフェーズ→Standbyフェーズ移行後に勝利判定が実行される
- [ ] Standbyフェーズ→Main Phase移行後に勝利判定が実行される
- [ ] Main Phase→Endフェーズ移行後に勝利判定が実行される

### FR-006: 勝利時の即座の状態遷移
- [ ] 勝利条件を満たした場合、GameStateのisGameOverフラグがtrueになる
- [ ] 勝利画面（Game Resultセクション）が即座に表示される
- [ ] 勝利理由（reason）が正しく表示される（例: "Exodia Victory"）
- [ ] 勝利メッセージ（message）が日本語で表示される

### FR-007: 重複勝利判定の防止
- [ ] 既にisGameOver = trueの場合、勝利判定がスキップされる
- [ ] カード効果チェーン中に複数回勝利判定が呼ばれても、最初の1回のみ処理される
- [ ] 勝利判定実行前にisGameOverフラグをチェックするガード条件が存在する

### FR-008: 不要なUIボタン削除
- [ ] 「Draw Card」ボタンがUI上から削除されている（またはDebug Infoセクション内のみ）
- [ ] 「Advance Phase」ボタンがUI上から削除されている（またはDebug Infoセクション内のみ）
- [ ] 「Check Victory」ボタンがUI上から削除されている（またはDebug Infoセクション内のみ）
- [ ] デバッグ用に残す場合、`<details>`タグ内のDebug Infoセクションにのみ表示される

### FR-009: ゲームロード完了後の自動進行
- [ ] カードデータのロードが完了するまで、自動フェーズ進行が開始されない
- [ ] `$handCards`がすべて読み込まれた後に自動進行が開始される
- [ ] ローディング中の場合、自動進行がスキップされる（ガード条件）
- [ ] Svelteの`$effect`またはライフサイクルフックで適切に制御される

---

## User Stories Validation

### User Story 1: 自動フェーズ進行
- [ ] **Scenario 1**: ゲーム開始時、自動的にDrawフェーズ→Standbyフェーズ→Main Phaseと進行する
- [ ] **Scenario 2**: Main Phase到達後、手札からカードを発動できる

### User Story 2: デッキシャッフル
- [ ] **Scenario 1**: ゲーム開始時、デッキがランダムにシャッフルされる
- [ ] **Scenario 2**: 複数回リロードした場合、手札のカード順序が異なる

### User Story 3: 自動勝利判定
- [ ] **Scenario 1**: Exodia5体揃い時、自動的に勝利画面が表示される
- [ ] **Scenario 2**: カード効果解決後、自動的に勝利判定が実行される
- [ ] **Scenario 3**: フェーズ移行後、自動的に勝利判定が実行される

### User Story 4: UIボタン削除
- [ ] **Scenario 1**: 「Draw Card」「Advance Phase」「Check Victory」ボタンがUI上から削除されている（またはDebugセクションのみ）

---

## Edge Cases

- [ ] **ゲームロード中のフェーズ進行**: ロード完了後に自動進行が開始される（不整合が発生しない）
- [ ] **複数回の勝利判定**: 重複チェックが正しく動作し、2回目以降はスキップされる
- [ ] **シャッフルの偏り**: 統計的にランダムであることが確認できる（10回中10回異なる手札）
- [ ] **フェーズ進行中のユーザー操作**: 自動進行中にユーザー操作をしても競合しない（isGameOverフラグ等でガード）

---

## Success Criteria

- [ ] **SC-001**: ゲーム開始後、手動操作なしで2秒以内にMain Phaseに到達できる
- [ ] **SC-002**: 10回のゲームリロードで10回とも異なる手札順序が得られる
- [ ] **SC-003**: Exodia5体揃い時、自動的に勝利画面が表示される
- [ ] **SC-004**: 「Draw Card」「Advance Phase」「Check Victory」ボタンがUI上に存在しない（またはDebugセクションのみ）
- [ ] **SC-005**: 全312テスト（既存のユニットテスト）が引き続きpassする
- [ ] **SC-006**: E2Eテストで、ゲーム開始→自動フェーズ進行→カード発動→自動勝利判定のフローが正常に動作する

---

## Testing Checklist

### Unit Tests
- [ ] デッキシャッフル機能のユニットテスト（Fisher-Yatesアルゴリズム検証）
- [ ] 自動勝利判定のユニットテスト（isGameOverフラグチェック、重複防止）
- [ ] フェーズ自動進行のユニットテスト（ターン1のみ、Main Phaseまで進行）

### Integration Tests
- [ ] GameFacade経由の自動フェーズ進行テスト
- [ ] カード効果→自動勝利判定の統合テスト
- [ ] フェーズ移行→自動勝利判定の統合テスト

### E2E Tests
- [ ] ゲーム開始→自動フェーズ進行→Main Phase到達のE2Eテスト
- [ ] カード発動→Exodia5体揃い→自動勝利のE2Eテスト
- [ ] デッキシャッフル→異なる手札のE2Eテスト

### Manual Tests
- [ ] 実際にブラウザでゲームを開始し、自動フェーズ進行を確認
- [ ] トースト通知が正しく表示されることを確認
- [ ] Exodia5体揃い時に勝利画面が即座に表示されることを確認
- [ ] UIボタンが削除されていることを確認

---

## Documentation & Code Quality

- [ ] CLAUDE.mdの「Recent Changes」セクションを更新（006-ux-automation実装完了を記載）
- [ ] 必要に応じてADRを作成（自動化戦略に関する設計判断）
- [ ] コードコメントで自動化ロジックの意図を明記
- [ ] Linter/Formatterを実行し、コードスタイル違反がない
- [ ] TypeScriptコンパイルエラーがない

---

## Deployment Checklist

- [ ] 全変更をコミット
- [ ] リモートブランチにpush
- [ ] Pull Request作成
- [ ] PR説明にspec.mdへのリンクを記載
- [ ] レビュー後、mainブランチにマージ

---

**Final Validation**: すべてのチェックボックスが✅になった時点で、この機能は完成とみなされます。
