import{s as De}from"./CGsWEf79.js";import{c as Ie,a as v,f as y,t as qe}from"./BzqWM1xr.js";import{j as J,D as Ee,m as U,aG as ae,k as re,l as K,q as i,y as E,v as h,x as m,u as P,t as D,A as Se}from"./CKuk0KJ3.js";import{s as L}from"./BtrBAieD.js";import{i as C}from"./CiQuYYFI.js";import{e as Ae}from"./Clij8A-N.js";import{a as se,g as Pe,s as Te,b as M,c as N}from"./B9oa_3uL.js";import{p}from"./DQPV5J1y.js";function Oe(){return{credentials:"same-origin"}}async function je(a,e,t){try{return await a(e,t)}catch(r){throw console.error("API error:",r),new Error(`Failed to fetch: ${t.method} ${e}`)}}const ze="https://db.ygoprodeck.com/api/v7",ne=new Map;async function oe(a,e){const r={...Oe(),method:"GET"},n=`${ze}/${e}`;try{const s=await je(a,n,r);if(!s.ok){if(console.error(`YGOPRODeck API Error: ${s.status} ${s.statusText} - ${n}`),s.status===429)throw new Error("YGOPRODeck API rate limit exceeded. Please reduce request frequency.");return null}return await s.json()}catch(s){throw console.error("YGOPRODeck API fetch failed:",s),s}}async function Re(a,e){const t=`cardinfo.php?id=${e}`,r=await oe(a,t);return(r==null?void 0:r.data[0])||null}async function Be(a,e){if(e.length===0)return[];const t=[],r=[];for(const s of e){const l=ne.get(s);l?t.push(l):r.push(s)}let n=[];if(r.length>0){const l=`cardinfo.php?id=${r.join(",")}`,u=await oe(a,l);if(u!=null&&u.data){n=u.data;for(const o of n)ne.set(o.id,o)}}return[...t,...n]}class Ge{async getCardsByIds(e){return(await Be(fetch,e)).map(r=>this.convertToCardDisplayData(r))}async getCardById(e){const t=await Re(fetch,e);if(!t)throw new Error(`Card not found: ID ${e}`);return this.convertToCardDisplayData(t)}normalizeType(e){const t=e.toLowerCase();if(t.includes("monster"))return"monster";if(t.includes("spell"))return"spell";if(t.includes("trap"))return"trap";throw console.error(`Unknown card type: ${e}`),new Error(`Unable to normalize card type: "${e}". Expected type containing "monster", "spell", or "trap".`)}convertToCardDisplayData(e){const t=this.normalizeType(e.type),r=e.card_images[0],n=r?{image:r.image_url,imageSmall:r.image_url_small,imageCropped:r.image_url_cropped}:void 0,s=t==="monster"&&e.atk!==void 0&&e.def!==void 0&&e.level!==void 0?{attack:e.atk,defense:e.def,level:e.level,attribute:e.attribute??"",race:e.race??""}:void 0;return{id:e.id,name:e.name,type:t,description:e.desc,frameType:e.frameType,archetype:e.archetype,monsterAttributes:s,images:n}}}function Le(a,e){const t=[],r=[],n=[];for(const s of e){const l=a.get(s.id);if(l){const u={cardData:l,quantity:s.quantity};switch(l.type){case"monster":t.push(u);break;case"spell":r.push(u);break;case"trap":n.push(u);break}}}return{monsters:t,spells:r,traps:n}}function Ye(a,e){var s;const t=[],r=[],n=[];for(const l of e){const u=a.get(l.id);if(u){const o={cardData:u,quantity:l.quantity},c=((s=u.frameType)==null?void 0:s.toLowerCase())||"";c.includes("fusion")?t.push(o):c.includes("synchro")?r.push(o):c.includes("xyz")&&n.push(o)}}return{fusion:t,synchro:r,xyz:n}}function He(a,e){const t=a.monsters.reduce((o,c)=>o+c.quantity,0),r=a.spells.reduce((o,c)=>o+c.quantity,0),n=a.traps.reduce((o,c)=>o+c.quantity,0),s=e.fusion.reduce((o,c)=>o+c.quantity,0)+e.synchro.reduce((o,c)=>o+c.quantity,0)+e.xyz.reduce((o,c)=>o+c.quantity,0),l=t+r+n+s,u=a.monsters.length+a.spells.length+a.traps.length+e.fusion.length+e.synchro.length+e.xyz.length;return{totalCards:l,uniqueCards:u,monsterCount:t,spellCount:r,trapCount:n}}function Me(a){if(typeof a.id!="number"||!Number.isInteger(a.id)||a.id<=0)throw new Error(`Invalid card ID: ${a.id}. RecipeCardEntry must have a valid positive integer ID (YGOPRODeck API compatible).`);if(typeof a.quantity!="number"||!Number.isInteger(a.quantity)||a.quantity<=0)throw new Error(`Invalid quantity: ${a.quantity} for card ID ${a.id}. Quantity must be a positive integer.`)}async function _t(a,e){const t=De[a];if(!t)throw new Error(`Deck not found: ${a}`);const r=[...t.mainDeck,...t.extraDeck];for(const d of r)Me(d);const n=Array.from(new Set(r.map(d=>d.id))),s=new Ge;let l;try{l=await s.getCardsByIds(n)}catch(d){throw console.error("カード情報のAPI取得に失敗しました:",d),new Error(`Failed to fetch card data: ${d instanceof Error?d.message:String(d)}`)}const u=new Map(l.map(d=>[d.id,d])),o=Le(u,t.mainDeck),c=Ye(u,t.extraDeck),b=He(o,c);return{name:t.name,description:t.description,category:t.category,mainDeck:o,extraDeck:c,stats:b}}const Ue={small:"w-16 h-24",medium:"w-22 h-32",large:"w-32 h-48"},Ne={small:"w-4 h-4 text-xs",medium:"w-6 h-6 text-xs",large:"w-8 h-8 text-sm"},Fe=""+new URL("../assets/CardBack.DGn8cQOG.jpg",import.meta.url).href;var Qe=y('<img class="w-full h-full object-cover rounded-sm"/>'),Ze=y('<span class="text-xs opacity-75 select-none mt-1"> </span>'),Je=y('<div class="w-full h-full bg-surface-200-700-token rounded-sm flex flex-col items-center justify-center text-center overflow-hidden"><img class="w-full h-full object-cover opacity-30"/> <div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-xs select-none text-surface-600-300-token font-medium"> </span> <!></div></div>'),Ke=y('<div class="w-full h-full bg-surface-200-700-token rounded-sm flex items-center justify-center"><img alt="" class="w-full h-full object-cover opacity-20"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs opacity-50 select-none">No Image</span></div></div>'),Ve=y('<div class="px-1 py-1 bg-surface-50-900-token border-t border-surface-300"><div class="text-xs font-medium truncate"> </div></div>'),We=y('<div class="absolute top-1 right-1 w-3 h-3 bg-primary-500 rounded-full animate-pulse"></div>'),Xe=y('<div class="absolute inset-0 bg-primary-500 opacity-10 pointer-events-none"></div>'),$e=y('<div class="flex-1 flex items-center justify-center p-1"><!></div> <!> <!> <!>',1),et=y("<button><!></button>"),tt=y("<div><!></div>");function at(a,e){J(e,!0);const t=w=>{var x=$e(),T=re(x),Y=h(T);{var he=f=>{var g=Qe();D(()=>{M(g,"src",e.card.images.imageCropped),M(g,"alt",e.card.name||"カード")}),v(f,g)},ge=(f,g)=>{{var O=B=>{var j=Je(),H=h(j),te=P(H,2),Q=h(te),xe=h(Q,!0);m(Q);var pe=P(Q,2);{var Ce=Z=>{var G=Ze(),ke=h(G,!0);m(G),D(()=>L(ke,e.card.type)),v(Z,G)};C(pe,Z=>{var G;(G=e.card)!=null&&G.type&&Z(Ce)})}m(te),m(j),D(()=>{M(H,"src",R),M(H,"alt",o()),L(xe,o())}),v(B,j)},F=B=>{var j=Ke(),H=h(j);Se(2),m(j),D(()=>M(H,"src",R)),v(B,j)};C(f,B=>{i(z)?B(O):B(F,!1)},g)}};C(Y,f=>{var g,O;(O=(g=e.card)==null?void 0:g.images)!=null&&O.imageCropped?f(he):f(ge,!1)})}m(T);var $=P(T,2);{var ye=f=>{var g=Ve(),O=h(g),F=h(O,!0);m(O),m(g),D(()=>L(F,e.card.name)),v(f,g)};C($,f=>{e.card&&!i(z)&&f(ye)})}var ee=P($,2);{var _e=f=>{var g=We();v(f,g)};C(ee,f=>{i(S)&&f(_e)})}var we=P(ee,2);{var be=f=>{var g=Xe();v(f,g)};C(we,f=>{b()&&(i(d)||i(S))&&f(be)})}v(w,x)};let r=p(e,"size",3,"medium"),n=p(e,"clickable",3,!1),s=p(e,"selectable",3,!1),l=p(e,"isSelected",3,!1),u=p(e,"placeholder",3,!1),o=p(e,"placeholderText",3,"カード"),c=p(e,"rotation",3,0),b=p(e,"animate",3,!0),_=p(e,"showDetailOnClick",3,!1),d=ae(!1),I=ae(!1),S=E(()=>s()?i(I):l());Ee(()=>{s()||U(I,l())});function A(){var w;console.log(`[Card] クリックイベント発生: clickable=${n()}, card=${(w=e.card)==null?void 0:w.name}, hasOnClick=${!!e.onClick}`),n()&&e.card&&e.onClick&&(console.log(`[Card] onClickコールバックを実行します: ${e.card.name}`),e.onClick(e.card)),s()&&U(I,!i(I)),_()&&e.card&&Te(e.card)}function k(){U(d,!0),e.onHover&&e.card&&e.onHover(e.card)}function q(){U(d,!1),e.onHover&&e.onHover(null)}const z=E(()=>u()||!e.card),R=Fe,ce=E(()=>b()?"transition-all duration-300 ease-in-out":""),ie=E(()=>n()||s()||_()?"cursor-pointer hover:scale-105 hover:shadow-lg":""),le=E(()=>i(S)?"ring-2 ring-primary-500 shadow-lg":""),de=E(()=>c()!==0?`transform: rotate(${c()}deg);`:""),ue=E(()=>()=>{var w;return Pe((w=e.card)==null?void 0:w.type)}),V=E(()=>()=>`
      ${Ue[r()]}
      ${i(ce)}
      ${i(ie)}
      ${i(le)}
      ${i(ue)()}
      border border-surface-300 rounded aspect-[3/4] flex flex-col justify-between
      relative overflow-hidden
    `),W=E(()=>({style:i(de),onclick:n()||s()||_()?A:void 0,onmouseenter:k,onmouseleave:q}));var X=Ie(),fe=re(X);{var ve=w=>{var x=et();se(x,Y=>({class:`${Y??""} bg-transparent p-0 border border-2 border-gray-100`,...i(W)}),[()=>i(V)()]);var T=h(x);t(T),m(x),v(w,x)},me=w=>{var x=tt();se(x,Y=>({class:Y,role:"img",...i(W)}),[()=>i(V)()]);var T=h(x);t(T),m(x),v(w,x)};C(fe,w=>{n()||s()||_()?w(ve):w(me,!1)})}v(a,X),K()}var rt=y("<div> </div>");function st(a,e){J(e,!0);let t=p(e,"size",3,"medium"),r=p(e,"colorClasses",3,"bg-primary-200 text-primary-900");var n=rt(),s=h(n,!0);m(n),D(()=>{N(n,1,`absolute -top-2 -right-2 ${Ne[t()]??""} ${r()??""} rounded-full flex items-center justify-center font-bold shadow-md z-10`),L(s,e.count)}),v(a,n),K()}var nt=y('<span class="badge w-fit preset-tonal-surface text-sm"> </span>'),ot=y('<h3 class="md:col-span-2 h4 flex flex-col min-w-fit"><!> <!></h3>'),ct=y('<div class="relative"><div><!></div> <!></div>'),it=y("<div></div>"),lt=y("<section><div><!> <!></div></section>");function wt(a,e){J(e,!0);let t=p(e,"borderColor",3,"border-gray-400");const r=E(()=>e.title||e.cardCount!==void 0);var n=lt(),s=h(n),l=h(s);{var u=b=>{var _=ot(),d=h(_);{var I=k=>{var q=qe();D(()=>L(q,e.title)),v(k,q)};C(d,k=>{e.title&&k(I)})}var S=P(d,2);{var A=k=>{var q=nt(),z=h(q);m(q),D(()=>L(z,`${e.cardCount??""}枚`)),v(k,q)};C(S,k=>{e.cardCount!==void 0&&k(A)})}m(_),v(b,_)};C(l,b=>{i(r)&&b(u)})}var o=P(l,2);{var c=b=>{var _=it();Ae(_,21,()=>e.cards,d=>d.cardData.id,(d,I)=>{var S=ct(),A=h(S),k=h(A);at(k,{get card(){return i(I).cardData},size:"medium",showDetailOnClick:!0}),m(A);var q=P(A,2);{var z=R=>{st(R,{get count(){return i(I).quantity},colorClasses:"bg-primary-200 text-primary-900"})};C(q,R=>{i(I).quantity>1&&R(z)})}m(S),D(()=>N(A,1,`border-2 ${t()??""} rounded-lg shadow-md overflow-hidden`)),v(d,S)}),m(_),D(()=>N(_,1,`${i(r)?"md:col-span-10":""} flex-1 flex gap-2 flex-wrap`)),v(b,_)};C(o,b=>{e.cards.length>0&&b(c)})}m(s),m(n),D(()=>N(s,1,`badge preset-tonal-surface mb-3 grid items-center gap-4 p-2 rounded-lg shadow-md ${i(r)?"grid-cols-1 md:grid-cols-12":"grid-cols-1"}`)),v(a,n),K()}export{wt as C,Ge as Y,Ue as a,at as b,st as c,Fe as d,_t as l};
