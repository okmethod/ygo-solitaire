var Kr=Object.defineProperty;var Qr=(e,t,n)=>t in e?Kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var O=(e,t,n)=>Qr(e,typeof t!="symbol"?t+"":t,n);import{C as le,a as Ft,e as xt,b as Mt}from"./BIv3uo6h.js";import{w as Xe,g as N}from"./vgD3KS5I.js";import{c as Xr,a as L,f as G}from"./fttJYjWf.js";import{a4 as Rn,f as ei,a7 as Ge,aq as Lt,a5 as ht,a6 as bn,g as A,ar as ie,c as W,r as Y,s as Ve,t as ge,aM as ti}from"./CinUWrNX.js";import{s as We}from"./CLOOnzvv.js";import{i as ce}from"./zKTDKC1X.js";import{a as jt,f as ni,k as ri,b as Te,s as ii}from"./xcxp5XA3.js";import{p as q}from"./DIRs0Bkg.js";const Re=(e,t,n)=>[t,()=>le.register(t,{jaName:n,type:"monster",frameType:e})],$=(e,t,n)=>[t,()=>le.register(t,{jaName:n,type:"spell",frameType:"spell",spellType:e})],oi=(e,t,n)=>[t,()=>le.register(t,{jaName:n,type:"trap",frameType:"trap",trapType:e})],si=new Map([Re("effect",33396948,"封印されしエクゾディア"),Re("normal",7902349,"封印されし者の右腕"),Re("normal",70903634,"封印されし者の左腕"),Re("normal",44519536,"封印されし者の左足"),Re("normal",8124921,"封印されし者の右足"),Re("effect",70791313,"王立魔法図書館"),$("normal",55144522,"強欲な壺"),$("normal",79571449,"天使の施し"),$("normal",70368879,"成金ゴブリン"),$("normal",33782437,"一時休戦"),$("normal",85852291,"打ち出の小槌"),$("normal",90928333,"闇の量産工場"),$("normal",73628505,"テラ・フォーミング"),$("normal",98494543,"魔法石の採掘"),$("normal",93946239,"無の煉獄"),$("normal",98645731,"強欲で謙虚な壺"),$("normal",59750328,"命削りの宝札"),$("normal",89997728,"トゥーンのもくじ"),$("quick-play",74519184,"手札断殺"),$("continuous",15259703,"トゥーン・ワールド"),$("field",67616300,"チキンレース"),oi("normal",83968380,"強欲な瓶")]);function Ut(e){le.clear();for(const t of e){const n=si.get(t);n&&n()}}const kn=["mainMonsterZone","spellTrapZone","fieldZone"],wn=["mainDeck","extraDeck"],ai=["hand","graveyard","banished"],ci=e=>kn.includes(e),ui=e=>wn.includes(e),li=e=>e==="hand",di=e=>e==="graveyard",fi=e=>e==="banished",ae={names:[...kn,...wn,...ai],isField:ci,isDeck:ui,isHand:li,isGraveyard:di,isBanished:fi},pi=e=>e.type==="monster",hi=e=>e.type==="spell",mi=e=>e.type==="spell"&&e.spellType==="normal",_i=e=>e.type==="spell"&&e.spellType==="quick-play",vi=e=>e.type==="spell"&&e.spellType==="field",gi=e=>e.type==="trap",Si=e=>({position:(e==null?void 0:e.position)??"faceDown",battlePosition:e==null?void 0:e.battlePosition,placedThisTurn:e==null?void 0:e.placedThisTurn,counters:[],activatedEffects:new Set}),Ci=e=>ae.isHand(e.location),yi=e=>ae.isField(e.location),Ii=e=>ae.isGraveyard(e.location),Oi=e=>ae.isBanished(e.location),Ei=e=>{var t;return((t=e.stateOnField)==null?void 0:t.position)==="faceUp"},Ti=e=>{var t;return((t=e.stateOnField)==null?void 0:t.position)==="faceDown"},Ri=e=>{var t;return((t=e.stateOnField)==null?void 0:t.battlePosition)==="attack"},bi=e=>{var t;return((t=e.stateOnField)==null?void 0:t.battlePosition)==="defense"},et=(e,t,n)=>({...e,location:t,stateOnField:n}),ki=(e,t)=>et(e,t),wi=(e,t,n,r)=>{if(!ae.isField(t))throw new Error(`Invalid location for placing on field: ${t}`);return et(e,t,Si({position:n,battlePosition:r,placedThisTurn:!0}))},Ni=(e,t)=>{if(ae.isField(t))throw new Error(`Invalid location for removing from field: ${t}`);return et(e,t,void 0)};function Ai(e,t){if(!ae.isField(e.location))throw new Error(`Card must be on the field to update state: currently in ${e.location}`);if(!e.stateOnField)throw new Error("Card has no stateOnField to update.");const n={...e.stateOnField,...t};return et(e,e.location,n)}function zi(e,t){const n=e.find(r=>r.type===t);return(n==null?void 0:n.count)??0}function Di(e,t,n){const r=e.findIndex(i=>i.type===t);if(r>=0){const i=e[r],o=Math.max(0,i.count+n);return o===0?[...e.slice(0,r),...e.slice(r+1)]:[...e.slice(0,r),{type:t,count:o},...e.slice(r+1)]}else if(n>0)return[...e,{type:t,count:n}];return e}const g={isMonster:pi,isSpell:hi,isTrap:gi,isNormalSpell:mi,isQuickPlaySpell:_i,isFieldSpell:vi,Instance:{inHand:Ci,onField:yi,inGraveyard:Ii,isBanished:Oi,isFaceUp:Ei,isFaceDown:Ti,isAttackPosition:Ri,isDefensePosition:bi,moved:ki,placedOnField:wi,leavedFromField:Ni,updatedState:Ai},Counter:{get:zi,update:Di}};function $i(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}const tt={mainMonsterZone:5,spellTrapZone:5,fieldZone:1},It=(e,t)=>e[t].length,Zi=(e,t)=>{const n=It(e,"hand");return t.location==="hand"?n-1:n},Pi=e=>It(e,"mainDeck")===0,Ot=(e,t,n)=>It(e,t)>=n,Vi=(e,t=tt.mainMonsterZone)=>Ot(e,"mainMonsterZone",t),Fi=(e,t=tt.spellTrapZone)=>Ot(e,"spellTrapZone",t),Nn=(e,t=tt.fieldZone)=>Ot(e,"fieldZone",t);function xi(e,t){for(const n of Object.keys(e)){const r=e[n].find(i=>i.instanceId===t);if(r)return r}}function nt(e,t,n,r){const i=t.location,o=e[i];if(o.findIndex(m=>m.instanceId===t.instanceId)===-1)return e;const a=ae.isField(n),u=ae.isField(i),l=a&&!u,f=!a&&u;let p;if(l){if((r==null?void 0:r.position)===void 0)throw new Error("Position must be specified when placing a card on the field.");p=g.Instance.placedOnField(t,n,r==null?void 0:r.position,r==null?void 0:r.battlePosition)}else f?p=g.Instance.leavedFromField(t,n):a&&u&&r!==void 0?p=g.Instance.updatedState(t,r):p=g.Instance.moved(t,n);if(i===n){const m=o.map(S=>S.instanceId===t.instanceId?p:S);return{...e,[i]:m}}const v=o.filter(m=>m.instanceId!==t.instanceId);return{...e,[i]:v,[n]:[...e[n],p]}}function Mi(e,t,n){return nt(e,t,t.location,n)}function Et(e,t=1){const n=e.mainDeck.length;if(n<t)throw new Error(`Cannot draw ${t} cards. Only ${n} cards remaining in main deck.`);let r=e;for(let i=0;i<t;i++){const o=r.mainDeck[r.mainDeck.length-1];r=nt(r,o,"hand")}return r}function An(e){return{...e,mainDeck:$i(e.mainDeck)}}function Li(e){return Nn(e)?nt(e,e.fieldZone[0],"graveyard"):e}const Gt=8e3;function ji(e,t,n){const r=e.mainDeckCardIds.map((a,u)=>({...t(a),instanceId:`main-${u}`,location:"mainDeck",placedThisTurn:!1,counters:[]})),i=e.extraDeckCardIds.map((a,u)=>({...t(a),instanceId:`extra-${u}`,location:"extraDeck",placedThisTurn:!1,counters:[]})),o={mainDeck:r,extraDeck:i,hand:[],mainMonsterZone:[],spellTrapZone:[],fieldZone:[],graveyard:[],banished:[]};let s=n!=null&&n.skipShuffle?o:An(o);return n!=null&&n.skipInitialDraw||(s=Et(s,5)),{space:s,lp:{player:Gt,opponent:Gt},phase:"draw",turn:1,result:{isGameOver:!1},normalSummonLimit:1,normalSummonUsed:0,activatedCardIds:new Set,queuedEndPhaseEffectIds:[]}}function Ui(e,t){const n=new Set(e);return n.add(t),n}const Le=["draw","standby","main1","end"],Gi={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ",end:"エンドフェイズ"},Bi=e=>Gi[e],zn=e=>{const t=Le.indexOf(e);return t===-1||t===Le.length-1?"end":Le[t+1]},Hi=(e,t)=>{const n=zn(e);return t!==n?{valid:!1,error:`Invalid phase transition: ${e} → ${t}. Expected: ${n}`}:{valid:!0}},Ji=e=>e==="main1",Wi=e=>e==="end",Bt=["exodia","lp0","deckout","surrender"],Ht=["player","opponent"];function Ne(e=[]){return{isConsistent:e.length===0,errors:e,and(t){return Ne([...this.errors,...t.errors])}}}const oe=(e,t,n,r)=>{const i=[];return Number.isInteger(e)||i.push(`${r} must be an integer: ${e}`),(e<t||e>n)&&i.push(`${r} is out of bounds: ${e} (Allowed: ${t} to ${n})`),i},ue=(e,t)=>{const n=e.filter(r=>r.location!==t);return n.length>0?[`${n.length} cards in ${t} have incorrect location property`]:[]};function Yi(e){const t=[];t.push(...oe(e.space.mainDeck.length,0,60,"Deck size")),t.push(...oe(e.space.extraDeck.length,0,15,"Extra Deck size")),t.push(...oe(e.space.hand.length,0,99,"Hand size")),t.push(...oe(e.space.mainMonsterZone.length,0,5,"Main Monster Zone size")),t.push(...oe(e.space.spellTrapZone.length,0,5,"Spell/Trap Zone size")),t.push(...oe(e.space.fieldZone.length,0,1,"Field Zone size"));const n=[...e.space.mainDeck,...e.space.extraDeck,...e.space.hand,...e.space.mainMonsterZone,...e.space.spellTrapZone,...e.space.fieldZone,...e.space.graveyard,...e.space.banished],r=n.map(s=>s.instanceId),i=r.filter((s,a)=>r.indexOf(s)!==a);i.length>0&&t.push(`Duplicate card instance IDs found: ${i.join(", ")}`);const o=n.filter(s=>!s.instanceId||!s.id);return o.length>0&&t.push(`Found ${o.length} card instances with missing IDs`),t.push(...ue(e.space.mainDeck,"mainDeck")),t.push(...ue(e.space.extraDeck,"extraDeck")),t.push(...ue(e.space.hand,"hand")),t.push(...ue(e.space.mainMonsterZone,"mainMonsterZone")),t.push(...ue(e.space.spellTrapZone,"spellTrapZone")),t.push(...ue(e.space.fieldZone,"fieldZone")),t.push(...ue(e.space.graveyard,"graveyard")),t.push(...ue(e.space.banished,"banished")),Ne(t)}function qi(e){const t=[];return t.push(...oe(e.lp.player,0,99999,"Player LP")),t.push(...oe(e.lp.opponent,0,99999,"Opponent LP")),Ne(t)}function Ki(e){const t=[];return Le.includes(e.phase)||t.push(`Invalid phase: ${e.phase}. Must be one of: ${Le.join(", ")}`),Ne(t)}function Qi(e){const t=[];return t.push(...oe(e.turn,1,999,"Turn")),Ne(t)}function Xi(e){const t=[];return e.result.isGameOver?(e.result.winner||t.push("Game is over but winner is not set"),e.result.winner&&![...Ht,"draw"].includes(e.result.winner)&&t.push(`Invalid winner: ${e.result.winner}. Must be one of: ${[...Ht,"draw"].join(", ")}`),e.result.reason||t.push("Game is over but reason is not set"),e.result.reason&&!Bt.includes(e.result.reason)&&t.push(`Invalid reason: ${e.result.reason}. Must be one of: ${Bt.join(", ")}`)):(e.result.winner&&t.push("Game is ongoing but winner is set"),e.result.reason&&t.push("Game is ongoing but reason is set")),Ne(t)}function eo(e){return Yi(e).and(qi(e)).and(Ki(e)).and(Qi(e)).and(Xi(e))}function to(e){const t=eo(e);if(!t.isConsistent)throw new Error(`Invalid GameState:
${t.errors.join(`
`)}`)}const no=e=>{const t=[33396948,7902349,70903634,44519536,8124921],n=e.space.hand.map(i=>i.id);return t.every(i=>n.includes(i))},ro=e=>no(e)?{isGameOver:!0,winner:"player",reason:"exodia",message:"5つのエクゾディアパーツが手札に揃いました。勝利です！"}:e.lp.player<=0?{isGameOver:!0,winner:"opponent",reason:"lp0",message:"ライフポイントが0になりました。敗北です。"}:e.lp.opponent<=0?{isGameOver:!0,winner:"player",reason:"lp0",message:"相手のライフポイントが0になりました。勝利です！"}:{isGameOver:!1},io=e=>{var t;return(t=e.result)!=null&&t.isGameOver?e:{...e,result:ro(e)}},h={initialize:ji,updatedActivatedCardIds:Ui,assert:to,checkVictory:io,Phase:{displayName:Bi,next:zn,isMain:Ji,isEnd:Wi,changeable:Hi},Space:{ZONE_CAPACITY:tt,countHandExcludingSelf:Zi,isMainDeckEmpty:Pi,isMainMonsterZoneFull:Vi,isSpellTrapZoneFull:Fi,isFieldZoneFull:Nn,findCard:xi,moveCard:nt,updateCardStateInPlace:Mi,drawCards:Et,shuffleMainDeck:An,sendExistingFieldSpellToGraveyard:Li}},oo={GAME_OVER:"GAME_OVER",NOT_MAIN_PHASE:"NOT_MAIN_PHASE",CARD_NOT_FOUND:"CARD_NOT_FOUND",CARD_NOT_IN_HAND:"CARD_NOT_IN_HAND",CARD_NOT_IN_VALID_LOCATION:"CARD_NOT_IN_VALID_LOCATION",CARD_NOT_ON_FIELD:"CARD_NOT_ON_FIELD",CARD_NOT_FACE_UP:"CARD_NOT_FACE_UP",NOT_SPELL_CARD:"NOT_SPELL_CARD",NOT_SPELL_OR_TRAP_CARD:"NOT_SPELL_OR_TRAP_CARD",NOT_MONSTER_CARD:"NOT_MONSTER_CARD",SPELL_TRAP_ZONE_FULL:"SPELL_TRAP_ZONE_FULL",MONSTER_ZONE_FULL:"MONSTER_ZONE_FULL",INSUFFICIENT_DECK:"INSUFFICIENT_DECK",INSUFFICIENT_COUNTERS:"INSUFFICIENT_COUNTERS",SUMMON_LIMIT_REACHED:"SUMMON_LIMIT_REACHED",QUICK_PLAY_RESTRICTION:"QUICK_PLAY_RESTRICTION",ACTIVATION_CONDITIONS_NOT_MET:"ACTIVATION_CONDITIONS_NOT_MET",NO_IGNITION_EFFECT:"NO_IGNITION_EFFECT",EFFECT_NOT_REGISTERED:"EFFECT_NOT_REGISTERED",PHASE_TRANSITION_NOT_ALLOWED:"PHASE_TRANSITION_NOT_ALLOWED"},so={GAME_OVER:"ゲームは終了しています",NOT_MAIN_PHASE:"メインフェイズではありません",CARD_NOT_FOUND:"カードが見つかりません",CARD_NOT_IN_HAND:"カードが手札にありません",CARD_NOT_IN_VALID_LOCATION:"カードが有効な位置にありません",CARD_NOT_ON_FIELD:"カードがフィールドにありません",CARD_NOT_FACE_UP:"カードが表側表示ではありません",NOT_SPELL_CARD:"魔法カードではありません",NOT_SPELL_OR_TRAP_CARD:"魔法または罠カードではありません",NOT_MONSTER_CARD:"モンスターカードではありません",SPELL_TRAP_ZONE_FULL:"魔法・罠ゾーンに空きがありません",MONSTER_ZONE_FULL:"モンスターゾーンに空きがありません",INSUFFICIENT_DECK:"デッキのカードが不足しています",INSUFFICIENT_COUNTERS:"カウンターが不足しています",SUMMON_LIMIT_REACHED:"召喚権がありません",QUICK_PLAY_RESTRICTION:"速攻魔法はセットしたターンに発動できません",ACTIVATION_CONDITIONS_NOT_MET:"発動条件を満たしていません",NO_IGNITION_EFFECT:"このカードには起動効果がありません",EFFECT_NOT_REGISTERED:"このカードの効果が登録されていません",PHASE_TRANSITION_NOT_ALLOWED:"フェイズ遷移が許可されていません"},ao=()=>({isValid:!0}),co=(e,t)=>({isValid:!1,errorCode:e,errorParams:t}),uo=e=>{if(e.isValid||!e.errorCode)return"";const t=so[e.errorCode];return e.errorParams,t},lo=(e,t,n)=>({success:!0,updatedState:h.checkVictory(e),message:t,emittedEvents:n}),fo=(e,t)=>({success:!1,updatedState:e,error:t});function po(){return{current:{timestamp:0,events:[]},history:[],nextTimestamp:1}}function Dn(e){return{timestamp:e,events:[]}}function ho(e,t){return{...e,current:{...e.current,events:[...e.current.events,t]}}}function mo(e){return e.current.events.length===0?e:{current:Dn(e.nextTimestamp),history:[...e.history,e.current],nextTimestamp:e.nextTimestamp+1}}function _o(e){return e.current.events.length>0}function vo(e){return e.current.events}function go(e,t){return e.current.events.some(n=>n.type===t)}function So(e){return{...e,history:[]}}const c={Validation:{ERROR_CODES:oo,success:ao,failure:co,errorMessage:uo},Result:{success:lo,failure:fo},TimeLine:{createEmptyTimeline:po,createEmptySnapshot:Dn,recordEvent:ho,advanceTime:mo,hasCurrentEvents:_o,getCurrentEvents:vo,hasEventOfType:go,clearHistory:So}},Co=(e,t,n,r,i)=>({success:!0,updatedState:h.checkVictory(e),message:t,emittedEvents:n,activationSteps:r??[],chainBlock:i}),yo=(e,t)=>({success:!1,updatedState:e,error:t,activationSteps:[]}),Q={Result:{success:Co,failure:yo}};class Io{constructor(){O(this,"description");this.description="Advance to next phase"}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);const n=h.Phase.next(t.phase);return h.Phase.changeable(t.phase,n).valid?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.PHASE_TRANSITION_NOT_ALLOWED)}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Phase.next(t.phase),i=h.Phase.isEnd(r)&&t.queuedEndPhaseEffectIds.length>0,o=h.Phase.isEnd(r)?this.resetFieldCardActivatedEffects(t.space):t.space,s={...t,space:o,phase:r,activatedCardIds:h.Phase.isEnd(r)?new Set:t.activatedCardIds,queuedEndPhaseEffectIds:i?[]:t.queuedEndPhaseEffectIds};return Q.Result.success(s,`Advanced to ${h.Phase.displayName(r)}`)}getNextPhase(t){return h.Phase.next(t.phase)}resetFieldCardActivatedEffects(t){const n=r=>{if(!r.stateOnField||r.stateOnField.activatedEffects.size===0)return r;const i={...r.stateOnField,activatedEffects:new Set};return{...r,stateOnField:i}};return{...t,mainMonsterZone:t.mainMonsterZone.map(n),spellTrapZone:t.spellTrapZone.map(n),fieldZone:t.fieldZone.map(n)}}}function $n(e){return h.Phase.isMain(e.phase)?h.Space.isMainMonsterZoneFull(e.space)?c.Validation.failure(c.Validation.ERROR_CODES.MONSTER_ZONE_FULL):e.normalSummonUsed>=e.normalSummonLimit?c.Validation.failure(c.Validation.ERROR_CODES.SUMMON_LIMIT_REACHED):c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE)}function Zn(e,t,n){const r=h.Space.findCard(e.space,t),i=h.Space.moveCard(e.space,r,"mainMonsterZone",{position:n==="attack"?"faceUp":"faceDown",battlePosition:n});return{...e,space:i,normalSummonUsed:e.normalSummonUsed+1}}class Jt{constructor(t){O(this,"description");this.cardInstanceId=t,this.description=`Summon monster ${t}`}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);const n=$n(t);if(!n.isValid)return n;const r=h.Space.findCard(t.space,this.cardInstanceId);return r?g.isMonster(r)?g.Instance.inHand(r)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_IN_HAND):c.Validation.failure(c.Validation.ERROR_CODES.NOT_MONSTER_CARD):c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FOUND)}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Space.findCard(t.space,this.cardInstanceId),i=Zn(t,this.cardInstanceId,"attack");return Q.Result.success(i,`Monster summoned: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class Wt{constructor(t){O(this,"description");this.cardInstanceId=t,this.description=`Set monster ${t}`}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);const n=$n(t);if(!n.isValid)return n;const r=h.Space.findCard(t.space,this.cardInstanceId);return r?g.isMonster(r)?g.Instance.inHand(r)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_IN_HAND):c.Validation.failure(c.Validation.ERROR_CODES.NOT_MONSTER_CARD):c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FOUND)}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Space.findCard(t.space,this.cardInstanceId),i=Zn(t,this.cardInstanceId,"defense");return Q.Result.success(i,`Monster set: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class Yt{constructor(t){O(this,"description");this.cardInstanceId=t,this.description=`Set spell/trap ${t}`}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);if(!h.Phase.isMain(t.phase))return c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE);const n=h.Space.findCard(t.space,this.cardInstanceId);return n?!g.isSpell(n)&&!g.isTrap(n)?c.Validation.failure(c.Validation.ERROR_CODES.NOT_SPELL_OR_TRAP_CARD):g.Instance.inHand(n)?!g.isFieldSpell(n)&&h.Space.isSpellTrapZoneFull(t.space)?c.Validation.failure(c.Validation.ERROR_CODES.SPELL_TRAP_ZONE_FULL):c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_IN_HAND):c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FOUND)}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Space.findCard(t.space,this.cardInstanceId),i={...t,space:this.moveSetSpellTrapCard(t.space,r)};return Q.Result.success(i,`Card set: ${r.jaName}`)}moveSetSpellTrapCard(t,n){if(g.isFieldSpell(n)){const r=h.Space.sendExistingFieldSpellToGraveyard(t);return h.Space.moveCard(r,n,"fieldZone",{position:"faceDown"})}return h.Space.moveCard(t,n,"spellTrapZone",{position:"faceDown"})}getCardInstanceId(){return this.cardInstanceId}}function Pn(e,t){if(g.Instance.inHand(t)){if(g.isFieldSpell(t)){const n=h.Space.sendExistingFieldSpellToGraveyard(e);return h.Space.moveCard(n,t,"fieldZone",{position:"faceUp"})}if(g.isSpell(t)||g.isTrap(t))return h.Space.moveCard(e,t,"spellTrapZone",{position:"faceUp"});throw new Error("Invalid card type for activation")}return h.Space.updateCardStateInPlace(e,t,{position:"faceUp"})}class ee{static registerActivation(t,n){const r=this.getOrCreateEntry(t);r.activation=n}static registerIgnition(t,n){this.getOrCreateEntry(t).ignitionEffects.push(n)}static getActivation(t){var n;return(n=this.effects.get(t))==null?void 0:n.activation}static getIgnitionEffects(t){var n;return((n=this.effects.get(t))==null?void 0:n.ignitionEffects)??[]}static hasIgnitionEffects(t){const n=this.effects.get(t);return n!==void 0&&n.ignitionEffects.length>0}static collectChainableActions(t,n,r=new Set){const i=[];for(const o of t.space.hand)r.has(o.instanceId)||(this.collectActivation(i,o,t,n),this.collectEffects(i,o,t,n));for(const o of t.space.mainMonsterZone)r.has(o.instanceId)||g.Instance.isFaceUp(o)&&this.collectEffects(i,o,t,n);for(const o of t.space.spellTrapZone)r.has(o.instanceId)||(g.Instance.isFaceDown(o)?this.collectActivation(i,o,t,n):this.collectEffects(i,o,t,n));for(const o of t.space.fieldZone)r.has(o.instanceId)||g.Instance.isFaceUp(o)&&this.collectEffects(i,o,t,n);for(const o of t.space.graveyard)r.has(o.instanceId)||this.collectEffects(i,o,t,n);for(const o of t.space.banished)r.has(o.instanceId)||this.collectEffects(i,o,t,n);return i}static collectActivation(t,n,r,i){const o=this.getActivation(n.id);o&&this.tryAddAction(t,n,o,r,i)}static collectEffects(t,n,r,i){for(const o of this.getIgnitionEffects(n.id))this.tryAddAction(t,n,o,r,i)}static tryAddAction(t,n,r,i,o){if(r.spellSpeed<o)return;r.canActivate(i,n).isValid&&t.push({instance:n,action:r})}static clear(){this.effects.clear()}static getRegisteredCardIds(){return Array.from(this.effects.keys())}static getOrCreateEntry(t){let n=this.effects.get(t);return n||(n={ignitionEffects:[]},this.effects.set(t,n)),n}}O(ee,"effects",new Map);function Oo(e,t,n){return n!==void 0?`${e}-${t}-${n}`:`${e}-${t}`}const Vn={Id:{create:Oo}},Fn=e=>{const t=le.getCardNameWithBrackets(e);return{id:`${e}-activation-notification`,summary:"カード発動",description:`${t}を発動します`,notificationLevel:"info",action:n=>c.Result.success(n,`${t} activated`)}},xn=e=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:e.availableCards,_sourceZone:e._sourceZone,_filter:e._filter,minCards:e.minCards,maxCards:e.maxCards,summary:e.summary,description:e.description,cancelable:e.cancelable??!1},action:(t,n)=>!n||n.length===0?e.onSelect(t,[]):e.onSelect(t,n)});function Eo(e){return{id:`emit-spell-activated-${e.instanceId}`,summary:"魔法発動イベント",description:"魔法カード発動をトリガーシステムに通知",notificationLevel:"silent",action:t=>c.Result.success(t,void 0,[{type:"spellActivated",sourceCardId:e.id,sourceInstanceId:e.instanceId}])}}class rt{constructor(t){O(this,"cardId");O(this,"effectId");O(this,"effectCategory","activation");this.cardId=t,this.effectId=Vn.Id.create("activation",t)}canActivate(t,n){const r=this.subTypeConditions(t,n);if(!r.isValid)return r;const i=this.individualConditions(t,n);return i.isValid?c.Validation.success():i}createActivationSteps(t,n){return[Fn(this.cardId),Eo(n),...this.subTypePreActivationSteps(t,n),...this.individualActivationSteps(t,n),...this.subTypePostActivationSteps(t,n)]}createResolutionSteps(t,n){return[...this.subTypePreResolutionSteps(t,n),...this.individualResolutionSteps(t,n),...this.subTypePostResolutionSteps(t,n)]}}function To(e,t){return{id:(t==null?void 0:t.id)??`queue-end-phase-effect-${e.id}`,summary:(t==null?void 0:t.summary)??"エンドフェイズ効果を登録",description:(t==null?void 0:t.description)??"エンドフェイズに処理される効果を登録します",notificationLevel:"silent",action:n=>{const r={...n,queuedEndPhaseEffectIds:[...n.queuedEndPhaseEffectIds,e.id]};return c.Result.success(r,`Added end phase effect: ${e.summary}`)}}}const Mn=(e,t)=>({id:`send-${e}-to-graveyard`,summary:"墓地へ送る",description:`《${t}》を墓地に送ります`,notificationLevel:"info",action:n=>{const r=h.Space.findCard(n.space,e),i={...n,space:h.Space.moveCard(n.space,r,"graveyard")};return c.Result.success(i,`Sent ${t} to graveyard`)}}),Ln=(e,t)=>{let n=e.space;for(const i of t){const o=h.Space.findCard(n,i);n=h.Space.moveCard(n,o,"graveyard")}const r={...e,space:n};return c.Result.success(r,`Sent ${t.length} card${t.length>1?"s":""} to graveyard`)},Ro=e=>{const t=[...e.space.hand];if(t.length===0)return c.Result.success(e,"No cards in hand to discard");const n=t.map(r=>r.instanceId);return Ln(e,n)},bo=()=>({id:"discard-all-hand",summary:"手札を全て捨てる",description:"手札を全て捨てます",notificationLevel:"info",action:e=>Ro(e)}),jn=()=>To(bo(),{id:"end-phase-discard-all-hand",summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます"}),Tt=(e,t)=>xn({id:`select-and-discard-${e}-cards`,summary:`手札を${e}枚捨てる`,description:`手札から${e}枚選んで捨てます`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:e,maxCards:e,cancelable:!1,onSelect:(n,r)=>r.length!==e?c.Result.failure(n,`Must select exactly ${e} cards to discard`):Ln(n,r)});class B extends rt{constructor(){super(...arguments);O(this,"spellSpeed",1)}subTypeConditions(n,r){return h.Phase.isMain(n.phase)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE)}subTypePreActivationSteps(n,r){return[]}subTypePostActivationSteps(n){return[]}subTypePreResolutionSteps(n,r){return[]}subTypePostResolutionSteps(n,r){return[Mn(r.instanceId,r.jaName)]}static createNoOp(n){return new ko(n)}}class ko extends B{constructor(t){super(t)}individualConditions(){return c.Validation.success()}individualActivationSteps(){return[]}individualResolutionSteps(){return[]}}const Un=(e,t)=>({id:t.id,summary:t.summary,description:t.description,notificationLevel:"info",action:n=>{const{drawCount:r,message:i}=e(n);if(r===0)return c.Result.success(n,i);if(n.space.mainDeck.length<r)return c.Result.failure(n,`Insufficient deck: needed ${r}, but only ${n.space.mainDeck.length} remaining.`);const o={...n,space:Et(n.space,r)};return c.Result.success(o,`${i} (${r} card${r>1?"s":""})`)}}),de=e=>Un(()=>({drawCount:e,message:`Draw ${e} card(s)`}),{id:`draw-${e}`,summary:"カードをドロー",description:`デッキから${e}枚ドローします`}),wo=e=>Un(t=>{const n=Math.max(0,e-t.space.hand.length);return{drawCount:n,message:n===0?`Hand already has ${e} or more cards`:`Filled hand to ${e}`}},{id:`fill-hands-${e}`,summary:`手札が${e}枚になるまでドロー`,description:`手札が${e}枚になるまでドローします`});class No extends B{constructor(){super(55144522)}individualConditions(t,n){return t.space.mainDeck.length<2?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[de(2)]}}class Ao extends B{constructor(){super(79571449)}individualConditions(t,n){return t.space.mainDeck.length<3?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[de(3),Tt(2)]}}const Gn=(e,t,n)=>{const r=n==="player",i=r?"プレイヤー":"相手",o=r?"Player":"Opponent",s=e==="gain"?1:-1,a={gain:{id:"gain-lp",action:"増加",msg:"gained"},damage:{id:"damage",action:"ダメージ",msg:"took"},payment:{id:"pay-lp",action:"支払い",msg:"paid"},loss:{id:"loss-lp",action:"喪失",msg:"lost"}}[e];return{id:`${a.id}-${n}-${t}`,summary:`${i}のLP${a.action}`,description:`${i}に${t}の${a.action}が発生します`,notificationLevel:"info",action:u=>{const l={...u,lp:{...u.lp,[n]:u.lp[n]+t*s}};return c.Result.success(l,`${o} ${a.msg} ${t} LP`)}}},zo=(e,t)=>Gn("gain",e,t),Bn=(e,t)=>Gn("payment",e,t);class Do extends B{constructor(){super(70368879)}individualConditions(t,n){return t.space.mainDeck.length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[de(1),zo(1e3,"opponent")]}}class Hn extends rt{constructor(){super(...arguments);O(this,"spellSpeed",1)}subTypeConditions(n,r){return h.Phase.isMain(n.phase)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE)}subTypePreActivationSteps(n,r){return[]}subTypePostActivationSteps(n,r){return[]}subTypePreResolutionSteps(n,r){return[]}subTypePostResolutionSteps(n,r){return[]}static createNoOp(n){return new $o(n)}}class $o extends Hn{constructor(t){super(t)}individualConditions(){return c.Validation.success()}individualActivationSteps(){return[]}individualResolutionSteps(){return[]}}class Zo extends B{constructor(){super(33782437)}individualConditions(t,n){return t.space.mainDeck.length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[de(1),{id:"one-day-of-peace-damage-negation",summary:"ダメージ無効化",description:"このターン、全てのダメージは0になります",notificationLevel:"info",action:r=>({success:!0,updatedState:{...r},message:"Damage negation activated for this turn"})}]}}const Po=e=>xn({id:"select-and-return-to-deck",summary:"手札をデッキに戻す",description:`デッキに戻すカードを選択してください（${e.min}〜${e.max??100}枚）`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:e.min,maxCards:e.max??100,cancelable:!1,onSelect:(t,n)=>{if(n.length===0)return c.Result.success(t,"No cards selected");let r=t.space;for(const o of n){const s=h.Space.findCard(r,o);r=h.Space.moveCard(r,s,"mainDeck")}r=h.Space.shuffleMainDeck(r),r=h.Space.drawCards(r,n.length);const i={...t,space:r};return c.Result.success(i,`${n.length}枚をデッキに戻し、シャッフルして${n.length}枚ドローしました`)}});class Vo extends B{constructor(){super(85852291)}individualConditions(t,n){return c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[Po({min:0})]}}class Jn extends rt{constructor(){super(...arguments);O(this,"spellSpeed",2)}subTypeConditions(n,r){var i;return g.Instance.isFaceDown(r)&&((i=r.stateOnField)!=null&&i.placedThisTurn)?c.Validation.failure(c.Validation.ERROR_CODES.QUICK_PLAY_RESTRICTION):c.Validation.success()}subTypePreActivationSteps(n,r){return[]}subTypePostActivationSteps(n,r){return[]}subTypePreResolutionSteps(n,r){return[]}subTypePostResolutionSteps(n,r){return[Mn(r.instanceId,r.jaName)]}static createNoOp(n){return new Fo(n)}}class Fo extends Jn{constructor(t){super(t)}individualConditions(){return c.Validation.success()}individualActivationSteps(){return[]}individualResolutionSteps(){return[]}}class xo extends Jn{constructor(){super(74519184)}individualConditions(t,n){return h.Space.countHandExcludingSelf(t.space,n)<2||t.space.mainDeck.length<2?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[Tt(2),de(2)]}}const Wn=(e,t,n)=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:e.minCards,maxCards:e.maxCards,summary:e.summary,description:e.description,cancelable:e.cancelable??!1,_sourceZone:t,_filter:e.filter},action:(r,i)=>{if((t==="graveyard"?r.space.graveyard.filter(e.filter):r.space.mainDeck.filter((l,f)=>e.filter(l,f))).length===0)return c.Result.failure(r,`No cards available in ${t} matching the criteria`);if(!i||i.length===0)return c.Result.failure(r,"No cards selected");let s=r.space;for(const l of i){const f=h.Space.findCard(s,l);s=h.Space.moveCard(s,f,"hand")}n&&(s=h.Space.shuffleMainDeck(s));const a={...r,space:s},u=n?" and shuffled":"";return c.Result.success(a,`Added ${i.length} card${i.length>1?"s":""} from ${t} to hand${u}`)}}),Yn=e=>Wn(e,"graveyard",!1),qn=e=>Wn(e,"mainDeck",!0),Mo=e=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:e.minCards,maxCards:e.maxCards,summary:e.summary,description:e.description,cancelable:e.cancelable??!1,_sourceZone:"mainDeck",_filter:(t,n)=>n!==void 0&&n<e.count},action:(t,n)=>{const r=t.space.mainDeck.slice(0,e.count);if(r.length<e.count)return c.Result.failure(t,`Cannot excavate ${e.count} cards. Deck has only ${r.length} cards.`);if(!n||n.length===0)return c.Result.failure(t,"No cards selected");let i=t.space;for(const s of n){const a=h.Space.findCard(i,s);i=h.Space.moveCard(i,a,"hand")}const o={...t,space:i};return c.Result.success(o,`Added ${n.length} card${n.length>1?"s":""} from deck to hand`)}});class Lo extends B{constructor(){super(90928333)}individualConditions(t,n){return t.space.graveyard.filter(i=>i.type==="monster"&&i.frameType==="normal").length<2?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[Yn({id:`dark-factory-search-${n.instanceId}`,summary:"通常モンスター2枚をサルベージ",description:"墓地から通常モンスター2枚を選択し、手札に加えます",filter:r=>r.type==="monster"&&r.frameType==="normal",minCards:2,maxCards:2,cancelable:!1})]}}class jo extends B{constructor(){super(73628505)}individualConditions(t,n){return t.space.mainDeck.filter(i=>i.type==="spell"&&i.spellType==="field").length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[qn({id:`terraforming-search-${n.instanceId}`,summary:"フィールド魔法1枚をサーチ",description:"デッキからフィールド魔法1枚を選択し、手札に加えます",filter:r=>r.type==="spell"&&r.spellType==="field",minCards:1,maxCards:1,cancelable:!1})]}}class Uo extends B{constructor(){super(98494543)}individualConditions(t,n){return h.Space.countHandExcludingSelf(t.space,n)<2||t.space.graveyard.filter(i=>i.type==="spell").length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[Tt(2)]}individualResolutionSteps(t,n){return[Yn({id:`magical-stone-excavation-search-${n.instanceId}`,summary:"魔法カード1枚をサルベージ",description:"墓地から魔法カード1枚を選択し、手札に加えます",filter:r=>r.type==="spell",minCards:1,maxCards:1,cancelable:!1})]}}class Go extends B{constructor(){super(93946239)}individualConditions(t,n){return t.space.hand.length<3||t.space.mainDeck.length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[de(1),jn()]}}const Bo=()=>({id:"shuffle-deck",summary:"デッキシャッフル",description:"デッキをシャッフルします",notificationLevel:"info",action:e=>{const t={...e,space:h.Space.shuffleMainDeck(e.space)};return c.Result.success(t,"Deck shuffled")}});class Ho extends B{constructor(){super(98645731)}individualConditions(t,n){return t.activatedCardIds.has(this.cardId)||t.space.mainDeck.length<3?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[Mo({id:`pot-of-duality-search-${n.instanceId}`,summary:"デッキトップ3枚から1枚をサーチ",description:"デッキトップ3枚から1枚を選択し、手札に加えます",count:3,minCards:1,maxCards:1,cancelable:!1}),Bo()]}}class Jo extends B{constructor(){super(59750328)}individualConditions(t,n){return t.activatedCardIds.has(this.cardId)?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[wo(3),jn()]}}class Wo extends B{constructor(){super(89997728)}individualConditions(t,n){return t.space.mainDeck.filter(i=>i.jaName.includes("トゥーン")).length<1?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[]}individualResolutionSteps(t,n){return[qn({id:`toon-table-search-${n.instanceId}`,summary:"「トゥーン」カード1枚をサーチ",description:"デッキから「トゥーン」カード1枚を選択し、手札に加えます",filter:r=>r.jaName.includes("トゥーン"),minCards:1,maxCards:1,cancelable:!1})]}}class Kn extends rt{constructor(){super(...arguments);O(this,"spellSpeed",1)}subTypeConditions(n,r){return h.Phase.isMain(n.phase)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE)}subTypePreActivationSteps(n,r){return[]}subTypePostActivationSteps(n,r){return[]}subTypePreResolutionSteps(n,r){return[]}subTypePostResolutionSteps(n,r){return[]}static createNoOp(n){return new Yo(n)}}class Yo extends Kn{constructor(t){super(t)}individualConditions(){return c.Validation.success()}individualActivationSteps(){return[]}individualResolutionSteps(){return[]}}class qo extends Kn{constructor(){super(15259703)}individualConditions(t,n){return t.lp.player<1e3?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[Bn(1e3,"player")]}individualResolutionSteps(t,n){return[]}}class Qn{constructor(t,n){O(this,"cardId");O(this,"effectId");O(this,"effectCategory","ignition");O(this,"spellSpeed",1);this.cardId=t,this.effectId=Vn.Id.create("ignition",t,n)}canActivate(t,n){if(!h.Phase.isMain(t.phase))return c.Validation.failure(c.Validation.ERROR_CODES.NOT_MAIN_PHASE);const r=this.individualConditions(t,n);return r.isValid?c.Validation.success():r}createActivationSteps(t,n){return[Fn(n.id),...this.individualActivationSteps(t,n)]}createResolutionSteps(t,n){return[...this.individualResolutionSteps(t,n)]}}class Ko extends Qn{constructor(){super(67616300,1)}individualConditions(t,n){var r,i;return t.lp.player<=1e3||(i=(r=n.stateOnField)==null?void 0:r.activatedEffects)!=null&&i.has(this.effectId)?c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET):c.Validation.success()}individualActivationSteps(t,n){return[Bn(1e3,"player")]}individualResolutionSteps(t,n){return[de(1)]}}const Qo=(e,t,n,r)=>({id:`add-counter-${t}-${n}-${e}`,summary:"カウンターを置く",description:`魔力カウンターを${n}つ置きます`,notificationLevel:"silent",action:i=>{const o=h.Space.findCard(i.space,e);if(!o||!o.stateOnField)return c.Result.success(i,"カードが見つかりません");const s=o.stateOnField.counters,a=g.Counter.get(s,t);if(a>=r)return c.Result.success(i,"カウンターは既に最大数です");const u=Math.min(n,r-a),l=g.Counter.update(s,t,u),f={...o.stateOnField,counters:l},p=h.Space.updateCardStateInPlace(i.space,o,f);return c.Result.success({...i,space:p},`魔力カウンターを${u}つ置きました`)}}),Xo=(e,t,n)=>({id:`remove-counter-${t}-${n}-${e}`,summary:"カウンターを取り除く",description:`魔力カウンターを${n}つ取り除きます`,notificationLevel:"info",action:r=>{const i=h.Space.findCard(r.space,e);if(!i||!i.stateOnField)return c.Result.failure(r,`Target card not found: ${e}`);const o=i.stateOnField.counters,s=g.Counter.get(o,t);if(s<n)return c.Result.failure(r,`Insufficient counters: needed ${n}, but only ${s} available.`);const a=g.Counter.update(o,t,-n),u={...i.stateOnField,counters:a},l=h.Space.updateCardStateInPlace(r.space,i,u);return c.Result.success({...r,space:l},`Removed ${n} ${t} counter(s) from card.`)}}),qt=3;class es extends Qn{constructor(){super(70791313,1)}individualConditions(t,n){var o;const r=((o=n.stateOnField)==null?void 0:o.counters)??[];return g.Counter.get(r,"spell")<qt?c.Validation.failure(c.Validation.ERROR_CODES.INSUFFICIENT_COUNTERS):c.Validation.success()}individualActivationSteps(t,n){return[Xo(n.instanceId,"spell",qt)]}individualResolutionSteps(t,n){return[de(1)]}}const M=(e,t)=>[e,()=>ee.registerActivation(e,t)],ts=(e,t)=>[e,()=>ee.registerIgnition(e,t)],ns=(e,t)=>[e,()=>{ee.registerActivation(e,Hn.createNoOp(e)),ee.registerIgnition(e,t)}],rs=new Map([M(55144522,new No),M(79571449,new Ao),ns(67616300,new Ko),M(70368879,new Do),M(33782437,new Zo),M(85852291,new Vo),M(74519184,new xo),M(90928333,new Lo),M(73628505,new jo),M(98494543,new Uo),M(93946239,new Go),M(98645731,new Ho),M(59750328,new Jo),M(89997728,new Wo),M(15259703,new qo),ts(70791313,new es)]);function is(e){ee.clear();for(const t of e){const n=rs.get(t);n&&n()}}class Kt{constructor(t){O(this,"description");this.cardInstanceId=t,this.description=`Activate spell card ${t}`}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);const n=h.Space.findCard(t.space,this.cardInstanceId);if(!n)return c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FOUND);if(!g.isSpell(n))return c.Validation.failure(c.Validation.ERROR_CODES.NOT_SPELL_CARD);if(!g.Instance.inHand(n)&&!(g.Instance.onField(n)&&g.Instance.isFaceDown(n)))return c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_IN_VALID_LOCATION);if(!g.isFieldSpell(n)&&h.Space.isSpellTrapZoneFull(t.space))return c.Validation.failure(c.Validation.ERROR_CODES.SPELL_TRAP_ZONE_FULL);const r=ee.getActivation(n.id);if(!r)return c.Validation.failure(c.Validation.ERROR_CODES.EFFECT_NOT_REGISTERED);const i=r.canActivate(t,n);return i.isValid?c.Validation.success():i}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Space.findCard(t.space,this.cardInstanceId),i={...t,space:Pn(t.space,r),activatedCardIds:h.updatedActivatedCardIds(t.activatedCardIds,r.id)},o=ee.getActivation(r.id),s=(o==null?void 0:o.createActivationSteps(i,r))??[],a=(o==null?void 0:o.createResolutionSteps(i,r))??[],u=o?{effectId:o.effectId,sourceInstanceId:r.instanceId,sourceCardId:r.id,spellSpeed:o.spellSpeed,resolutionSteps:a,isNegated:!1}:void 0;return Q.Result.success(i,`Spell card activated: ${this.cardInstanceId}`,[],s,u)}getCardInstanceId(){return this.cardInstanceId}}class Qt{constructor(t){O(this,"description");this.cardInstanceId=t,this.description=`Activate ignition effect of ${t}`}canExecute(t){if(t.result.isGameOver)return c.Validation.failure(c.Validation.ERROR_CODES.GAME_OVER);const n=h.Space.findCard(t.space,this.cardInstanceId);if(!n)return c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FOUND);if(!["fieldZone","spellTrapZone","mainMonsterZone"].includes(n.location))return c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_ON_FIELD);if(!g.Instance.isFaceUp(n))return c.Validation.failure(c.Validation.ERROR_CODES.CARD_NOT_FACE_UP);const i=ee.getIgnitionEffects(n.id);return i.length===0?c.Validation.failure(c.Validation.ERROR_CODES.NO_IGNITION_EFFECT):this.findActivatableEffect(i,t,n)?c.Validation.success():c.Validation.failure(c.Validation.ERROR_CODES.ACTIVATION_CONDITIONS_NOT_MET)}findActivatableEffect(t,n,r){return t.find(i=>i.canActivate(n,r).isValid)}execute(t){const n=this.canExecute(t);if(!n.isValid)return Q.Result.failure(t,c.Validation.errorMessage(n));const r=h.Space.findCard(t.space,this.cardInstanceId),i=ee.getIgnitionEffects(r.id),o=this.findActivatableEffect(i,t,r),s=r.stateOnField,a=new Set(s.activatedEffects);a.add(o.effectId);const u={...t,space:h.Space.updateCardStateInPlace(t.space,r,{activatedEffects:a})},l=o.createActivationSteps(u,r),f=o.createResolutionSteps(u,r),p={effectId:o.effectId,sourceInstanceId:r.instanceId,sourceCardId:r.id,spellSpeed:o.spellSpeed,resolutionSteps:f,isNegated:!1};return Q.Result.success(u,`Ignition effect activated: ${this.cardInstanceId}`,[],l,p)}getCardInstanceId(){return this.cardInstanceId}}class it{static register(t,n){const r=this.rules.get(t)||[];this.rules.set(t,[...r,n])}static get(t){return this.rules.get(t)||[]}static getByCategory(t,n){return this.get(t).filter(i=>i.category===n)}static collectActiveRules(t,n){const r=[],i=[...t.space.spellTrapZone,...t.space.fieldZone];for(const o of i){if(!g.Instance.isFaceUp(o))continue;const s=this.getByCategory(o.id,n);for(const a of s)a.canApply(t)&&r.push(a)}return r}static collectTriggerRules(t,n){var o;const r=[],i=[...t.space.mainMonsterZone,...t.space.spellTrapZone,...t.space.fieldZone];for(const s of i){if(!g.Instance.isFaceUp(s))continue;const a=this.getByCategory(s.id,"TriggerRule");for(const u of a)(o=u.triggers)!=null&&o.includes(n)&&r.push({rule:u,sourceInstance:s})}return r}static collectTriggerSteps(t,n){const r=this.collectTriggerRules(t,n),i=[];for(const{rule:o,sourceInstance:s}of r)if(o.canApply(t)&&o.createTriggerSteps){const a=o.createTriggerSteps(t,s);i.push(...a)}return i}static clear(){this.rules.clear()}static getRegisteredCardIds(){return Array.from(this.rules.keys())}}O(it,"rules",new Map);class os{constructor(){O(this,"isEffect",!0);O(this,"category","ActionPermission")}canApply(t){return t.space.fieldZone.some(n=>n.id===67616300&&g.Instance.isFaceUp(n))}checkPermission(t){return!1}}const ss=70791313,as=3;class cs{constructor(){O(this,"isEffect",!0);O(this,"category","TriggerRule");O(this,"triggers",["spellActivated"])}canApply(t){return t.space.mainMonsterZone.some(r=>r.id===ss&&g.Instance.isFaceUp(r))}createTriggerSteps(t,n){return[Qo(n.instanceId,"spell",1,as)]}}const Xt=(e,t)=>[e,()=>it.register(e,t)],us=new Map([Xt(67616300,new os),Xt(70791313,new cs)]);function ls(e){it.clear();for(const t of e){const n=us.get(t);n&&n()}}function Xn(){return h.initialize({mainDeckCardIds:[],extraDeckCardIds:[]},le.getCard,{skipShuffle:!0,skipInitialDraw:!0})}const se=Xe(Xn());function ds(e){const t=[];e.mainDeck.forEach(r=>{for(let i=0;i<r.quantity;i++)t.push(r.id)});const n=[];return e.extraDeck.forEach(r=>{for(let i=0;i<r.quantity;i++)n.push(r.id)}),{mainDeckCardIds:t,extraDeckCardIds:n}}function fs(e){const t=ds(e);se.set(h.initialize(t,le.getCard))}function Fe(){let e=Xn();return se.subscribe(n=>{e=n})(),e}const ps="then-marker";function hs(e){return e.id===ps}function en(){return{isBuilding:!1,stack:[],currentChainNumber:0,lastSpellSpeed:null}}function ms(){const{subscribe:e,update:t,set:n}=Xe(en()),r={subscribe:e,startChain:()=>{t(i=>({...i,isBuilding:!0,currentChainNumber:1}))},pushChainBlock:i=>{t(o=>{const s={...i,chainNumber:o.currentChainNumber};return{...o,stack:[...o.stack,s],currentChainNumber:o.currentChainNumber+1,lastSpellSpeed:i.spellSpeed}})},endChainBuilding:()=>{t(i=>({...i,isBuilding:!1}))},popChainBlock:()=>{const i=N(r);if(i.stack.length===0)return;const o=i.stack[i.stack.length-1];return t(s=>({...s,stack:s.stack.slice(0,-1)})),o},canChain:i=>{const o=N(r);return o.isBuilding?i>=(o.lastSpellSpeed??1):i>=1},isEmpty:()=>N(r).stack.length===0,isBuilding:()=>N(r).isBuilding,getStackSize:()=>N(r).stack.length,getState:()=>N(r),getStackedInstanceIds:()=>{const i=N(r);return new Set(i.stack.map(o=>o.sourceInstanceId))},getRequiredSpellSpeed:()=>{const i=N(r);return i.stack.length===0?1:Math.max(2,i.lastSpellSpeed??2)},reset:()=>{n(en())}};return r}const K=ms();function ot(e,t,n){const r=e.action(t,n);return r.success?(se.set(r.updatedState),{updatedState:r.updatedState,emittedEvents:r.emittedEvents||[]}):{updatedState:t,emittedEvents:[]}}function _s(e,t,n,r){const i=[];for(const o of e){const s=it.collectTriggerSteps(t,o.type);i.push(...s)}return i.length===0?n:[...n.slice(0,r+1),...i,...n.slice(r+1)]}function tn(e,t){const n=e.currentIndex+1;return n<e.steps.length?(t(r=>({...r,currentIndex:n,currentStep:r.steps[n]})),!0):(gt(t),!1)}function gt(e){if(e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1})),K.isEmpty())K.reset();else if(K.isBuilding()){const t=N(se),n=K.getRequiredSpellSpeed(),r=K.getStackedInstanceIds(),i=ee.collectChainableActions(t,n,r);if(i.length>0){e(o=>({...o,chainConfirmationConfig:{chainableCards:i,onActivate:s=>{const a=i.find(u=>u.instance.instanceId===s);a&&P.activateChain(a.instance,a.action)},onPass:()=>{e(s=>({...s,chainConfirmationConfig:null})),P.resolveChain()}}}));return}setTimeout(()=>{P.resolveChain()},0)}else setTimeout(()=>{P.continueChainResolution()},0)}const vs=async(e,t)=>({shouldContinue:!0,emittedEvents:ot(e,t).emittedEvents}),gs=async(e,t,n)=>{const r=ot(e,t);return n.notification&&n.notification.showInfo(e.summary,e.description),{shouldContinue:!0,delay:300,emittedEvents:r.emittedEvents}},Ss=async(e,t,n,r)=>{const i=e.cardSelectionConfig;let o;if(i.availableCards!==null)o=i.availableCards;else{if(!i._sourceZone)return console.error("_sourceZone must be specified when availableCards is null"),{shouldContinue:!1};const a=t.space[i._sourceZone];o=i._filter?a.filter((u,l)=>i._filter(u,l)):a}let s=[];return await new Promise(a=>{r(u=>({...u,cardSelectionConfig:{availableCards:o,minCards:i.minCards,maxCards:i.maxCards,summary:i.summary,description:i.description,cancelable:i.cancelable,onConfirm:l=>{s=ot(e,t,l).emittedEvents,r(p=>({...p,cardSelectionConfig:null})),a()},onCancel:()=>{r(l=>({...l,cardSelectionConfig:null})),a()}}}))}),{shouldContinue:!0,emittedEvents:s}},Cs=async(e,t,n,r)=>{let i=[];return await new Promise(o=>{r(s=>({...s,confirmationConfig:{summary:e.summary,description:e.description,onConfirm:()=>{i=ot(e,t).emittedEvents,r(u=>({...u,confirmationConfig:null})),o()}}}))}),{shouldContinue:!0,emittedEvents:i}};function ys(e){const t=e.notificationLevel||"info";return t==="silent"?vs:t==="info"?gs:e.cardSelectionConfig?Ss:Cs}function Is(){const{subscribe:e,update:t}=Xe({isActive:!1,currentStep:null,steps:[],currentIndex:-1,notificationHandler:null,confirmationConfig:null,cardSelectionConfig:null,chainConfirmationConfig:null,eventTimeline:c.TimeLine.createEmptyTimeline()});return{subscribe:e,registerNotificationHandler:n=>{t(r=>({...r,notificationHandler:n}))},startProcessing:n=>{t(i=>({...i,isActive:!0,steps:n,currentIndex:0,currentStep:n[0]||null}));const r=n[0];if(r){const i=r.notificationLevel||"info";(i==="info"||i==="silent")&&P.confirmCurrentStep()}},confirmCurrentStep:async()=>{let n=N(P);if(!n.currentStep)return;if(hs(n.currentStep)){t(a=>({...a,eventTimeline:c.TimeLine.advanceTime(a.eventTimeline)})),tn(n,t)&&P.confirmCurrentStep();return}const r=N(se),o=await ys(n.currentStep)(n.currentStep,r,{notification:n.notificationHandler},t);if(o.emittedEvents&&o.emittedEvents.length>0){let s=n.eventTimeline;for(const l of o.emittedEvents)s=c.TimeLine.recordEvent(s,l);const a=N(se),u=_s(o.emittedEvents,a,n.steps,n.currentIndex);t(l=>({...l,steps:u,eventTimeline:s})),n=N(P)}o.delay&&await new Promise(s=>setTimeout(s,o.delay)),o.shouldContinue?tn(n,t)&&P.confirmCurrentStep():gt(t)},activateChain:(n,r)=>{t(u=>({...u,chainConfirmationConfig:null}));const i=N(se),o={...i,space:Pn(i.space,n),activatedCardIds:h.updatedActivatedCardIds(i.activatedCardIds,n.id)};se.set(o);const s=r.createActivationSteps(o,n),a=r.createResolutionSteps(o,n);K.pushChainBlock({sourceInstanceId:n.instanceId,sourceCardId:n.id,effectId:r.effectId,spellSpeed:r.spellSpeed,resolutionSteps:a,isNegated:!1}),s.length>0?P.startProcessing(s):gt(t)},resolveChain:()=>{K.endChainBuilding(),P.continueChainResolution()},continueChainResolution:()=>{const n=K.popChainBlock();if(!n){K.reset();return}!n.isNegated&&n.resolutionSteps.length>0?(t(r=>({...r,isActive:!0,steps:n.resolutionSteps,currentIndex:0,currentStep:n.resolutionSteps[0]||null})),P.confirmCurrentStep()):P.continueChainResolution()},cancelProcessing:()=>{t(n=>({...n,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))},reset:()=>{t(n=>({...n,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}}}const P=Is();class Os{canExecuteCommand(t,...n){const r=Fe();return new t(...n).canExecute(r).isValid}executeCommand(t,...n){const r=Fe(),o=new t(...n).execute(r);return o.success&&(se.set(o.updatedState),o.chainBlock&&(K.getStackSize()===0&&K.startChain(),K.pushChainBlock(o.chainBlock)),o.activationSteps&&o.activationSteps.length>0?P.startProcessing(o.activationSteps):o.chainBlock&&P.resolveChain()),{success:o.success,message:o.message,error:o.error}}loadDeck(t){const n=Ft(t),r=xt(n);return Ut(r),{deckData:Mt(n,r),uniqueCardIds:r}}initializeGame(t){const n=Ft(t),r=xt(n);Ut(r),is(r),ls(r);const i=Mt(n,r);return this.startGame(n),{deckData:i,uniqueCardIds:r}}startGame(t){fs(t)}getGameState(){return Fe()}findCardOnField(t){const n=Fe();return[...n.space.mainMonsterZone,...n.space.spellTrapZone,...n.space.fieldZone].find(i=>i.instanceId===t)}advancePhase(){return this.executeCommand(Io)}async autoAdvanceToMainPhase(t,n){const r=Fe();if(r.turn!==1||r.phase!=="draw")return!1;for(let i=0;i<2;i++){t&&await t();const o=this.advancePhase();if(o.success)o.message&&n&&n(o.message);else return console.error(`[GameFacade] Auto advance failed: ${o.error}`),!1}return!0}canSummonMonster(t){return this.canExecuteCommand(Jt,t)}summonMonster(t){return this.executeCommand(Jt,t)}canSetMonster(t){return this.canExecuteCommand(Wt,t)}setMonster(t){return this.executeCommand(Wt,t)}canSetSpellTrap(t){return this.canExecuteCommand(Yt,t)}setSpellTrap(t){return this.executeCommand(Yt,t)}canActivateSpell(t){return this.canExecuteCommand(Kt,t)}activateSpell(t){return this.executeCommand(Kt,t)}canActivateIgnitionEffect(t){return this.canExecuteCommand(Qt,t)}activateIgnitionEffect(t){return this.executeCommand(Qt,t)}}const Ud=new Os;function d(e,t,n){function r(a,u){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:u,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(e))return;a._zod.traits.add(e),t(a,u);const l=s.prototype,f=Object.keys(l);for(let p=0;p<f.length;p++){const v=f[p];v in a||(a[v]=l[v].bind(a))}}const i=(n==null?void 0:n.Parent)??Object;class o extends i{}Object.defineProperty(o,"name",{value:e});function s(a){var u;const l=n!=null&&n.Parent?new o:this;r(l,a),(u=l._zod).deferred??(u.deferred=[]);for(const f of l._zod.deferred)f();return l}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var u,l;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(l=(u=a==null?void 0:a._zod)==null?void 0:u.traits)==null?void 0:l.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class we extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class er extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const tr={};function Se(e){return tr}function nr(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,i])=>t.indexOf(+r)===-1).map(([r,i])=>i)}function St(e,t){return typeof t=="bigint"?t.toString():t}function Rt(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function bt(e){return e==null}function kt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Es(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let i=(r.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(r)){const u=r.match(/\d?e-(\d?)/);u!=null&&u[1]&&(i=Number.parseInt(u[1]))}const o=n>i?n:i,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}const nn=Symbol("evaluating");function y(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==nn)return r===void 0&&(r=nn,r=n()),r},set(i){Object.defineProperty(e,t,{value:i})},configurable:!0})}function ye(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function fe(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function rn(e){return JSON.stringify(e)}function Ts(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const rr="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ye(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Rs=Rt(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function je(e){if(Ye(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Ye(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function ir(e){return je(e)?{...e}:Array.isArray(e)?[...e]:e}const bs=new Set(["string","number","symbol"]);function st(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pe(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function _(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ks(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const ws={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ns(e,t){const n=e._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const o=fe(e._zod.def,{get shape(){const s={};for(const a in t){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&(s[a]=n.shape[a])}return ye(this,"shape",s),s},checks:[]});return pe(e,o)}function As(e,t){const n=e._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const o=fe(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const a in t){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&delete s[a]}return ye(this,"shape",s),s},checks:[]});return pe(e,o)}function zs(e,t){if(!je(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0){const o=e._zod.def.shape;for(const s in t)if(Object.getOwnPropertyDescriptor(o,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const i=fe(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return ye(this,"shape",o),o}});return pe(e,i)}function Ds(e,t){if(!je(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n=fe(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t};return ye(this,"shape",r),r}});return pe(e,n)}function $s(e,t){const n=fe(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return ye(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return pe(e,n)}function Zs(e,t,n){const i=t._zod.def.checks;if(i&&i.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const s=fe(t._zod.def,{get shape(){const a=t._zod.def.shape,u={...a};if(n)for(const l in n){if(!(l in a))throw new Error(`Unrecognized key: "${l}"`);n[l]&&(u[l]=e?new e({type:"optional",innerType:a[l]}):a[l])}else for(const l in a)u[l]=e?new e({type:"optional",innerType:a[l]}):a[l];return ye(this,"shape",u),u},checks:[]});return pe(t,s)}function Ps(e,t,n){const r=fe(t._zod.def,{get shape(){const i=t._zod.def.shape,o={...i};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:i[s]}))}else for(const s in i)o[s]=new e({type:"nonoptional",innerType:i[s]});return ye(this,"shape",o),o}});return pe(t,r)}function be(e,t=0){var n;if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(((n=e.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function or(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Be(e){return typeof e=="string"?e:e==null?void 0:e.message}function Ce(e,t,n){var i,o,s,a,u,l;const r={...e,path:e.path??[]};if(!e.message){const f=Be((s=(o=(i=e.inst)==null?void 0:i._zod.def)==null?void 0:o.error)==null?void 0:s.call(o,e))??Be((a=t==null?void 0:t.error)==null?void 0:a.call(t,e))??Be((u=n.customError)==null?void 0:u.call(n,e))??Be((l=n.localeError)==null?void 0:l.call(n,e))??"Invalid input";r.message=f}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function wt(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Ue(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const sr=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,St,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},ar=d("$ZodError",sr),cr=d("$ZodError",sr,{Parent:Error});function Vs(e,t=n=>n.message){const n={},r=[];for(const i of e.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}function Fs(e,t=n=>n.message){const n={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(s=>r({issues:s}));else if(o.code==="invalid_key")r({issues:o.issues});else if(o.code==="invalid_element")r({issues:o.issues});else if(o.path.length===0)n._errors.push(t(o));else{let s=n,a=0;for(;a<o.path.length;){const u=o.path[a];a===o.path.length-1?(s[u]=s[u]||{_errors:[]},s[u]._errors.push(t(o))):s[u]=s[u]||{_errors:[]},s=s[u],a++}}};return r(e),n}const Nt=e=>(t,n,r,i)=>{const o=r?Object.assign(r,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new we;if(s.issues.length){const a=new((i==null?void 0:i.Err)??e)(s.issues.map(u=>Ce(u,o,Se())));throw rr(a,i==null?void 0:i.callee),a}return s.value},At=e=>async(t,n,r,i)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((i==null?void 0:i.Err)??e)(s.issues.map(u=>Ce(u,o,Se())));throw rr(a,i==null?void 0:i.callee),a}return s.value},at=e=>(t,n,r)=>{const i=r?{...r,async:!1}:{async:!1},o=t._zod.run({value:n,issues:[]},i);if(o instanceof Promise)throw new we;return o.issues.length?{success:!1,error:new(e??ar)(o.issues.map(s=>Ce(s,i,Se())))}:{success:!0,data:o.value}},xs=at(cr),ct=e=>async(t,n,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(s=>Ce(s,i,Se())))}:{success:!0,data:o.value}},Ms=ct(cr),Ls=e=>(t,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Nt(e)(t,n,i)},js=e=>(t,n,r)=>Nt(e)(t,n,r),Us=e=>async(t,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return At(e)(t,n,i)},Gs=e=>async(t,n,r)=>At(e)(t,n,r),Bs=e=>(t,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return at(e)(t,n,i)},Hs=e=>(t,n,r)=>at(e)(t,n,r),Js=e=>async(t,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return ct(e)(t,n,i)},Ws=e=>async(t,n,r)=>ct(e)(t,n,r),Ys=/^[cC][^\s-]{8,}$/,qs=/^[0-9a-z]+$/,Ks=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Qs=/^[0-9a-vA-V]{20}$/,Xs=/^[A-Za-z0-9]{27}$/,ea=/^[a-zA-Z0-9_-]{21}$/,ta=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,na=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,on=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,ra=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ia="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function oa(){return new RegExp(ia,"u")}const sa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,aa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ca=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,ua=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,la=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ur=/^[A-Za-z0-9_-]*$/,da=/^\+[1-9]\d{6,14}$/,lr="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",fa=new RegExp(`^${lr}$`);function dr(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function pa(e){return new RegExp(`^${dr(e)}$`)}function ha(e){const t=dr({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${lr}T(?:${r})$`)}const ma=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},_a=/^-?\d+$/,va=/^-?\d+(?:\.\d+)?$/,ga=/^[^A-Z]*$/,Sa=/^[^a-z]*$/,j=d("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),fr={number:"number",bigint:"bigint",object:"date"},pr=d("$ZodCheckLessThan",(e,t)=>{j.init(e,t);const n=fr[typeof t.value];e._zod.onattach.push(r=>{const i=r._zod.bag,o=(t.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?i.maximum=t.value:i.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),hr=d("$ZodCheckGreaterThan",(e,t)=>{j.init(e,t);const n=fr[typeof t.value];e._zod.onattach.push(r=>{const i=r._zod.bag,o=(t.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?i.minimum=t.value:i.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ca=d("$ZodCheckMultipleOf",(e,t)=>{j.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Es(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),ya=d("$ZodCheckNumberFormat",(e,t)=>{var s;j.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),r=n?"int":"number",[i,o]=ws[t.format];e._zod.onattach.push(a=>{const u=a._zod.bag;u.format=t.format,u.minimum=i,u.maximum=o,n&&(u.pattern=_a)}),e._zod.check=a=>{const u=a.value;if(n){if(!Number.isInteger(u)){a.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:u,inst:e});return}if(!Number.isSafeInteger(u)){u>0?a.issues.push({input:u,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort}):a.issues.push({input:u,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort});return}}u<i&&a.issues.push({origin:"number",input:u,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),u>o&&a.issues.push({origin:"number",input:u,code:"too_big",maximum:o,inclusive:!0,inst:e,continue:!t.abort})}}),Ia=d("$ZodCheckMaxLength",(e,t)=>{var n;j.init(e,t),(n=e._zod.def).when??(n.when=r=>{const i=r.value;return!bt(i)&&i.length!==void 0}),e._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<i&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const i=r.value;if(i.length<=t.maximum)return;const s=wt(i);r.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),Oa=d("$ZodCheckMinLength",(e,t)=>{var n;j.init(e,t),(n=e._zod.def).when??(n.when=r=>{const i=r.value;return!bt(i)&&i.length!==void 0}),e._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>i&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const i=r.value;if(i.length>=t.minimum)return;const s=wt(i);r.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),Ea=d("$ZodCheckLengthEquals",(e,t)=>{var n;j.init(e,t),(n=e._zod.def).when??(n.when=r=>{const i=r.value;return!bt(i)&&i.length!==void 0}),e._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=t.length,i.maximum=t.length,i.length=t.length}),e._zod.check=r=>{const i=r.value,o=i.length;if(o===t.length)return;const s=wt(i),a=o>t.length;r.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),ut=d("$ZodCheckStringFormat",(e,t)=>{var n,r;j.init(e,t),e._zod.onattach.push(i=>{const o=i._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=i=>{t.pattern.lastIndex=0,!t.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:t.format,input:i.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),Ta=d("$ZodCheckRegex",(e,t)=>{ut.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Ra=d("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ga),ut.init(e,t)}),ba=d("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Sa),ut.init(e,t)}),ka=d("$ZodCheckIncludes",(e,t)=>{j.init(e,t);const n=st(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(i=>{const o=i._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=i=>{i.value.includes(t.includes,t.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:i.value,inst:e,continue:!t.abort})}}),wa=d("$ZodCheckStartsWith",(e,t)=>{j.init(e,t);const n=new RegExp(`^${st(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Na=d("$ZodCheckEndsWith",(e,t)=>{j.init(e,t);const n=new RegExp(`.*${st(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Aa=d("$ZodCheckOverwrite",(e,t)=>{j.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class za{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(s=>s),i=Math.min(...r.map(s=>s.length-s.trimStart().length)),o=r.map(s=>s.slice(i)).map(s=>" ".repeat(this.indent*2)+s);for(const s of o)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,i=[...((this==null?void 0:this.content)??[""]).map(o=>`  ${o}`)];return new t(...n,i.join(`
`))}}const Da={major:4,minor:3,patch:6},b=d("$ZodType",(e,t)=>{var i;var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Da;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const o of r)for(const s of o._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(i=e._zod.deferred)==null||i.push(()=>{e._zod.run=e._zod.parse});else{const o=(a,u,l)=>{let f=be(a),p;for(const v of u){if(v._zod.def.when){if(!v._zod.def.when(a))continue}else if(f)continue;const m=a.issues.length,S=v._zod.check(a);if(S instanceof Promise&&(l==null?void 0:l.async)===!1)throw new we;if(p||S instanceof Promise)p=(p??Promise.resolve()).then(async()=>{await S,a.issues.length!==m&&(f||(f=be(a,m)))});else{if(a.issues.length===m)continue;f||(f=be(a,m))}}return p?p.then(()=>a):a},s=(a,u,l)=>{if(be(a))return a.aborted=!0,a;const f=o(u,r,l);if(f instanceof Promise){if(l.async===!1)throw new we;return f.then(p=>e._zod.parse(p,l))}return e._zod.parse(f,l)};e._zod.run=(a,u)=>{if(u.skipChecks)return e._zod.parse(a,u);if(u.direction==="backward"){const f=e._zod.parse({value:a.value,issues:[]},{...u,skipChecks:!0});return f instanceof Promise?f.then(p=>s(p,a,u)):s(f,a,u)}const l=e._zod.parse(a,u);if(l instanceof Promise){if(u.async===!1)throw new we;return l.then(f=>o(f,r,u))}return o(l,r,u)}}y(e,"~standard",()=>({validate:o=>{var s;try{const a=xs(e,o);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return Ms(e,o).then(u=>{var l;return u.success?{value:u.data}:{issues:(l=u.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}))}),zt=d("$ZodString",(e,t)=>{var n;b.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??ma(e._zod.bag),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),E=d("$ZodStringFormat",(e,t)=>{ut.init(e,t),zt.init(e,t)}),$a=d("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=na),E.init(e,t)}),Za=d("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=on(r))}else t.pattern??(t.pattern=on());E.init(e,t)}),Pa=d("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=ra),E.init(e,t)}),Va=d("$ZodURL",(e,t)=>{E.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),i=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Fa=d("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=oa()),E.init(e,t)}),xa=d("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ea),E.init(e,t)}),Ma=d("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Ys),E.init(e,t)}),La=d("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=qs),E.init(e,t)}),ja=d("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Ks),E.init(e,t)}),Ua=d("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Qs),E.init(e,t)}),Ga=d("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Xs),E.init(e,t)}),Ba=d("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=ha(t)),E.init(e,t)}),Ha=d("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=fa),E.init(e,t)}),Ja=d("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=pa(t)),E.init(e,t)}),Wa=d("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=ta),E.init(e,t)}),Ya=d("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=sa),E.init(e,t),e._zod.bag.format="ipv4"}),qa=d("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=aa),E.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),Ka=d("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ca),E.init(e,t)}),Qa=d("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=ua),E.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[i,o]=r;if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${i}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function mr(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Xa=d("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=la),E.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{mr(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function ec(e){if(!ur.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return mr(n)}const tc=d("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=ur),E.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{ec(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),nc=d("$ZodE164",(e,t)=>{t.pattern??(t.pattern=da),E.init(e,t)});function rc(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const i=JSON.parse(atob(r));return!("typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||t&&(!("alg"in i)||i.alg!==t))}catch{return!1}}const ic=d("$ZodJWT",(e,t)=>{E.init(e,t),e._zod.check=n=>{rc(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),_r=d("$ZodNumber",(e,t)=>{b.init(e,t),e._zod.pattern=e._zod.bag.pattern??va,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const i=n.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return n;const o=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:i,inst:e,...o?{received:o}:{}}),n}}),oc=d("$ZodNumberFormat",(e,t)=>{ya.init(e,t),_r.init(e,t)}),sc=d("$ZodUnknown",(e,t)=>{b.init(e,t),e._zod.parse=n=>n}),ac=d("$ZodNever",(e,t)=>{b.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function sn(e,t,n){e.issues.length&&t.issues.push(...or(n,e.issues)),t.value[n]=e.value}const cc=d("$ZodArray",(e,t)=>{b.init(e,t),e._zod.parse=(n,r)=>{const i=n.value;if(!Array.isArray(i))return n.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),n;n.value=Array(i.length);const o=[];for(let s=0;s<i.length;s++){const a=i[s],u=t.element._zod.run({value:a,issues:[]},r);u instanceof Promise?o.push(u.then(l=>sn(l,n,s))):sn(u,n,s)}return o.length?Promise.all(o).then(()=>n):n}});function qe(e,t,n,r,i){if(e.issues.length){if(i&&!(n in r))return;t.issues.push(...or(n,e.issues))}e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function vr(e){var r,i,o,s;const t=Object.keys(e.shape);for(const a of t)if(!((s=(o=(i=(r=e.shape)==null?void 0:r[a])==null?void 0:i._zod)==null?void 0:o.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${a}": expected a Zod schema`);const n=ks(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function gr(e,t,n,r,i,o){const s=[],a=i.keySet,u=i.catchall._zod,l=u.def.type,f=u.optout==="optional";for(const p in t){if(a.has(p))continue;if(l==="never"){s.push(p);continue}const v=u.run({value:t[p],issues:[]},r);v instanceof Promise?e.push(v.then(m=>qe(m,n,p,t,f))):qe(v,n,p,t,f)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:o}),e.length?Promise.all(e).then(()=>n):n}const uc=d("$ZodObject",(e,t)=>{b.init(e,t);const n=Object.getOwnPropertyDescriptor(t,"shape");if(!(n!=null&&n.get)){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const u={...a};return Object.defineProperty(t,"shape",{value:u}),u}})}const r=Rt(()=>vr(t));y(e._zod,"propValues",()=>{const a=t.shape,u={};for(const l in a){const f=a[l]._zod;if(f.values){u[l]??(u[l]=new Set);for(const p of f.values)u[l].add(p)}}return u});const i=Ye,o=t.catchall;let s;e._zod.parse=(a,u)=>{s??(s=r.value);const l=a.value;if(!i(l))return a.issues.push({expected:"object",code:"invalid_type",input:l,inst:e}),a;a.value={};const f=[],p=s.shape;for(const v of s.keys){const m=p[v],S=m._zod.optout==="optional",C=m._zod.run({value:l[v],issues:[]},u);C instanceof Promise?f.push(C.then(R=>qe(R,a,v,l,S))):qe(C,a,v,l,S)}return o?gr(f,l,a,u,r.value,e):f.length?Promise.all(f).then(()=>a):a}}),lc=d("$ZodObjectJIT",(e,t)=>{uc.init(e,t);const n=e._zod.parse,r=Rt(()=>vr(t)),i=v=>{var me;const m=new za(["shape","payload","ctx"]),S=r.value,C=V=>{const D=rn(V);return`shape[${D}]._zod.run({ value: input[${D}], issues: [] }, ctx)`};m.write("const input = payload.value;");const R=Object.create(null);let he=0;for(const V of S.keys)R[V]=`key_${he++}`;m.write("const newResult = {};");for(const V of S.keys){const D=R[V],U=rn(V),De=v[V],lt=((me=De==null?void 0:De._zod)==null?void 0:me.optout)==="optional";m.write(`const ${D} = ${C(V)};`),lt?m.write(`
        if (${D}.issues.length) {
          if (${U} in input) {
            payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${U}, ...iss.path] : [${U}]
            })));
          }
        }
        
        if (${D}.value === undefined) {
          if (${U} in input) {
            newResult[${U}] = undefined;
          }
        } else {
          newResult[${U}] = ${D}.value;
        }
        
      `):m.write(`
        if (${D}.issues.length) {
          payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${U}, ...iss.path] : [${U}]
          })));
        }
        
        if (${D}.value === undefined) {
          if (${U} in input) {
            newResult[${U}] = undefined;
          }
        } else {
          newResult[${U}] = ${D}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const w=m.compile();return(V,D)=>w(v,V,D)};let o;const s=Ye,a=!tr.jitless,l=a&&Rs.value,f=t.catchall;let p;e._zod.parse=(v,m)=>{p??(p=r.value);const S=v.value;return s(S)?a&&l&&(m==null?void 0:m.async)===!1&&m.jitless!==!0?(o||(o=i(t.shape)),v=o(v,m),f?gr([],S,v,m,p,e):v):n(v,m):(v.issues.push({expected:"object",code:"invalid_type",input:S,inst:e}),v)}});function an(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;const i=e.filter(o=>!be(o));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>Ce(s,r,Se())))}),t)}const dc=d("$ZodUnion",(e,t)=>{b.init(e,t),y(e._zod,"optin",()=>t.options.some(i=>i._zod.optin==="optional")?"optional":void 0),y(e._zod,"optout",()=>t.options.some(i=>i._zod.optout==="optional")?"optional":void 0),y(e._zod,"values",()=>{if(t.options.every(i=>i._zod.values))return new Set(t.options.flatMap(i=>Array.from(i._zod.values)))}),y(e._zod,"pattern",()=>{if(t.options.every(i=>i._zod.pattern)){const i=t.options.map(o=>o._zod.pattern);return new RegExp(`^(${i.map(o=>kt(o.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(i,o)=>{if(n)return r(i,o);let s=!1;const a=[];for(const u of t.options){const l=u._zod.run({value:i.value,issues:[]},o);if(l instanceof Promise)a.push(l),s=!0;else{if(l.issues.length===0)return l;a.push(l)}}return s?Promise.all(a).then(u=>an(u,i,e,o)):an(a,i,e,o)}}),fc=d("$ZodIntersection",(e,t)=>{b.init(e,t),e._zod.parse=(n,r)=>{const i=n.value,o=t.left._zod.run({value:i,issues:[]},r),s=t.right._zod.run({value:i,issues:[]},r);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([u,l])=>cn(n,u,l)):cn(n,o,s)}});function Ct(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(je(e)&&je(t)){const n=Object.keys(t),r=Object.keys(e).filter(o=>n.indexOf(o)!==-1),i={...e,...t};for(const o of r){const s=Ct(e[o],t[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};i[o]=s.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=t[r],s=Ct(i,o);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function cn(e,t,n){const r=new Map;let i;for(const a of t.issues)if(a.code==="unrecognized_keys"){i??(i=a);for(const u of a.keys)r.has(u)||r.set(u,{}),r.get(u).l=!0}else e.issues.push(a);for(const a of n.issues)if(a.code==="unrecognized_keys")for(const u of a.keys)r.has(u)||r.set(u,{}),r.get(u).r=!0;else e.issues.push(a);const o=[...r].filter(([,a])=>a.l&&a.r).map(([a])=>a);if(o.length&&i&&e.issues.push({...i,keys:o}),be(e))return e;const s=Ct(t.value,n.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return e.value=s.data,e}const pc=d("$ZodEnum",(e,t)=>{b.init(e,t);const n=nr(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(i=>bs.has(typeof i)).map(i=>typeof i=="string"?st(i):i.toString()).join("|")})$`),e._zod.parse=(i,o)=>{const s=i.value;return r.has(s)||i.issues.push({code:"invalid_value",values:n,input:s,inst:e}),i}}),hc=d("$ZodTransform",(e,t)=>{b.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new er(e.constructor.name);const i=t.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(s=>(n.value=s,n));if(i instanceof Promise)throw new we;return n.value=i,n}});function un(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Sr=d("$ZodOptional",(e,t)=>{b.init(e,t),e._zod.optin="optional",e._zod.optout="optional",y(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),y(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${kt(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>un(o,n.value)):un(i,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),mc=d("$ZodExactOptional",(e,t)=>{Sr.init(e,t),y(e._zod,"values",()=>t.innerType._zod.values),y(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(n,r)=>t.innerType._zod.run(n,r)}),_c=d("$ZodNullable",(e,t)=>{b.init(e,t),y(e._zod,"optin",()=>t.innerType._zod.optin),y(e._zod,"optout",()=>t.innerType._zod.optout),y(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${kt(n.source)}|null)$`):void 0}),y(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),vc=d("$ZodDefault",(e,t)=>{b.init(e,t),e._zod.optin="optional",y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>ln(o,t)):ln(i,t)}});function ln(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const gc=d("$ZodPrefault",(e,t)=>{b.init(e,t),e._zod.optin="optional",y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Sc=d("$ZodNonOptional",(e,t)=>{b.init(e,t),y(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>dn(o,e)):dn(i,e)}});function dn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Cc=d("$ZodCatch",(e,t)=>{b.init(e,t),y(e._zod,"optin",()=>t.innerType._zod.optin),y(e._zod,"optout",()=>t.innerType._zod.optout),y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>Ce(s,r,Se()))},input:n.value}),n.issues=[]),n)):(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(o=>Ce(o,r,Se()))},input:n.value}),n.issues=[]),n)}}),yc=d("$ZodPipe",(e,t)=>{b.init(e,t),y(e._zod,"values",()=>t.in._zod.values),y(e._zod,"optin",()=>t.in._zod.optin),y(e._zod,"optout",()=>t.out._zod.optout),y(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const o=t.out._zod.run(n,r);return o instanceof Promise?o.then(s=>He(s,t.in,r)):He(o,t.in,r)}const i=t.in._zod.run(n,r);return i instanceof Promise?i.then(o=>He(o,t.out,r)):He(i,t.out,r)}});function He(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Ic=d("$ZodReadonly",(e,t)=>{b.init(e,t),y(e._zod,"propValues",()=>t.innerType._zod.propValues),y(e._zod,"values",()=>t.innerType._zod.values),y(e._zod,"optin",()=>{var n,r;return(r=(n=t.innerType)==null?void 0:n._zod)==null?void 0:r.optin}),y(e._zod,"optout",()=>{var n,r;return(r=(n=t.innerType)==null?void 0:n._zod)==null?void 0:r.optout}),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(fn):fn(i)}});function fn(e){return e.value=Object.freeze(e.value),e}const Oc=d("$ZodCustom",(e,t)=>{j.init(e,t),b.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,i=t.fn(r);if(i instanceof Promise)return i.then(o=>pn(o,n,r,e));pn(i,n,r,e)}});function pn(e,t,n,r){if(!e){const i={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),t.issues.push(Ue(i))}}var hn;class Ec{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];return this._map.set(t,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const i={...r,...this._map.get(t)};return Object.keys(i).length?i:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Tc(){return new Ec}(hn=globalThis).__zod_globalRegistry??(hn.__zod_globalRegistry=Tc());const xe=globalThis.__zod_globalRegistry;function Rc(e,t){return new e({type:"string",..._(t)})}function bc(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,..._(t)})}function mn(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,..._(t)})}function kc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,..._(t)})}function wc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",..._(t)})}function Nc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",..._(t)})}function Ac(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",..._(t)})}function zc(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,..._(t)})}function Dc(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,..._(t)})}function $c(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,..._(t)})}function Zc(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,..._(t)})}function Pc(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,..._(t)})}function Vc(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,..._(t)})}function Fc(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,..._(t)})}function xc(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,..._(t)})}function Mc(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,..._(t)})}function Lc(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,..._(t)})}function jc(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,..._(t)})}function Uc(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,..._(t)})}function Gc(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,..._(t)})}function Bc(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,..._(t)})}function Hc(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,..._(t)})}function Jc(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,..._(t)})}function Wc(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,..._(t)})}function Yc(e,t){return new e({type:"string",format:"date",check:"string_format",..._(t)})}function qc(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,..._(t)})}function Kc(e,t){return new e({type:"string",format:"duration",check:"string_format",..._(t)})}function Qc(e,t){return new e({type:"number",checks:[],..._(t)})}function Xc(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",..._(t)})}function eu(e){return new e({type:"unknown"})}function tu(e,t){return new e({type:"never",..._(t)})}function _n(e,t){return new pr({check:"less_than",..._(t),value:e,inclusive:!1})}function mt(e,t){return new pr({check:"less_than",..._(t),value:e,inclusive:!0})}function vn(e,t){return new hr({check:"greater_than",..._(t),value:e,inclusive:!1})}function _t(e,t){return new hr({check:"greater_than",..._(t),value:e,inclusive:!0})}function gn(e,t){return new Ca({check:"multiple_of",..._(t),value:e})}function Cr(e,t){return new Ia({check:"max_length",..._(t),maximum:e})}function Ke(e,t){return new Oa({check:"min_length",..._(t),minimum:e})}function yr(e,t){return new Ea({check:"length_equals",..._(t),length:e})}function nu(e,t){return new Ta({check:"string_format",format:"regex",..._(t),pattern:e})}function ru(e){return new Ra({check:"string_format",format:"lowercase",..._(e)})}function iu(e){return new ba({check:"string_format",format:"uppercase",..._(e)})}function ou(e,t){return new ka({check:"string_format",format:"includes",..._(t),includes:e})}function su(e,t){return new wa({check:"string_format",format:"starts_with",..._(t),prefix:e})}function au(e,t){return new Na({check:"string_format",format:"ends_with",..._(t),suffix:e})}function Ae(e){return new Aa({check:"overwrite",tx:e})}function cu(e){return Ae(t=>t.normalize(e))}function uu(){return Ae(e=>e.trim())}function lu(){return Ae(e=>e.toLowerCase())}function du(){return Ae(e=>e.toUpperCase())}function fu(){return Ae(e=>Ts(e))}function pu(e,t,n){return new e({type:"array",element:t,..._(n)})}function hu(e,t,n){return new e({type:"custom",check:"custom",fn:t,..._(n)})}function mu(e){const t=_u(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Ue(r,n.value,t._zod.def));else{const i=r;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=t),i.continue??(i.continue=!t._zod.def.abort),n.issues.push(Ue(i))}},e(n.value,n)));return t}function _u(e,t){const n=new j({check:"custom",..._(t)});return n._zod.check=e,n}function Ir(e){let t=(e==null?void 0:e.target)??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:(e==null?void 0:e.metadata)??xe,target:t,unrepresentable:(e==null?void 0:e.unrepresentable)??"throw",override:(e==null?void 0:e.override)??(()=>{}),io:(e==null?void 0:e.io)??"output",counter:0,seen:new Map,cycles:(e==null?void 0:e.cycles)??"ref",reused:(e==null?void 0:e.reused)??"inline",external:(e==null?void 0:e.external)??void 0}}function z(e,t,n={path:[],schemaPath:[]}){var f,p;var r;const i=e._zod.def,o=t.seen.get(e);if(o)return o.count++,n.schemaPath.includes(e)&&(o.cycle=n.path),o.schema;const s={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,s);const a=(p=(f=e._zod).toJSONSchema)==null?void 0:p.call(f);if(a)s.schema=a;else{const v={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,s.schema,v);else{const S=s.schema,C=t.processors[i.type];if(!C)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);C(e,t,S,v)}const m=e._zod.parent;m&&(s.ref||(s.ref=m),z(m,t,v),t.seen.get(m).isParent=!0)}const u=t.metadataRegistry.get(e);return u&&Object.assign(s.schema,u),t.io==="input"&&Z(e)&&(delete s.schema.examples,delete s.schema.default),t.io==="input"&&s.schema._prefault&&((r=s.schema).default??(r.default=s.schema._prefault)),delete s.schema._prefault,t.seen.get(e).schema}function Or(e,t){var s,a,u,l;const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const f of e.seen.entries()){const p=(s=e.metadataRegistry.get(f[0]))==null?void 0:s.id;if(p){const v=r.get(p);if(v&&v!==f[0])throw new Error(`Duplicate schema id "${p}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(p,f[0])}}const i=f=>{var C;const p=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const R=(C=e.external.registry.get(f[0]))==null?void 0:C.id,he=e.external.uri??(me=>me);if(R)return{ref:he(R)};const w=f[1].defId??f[1].schema.id??`schema${e.counter++}`;return f[1].defId=w,{defId:w,ref:`${he("__shared")}#/${p}/${w}`}}if(f[1]===n)return{ref:"#"};const m=`#/${p}/`,S=f[1].schema.id??`__schema${e.counter++}`;return{defId:S,ref:m+S}},o=f=>{if(f[1].schema.$ref)return;const p=f[1],{ref:v,defId:m}=i(f);p.def={...p.schema},m&&(p.defId=m);const S=p.schema;for(const C in S)delete S[C];S.$ref=v};if(e.cycles==="throw")for(const f of e.seen.entries()){const p=f[1];if(p.cycle)throw new Error(`Cycle detected: #/${(a=p.cycle)==null?void 0:a.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const f of e.seen.entries()){const p=f[1];if(t===f[0]){o(f);continue}if(e.external){const m=(u=e.external.registry.get(f[0]))==null?void 0:u.id;if(t!==f[0]&&m){o(f);continue}}if((l=e.metadataRegistry.get(f[0]))==null?void 0:l.id){o(f);continue}if(p.cycle){o(f);continue}if(p.count>1&&e.reused==="ref"){o(f);continue}}}function Er(e,t){var s,a,u;const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=l=>{const f=e.seen.get(l);if(f.ref===null)return;const p=f.def??f.schema,v={...p},m=f.ref;if(f.ref=null,m){r(m);const C=e.seen.get(m),R=C.schema;if(R.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(p.allOf=p.allOf??[],p.allOf.push(R)):Object.assign(p,R),Object.assign(p,v),l._zod.parent===m)for(const w in p)w==="$ref"||w==="allOf"||w in v||delete p[w];if(R.$ref&&C.def)for(const w in p)w==="$ref"||w==="allOf"||w in C.def&&JSON.stringify(p[w])===JSON.stringify(C.def[w])&&delete p[w]}const S=l._zod.parent;if(S&&S!==m){r(S);const C=e.seen.get(S);if(C!=null&&C.schema.$ref&&(p.$ref=C.schema.$ref,C.def))for(const R in p)R==="$ref"||R==="allOf"||R in C.def&&JSON.stringify(p[R])===JSON.stringify(C.def[R])&&delete p[R]}e.override({zodSchema:l,jsonSchema:p,path:f.path??[]})};for(const l of[...e.seen.entries()].reverse())r(l[0]);const i={};if(e.target==="draft-2020-12"?i.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?i.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?i.$schema="http://json-schema.org/draft-04/schema#":e.target,(s=e.external)!=null&&s.uri){const l=(a=e.external.registry.get(t))==null?void 0:a.id;if(!l)throw new Error("Schema is missing an `id` property");i.$id=e.external.uri(l)}Object.assign(i,n.def??n.schema);const o=((u=e.external)==null?void 0:u.defs)??{};for(const l of e.seen.entries()){const f=l[1];f.def&&f.defId&&(o[f.defId]=f.def)}e.external||Object.keys(o).length>0&&(e.target==="draft-2020-12"?i.$defs=o:i.definitions=o);try{const l=JSON.parse(JSON.stringify(i));return Object.defineProperty(l,"~standard",{value:{...t["~standard"],jsonSchema:{input:Qe(t,"input",e.processors),output:Qe(t,"output",e.processors)}},enumerable:!1,writable:!1}),l}catch{throw new Error("Error converting schema to JSON.")}}function Z(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const r=e._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return Z(r.element,n);if(r.type==="set")return Z(r.valueType,n);if(r.type==="lazy")return Z(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return Z(r.innerType,n);if(r.type==="intersection")return Z(r.left,n)||Z(r.right,n);if(r.type==="record"||r.type==="map")return Z(r.keyType,n)||Z(r.valueType,n);if(r.type==="pipe")return Z(r.in,n)||Z(r.out,n);if(r.type==="object"){for(const i in r.shape)if(Z(r.shape[i],n))return!0;return!1}if(r.type==="union"){for(const i of r.options)if(Z(i,n))return!0;return!1}if(r.type==="tuple"){for(const i of r.items)if(Z(i,n))return!0;return!!(r.rest&&Z(r.rest,n))}return!1}const vu=(e,t={})=>n=>{const r=Ir({...n,processors:t});return z(e,r),Or(r,e),Er(r,e)},Qe=(e,t,n={})=>r=>{const{libraryOptions:i,target:o}=r??{},s=Ir({...i??{},target:o,io:t,processors:n});return z(e,s),Or(s,e),Er(s,e)},gu={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Su=(e,t,n,r)=>{const i=n;i.type="string";const{minimum:o,maximum:s,format:a,patterns:u,contentEncoding:l}=e._zod.bag;if(typeof o=="number"&&(i.minLength=o),typeof s=="number"&&(i.maxLength=s),a&&(i.format=gu[a]??a,i.format===""&&delete i.format,a==="time"&&delete i.format),l&&(i.contentEncoding=l),u&&u.size>0){const f=[...u];f.length===1?i.pattern=f[0].source:f.length>1&&(i.allOf=[...f.map(p=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:p.source}))])}},Cu=(e,t,n,r)=>{const i=n,{minimum:o,maximum:s,format:a,multipleOf:u,exclusiveMaximum:l,exclusiveMinimum:f}=e._zod.bag;typeof a=="string"&&a.includes("int")?i.type="integer":i.type="number",typeof f=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(i.minimum=f,i.exclusiveMinimum=!0):i.exclusiveMinimum=f),typeof o=="number"&&(i.minimum=o,typeof f=="number"&&t.target!=="draft-04"&&(f>=o?delete i.minimum:delete i.exclusiveMinimum)),typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(i.maximum=l,i.exclusiveMaximum=!0):i.exclusiveMaximum=l),typeof s=="number"&&(i.maximum=s,typeof l=="number"&&t.target!=="draft-04"&&(l<=s?delete i.maximum:delete i.exclusiveMaximum)),typeof u=="number"&&(i.multipleOf=u)},yu=(e,t,n,r)=>{n.not={}},Iu=(e,t,n,r)=>{},Ou=(e,t,n,r)=>{const i=e._zod.def,o=nr(i.entries);o.every(s=>typeof s=="number")&&(n.type="number"),o.every(s=>typeof s=="string")&&(n.type="string"),n.enum=o},Eu=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Tu=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Ru=(e,t,n,r)=>{const i=n,o=e._zod.def,{minimum:s,maximum:a}=e._zod.bag;typeof s=="number"&&(i.minItems=s),typeof a=="number"&&(i.maxItems=a),i.type="array",i.items=z(o.element,t,{...r,path:[...r.path,"items"]})},bu=(e,t,n,r)=>{var l;const i=n,o=e._zod.def;i.type="object",i.properties={};const s=o.shape;for(const f in s)i.properties[f]=z(s[f],t,{...r,path:[...r.path,"properties",f]});const a=new Set(Object.keys(s)),u=new Set([...a].filter(f=>{const p=o.shape[f]._zod;return t.io==="input"?p.optin===void 0:p.optout===void 0}));u.size>0&&(i.required=Array.from(u)),((l=o.catchall)==null?void 0:l._zod.def.type)==="never"?i.additionalProperties=!1:o.catchall?o.catchall&&(i.additionalProperties=z(o.catchall,t,{...r,path:[...r.path,"additionalProperties"]})):t.io==="output"&&(i.additionalProperties=!1)},ku=(e,t,n,r)=>{const i=e._zod.def,o=i.inclusive===!1,s=i.options.map((a,u)=>z(a,t,{...r,path:[...r.path,o?"oneOf":"anyOf",u]}));o?n.oneOf=s:n.anyOf=s},wu=(e,t,n,r)=>{const i=e._zod.def,o=z(i.left,t,{...r,path:[...r.path,"allOf",0]}),s=z(i.right,t,{...r,path:[...r.path,"allOf",1]}),a=l=>"allOf"in l&&Object.keys(l).length===1,u=[...a(o)?o.allOf:[o],...a(s)?s.allOf:[s]];n.allOf=u},Nu=(e,t,n,r)=>{const i=e._zod.def,o=z(i.innerType,t,r),s=t.seen.get(e);t.target==="openapi-3.0"?(s.ref=i.innerType,n.nullable=!0):n.anyOf=[o,{type:"null"}]},Au=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType},zu=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType,n.default=JSON.parse(JSON.stringify(i.defaultValue))},Du=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType,t.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},$u=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType;let s;try{s=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=s},Zu=(e,t,n,r)=>{const i=e._zod.def,o=t.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;z(o,t,r);const s=t.seen.get(e);s.ref=o},Pu=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType,n.readOnly=!0},Tr=(e,t,n,r)=>{const i=e._zod.def;z(i.innerType,t,r);const o=t.seen.get(e);o.ref=i.innerType},Vu=d("ZodISODateTime",(e,t)=>{Ba.init(e,t),T.init(e,t)});function Fu(e){return Wc(Vu,e)}const xu=d("ZodISODate",(e,t)=>{Ha.init(e,t),T.init(e,t)});function Mu(e){return Yc(xu,e)}const Lu=d("ZodISOTime",(e,t)=>{Ja.init(e,t),T.init(e,t)});function ju(e){return qc(Lu,e)}const Uu=d("ZodISODuration",(e,t)=>{Wa.init(e,t),T.init(e,t)});function Gu(e){return Kc(Uu,e)}const Rr=(e,t)=>{ar.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Fs(e,n)},flatten:{value:n=>Vs(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,St,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,St,2)}},isEmpty:{get(){return e.issues.length===0}}})},Bu=d("ZodError",Rr),X=d("ZodError",Rr,{Parent:Error}),Hu=Nt(X),Ju=At(X),Wu=at(X),Yu=ct(X),qu=Ls(X),Ku=js(X),Qu=Us(X),Xu=Gs(X),el=Bs(X),tl=Hs(X),nl=Js(X),rl=Ws(X),k=d("ZodType",(e,t)=>(b.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:Qe(e,"input"),output:Qe(e,"output")}}),e.toJSONSchema=vu(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(fe(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),e.with=e.check,e.clone=(n,r)=>pe(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>Hu(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Wu(e,n,r),e.parseAsync=async(n,r)=>Ju(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Yu(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>qu(e,n,r),e.decode=(n,r)=>Ku(e,n,r),e.encodeAsync=async(n,r)=>Qu(e,n,r),e.decodeAsync=async(n,r)=>Xu(e,n,r),e.safeEncode=(n,r)=>el(e,n,r),e.safeDecode=(n,r)=>tl(e,n,r),e.safeEncodeAsync=async(n,r)=>nl(e,n,r),e.safeDecodeAsync=async(n,r)=>rl(e,n,r),e.refine=(n,r)=>e.check(Yl(n,r)),e.superRefine=n=>e.check(ql(n)),e.overwrite=n=>e.check(Ae(n)),e.optional=()=>In(e),e.exactOptional=()=>Pl(e),e.nullable=()=>On(e),e.nullish=()=>In(On(e)),e.nonoptional=n=>jl(e,n),e.array=()=>ke(e),e.or=n=>wl([e,n]),e.and=n=>Al(e,n),e.transform=n=>En(e,$l(n)),e.default=n=>xl(e,n),e.prefault=n=>Ll(e,n),e.catch=n=>Gl(e,n),e.pipe=n=>En(e,n),e.readonly=()=>Jl(e),e.describe=n=>{const r=e.clone();return xe.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=xe.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return xe.get(e);const r=e.clone();return xe.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=n=>n(e),e)),br=d("_ZodString",(e,t)=>{zt.init(e,t),k.init(e,t),e._zod.processJSONSchema=(r,i,o)=>Su(e,r,i);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(nu(...r)),e.includes=(...r)=>e.check(ou(...r)),e.startsWith=(...r)=>e.check(su(...r)),e.endsWith=(...r)=>e.check(au(...r)),e.min=(...r)=>e.check(Ke(...r)),e.max=(...r)=>e.check(Cr(...r)),e.length=(...r)=>e.check(yr(...r)),e.nonempty=(...r)=>e.check(Ke(1,...r)),e.lowercase=r=>e.check(ru(r)),e.uppercase=r=>e.check(iu(r)),e.trim=()=>e.check(uu()),e.normalize=(...r)=>e.check(cu(...r)),e.toLowerCase=()=>e.check(lu()),e.toUpperCase=()=>e.check(du()),e.slugify=()=>e.check(fu())}),il=d("ZodString",(e,t)=>{zt.init(e,t),br.init(e,t),e.email=n=>e.check(bc(ol,n)),e.url=n=>e.check(zc(sl,n)),e.jwt=n=>e.check(Jc(yl,n)),e.emoji=n=>e.check(Dc(al,n)),e.guid=n=>e.check(mn(Sn,n)),e.uuid=n=>e.check(kc(Je,n)),e.uuidv4=n=>e.check(wc(Je,n)),e.uuidv6=n=>e.check(Nc(Je,n)),e.uuidv7=n=>e.check(Ac(Je,n)),e.nanoid=n=>e.check($c(cl,n)),e.guid=n=>e.check(mn(Sn,n)),e.cuid=n=>e.check(Zc(ul,n)),e.cuid2=n=>e.check(Pc(ll,n)),e.ulid=n=>e.check(Vc(dl,n)),e.base64=n=>e.check(Gc(gl,n)),e.base64url=n=>e.check(Bc(Sl,n)),e.xid=n=>e.check(Fc(fl,n)),e.ksuid=n=>e.check(xc(pl,n)),e.ipv4=n=>e.check(Mc(hl,n)),e.ipv6=n=>e.check(Lc(ml,n)),e.cidrv4=n=>e.check(jc(_l,n)),e.cidrv6=n=>e.check(Uc(vl,n)),e.e164=n=>e.check(Hc(Cl,n)),e.datetime=n=>e.check(Fu(n)),e.date=n=>e.check(Mu(n)),e.time=n=>e.check(ju(n)),e.duration=n=>e.check(Gu(n))});function I(e){return Rc(il,e)}const T=d("ZodStringFormat",(e,t)=>{E.init(e,t),br.init(e,t)}),ol=d("ZodEmail",(e,t)=>{Pa.init(e,t),T.init(e,t)}),Sn=d("ZodGUID",(e,t)=>{$a.init(e,t),T.init(e,t)}),Je=d("ZodUUID",(e,t)=>{Za.init(e,t),T.init(e,t)}),sl=d("ZodURL",(e,t)=>{Va.init(e,t),T.init(e,t)}),al=d("ZodEmoji",(e,t)=>{Fa.init(e,t),T.init(e,t)}),cl=d("ZodNanoID",(e,t)=>{xa.init(e,t),T.init(e,t)}),ul=d("ZodCUID",(e,t)=>{Ma.init(e,t),T.init(e,t)}),ll=d("ZodCUID2",(e,t)=>{La.init(e,t),T.init(e,t)}),dl=d("ZodULID",(e,t)=>{ja.init(e,t),T.init(e,t)}),fl=d("ZodXID",(e,t)=>{Ua.init(e,t),T.init(e,t)}),pl=d("ZodKSUID",(e,t)=>{Ga.init(e,t),T.init(e,t)}),hl=d("ZodIPv4",(e,t)=>{Ya.init(e,t),T.init(e,t)}),ml=d("ZodIPv6",(e,t)=>{qa.init(e,t),T.init(e,t)}),_l=d("ZodCIDRv4",(e,t)=>{Ka.init(e,t),T.init(e,t)}),vl=d("ZodCIDRv6",(e,t)=>{Qa.init(e,t),T.init(e,t)}),gl=d("ZodBase64",(e,t)=>{Xa.init(e,t),T.init(e,t)}),Sl=d("ZodBase64URL",(e,t)=>{tc.init(e,t),T.init(e,t)}),Cl=d("ZodE164",(e,t)=>{nc.init(e,t),T.init(e,t)}),yl=d("ZodJWT",(e,t)=>{ic.init(e,t),T.init(e,t)}),kr=d("ZodNumber",(e,t)=>{_r.init(e,t),k.init(e,t),e._zod.processJSONSchema=(r,i,o)=>Cu(e,r,i),e.gt=(r,i)=>e.check(vn(r,i)),e.gte=(r,i)=>e.check(_t(r,i)),e.min=(r,i)=>e.check(_t(r,i)),e.lt=(r,i)=>e.check(_n(r,i)),e.lte=(r,i)=>e.check(mt(r,i)),e.max=(r,i)=>e.check(mt(r,i)),e.int=r=>e.check(Cn(r)),e.safe=r=>e.check(Cn(r)),e.positive=r=>e.check(vn(0,r)),e.nonnegative=r=>e.check(_t(0,r)),e.negative=r=>e.check(_n(0,r)),e.nonpositive=r=>e.check(mt(0,r)),e.multipleOf=(r,i)=>e.check(gn(r,i)),e.step=(r,i)=>e.check(gn(r,i)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Me(e){return Qc(kr,e)}const Il=d("ZodNumberFormat",(e,t)=>{oc.init(e,t),kr.init(e,t)});function Cn(e){return Xc(Il,e)}const Ol=d("ZodUnknown",(e,t)=>{sc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Iu()});function yn(){return eu(Ol)}const El=d("ZodNever",(e,t)=>{ac.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>yu(e,n,r)});function Tl(e){return tu(El,e)}const Rl=d("ZodArray",(e,t)=>{cc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Ru(e,n,r,i),e.element=t.element,e.min=(n,r)=>e.check(Ke(n,r)),e.nonempty=n=>e.check(Ke(1,n)),e.max=(n,r)=>e.check(Cr(n,r)),e.length=(n,r)=>e.check(yr(n,r)),e.unwrap=()=>e.element});function ke(e,t){return pu(Rl,e,t)}const bl=d("ZodObject",(e,t)=>{lc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>bu(e,n,r,i),y(e,"shape",()=>t.shape),e.keyof=()=>zl(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:yn()}),e.loose=()=>e.clone({...e._zod.def,catchall:yn()}),e.strict=()=>e.clone({...e._zod.def,catchall:Tl()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>zs(e,n),e.safeExtend=n=>Ds(e,n),e.merge=n=>$s(e,n),e.pick=n=>Ns(e,n),e.omit=n=>As(e,n),e.partial=(...n)=>Zs(wr,e,n[0]),e.required=(...n)=>Ps(Nr,e,n[0])});function ze(e,t){const n={type:"object",shape:e??{},..._(t)};return new bl(n)}const kl=d("ZodUnion",(e,t)=>{dc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>ku(e,n,r,i),e.options=t.options});function wl(e,t){return new kl({type:"union",options:e,..._(t)})}const Nl=d("ZodIntersection",(e,t)=>{fc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>wu(e,n,r,i)});function Al(e,t){return new Nl({type:"intersection",left:e,right:t})}const yt=d("ZodEnum",(e,t)=>{pc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(r,i,o)=>Ou(e,r,i),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,i)=>{const o={};for(const s of r)if(n.has(s))o[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new yt({...t,checks:[],..._(i),entries:o})},e.exclude=(r,i)=>{const o={...t.entries};for(const s of r)if(n.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new yt({...t,checks:[],..._(i),entries:o})}});function zl(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new yt({type:"enum",entries:n,..._(t)})}const Dl=d("ZodTransform",(e,t)=>{hc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Tu(e,n),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new er(e.constructor.name);n.addIssue=o=>{if(typeof o=="string")n.issues.push(Ue(o,n.value,t));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),n.issues.push(Ue(s))}};const i=t.transform(n.value,n);return i instanceof Promise?i.then(o=>(n.value=o,n)):(n.value=i,n)}});function $l(e){return new Dl({type:"transform",transform:e})}const wr=d("ZodOptional",(e,t)=>{Sr.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Tr(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function In(e){return new wr({type:"optional",innerType:e})}const Zl=d("ZodExactOptional",(e,t)=>{mc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Tr(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function Pl(e){return new Zl({type:"optional",innerType:e})}const Vl=d("ZodNullable",(e,t)=>{_c.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Nu(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function On(e){return new Vl({type:"nullable",innerType:e})}const Fl=d("ZodDefault",(e,t)=>{vc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>zu(e,n,r,i),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function xl(e,t){return new Fl({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():ir(t)}})}const Ml=d("ZodPrefault",(e,t)=>{gc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Du(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function Ll(e,t){return new Ml({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():ir(t)}})}const Nr=d("ZodNonOptional",(e,t)=>{Sc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Au(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function jl(e,t){return new Nr({type:"nonoptional",innerType:e,..._(t)})}const Ul=d("ZodCatch",(e,t)=>{Cc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>$u(e,n,r,i),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Gl(e,t){return new Ul({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Bl=d("ZodPipe",(e,t)=>{yc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Zu(e,n,r,i),e.in=t.in,e.out=t.out});function En(e,t){return new Bl({type:"pipe",in:e,out:t})}const Hl=d("ZodReadonly",(e,t)=>{Ic.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Pu(e,n,r,i),e.unwrap=()=>e._zod.def.innerType});function Jl(e){return new Hl({type:"readonly",innerType:e})}const Wl=d("ZodCustom",(e,t)=>{Oc.init(e,t),k.init(e,t),e._zod.processJSONSchema=(n,r,i)=>Eu(e,n)});function Yl(e,t={}){return hu(Wl,e,t)}function ql(e){return mu(e)}function Kl(){return{credentials:"same-origin"}}async function Ql(e,t,n){try{return await e(t,n)}catch(r){throw console.error("API error:",r),new Error(`Failed to fetch: ${n.method} ${t}`)}}const Xl=ze({id:Me(),image_url:I(),image_url_small:I(),image_url_cropped:I()}),ed=ze({set_name:I(),set_code:I(),set_rarity:I(),set_rarity_code:I(),set_price:I()}),td=ze({cardmarket_price:I(),tcgplayer_price:I(),ebay_price:I(),amazon_price:I(),coolstuffinc_price:I()}),nd=ze({ban_tcg:I().optional(),ban_ocg:I().optional(),ban_goat:I().optional()}),rd=ze({id:Me(),name:I(),type:I(),humanReadableCardType:I(),frameType:I(),desc:I(),race:I(),ygoprodeck_url:I(),archetype:I().optional(),typeline:ke(I()).optional(),atk:Me().optional(),def:Me().optional(),level:Me().optional(),attribute:I().optional(),banlist_info:nd.optional(),card_images:ke(Xl),card_sets:ke(ed).optional(),card_prices:ke(td).optional()}),id=ze({data:ke(rd)});function Ar(e){const t=e.card_images[0];return{id:e.id,name:e.name,type:e.type,frameType:e.frameType,desc:e.desc,archetype:e.archetype,atk:e.atk,def:e.def,level:e.level,attribute:e.attribute,race:e.type.toLowerCase().includes("monster")?e.race:void 0,images:t?{image:t.image_url,imageSmall:t.image_url_small,imageCropped:t.image_url_cropped}:null}}const od="https://db.ygoprodeck.com/api/v7",zr="cardinfo.php",Tn=new Map;async function Dr(e,t){const r={...Kl(),method:"GET"},i=`${od}/${t}`;try{const o=await Ql(e,i,r);if(!o.ok){if(console.error(`YGOPRODeck API Error: ${o.status} ${o.statusText} - ${i}`),o.status===429)throw new Error("YGOPRODeck API rate limit exceeded. Please reduce request frequency.");return null}const s=await o.json();return id.parse(s)}catch(o){throw o instanceof Bu?console.error("YGOPRODeck API response validation failed:",o.issues):console.error("YGOPRODeck API fetch failed:",o),o}}async function sd(e,t){const n=`${zr}?id=${t}`,r=await Dr(e,n),i=r==null?void 0:r.data[0];return i?Ar(i):null}async function ad(e,t){if(t.length===0)return[];const n=[],r=[];for(const o of t){const s=Tn.get(o);s?n.push(s):r.push(o)}let i=[];if(r.length>0){const o=r.join(","),s=`${zr}?id=${o}`,a=await Dr(e,s);if(a!=null&&a.data){i=a.data;for(const u of i)Tn.set(u.id,u)}}return[...n,...i].map(Ar)}class cd{async getCardsByIds(t,n){return ad(t,n)}async getCardById(t,n){const r=await sd(t,n);if(!r)throw new Error(`Card not found: ID ${n}`);return r}}let vt=null;function ud(){return vt||(vt=new cd),vt}function ld(e){const t=e.toLowerCase();return t.includes("monster")?"monster":t.includes("spell")?"spell":t.includes("trap")?"trap":null}function dd(e){return e.toLowerCase()}function fd(e,t){const n=`${t.jaName} (ID: ${t.id})`,r=ld(e.type);r&&r!==t.type&&console.warn(`[CardData Mismatch] ${n}: type が一致しません。Domain="${t.type}", API="${r}" (raw: "${e.type}")`);const i=dd(e.frameType);i!==t.frameType&&console.warn(`[CardData Mismatch] ${n}: frameType が一致しません。Domain="${t.frameType}", API="${i}" (raw: "${e.frameType}")`)}function pd(e,t){fd(e,t);const n=t.type==="monster"&&e.atk!==void 0&&e.def!==void 0&&e.level!==void 0?{attack:e.atk,defense:e.def,level:e.level,attribute:e.attribute??"",race:e.race??""}:void 0;return{id:t.id,name:e.name,jaName:t.jaName,type:t.type,description:e.desc,frameType:t.frameType,archetype:e.archetype,monsterAttributes:n,images:e.images??void 0}}function hd(e){const t=le.get(e.id);return pd(e,t)}function md(e){return e.map(t=>hd(t))}const _d={isInitialized:!1,isLoading:!1,error:null,data:new Map},re=Xe(_d),vd=ud();async function Gd(e){const t=N(re);if(!(t.isInitialized&&e.every(n=>t.data.has(n)))){re.update(n=>({...n,isLoading:!0,error:null}));try{const n=e.filter(r=>!t.data.has(r));if(n.length>0){const r=await vd.getCardsByIds(fetch,n),i=md(r);re.update(o=>{const s=new Map(o.data);return i.forEach(a=>{s.set(a.id,a)}),{...o,isInitialized:!0,isLoading:!1,data:s}})}else re.update(r=>({...r,isInitialized:!0,isLoading:!1}))}catch(n){const r=n instanceof Error?n.message:"Failed to initialize display card data cache";throw console.error("[displayCardDataCache] Initialization error:",n),re.update(i=>({...i,isLoading:!1,error:r})),n}}}function Bd(e){return N(re).data.get(e)}const Hd={subscribe:re.subscribe,get isInitialized(){return N(re).isInitialized},get isLoading(){return N(re).isLoading},get error(){return N(re).error}},gd={small:"w-16 h-24",medium:"w-22 h-32",large:"w-32 h-48"},Sd={small:"w-4 h-4 text-xs",medium:"w-6 h-6 text-xs",large:"w-8 h-8 text-sm"},Cd=""+new URL("../assets/CardBack.DGn8cQOG.jpg",import.meta.url).href;var yd=G('<div class="w-full h-full flex items-center justify-center p-1"><img alt="裏向きカード" class="w-full h-full object-cover rounded-sm"/></div>'),Id=G('<img class="w-full h-full object-cover rounded-sm"/>'),Od=G('<span class="text-xs opacity-75 select-none mt-1"> </span>'),Ed=G('<div class="w-full h-full bg-surface-200-700-token rounded-sm flex flex-col items-center justify-center text-center overflow-hidden"><img class="w-full h-full object-cover opacity-30"/> <div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-xs select-none text-surface-600-300-token font-medium"> </span> <!></div></div>'),Td=G('<div class="w-full h-full bg-surface-200-700-token rounded-sm flex items-center justify-center"><img alt="" class="w-full h-full object-cover opacity-20"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs opacity-50 select-none">No Image</span></div></div>'),Rd=G('<div class="px-1 py-1 bg-surface-50-900-token border-t border-surface-300"><div class="text-xs font-medium truncate"> </div></div>'),bd=G('<div class="flex-1 flex items-center justify-center p-1"><!></div> <!>',1),kd=G('<div class="absolute top-1 right-1 w-3 h-3 bg-primary-500 rounded-full animate-pulse"></div>'),wd=G('<div class="absolute inset-0 bg-primary-500 opacity-10 pointer-events-none"></div>'),Nd=G("<!> <!> <!>",1),Ad=G("<button><!></button>"),zd=G("<div><!></div>");function Jd(e,t){Rn(t,!0);const n=F=>{var H=Nd(),Ie=ht(H);{var $e=x=>{var te=yd(),Ze=W(te);Y(te),ge(()=>Te(Ze,"src",V)),L(x,te)},Fr=x=>{var te=bd(),Ze=ht(te),jr=W(Ze);{var Ur=ne=>{var J=Id();ge(()=>{Te(J,"src",t.card.images.imageCropped),Te(J,"alt",t.card.jaName||"カード")}),L(ne,J)},Gr=(ne,J)=>{{var _e=Oe=>{var ve=Ed(),Pe=W(ve),Vt=Ve(Pe,2),ft=W(Vt),Jr=W(ft,!0);Y(ft);var Wr=Ve(ft,2);{var Yr=pt=>{var Ee=Od(),qr=W(Ee,!0);Y(Ee),ge(()=>We(qr,t.card.type)),L(pt,Ee)};ce(Wr,pt=>{var Ee;(Ee=t.card)!=null&&Ee.type&&pt(Yr)})}Y(Vt),Y(ve),ge(()=>{Te(Pe,"src",V),Te(Pe,"alt",u()),We(Jr,u())}),L(Oe,ve)},dt=Oe=>{var ve=Td(),Pe=W(ve);ti(2),Y(ve),ge(()=>Te(Pe,"src",V)),L(Oe,ve)};ce(ne,Oe=>{A(me)?Oe(_e):Oe(dt,!1)},J)}};ce(jr,ne=>{var J,_e;(_e=(J=t.card)==null?void 0:J.images)!=null&&_e.imageCropped?ne(Ur):ne(Gr,!1)})}Y(Ze);var Br=Ve(Ze,2);{var Hr=ne=>{var J=Rd(),_e=W(J),dt=W(_e,!0);Y(_e),Y(J),ge(()=>We(dt,t.card.jaName)),L(ne,J)};ce(Br,ne=>{t.card&&!A(me)&&ne(Hr)})}L(x,te)};ce(Ie,x=>{v()?x($e):x(Fr,!1)})}var Pt=Ve(Ie,2);{var xr=x=>{var te=kd();L(x,te)};ce(Pt,x=>{A(C)&&x(xr)})}var Mr=Ve(Pt,2);{var Lr=x=>{var te=wd();L(x,te)};ce(Mr,x=>{f()&&(A(m)||A(C))&&x(Lr)})}L(F,H)};let r=q(t,"size",3,"medium"),i=q(t,"clickable",3,!1),o=q(t,"selectable",3,!1),s=q(t,"isSelected",3,!1),a=q(t,"placeholder",3,!1),u=q(t,"placeholderText",3,"カード"),l=q(t,"rotation",3,0),f=q(t,"animate",3,!0),p=q(t,"showDetailOnClick",3,!1),v=q(t,"faceDown",3,!1),m=Lt(!1),S=Lt(!1),C=ie(()=>o()?A(S):s());ei(()=>{o()||Ge(S,s())});function R(){var F;console.log(`[Card] クリックイベント発生: clickable=${i()}, card=${(F=t.card)==null?void 0:F.jaName}, hasOnClick=${!!t.onClick}`),i()&&t.card&&t.onClick&&(console.log(`[Card] onClickコールバックを実行します: ${t.card.jaName}`),t.onClick(t.card)),o()&&Ge(S,!A(S)),p()&&t.card&&ri(t.card)}function he(){Ge(m,!0),t.onHover&&t.card&&t.onHover(t.card)}function w(){Ge(m,!1),t.onHover&&t.onHover(null)}const me=ie(()=>a()||!t.card),V=Cd,D=ie(()=>f()?"transition-all duration-300 ease-in-out":""),U=ie(()=>i()||o()||p()?"cursor-pointer hover:scale-105 hover:shadow-lg":""),De=ie(()=>A(C)?"ring-2 ring-primary-500 shadow-lg":""),lt=ie(()=>l()!==0?`transform: rotate(${l()}deg);`:""),$r=ie(()=>()=>{var F;return ni((F=t.card)==null?void 0:F.frameType)}),Dt=ie(()=>()=>`
      ${gd[r()]}
      ${A(D)}
      ${A(U)}
      ${A(De)}
      ${A($r)()}
      border border-surface-300 rounded aspect-[3/4] flex flex-col justify-between
      relative overflow-hidden
    `),$t=ie(()=>({style:A(lt),onclick:i()||o()||p()?R:void 0,onmouseenter:he,onmouseleave:w}));var Zt=Xr(),Zr=ht(Zt);{var Pr=F=>{var H=Ad();jt(H,$e=>({class:`${$e??""} bg-transparent p-0 border border-2 border-gray-100`,...A($t)}),[()=>A(Dt)()]);var Ie=W(H);n(Ie),Y(H),L(F,H)},Vr=F=>{var H=zd();jt(H,$e=>({class:$e,role:"img",...A($t)}),[()=>A(Dt)()]);var Ie=W(H);n(Ie),Y(H),L(F,H)};ce(Zr,F=>{i()||o()||p()?F(Pr):F(Vr,!1)})}L(e,Zt),bn()}var Dd=G("<div> </div>");function Wd(e,t){Rn(t,!0);let n=q(t,"size",3,"medium"),r=q(t,"colorClasses",3,"bg-primary-200 text-primary-900");var i=Dd(),o=W(i,!0);Y(i),ge(()=>{ii(i,1,`absolute -top-2 -right-2 ${Sd[n()]??""} ${r()??""} rounded-full flex items-center justify-center font-bold shadow-md z-10`),We(o,t.count)}),L(e,i),bn()}export{Jd as C,tt as Z,Bd as a,Wd as b,se as c,Hd as d,Bi as e,gd as f,Ud as g,Cd as h,Gd as i,P as j};
