import{g as fe,c as le,e as Bt,a as Me,C as Ce,b as Te,f as Ve,h as $e,i as Et,j as Ct,Z as Qe}from"../chunks/BMDz8R2p.js";import{c as Ae,a as m,f as y}from"../chunks/fttJYjWf.js";import{o as Ee}from"../chunks/DgC7Iw_E.js";import{a5 as ne,g as e,ar as b,c as r,s as f,r as n,t as ae,a4 as he,a6 as pe,aq as me,a7 as Q,aM as yt,ah as He,f as Pe,aF as It,a9 as Ue}from"../chunks/CinUWrNX.js";import{s as se,d as ze,e as je}from"../chunks/CLOOnzvv.js";import{p as ye,a as wt,s as ge}from"../chunks/DIRs0Bkg.js";import{d as ue,w as Ht,g as ht}from"../chunks/vgD3KS5I.js";import{M as Be,I as pt,x as Xe,y as Je}from"../chunks/CusGxjSp.js";import{p as Nt}from"../chunks/Dx2K-mJR.js";import{i as q}from"../chunks/zKTDKC1X.js";import{e as we}from"../chunks/2zu3kIHl.js";import{b as ke}from"../chunks/f-JyuqtT.js";import{b as Ze,s as Ie,i as et,c as St,j as Lt}from"../chunks/xcxp5XA3.js";const Gt=({params:a})=>{const{deckId:t}=a,{deckData:s,uniqueCardIds:h}=fe.initializeGame(t);return{deckId:t,deckData:s,uniqueCardIds:h}},Ta=Object.freeze(Object.defineProperty({__proto__:null,load:Gt},Symbol.toStringTag,{value:"Module"}));function tt(a){return{cardId:a.id,instanceId:a.instanceId}}function nt(a){var t,s,h;return{cardId:a.id,instanceId:a.instanceId,position:((t=a.stateOnField)==null?void 0:t.position)??"faceDown",battlePosition:(s=a.stateOnField)==null?void 0:s.battlePosition,counters:((h=a.stateOnField)==null?void 0:h.counters)??[]}}ue(le,a=>a.phase);const qt=ue(le,a=>Bt(a.phase));ue(le,a=>a.turn);const Wt=ue(le,a=>a.lp.player),Yt=ue(le,a=>a.lp.opponent),Qt=ue(le,a=>a.space.hand.length),Ut=ue(le,a=>a.space.mainDeck.length);ue(le,a=>a.space.graveyard.length);ue(le,a=>a.space.mainMonsterZone.length+a.space.spellTrapZone.length+a.space.fieldZone.length);const Xt=ue(le,a=>a.result);ue(le,a=>a.space.mainDeck.length===0);ue(le,a=>a.space.hand.length===0);const Jt=ue(le,a=>a.space.hand.map(tt)),Kt=ue(le,a=>a.space.graveyard.map(tt));ue(le,a=>a.space.banished.map(tt));const Vt=ue(le,a=>a.space.mainMonsterZone.map(nt)),$t=ue(le,a=>a.space.spellTrapZone.map(nt)),en=ue(le,a=>a.space.fieldZone.map(nt)),xt={activeAnimations:[],isAnimating:!1};function tn(){const{subscribe:a,set:t,update:s}=Ht(xt),h=new Map,k=new Map;return{subscribe:a,registerCardPosition(d,v){h.set(d,v)},getCardPosition(d){return h.get(d)},unregisterCardPosition(d){h.delete(d)},registerZonePosition(d,v){k.set(d,v)},getZonePosition(d){return k.get(d)},startAnimation(d){s(v=>({activeAnimations:[...v.activeAnimations,{...d,status:"animating"}],isAnimating:!0}))},completeAnimation(d){s(v=>{const D=v.activeAnimations.filter(I=>I.instanceId!==d);return{activeAnimations:D,isAnimating:D.length>0}})},clearAnimations(){t(xt)},getAnimatingCardIds(){return ht({subscribe:a}).activeAnimations.map(d=>d.instanceId)},isCardAnimating(d){return ht({subscribe:a}).activeAnimations.some(v=>v.instanceId===d)}}}const $=tn();function nn(a){const t=Me(a.cardId);if(!t)return null;const s=a.counters.find(h=>h.type==="spell");return{card:t,instanceId:a.instanceId,faceDown:a.position==="faceDown",rotation:a.battlePosition==="defense"?270:0,spellCounterCount:(s==null?void 0:s.count)??0}}function Ke(a,t=5){const s=Array(t).fill(null);return a.forEach((h,k)=>{k<t&&(s[k]=nn(h))}),s}const an=""+new URL("../assets/SpellCounter.pzkYCI1C.png",import.meta.url).href;var rn=y('<div class="absolute bottom-8 right-1 px-1 bg-green-900 text-white rounded-full flex items-center justify-center font-bold border-1 border-green-400 shadow-md z-10" data-testid="spell-counter-badge"><img alt="魔力カウンター" class="w-4 h-4"/> <span class="text-xs" data-testid="spell-counter-count"> </span></div>');function sn(a,t){const s=b(()=>t.count>0);var h=Ae(),k=ne(h);{var d=v=>{var D=rn(),I=r(D),Z=f(I,2),A=r(Z,!0);n(Z),n(D),ae(()=>{Ze(D,"title",`魔力カウンター: ${t.count??""}`),Ze(I,"src",an),se(A,t.count)}),m(v,D)};q(k,v=>{e(s)&&v(d)})}m(a,h)}var on=(a,t,s)=>t(e(s)),cn=y("<button> </button>"),dn=y('<div class="absolute -bottom-10 md:-bottom-14 left-1/2 -translate-x-1/2 flex flex-wrap justify-center gap-1 md:gap-2 z-10 max-w-[200px]"><!> <button class="btn btn-sm preset-tonal-warning">キャンセル</button></div>'),ln=y('<div class="relative"><div class="transition-transform duration-300 hover:scale-105"><!> <!></div> <!></div>');function Re(a,t){he(t,!0);let s=ye(t,"size",3,"medium"),h=ye(t,"showDetailOnClick",3,!0),k=ye(t,"faceDown",3,!1),d=ye(t,"rotation",3,0),v=ye(t,"spellCounterCount",3,0);function D(){t.onSelect(t.card,t.instanceId)}function I(P){P.onClick(t.card,t.instanceId)}function Z(P,H){const L=P||"filled",c=H||"primary";return{filled:{primary:"preset-filled-primary-500",secondary:"preset-filled-secondary-500",tertiary:"preset-filled-tertiary-500",success:"preset-filled-success-500",warning:"preset-filled-warning-500",error:"preset-filled-error-500",surface:"preset-filled-surface-500"},tonal:{primary:"preset-tonal-primary",secondary:"preset-tonal-secondary",tertiary:"preset-tonal-tertiary",success:"preset-tonal-success",warning:"preset-tonal-warning",error:"preset-tonal-error",surface:"preset-tonal-surface"},outlined:{primary:"preset-outlined-primary-500",secondary:"preset-outlined-secondary-500",tertiary:"preset-outlined-tertiary-500",success:"preset-outlined-success-500",warning:"preset-outlined-warning-500",error:"preset-outlined-error-500",surface:"preset-outlined-surface-500"}}[L][c]}var A=ln(),T=r(A),i=r(T);Ce(i,{get card(){return t.card},get size(){return s()},get faceDown(){return k()},get rotation(){return d()},clickable:!0,get isSelected(){return t.isSelected},onClick:D,get showDetailOnClick(){return h()},animate:!1});var u=f(i,2);{var M=P=>{sn(P,{get count(){return v()}})};q(u,P=>{v()>0&&P(M)})}n(T);var R=f(T,2);{var O=P=>{var H=dn(),L=r(H);we(L,17,()=>t.actionButtons,o=>o.label,(o,g)=>{var E=cn();E.__click=[on,I,g];var K=r(E,!0);n(E),ae(U=>{Ie(E,1,`btn btn-sm w-full border-2 border-gray-200 ${U??""} ${t.isActivatable?"":"opacity-50 cursor-not-allowed"}`),se(K,e(g).label)},[()=>Z(e(g).style,e(g).color)]),m(o,E)});var c=f(L,2);c.__click=function(...o){var g;(g=t.onCancel)==null||g.apply(this,o)},n(H),m(P,H)};q(R,P=>{t.isSelected&&P(O)})}n(A),m(a,A),pe()}ze(["click"]);function un(a,t){t.onOpenChange(!1)}function vn(a,t){Q(t,!e(t))}var fn=y('<div class="relative"><div><!></div> <!></div>'),gn=y('<div class="relative"><div><!></div></div>'),mn=y('<div class="flex gap-2 flex-wrap"><!></div>'),_n=y('<div class="text-center py-8"><p class="text-gray-500"> </p></div>'),bn=y('<header class="flex justify-between items-center mb-4"><h2 class="text-2xl sm:text-3xl font-bold mx-2"> </h2> <div class="flex items-center gap-2"><button type="button"><!> <span class="text-xs"> </span></button> <button type="button" class="btn preset-tonal rounded-full"><!></button></div></header> <div class="text-sm text-surface-600-300-token mb-2"> </div> <!>',1);function kt(a,t){he(t,!0);let s=ye(t,"emptyMessage",3,"カードがありません"),h=ye(t,"borderColor",3,"border-gray-400");const k=b(()=>t.cards.slice().reverse());let d=me(!1);const v=b(()=>{const I=new Map;return e(k).forEach(({card:Z,instanceId:A})=>{const T=I.get(Z.id);T?T.quantity+=1:I.set(Z.id,{card:Z,instanceId:A,quantity:1})}),Array.from(I.values())});function D(I){t.onOpenChange(I.open)}Be(a,{get open(){return t.open},onOpenChange:D,contentBase:"card bg-surface-100-900 p-6 mx-auto space-y-4 shadow-xl w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto",backdropClasses:"backdrop-blur-sm",content:Z=>{var A=bn(),T=ne(A),i=r(T),u=r(i,!0);n(i);var M=f(i,2),R=r(M);R.__click=[vn,d];var O=r(R);const P=b(()=>e(d)?"mdi:card-multiple":"mdi:cards");pt(O,{get icon(){return e(P)},class:"size-4"});var H=f(O,2),L=r(H,!0);n(H),n(R);var c=f(R,2);c.__click=[un,t];var o=r(c);pt(o,{icon:"mdi:close",class:"size-4"}),n(c),n(M),n(T);var g=f(T,2),E=r(g);n(g);var K=f(g,2);{var U=te=>{var _=mn(),p=r(_);{var F=l=>{var X=Ae(),Y=ne(X);we(Y,17,()=>e(v),({card:B,instanceId:N,quantity:w})=>N,(B,N)=>{let w=()=>e(N).card,S=()=>e(N).quantity;var G=fn(),J=r(G),ce=r(J);Ce(ce,{get card(){return w()},size:"medium",showDetailOnClick:!0}),n(J);var V=f(J,2);{var re=W=>{Te(W,{get count(){return S()},colorClasses:"bg-primary-200 text-primary-900"})};q(V,W=>{S()>1&&W(re)})}n(G),ae(()=>Ie(J,1,`border-2 ${h()??""} rounded-lg shadow-md overflow-hidden`)),m(B,G)}),m(l,X)},C=l=>{var X=Ae(),Y=ne(X);we(Y,17,()=>e(k),({card:B,instanceId:N})=>N,(B,N)=>{let w=()=>e(N).card;var S=gn(),G=r(S),J=r(G);Ce(J,{get card(){return w()},size:"medium",showDetailOnClick:!0}),n(G),n(S),ae(()=>Ie(G,1,`border-2 ${h()??""} rounded-lg shadow-md overflow-hidden`)),m(B,S)}),m(l,X)};q(p,l=>{e(d)?l(F):l(C,!1)})}n(_),m(te,_)},ee=te=>{var _=_n(),p=r(_),F=r(p,!0);n(p),n(_),ae(()=>se(F,s())),m(te,_)};q(K,te=>{t.cards.length>0?te(U):te(ee,!1)})}ae(()=>{se(u,t.title),Ie(R,1,`btn btn-sm ${e(d)?"preset-filled-primary-500":"preset-tonal"}`),Ze(R,"title",e(d)?"個別表示に切り替え":"集約表示に切り替え"),se(L,e(d)?"集約":"個別"),se(E,`${t.cards.length??""}枚`)}),m(Z,A)},$$slots:{content:!0}}),pe()}ze(["click"]);var Cn=(a,t)=>a.key==="Enter"&&t(),hn=y('<div class="absolute inset-1"><!></div> <!>',1),pn=y('<div class="h-full flex items-center justify-center p-1 relative" style="filter: grayscale(0.8) brightness(0.7) contrast(1.2);"><img alt="墓地" class="w-full h-full object-cover opacity-30 rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-surface-600-300-token text-center select-none drop-shadow-lg"> </span></div></div> <!>',1),xn=y('<div role="button" tabindex="0"><!></div> <!>',1);function yn(a,t){he(t,!0);let s=ye(t,"size",3,"medium"),h=ye(t,"animatingInstanceIds",19,()=>new Set);const k=et();let d=me(void 0);Ee(()=>{if(e(d)){const o=e(d).getBoundingClientRect();$.registerZonePosition("graveyard",o)}});let v=me(!1);const D=b(()=>t.cards.filter(o=>!h().has(o.instanceId))),I=b(()=>e(D).length>0?e(D)[e(D).length-1].card:null),Z=b(()=>e(D).length);function A(){Q(v,!0)}function T(o){Q(v,o,!0)}let i=me(!1);function u(){Q(i,!0)}function M(){Q(i,!1)}var R=xn(),O=ne(R);O.__click=A,O.__keydown=[Cn,A];var P=r(O);{var H=o=>{var g=hn(),E=ne(g),K=r(E);Ce(K,{get card(){return e(I)},get size(){return s()},clickable:!1}),n(E);var U=f(E,2);Te(U,{get count(){return e(Z)}}),m(o,g)},L=o=>{var g=pn(),E=ne(g),K=r(E),U=f(K,2),ee=r(U),te=r(ee,!0);n(ee),n(U),n(E);var _=f(E,2);Te(_,{get count(){return e(Z)}}),ae(()=>{Ze(K,"src",$e),se(te,k?"GY":"墓地")}),m(o,g)};q(P,o=>{e(I)?o(H):o(L,!1)})}n(O),ke(O,o=>Q(d,o),()=>e(d));var c=f(O,2);kt(c,{get cards(){return t.cards},get open(){return e(v)},onOpenChange:T,title:"墓地",borderColor:"border-gray-400"}),ae(()=>Ie(O,1,`
    ${Ve[s()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    hover:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700
    ${e(i)?"scale-105 shadow-lg":""}
  `)),je("mouseenter",O,u),je("mouseleave",O,M),m(a,R),pe()}ze(["click","keydown"]);var In=(a,t)=>a.key==="Enter"&&t(),wn=y('<div role="button" tabindex="0"><div class="h-full flex items-center justify-center p-1 relative"><img alt="EXデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">EX</span></div></div> <!></div> <!>',1);function Sn(a,t){he(t,!0);let s=ye(t,"size",3,"medium"),h=me(!1);function k(){Q(h,!0)}function d(R){Q(h,R,!0)}let v=me(!1);function D(){Q(v,!0)}function I(){Q(v,!1)}var Z=wn(),A=ne(Z);A.__click=k,A.__keydown=[In,k];var T=r(A),i=r(T);yt(2),n(T);var u=f(T,2);Te(u,{get count(){return t.cards.length}}),n(A);var M=f(A,2);kt(M,{get cards(){return t.cards},get open(){return e(h)},onOpenChange:d,title:"EXデッキ",borderColor:"border-purple-400"}),ae(()=>{Ie(A,1,`
    ${Ve[s()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    ${e(v)?"scale-105 shadow-lg":""}
  `),Ze(i,"src",$e)}),je("mouseenter",A,D),je("mouseleave",A,I),m(a,Z),pe()}ze(["click","keydown"]);var kn=y('<div role="img"><div class="h-full flex items-center justify-center p-1 relative"><img alt="メインデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">Deck</span></div></div> <!></div>');function An(a,t){he(t,!0);let s=ye(t,"size",3,"medium"),h=me(void 0);Ee(()=>{if(e(h)){const I=e(h).getBoundingClientRect();$.registerZonePosition("mainDeck",I)}});var k=kn(),d=r(k),v=r(d);yt(2),n(d);var D=f(d,2);Te(D,{get count(){return t.cardCount}}),n(k),ke(k,I=>Q(h,I),()=>e(h)),ae(()=>{Ie(k,1,`
    ${Ve[s()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
  `),Ze(v,"src",$e)}),m(a,k),pe()}var On=y("<div><!></div>"),Dn=y('<div class="absolute inset-0 opacity-0 pointer-events-none"><!></div>'),Mn=y('<div class="relative"><div style="filter: sepia(0.3) hue-rotate(90deg) saturate(1.5) brightness(0.9);"><!></div> <!></div>'),zn=y('<div class="flex justify-center"><!></div>'),Fn=y("<div><!></div>"),Rn=y('<div class="absolute inset-0 opacity-0 pointer-events-none"><!></div>'),Pn=y('<div class="relative"><div style="filter: sepia(0.5) hue-rotate(30deg) saturate(1.8) brightness(0.85);"><!></div> <!></div>'),Zn=y('<div class="flex justify-center"><!></div>'),Tn=y("<div><!></div>"),jn=y('<div class="absolute inset-0 opacity-0 pointer-events-none"><!></div>'),Bn=y('<div class="relative"><div style="filter: sepia(0.4) hue-rotate(200deg) saturate(2) brightness(0.8);"><!></div> <!></div>'),En=y('<div class="flex justify-center"><!></div>'),Hn=y('<div class="flex justify-center"><!></div>'),Nn=y('<div class="flex justify-center"><!></div>'),Ln=y('<div class="flex justify-center"><!></div>'),Gn=y('<div class="grid grid-cols-4 gap-1 mb-2"><!> <!> <!> <!></div> <div class="grid grid-cols-5 gap-1 mb-2"></div> <div class="grid grid-cols-5 gap-1 mb-2"></div>',1),qn=y('<div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div> <div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div>',1),Wn=y('<div class="card p-2 max-w-6xl mx-auto"><div class="transition-all duration-300"><!></div></div>');function Yn(a,t){he(t,!0);const s=(_,p=Ue)=>{var F=zn();const C=b(()=>t.fieldCards[0]),l=b(()=>{var w;return(w=e(C))==null?void 0:w.instanceId}),X=b(()=>e(l)?I().has(e(l)):!1);var Y=r(F);{var B=w=>{var S=On(),G=r(S);const J=b(()=>t.selectedFieldCardInstanceId===e(l)),ce=b(()=>o(e(l),e(C).faceDown).length>0),V=b(()=>o(e(l),e(C).faceDown)),re=b(()=>t.onCancelFieldCardSelection||(()=>{}));Re(G,{get card(){return e(C).card},get instanceId(){return e(l)},get faceDown(){return e(C).faceDown},get isSelected(){return e(J)},get isActivatable(){return e(ce)},onSelect:P,get actionButtons(){return e(V)},get onCancel(){return e(re)},get size(){return i},showDetailOnClick:!0}),n(S),ke(S,W=>u[e(l)]=W,()=>u==null?void 0:u[e(l)]),m(w,S)},N=w=>{var S=Mn(),G=r(S),J=r(G);Ce(J,{placeholder:!0,get placeholderText(){return p()},get size(){return i}}),n(G);var ce=f(G,2);{var V=re=>{var W=Dn(),ie=r(W);Re(ie,{get card(){return e(C).card},get instanceId(){return e(l)},get faceDown(){return e(C).faceDown},isSelected:!1,isActivatable:!1,onSelect:()=>{},actionButtons:[],onCancel:()=>{},get size(){return i}}),n(W),ke(W,_e=>u[e(l)]=_e,()=>u==null?void 0:u[e(l)]),m(re,W)};q(ce,re=>{e(C)&&e(l)&&e(X)&&re(V)})}n(S),m(w,S)};q(Y,w=>{e(C)&&e(l)&&!e(X)?w(B):w(N,!1)})}n(F),ke(F,w=>Q(M,w),()=>e(M)),m(_,F)},h=(_,p=Ue)=>{var F=Zn();const C=b(()=>t.monsterCards[p()]),l=b(()=>{var w;return(w=e(C))==null?void 0:w.instanceId}),X=b(()=>e(l)?I().has(e(l)):!1);var Y=r(F);{var B=w=>{var S=Fn(),G=r(S);const J=b(()=>e(C).rotation||0),ce=b(()=>t.selectedFieldCardInstanceId===e(l)),V=b(()=>g(e(l)).length>0),re=b(()=>g(e(l))),W=b(()=>t.onCancelFieldCardSelection||(()=>{})),ie=b(()=>e(C).spellCounterCount||0);Re(G,{get card(){return e(C).card},get instanceId(){return e(l)},get faceDown(){return e(C).faceDown},get rotation(){return e(J)},get isSelected(){return e(ce)},get isActivatable(){return e(V)},onSelect:P,get actionButtons(){return e(re)},get onCancel(){return e(W)},get size(){return i},showDetailOnClick:!0,get spellCounterCount(){return e(ie)}}),n(S),ke(S,_e=>u[e(l)]=_e,()=>u==null?void 0:u[e(l)]),m(w,S)},N=w=>{var S=Pn(),G=r(S),J=r(G);const ce=b(()=>p()+1);Ce(J,{placeholder:!0,get placeholderText(){return`M${e(ce)??""}`},get size(){return i}}),n(G);var V=f(G,2);{var re=W=>{var ie=Rn(),_e=r(ie);const Oe=b(()=>e(C).rotation||0),Fe=b(()=>e(C).spellCounterCount||0);Re(_e,{get card(){return e(C).card},get instanceId(){return e(l)},get faceDown(){return e(C).faceDown},get rotation(){return e(Oe)},isSelected:!1,isActivatable:!1,onSelect:()=>{},actionButtons:[],onCancel:()=>{},get size(){return i},get spellCounterCount(){return e(Fe)}}),n(ie),ke(ie,be=>u[e(l)]=be,()=>u==null?void 0:u[e(l)]),m(W,ie)};q(V,W=>{e(C)&&e(l)&&e(X)&&W(re)})}n(S),m(w,S)};q(Y,w=>{e(C)&&e(l)&&!e(X)?w(B):w(N,!1)})}n(F),m(_,F)},k=(_,p=Ue)=>{var F=En();const C=b(()=>t.spellTrapCards[p()]),l=b(()=>{var w;return(w=e(C))==null?void 0:w.instanceId}),X=b(()=>e(l)?I().has(e(l)):!1);var Y=r(F);{var B=w=>{var S=Tn(),G=r(S);{var J=V=>{const re=b(()=>t.selectedFieldCardInstanceId===e(l)),W=b(()=>c(e(l)).length>0),ie=b(()=>c(e(l))),_e=b(()=>t.onCancelFieldCardSelection||(()=>{}));Re(V,{get card(){return e(C).card},get instanceId(){return e(l)},faceDown:!0,get isSelected(){return e(re)},get isActivatable(){return e(W)},onSelect:P,get actionButtons(){return e(ie)},get onCancel(){return e(_e)},get size(){return i},showDetailOnClick:!0})},ce=V=>{Ce(V,{get card(){return e(C).card},faceDown:!1,get size(){return i},clickable:!0,showDetailOnClick:!0,onClick:()=>P(e(C).card,e(l))})};q(G,V=>{e(C).faceDown?V(J):V(ce,!1)})}n(S),ke(S,V=>u[e(l)]=V,()=>u==null?void 0:u[e(l)]),m(w,S)},N=w=>{var S=Bn(),G=r(S),J=r(G);const ce=b(()=>p()+1);Ce(J,{placeholder:!0,get placeholderText(){return`S${e(ce)??""}`},get size(){return i}}),n(G);var V=f(G,2);{var re=W=>{var ie=jn(),_e=r(ie);{var Oe=be=>{Re(be,{get card(){return e(C).card},get instanceId(){return e(l)},faceDown:!0,isSelected:!1,isActivatable:!1,onSelect:()=>{},actionButtons:[],onCancel:()=>{},get size(){return i}})},Fe=be=>{Ce(be,{get card(){return e(C).card},faceDown:!1,get size(){return i},clickable:!1})};q(_e,be=>{e(C).faceDown?be(Oe):be(Fe,!1)})}n(ie),ke(ie,be=>u[e(l)]=be,()=>u==null?void 0:u[e(l)]),m(W,ie)};q(V,W=>{e(C)&&e(l)&&e(X)&&W(re)})}n(S),m(w,S)};q(Y,w=>{e(C)&&e(l)&&!e(X)?w(B):w(N,!1)})}n(F),m(_,F)},d=_=>{var p=Hn(),F=r(p);yn(F,{get cards(){return t.graveyardCards},get size(){return i},get animatingInstanceIds(){return I()}}),n(p),m(_,p)},v=_=>{var p=Nn(),F=r(p);Sn(F,{get cards(){return t.extraDeckCards},get size(){return i}}),n(p),m(_,p)},D=_=>{var p=Ln(),F=r(p);An(F,{get cardCount(){return t.deckCards},get size(){return i}}),n(p),m(_,p)};let I=ye(t,"animatingInstanceIds",19,()=>new Set);const A=[...Array(5).keys()],T=et(),i=T?"small":"medium";let u=He({}),M=me(void 0);Ee(()=>{if(e(M)){const _=e(M).getBoundingClientRect();$.registerZonePosition("fieldZone",_)}});let R=[];async function O(){await It();const _=[...t.fieldCards,...t.monsterCards,...t.spellTrapCards].filter(p=>p!==null);for(const p of _){const F=u[p.instanceId];if(F){const C=F.getBoundingClientRect();$.registerCardPosition(p.instanceId,C)}}}Pe(()=>{const _=[...t.fieldCards,...t.monsterCards,...t.spellTrapCards].filter(C=>C!==null),p=_.map(C=>C.instanceId).join(","),F=R.join(",");p!==F&&(R=_.map(C=>C.instanceId),O())});function P(_,p){t.onFieldCardClick&&t.onFieldCardClick(_,p)}function H(_){return fe.canActivateSpell(_)}function L(_){return fe.canActivateIgnitionEffect(_)}function c(_){return H(_)?[{label:"発動",style:"filled",color:"primary",onClick:t.onActivateSetSpell||(()=>{})}]:[]}function o(_,p){return p?H(_)?[{label:"発動",style:"filled",color:"primary",onClick:t.onActivateSetSpell||(()=>{})}]:[]:L(_)?[{label:"効果発動",style:"filled",color:"primary",onClick:t.onActivateIgnitionEffect||(()=>{})}]:[]}function g(_){return L(_)?[{label:"効果発動",style:"filled",color:"primary",onClick:t.onActivateIgnitionEffect||(()=>{})}]:[]}var E=Wn(),K=r(E),U=r(K);{var ee=_=>{var p=Gn(),F=ne(p),C=r(F);s(C,()=>"F");var l=f(C,2);v(l);var X=f(l,2);D(X);var Y=f(X,2);d(Y),n(F);var B=f(F,2);we(B,20,()=>A,w=>w,(w,S)=>{h(w,()=>S)}),n(B);var N=f(B,2);we(N,20,()=>A,w=>w,(w,S)=>{k(w,()=>S)}),n(N),m(_,p)},te=_=>{var p=qn(),F=ne(p),C=r(F);s(C,()=>"フィールド");var l=f(C,2);we(l,16,()=>A,S=>S,(S,G)=>{h(S,()=>G)});var X=f(l,2);d(X),n(F);var Y=f(F,2),B=r(Y);v(B);var N=f(B,2);we(N,16,()=>A,S=>S,(S,G)=>{k(S,()=>G)});var w=f(N,2);D(w),n(Y),m(_,p)};q(U,_=>{T?_(ee):_(te,!1)})}n(K),n(E),m(a,E),pe()}var Qn=y("<div><!></div>"),Un=y('<div class="text-center text-sm opacity-50">No cards in hand</div>'),Xn=y("<div></div>");function Jn(a,t){he(t,!0);const s=et(),h=s?"small":"medium";let k=He({}),d=[];async function v(){await It();for(const{instanceId:c}of t.cards){const o=k[c];if(o){const g=o.getBoundingClientRect();$.registerCardPosition(c,g)}}}Pe(()=>{const c=t.cards.map(g=>g.instanceId).join(","),o=d.join(",");c!==o&&(d=t.cards.map(g=>g.instanceId),v())});function D(c){return fe.canActivateSpell(c)}function I(c){return fe.canSummonMonster(c)}function Z(c){return fe.canSetMonster(c)}function A(c){return fe.canSetSpellTrap(c)}function T(c){const o={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10"};if(c<=0)return"grid-cols-1";if(s){if(c>=5)return"grid-cols-5"}else if(c>=10)return"grid-cols-10";return o[c]}function i(c,o){const g=t.selectedHandCardInstanceId===o?null:o;t.onHandCardSelect(g)}function u(c,o){t.onCardClick(c,o),t.onHandCardSelect(null)}function M(c,o){t.onSummonMonster(c,o),t.onHandCardSelect(null)}function R(c,o){t.onSetMonster(c,o),t.onHandCardSelect(null)}function O(c,o){t.onSetSpellTrap(c,o),t.onHandCardSelect(null)}function P(){t.onHandCardSelect(null)}function H(c,o){const g=[];return c.type==="monster"?(I(o)&&g.push({label:"召喚",style:"filled",color:"primary",onClick:M}),Z(o)&&g.push({label:"セット",style:"filled",color:"primary",onClick:R})):(c.type==="spell"||c.type==="trap")&&(D(o)&&g.push({label:"発動",style:"filled",color:"primary",onClick:u}),A(o)&&g.push({label:"セット",style:"filled",color:"primary",onClick:O})),g}var L=Xn();we(L,21,()=>t.cards,({card:c,instanceId:o})=>o,(c,o)=>{let g=()=>e(o).card,E=()=>e(o).instanceId;var K=Ae(),U=ne(K);{var ee=_=>{var p=Qn(),F=r(p);const C=b(()=>t.selectedHandCardInstanceId===E()),l=b(()=>H(g(),E()).length>0),X=b(()=>H(g(),E()));Re(F,{get card(){return g()},get instanceId(){return E()},get isSelected(){return e(C)},get isActivatable(){return e(l)},onSelect:i,get actionButtons(){return e(X)},onCancel:P,get size(){return h}}),n(p),ke(p,(Y,B)=>k[B]=Y,Y=>k==null?void 0:k[Y],()=>[E()]),ae(Y=>Ie(p,1,Y),[()=>St(t.animatingInstanceIds.has(E())?"opacity-0":"")]),m(_,p)},te=_=>{Ce(_,{placeholder:!0,placeholderText:"...",get size(){return h}})};q(U,_=>{g()?_(ee):_(te,!1)})}m(c,K)},c=>{var o=Un();m(c,o)}),n(L),ae(c=>Ie(L,1,`grid ${c??""} gap-2 mb-16`),[()=>T(t.cards.length)]),m(a,L),pe()}function Kn(a,t){var s;(s=t.config)==null||s.onConfirm()}var Vn=y('<button class="btn variant-ghost">キャンセル</button>'),$n=y('<header class="text-center"><h2 class="h3 font-bold text-primary-600-300-token"> </h2></header> <article class="text-center"><p class="text-lg"> </p></article> <footer class="flex justify-center gap-3"><!> <button class="btn variant-filled-primary">OK</button></footer>',1);function ea(a,t){he(t,!0);const s=b(()=>{var d;return((d=t.config)==null?void 0:d.cancelable)??!1});function h(){var d,v;(v=(d=t.config)==null?void 0:d.onCancel)==null||v.call(d)}function k(d){!d.open&&t.isOpen&&e(s)&&h()}Be(a,{get open(){return t.isOpen},onOpenChange:k,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-md shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return e(s)},preventScroll:!0,content:v=>{var D=Ae(),I=ne(D);{var Z=A=>{var T=$n(),i=ne(T),u=r(i),M=r(u,!0);n(u),n(i);var R=f(i,2),O=r(R),P=r(O,!0);n(O),n(R);var H=f(R,2),L=r(H);{var c=g=>{var E=Vn();E.__click=h,m(g,E)};q(L,g=>{e(s)&&g(c)})}var o=f(L,2);o.__click=[Kn,t],n(H),ae(()=>{se(M,t.config.summary),se(P,t.config.description)}),m(A,T)};q(I,A=>{t.config&&A(Z)})}m(v,D)},$$slots:{content:!0}}),pe()}ze(["click"]);function ta(a,t,s,h){!t.config||!e(s)()||t.config.onConfirm(Array.from(e(h)))}var na=y('<button class="btn btn-sm btn-circle btn-ghost">✕</button>'),aa=y("<div><!></div>"),ra=y('<button class="btn btn-ghost">キャンセル</button>'),sa=y('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg"> </h3> <!></div> <p class="text-sm text-surface-600-300-token mb-4"> </p> <div class="flex justify-between items-center mb-4 p-3 bg-surface-200 dark:bg-surface-800 rounded-lg border border-surface-300 dark:border-surface-600"><span class="text-sm font-semibold"> </span></div> <div class="min-h-[200px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><!> <button class="btn btn-primary">確定</button></div>',1);function ia(a,t){he(t,!0);let s=me(He(new Set));Pe(()=>{t.isOpen&&Q(s,new Set,!0)});const h=b(()=>e(s).size),k=b(()=>{var i;return((i=t.config)==null?void 0:i.cancelable)??!1}),d=b(()=>()=>t.config?e(h)>=t.config.minCards&&e(h)<=t.config.maxCards:!1);function v(i){return e(s).has(i)}function D(i){return t.config?e(s).has(i)?!0:e(s).size<t.config.maxCards:!1}function I(i){!i.open&&t.isOpen&&e(k)&&A()}function Z(i){if(!t.config||!t.config.availableCards.some(O=>O.instanceId===i))return;const M=D(i),R=v(i);if(M||R){const O=new Set(e(s));R?O.delete(i):O.add(i),Q(s,O,!0)}}function A(){var i,u;(u=(i=t.config)==null?void 0:i.onCancel)==null||u.call(i)}function T(i){var M;const u=(M=t.config)==null?void 0:M.availableCards.find(R=>R.instanceId===i);if(u)return Me(u.id)}Be(a,{get open(){return t.isOpen},onOpenChange:I,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return e(k)},preventScroll:!0,content:u=>{var M=Ae(),R=ne(M);{var O=P=>{var H=sa(),L=ne(H),c=r(L),o=r(c,!0);n(c);var g=f(c,2);{var E=B=>{var N=na();N.__click=A,m(B,N)};q(g,B=>{e(k)&&B(E)})}n(L);var K=f(L,2),U=r(K,!0);n(K);var ee=f(K,2),te=r(ee),_=r(te);n(te),n(ee);var p=f(ee,2),F=r(p);we(F,21,()=>t.config.availableCards,B=>B.instanceId,(B,N)=>{var w=Ae();const S=b(()=>v(e(N).instanceId)),G=b(()=>D(e(N).instanceId)),J=b(()=>T(e(N).instanceId));var ce=ne(w);{var V=re=>{var W=aa();let ie;var _e=r(W);Ce(_e,{get card(){return e(J)},size:"small",clickable:!0,selectable:!1,get isSelected(){return e(S)},animate:!0,onClick:()=>Z(e(N).instanceId)}),n(W),ae(Oe=>ie=Ie(W,1,"",null,ie,Oe),[()=>({"opacity-50":!e(G)&&!e(S)})]),m(re,W)};q(ce,re=>{e(J)&&re(V)})}m(B,w)}),n(F),n(p);var C=f(p,2),l=r(C);{var X=B=>{var N=ra();N.__click=A,m(B,N)};q(l,B=>{e(k)&&B(X)})}var Y=f(l,2);Y.__click=[ta,t,d,s],n(C),ae(B=>{se(o,t.config.summary),se(U,t.config.description),se(_,`選択中: ${e(h)??""} / ${t.config.maxCards??""}枚`),Y.disabled=B},[()=>!e(d)()]),m(P,H)};q(R,P=>{t.config&&P(O)})}m(u,M)},$$slots:{content:!0}}),pe()}ze(["click"]);function oa(a,t,s){!t.config||!e(s)||t.config.onActivate(e(s))}function ca(a,t){var s;(s=t.config)==null||s.onPass()}var da=y("<div><!></div>"),la=y('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">チェーンしますか？</h3></div> <p class="text-sm text-surface-600-300-token mb-4">チェーン可能なカードがあります。発動するカードを選択するか、パスしてください。</p> <div class="min-h-[150px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><button class="btn btn-ghost">パス</button> <button class="btn btn-primary">発動</button></div>',1);function ua(a,t){he(t,!0);let s=me(null);Pe(()=>{t.isOpen&&Q(s,null)});function h(v){return e(s)===v}function k(v){!t.config||!t.config.chainableCards.some(I=>I.instance.instanceId===v)||(e(s)===v?Q(s,null):Q(s,v,!0))}function d(v){var I;const D=(I=t.config)==null?void 0:I.chainableCards.find(Z=>Z.instance.instanceId===v);if(D)return Me(D.instance.id)}Be(a,{get open(){return t.isOpen},onOpenChange:()=>{},contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!1,preventScroll:!0,content:D=>{var I=Ae(),Z=ne(I);{var A=T=>{var i=la(),u=f(ne(i),4),M=r(u);we(M,21,()=>t.config.chainableCards,H=>H.instance.instanceId,(H,L)=>{var c=Ae();const o=b(()=>h(e(L).instance.instanceId)),g=b(()=>d(e(L).instance.instanceId));var E=ne(c);{var K=U=>{var ee=da(),te=r(ee);Ce(te,{get card(){return e(g)},size:"small",clickable:!0,selectable:!1,get isSelected(){return e(o)},animate:!0,onClick:()=>k(e(L).instance.instanceId)}),n(ee),m(U,ee)};q(E,U=>{e(g)&&U(K)})}m(H,c)}),n(M),n(u);var R=f(u,2),O=r(R);O.__click=[ca,t];var P=f(O,2);P.__click=[oa,t,s],n(R),ae(()=>P.disabled=!e(s)),m(T,i)};q(Z,T=>{t.config&&T(A)})}m(D,I)},$$slots:{content:!0}}),pe()}ze(["click"]);var va=y('<span class="text-warning-600 dark:text-warning-400">Draw</span>'),fa=y("Winner: <span> </span>",1),ga=y('<p class="text-2xl font-bold"><!></p>'),ma=y('<p class="text-base opacity-75"><span class="font-semibold">Reason:</span> </p>'),_a=y('<p class="text-base"> </p>'),ba=y('<header class="text-center"><h2>Game Over!</h2></header> <article class="space-y-4 text-center"><!> <!> <!></article> <footer class="flex justify-center"><button class="btn variant-filled-primary">閉じる</button></footer>',1);function Ca(a,t){he(t,!0);function s(){t.onClose()}function h(v){v.open||s()}function k(){return t.winner==="player"?"border-success-500":t.winner==="opponent"?"border-error-500":t.winner==="draw"?"border-warning-500":"border-surface-500"}const d=b(k);Be(a,{get open(){return t.isOpen},onOpenChange:h,get contentBase(){return`card bg-surface-50 dark:bg-surface-900 p-8 space-y-6 max-w-lg shadow-2xl border-4 ${e(d)??""}`},backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!0,preventScroll:!0,content:D=>{var I=ba(),Z=ne(I),A=r(Z);n(Z);var T=f(Z,2),i=r(T);{var u=c=>{var o=ga(),g=r(o);{var E=U=>{var ee=va();m(U,ee)},K=U=>{var ee=fa(),te=f(ne(ee)),_=r(te,!0);n(te),ae(()=>{Ie(te,1,St(t.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400")),se(_,t.winner==="player"?"You":"Opponent")}),m(U,ee)};q(g,U=>{t.winner==="draw"?U(E):U(K,!1)})}n(o),m(c,o)};q(i,c=>{t.winner&&c(u)})}var M=f(i,2);{var R=c=>{var o=ma(),g=f(r(o));n(o),ae(()=>se(g,` ${t.reason??""}`)),m(c,o)};q(M,c=>{t.reason&&c(R)})}var O=f(M,2);{var P=c=>{var o=_a(),g=r(o,!0);n(o),ae(()=>se(g,t.message)),m(c,o)};q(O,c=>{t.message&&c(P)})}n(T);var H=f(T,2),L=r(H);L.__click=s,n(H),ae(()=>Ie(A,1,`h2 font-bold ${t.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400"}`)),m(D,I)},$$slots:{content:!0}}),pe()}ze(["click"]);var ha=y('<div class="absolute transition-transform ease-in-out"><!></div>'),pa=y('<div class="fixed inset-0 pointer-events-none z-50"></div>');function xa(a,t){he(t,!0);const[s,h]=wt(),d=b(()=>ge($,"$cardAnimationStore",s));let v=me(He(new Set));Pe(()=>{const i=e(d).activeAnimations.filter(M=>!e(v).has(M.instanceId)).map(M=>M.instanceId);if(i.length===0)return;const u=requestAnimationFrame(()=>{Q(v,new Set([...e(v),...i]),!0)});return()=>cancelAnimationFrame(u)});function D(i){$.completeAnimation(i),Q(v,new Set([...e(v)].filter(u=>u!==i)),!0)}function I(i){if(e(v).has(i.instanceId)){const u=i.targetRect.left-i.sourceRect.left,M=i.targetRect.top-i.sourceRect.top;return`translate(${u}px, ${M}px)`}return"translate(0, 0)"}var Z=Ae(),A=ne(Z);{var T=i=>{var u=pa();we(u,21,()=>e(d).activeAnimations,M=>M.instanceId,(M,R)=>{var O=ha();const P=b(()=>e(R).sourceRect);var H=r(O);Ce(H,{get card(){return e(R).cardData},size:"medium",clickable:!1,animate:!1}),n(O),ae(L=>Lt(O,`
          left: ${e(P).left??""}px;
          top: ${e(P).top??""}px;
          width: ${e(P).width??""}px;
          height: ${e(P).height??""}px;
          transform: ${L??""};
          transition-duration: 300ms;
        `),[()=>I(e(R))]),je("transitionend",O,()=>D(e(R).instanceId)),m(M,O)}),n(u),m(i,u)};q(A,i=>{e(d).isAnimating&&i(T)})}m(a,Z),pe(),h()}var ya=y('<div class="container mx-auto p-4"><main class="max-w-4xl mx-auto space-y-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card px-4"><h1 class="text-2xl font-bold"> </h1></div> <div class="card px-4 space-y-4"><div class="space-y-2"><div class="flex justify-start space-x-4"><span>Now:</span> <span class="font-bold" data-testid="current-phase"> </span></div> <div class="flex justify-between"><span>自分 LP:</span> <span class="font-bold text-success-500"> </span> <span>相手 LP:</span> <span class="font-bold text-error-500"> </span></div></div></div></div> <!> <div class="card px-4 space-y-4"><h2 class="text-xl font-bold"> </h2> <!></div> <details class="card p-4"><summary class="cursor-pointer font-bold">Debug Info</summary> <div class="mt-4 space-y-4"><pre class="text-xs overflow-auto"> </pre></div></details></main></div> <!> <!> <!> <!> <!>',1);function ja(a,t){he(t,!0);const[s,h]=wt(),k=()=>ge(Xt,"$gameResult",s),d=()=>ge(qt,"$currentPhaseDisplayName",s),v=()=>ge(Vt,"$monsterZoneInstanceOnFieldRefs",s),D=()=>ge($t,"$spellTrapZoneInstanceOnFieldRefs",s),I=()=>ge(en,"$fieldZoneInstanceOnFieldRefs",s),Z=()=>ge(Jt,"$handCardRefs",s),A=()=>ge(Kt,"$graveyardCardRefs",s),T=()=>ge(Ut,"$deckCardCount",s),i=()=>ge($,"$cardAnimationStore",s),u=()=>ge(Wt,"$playerLP",s),M=()=>ge(Yt,"$opponentLP",s),R=()=>ge(Qt,"$handCardCount",s),O=()=>ge(Ct,"$effectQueueStore",s),P=t.data.deckData.name;Ee(async()=>{await Et(t.data.uniqueCardIds),Ct.registerNotificationHandler({showInfo:(x,j)=>{Xe(j)}}),fe.autoAdvanceToMainPhase(()=>new Promise(x=>setTimeout(x,300)),x=>{Xe(x)})});let H=me(!1);Pe(()=>{k().isGameOver&&(Nt.win(),Q(H,!0))});function L(){return k().isGameOver?"ゲーム終了":d()}function c(x,j,ve){const xe=x();return xe.success?Xe(xe.message||j):Je(xe.error||ve),xe.success}let o=me(null),g=me(null);function E(x){Q(o,x,!0),Q(g,null)}function K(x,j){const ve=fe.activateSpell(j);ve.success||Je(ve.error||"発動に失敗しました")}function U(x,j){c(()=>fe.summonMonster(j),`${x.name}を召喚しました`,"召喚に失敗しました")}function ee(x,j){c(()=>fe.setMonster(j),`${x.name}をセットしました`,"セットに失敗しました")}function te(x,j){c(()=>fe.setSpellTrap(j),`${x.name}をセットしました`,"セットに失敗しました")}function _(x,j){if(!fe.findCardOnField(j)){Je("カードが見つかりませんでした");return}Q(o,null),Q(g,e(g)===j?null:j,!0)}function p(x,j){c(()=>fe.activateSpell(j),`${x.name}を発動しました`,"発動に失敗しました"),Q(g,null)}function F(x,j){c(()=>fe.activateIgnitionEffect(j),`${x.name}の効果を発動しました`,"効果発動に失敗しました"),Q(g,null)}function C(){Q(g,null)}let l=new Set,X=new Set,Y=new Set,B=0,N=!1;function w(){const x=new Set;for(const j of v())x.add(j.instanceId);for(const j of D())x.add(j.instanceId);for(const j of I())x.add(j.instanceId);return x}function S(x){return[...v(),...D(),...I()].find(ve=>ve.instanceId===x)}function G(x){return I().some(j=>j.instanceId===x)}function J(x,j,ve,xe){let z=0;const oe=5;function de(){const Se=Me(j),De=ve(),bt=xe();Se&&De&&bt?$.startAnimation({instanceId:x,cardData:Se,sourceRect:De,targetRect:bt}):z<oe&&(z++,requestAnimationFrame(de))}requestAnimationFrame(de)}Pe(()=>{const x=new Set(Z().map(z=>z.instanceId)),j=new Set(A().map(z=>z.instanceId)),ve=w(),xe=T();if(!N){l=x,X=ve,Y=j,B=xe,N=!0;return}if(xe<B){for(const z of x)if(!l.has(z)){const oe=Z().find(de=>de.instanceId===z);oe&&J(z,oe.cardId,()=>$.getZonePosition("mainDeck"),()=>$.getCardPosition(z))}}for(const z of l)if(!x.has(z)&&j.has(z)){const oe=A().find(de=>de.instanceId===z);if(oe){const de=$.getCardPosition(z),Se=$.getZonePosition("graveyard"),De=Me(oe.cardId);De&&de&&Se&&$.startAnimation({instanceId:z,cardData:De,sourceRect:de,targetRect:Se})}}for(const z of l)if(!x.has(z)&&ve.has(z)){const oe=S(z);if(oe){const de=$.getCardPosition(z),Se=G(z)?()=>$.getZonePosition("fieldZone"):()=>$.getCardPosition(z);J(z,oe.cardId,()=>de,Se)}}for(const z of X)if(!ve.has(z)&&j.has(z)){const oe=A().find(de=>de.instanceId===z);if(oe){const de=$.getCardPosition(z),Se=$.getZonePosition("graveyard"),De=Me(oe.cardId);De&&de&&Se&&$.startAnimation({instanceId:z,cardData:De,sourceRect:de,targetRect:Se})}}for(const z of Y)if(!j.has(z)&&x.has(z)){const oe=Z().find(de=>de.instanceId===z);oe&&J(z,oe.cardId,()=>$.getZonePosition("graveyard"),()=>$.getCardPosition(z))}for(const z of Y)if(!j.has(z)&&ve.has(z)){const oe=S(z);oe&&J(z,oe.cardId,()=>$.getZonePosition("graveyard"),()=>$.getCardPosition(z))}l=x,X=ve,Y=j,B=xe});const ce=b(()=>new Set(i().activeAnimations.map(x=>x.instanceId))),V=b(()=>Z().map(x=>({card:Me(x.cardId),instanceId:x.instanceId})).filter(x=>x.card!==void 0)),re=b(()=>A().map(x=>({card:Me(x.cardId),instanceId:x.instanceId})).filter(x=>x.card!==void 0)),W=b(()=>Ke(I(),Qe.fieldZone)),ie=b(()=>Ke(v(),Qe.mainMonsterZone)),_e=b(()=>Ke(D(),Qe.spellTrapZone));var Oe=ya(),Fe=ne(Oe),be=r(Fe),Ne=r(be),Le=r(Ne),at=r(Le),At=r(at);n(at),n(Le);var rt=f(Le,2),st=r(rt),Ge=r(st),it=f(r(Ge),2),Ot=r(it,!0);n(it),n(Ge);var ot=f(Ge,2),qe=f(r(ot),2),Dt=r(qe,!0);n(qe);var ct=f(qe,4),Mt=r(ct,!0);n(ct),n(ot),n(st),n(rt),n(Ne);var dt=f(Ne,2);Yn(dt,{get deckCards(){return T()},extraDeckCards:[],get graveyardCards(){return e(re)},get fieldCards(){return e(W)},get monsterCards(){return e(ie)},get spellTrapCards(){return e(_e)},get selectedFieldCardInstanceId(){return e(g)},get animatingInstanceIds(){return e(ce)},onFieldCardClick:_,onActivateSetSpell:p,onActivateIgnitionEffect:F,onCancelFieldCardSelection:C});var We=f(dt,2),Ye=r(We),zt=r(Ye);n(Ye);var Ft=f(Ye,2);Jn(Ft,{get cards(){return e(V)},get selectedHandCardInstanceId(){return e(o)},get animatingInstanceIds(){return e(ce)},onCardClick:K,onSummonMonster:U,onSetMonster:ee,onSetSpellTrap:te,onHandCardSelect:E}),n(We);var lt=f(We,2),ut=f(r(lt),2),vt=r(ut),Rt=r(vt,!0);n(vt),n(ut),n(lt),n(be),n(Fe);var ft=f(Fe,2);const Pt=b(()=>O().confirmationConfig!==null);ea(ft,{get isOpen(){return e(Pt)},get config(){return O().confirmationConfig}});var gt=f(ft,2);const Zt=b(()=>O().cardSelectionConfig!==null);ia(gt,{get isOpen(){return e(Zt)},get config(){return O().cardSelectionConfig}});var mt=f(gt,2);const Tt=b(()=>O().chainConfirmationConfig!==null);ua(mt,{get isOpen(){return e(Tt)},get config(){return O().chainConfirmationConfig}});var _t=f(mt,2);Ca(_t,{get isOpen(){return e(H)},get winner(){return k().winner},get reason(){return k().reason},get message(){return k().message},onClose:()=>{Q(H,!1)}});var jt=f(_t,2);xa(jt,{}),ae((x,j,ve,xe)=>{se(At,`Deck: ${P??""}`),se(Ot,x),se(Dt,j),se(Mt,ve),se(zt,`手札 (${R()??""} 枚)`),se(Rt,xe)},[L,()=>u().toLocaleString(),()=>M().toLocaleString(),()=>JSON.stringify(fe.getGameState(),null,2)]),m(a,Oe),pe(),h()}export{ja as component,Ta as universal};
