var gn=Object.defineProperty;var pn=(n,e,t)=>e in n?gn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>pn(n,typeof e!="symbol"?e+"":e,t);import{b as Cn,d as bt,l as hn,C as Se,a as Ve,e as ut,f as ft,g as Pe,i as Sn}from"../chunks/BD-KjtcG.js";import{w as Pt,g as He,d as ie}from"../chunks/C6WtwkGm.js";import{c as Oe,a as I,f as O}from"../chunks/LOn0ekQa.js";import{k as ne,q as c,y as k,v as d,u as m,x as o,t as re,j as pe,l as Ce,ar as Ie,m as ee,as as Lt,L as at,V as In,C as ct,o as Tn}from"../chunks/DKjaHnf_.js";import{s as te,d as De,e as qe}from"../chunks/CXYPiKii.js";import{p as he,a as yn,s as ve}from"../chunks/BFE1hTON.js";import{M as Ye,I as Ot,x as Ne,y as be}from"../chunks/ZKNqOsF7.js";import{i as Y}from"../chunks/CZBA5y4x.js";import{e as Te,a as An}from"../chunks/CGD6_aVM.js";import{b as Le,s as me,j as vt,c as bn}from"../chunks/dG0sfOGW.js";const On=(n,e)=>({...n,...e}),zt=n=>n.type==="monster",Ft=n=>n.type==="spell",Qe=n=>n.type==="spell"&&n.spellType==="field",xn=n=>n.type==="trap",dt=n=>n.position==="faceUp",En=n=>n.position==="faceDown";function Nn(n){const e=[...n];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}function ae(n,e){return[...n.deck,...n.hand,...n.mainMonsterZone,...n.spellTrapZone,...n.fieldZone,...n.graveyard,...n.banished].find(r=>r.instanceId===e)}function _e(n,e,t,r){const a=e.location,s=n[a],i=s.findIndex(S=>S.instanceId===e.instanceId),f={...e,...r,location:t};return{...n,[a]:[...s.slice(0,i),...s.slice(i+1)],[t]:[...n[t],f]}}function mt(n,e,t){const r=e.location,a=n[r];return{...n,[r]:a.map(s=>s.instanceId===e.instanceId?On(s,t):s)}}function _t(n,e=1){if(n.deck.length<e)throw new Error(`Cannot draw ${e} cards. Only ${n.deck.length} cards remaining in deck.`);let t=n;for(let r=0;r<e;r++){const a=t.deck[t.deck.length-1];t=_e(t,a,"hand")}return t}function Ke(n){return{...n,deck:Nn(n.deck)}}const Zt=(n,e)=>e.location==="hand"?n.hand.filter(t=>t.instanceId!==e.instanceId).length:n.hand.length,kn=(n,e=5)=>n.mainMonsterZone.length>=e,Dn=(n,e=5)=>n.spellTrapZone.length>=e,wn=(n,e=1)=>n.fieldZone.length>=e,xt=8e3;function Gt(n,e){const r={deck:n.mainDeckCardIds.map((s,i)=>({...Cn(s),instanceId:`deck-${i}`,location:"deck",placedThisTurn:!1,counters:[]})),hand:[],mainMonsterZone:[],spellTrapZone:[],fieldZone:[],graveyard:[],banished:[]};let a=e!=null&&e.skipShuffle?r:Ke(r);return e!=null&&e.skipInitialDraw||(a=_t(a,5)),{zones:a,lp:{player:xt,opponent:xt},phase:"Draw",turn:1,result:{isGameOver:!1},normalSummonLimit:1,normalSummonUsed:0,activatedIgnitionEffectsThisTurn:new Set,activatedOncePerTurnCards:new Set,pendingEndPhaseEffects:[],damageNegation:!1}}const Ge=class Ge{constructor(){j(this,"isEffect",!1);j(this,"category","VictoryCondition")}canApply(e){const t=e.zones.hand.map(r=>r.id);return Ge.EXODIA_PIECE_IDS.every(r=>t.includes(r))}checkPermission(e){return!0}static getExodiaPieceIds(){return Ge.EXODIA_PIECE_IDS}};j(Ge,"EXODIA_PIECE_IDS",[33396948,7902349,70903634,8124921,44519536]);let lt=Ge;function Vt(n){const e=new lt;return e.canApply(n,{})&&e.checkPermission(n,{})?{isGameOver:!0,winner:"player",reason:"exodia",message:"5つのエクゾディアパーツが手札に揃いました。勝利です！"}:n.lp.player<=0?{isGameOver:!0,winner:"opponent",reason:"lp0",message:"ライフポイントが0になりました。敗北です。"}:n.lp.opponent<=0?{isGameOver:!0,winner:"player",reason:"lp0",message:"相手のライフポイントが0になりました。勝利です！"}:{isGameOver:!1}}function Ut(){return Gt({mainDeckCardIds:[]},{skipShuffle:!0,skipInitialDraw:!0})}function Et(n){if(n.result.isGameOver||n.turn===0&&n.phase==="Draw")return n;const e=Vt(n);return e.isGameOver?{...n,result:e}:n}function Rn(){const{subscribe:n,set:e,update:t}=Pt(Ut());return{subscribe:n,set:r=>{e(Et(r))},update:r=>{t(a=>Et(r(a)))}}}const X=Rn();function Mn(n){const e=[];n.mainDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)e.push(r.id)});const t=[];return n.extraDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)t.push(r.id)}),{mainDeckCardIds:e,extraDeckCardIds:t}}function Pn(n){const e=Mn(n);X.set(Gt(e))}function st(){let n=Ut();return X.subscribe(t=>{n=t})(),n}function Ln(){return{current:{timestamp:0,events:[]},history:[],nextTimestamp:1}}function zn(n,e){return{...n,current:{...n.current,events:[...n.current.events,e]}}}class We{static register(e,t){const r=this.rules.get(e)||[];this.rules.set(e,[...r,t])}static get(e){return this.rules.get(e)||[]}static getByCategory(e,t){return this.get(e).filter(a=>a.category===t)}static collectActiveRules(e,t){const r=[],a=[...e.zones.spellTrapZone,...e.zones.fieldZone];for(const s of a){if(!dt(s))continue;const i=this.getByCategory(s.id,t);for(const f of i)f.canApply(e)&&r.push(f)}return r}static collectTriggerRules(e,t){var s;const r=[],a=[...e.zones.mainMonsterZone,...e.zones.spellTrapZone,...e.zones.fieldZone];for(const i of a){if(!dt(i))continue;const f=this.getByCategory(i.id,"TriggerRule");for(const S of f)(s=S.triggers)!=null&&s.includes(t)&&r.push({rule:S,sourceInstance:i})}return r}static collectTriggerSteps(e,t){const r=this.collectTriggerRules(e,t),a=[];for(const{rule:s,sourceInstance:i}of r)if(s.canApply(e)&&s.createTriggerSteps){const f=s.createTriggerSteps(e,i);a.push(...f)}return a}static clear(){this.rules.clear()}static getRegisteredCardIds(){return Array.from(this.rules.keys())}}j(We,"rules",new Map);function Xe(n,e,t){const r=n.action(e,t);return r.success?(X.set(r.updatedState),{updatedState:r.updatedState,emittedEvents:r.emittedEvents||[]}):{updatedState:e,emittedEvents:[]}}function Fn(n,e,t,r){const a=[];for(const s of n){const i=We.collectTriggerSteps(e,s.type);a.push(...i)}return a.length===0?t:[...t.slice(0,r+1),...a,...t.slice(r+1)]}function Zn(n,e){const t=n.currentIndex+1;return t<n.steps.length?(e(r=>({...r,currentIndex:t,currentStep:r.steps[t]})),!0):(Ht(e),!1)}function Ht(n){n(e=>({...e,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}const Gn=async(n,e)=>({shouldContinue:!0,emittedEvents:Xe(n,e).emittedEvents}),Vn=async(n,e,t)=>{const r=Xe(n,e);return t.notification&&t.notification.showInfo(n.summary,n.description),{shouldContinue:!0,delay:300,emittedEvents:r.emittedEvents}},Un=async(n,e,t,r)=>{const a=n.cardSelectionConfig;let s;if(a.availableCards!==null)s=a.availableCards;else{if(!a._sourceZone)return console.error("_sourceZone must be specified when availableCards is null"),{shouldContinue:!1};const f=e.zones[a._sourceZone];s=a._filter?f.filter((S,h)=>a._filter(S,h)):f}let i=[];return await new Promise(f=>{r(S=>({...S,cardSelectionConfig:{availableCards:s,minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable,onConfirm:h=>{i=Xe(n,e,h).emittedEvents,r(x=>({...x,cardSelectionConfig:null})),f()},onCancel:()=>{r(h=>({...h,cardSelectionConfig:null})),f()}}}))}),{shouldContinue:!0,emittedEvents:i}},Hn=async(n,e,t,r)=>{let a=[];return await new Promise(s=>{r(i=>({...i,confirmationConfig:{summary:n.summary,description:n.description,onConfirm:()=>{a=Xe(n,e).emittedEvents,r(S=>({...S,confirmationConfig:null})),s()}}}))}),{shouldContinue:!0,emittedEvents:a}};function jn(n){const e=n.notificationLevel||"info";return e==="silent"?Gn:e==="info"?Vn:n.cardSelectionConfig?Un:Hn}function Bn(){const{subscribe:n,update:e}=Pt({isActive:!1,currentStep:null,steps:[],currentIndex:-1,notificationHandler:null,confirmationConfig:null,cardSelectionConfig:null,eventTimeline:Ln()});return{subscribe:n,registerNotificationHandler:t=>{e(r=>({...r,notificationHandler:t}))},startProcessing:t=>{e(a=>({...a,isActive:!0,steps:t,currentIndex:0,currentStep:t[0]||null}));const r=t[0];if(r){const a=r.notificationLevel||"info";(a==="info"||a==="silent")&&ke.confirmCurrentStep()}},confirmCurrentStep:async()=>{let t=He(ke);if(!t.currentStep)return;const r=He(X),s=await jn(t.currentStep)(t.currentStep,r,{notification:t.notificationHandler},e);if(s.emittedEvents&&s.emittedEvents.length>0){let i=t.eventTimeline;for(const h of s.emittedEvents)i=zn(i,h);const f=He(X),S=Fn(s.emittedEvents,f,t.steps,t.currentIndex);e(h=>({...h,steps:S,eventTimeline:i})),t=He(ke)}s.delay&&await new Promise(i=>setTimeout(i,s.delay)),s.shouldContinue?Zn(t,e)&&ke.confirmCurrentStep():Ht(e)},cancelProcessing:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))},reset:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}}}const ke=Bn(),ge=(n,e,t,r)=>({success:!0,updatedState:n,message:e,effectSteps:t,emittedEvents:r}),xe=(n,e)=>({success:!1,updatedState:n,error:e}),it=["Draw","Standby","Main1","End"],qn={Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ",End:"エンドフェイズ"},Qn=n=>qn[n],je=n=>{const e=it.indexOf(n);return e===-1||e===it.length-1?"End":it[e+1]},Wn=(n,e)=>{const t=je(n);return e!==t?{valid:!1,error:`Invalid phase transition: ${n} → ${e}. Expected: ${t}`}:{valid:!0}},ze=n=>n==="Main1",ot=n=>n==="End",_={GAME_OVER:"GAME_OVER",NOT_MAIN_PHASE:"NOT_MAIN_PHASE",CARD_NOT_FOUND:"CARD_NOT_FOUND",CARD_NOT_IN_HAND:"CARD_NOT_IN_HAND",CARD_NOT_IN_VALID_LOCATION:"CARD_NOT_IN_VALID_LOCATION",CARD_NOT_ON_FIELD:"CARD_NOT_ON_FIELD",CARD_NOT_FACE_UP:"CARD_NOT_FACE_UP",NOT_SPELL_CARD:"NOT_SPELL_CARD",NOT_SPELL_OR_TRAP_CARD:"NOT_SPELL_OR_TRAP_CARD",NOT_MONSTER_CARD:"NOT_MONSTER_CARD",SPELL_TRAP_ZONE_FULL:"SPELL_TRAP_ZONE_FULL",MONSTER_ZONE_FULL:"MONSTER_ZONE_FULL",INSUFFICIENT_COUNTERS:"INSUFFICIENT_COUNTERS",SUMMON_LIMIT_REACHED:"SUMMON_LIMIT_REACHED",QUICK_PLAY_RESTRICTION:"QUICK_PLAY_RESTRICTION",ACTIVATION_CONDITIONS_NOT_MET:"ACTIVATION_CONDITIONS_NOT_MET",NO_IGNITION_EFFECT:"NO_IGNITION_EFFECT",PHASE_TRANSITION_NOT_ALLOWED:"PHASE_TRANSITION_NOT_ALLOWED"},Yn={GAME_OVER:"ゲームは終了しています",NOT_MAIN_PHASE:"メインフェイズではありません",CARD_NOT_FOUND:"カードが見つかりません",CARD_NOT_IN_HAND:"カードが手札にありません",CARD_NOT_IN_VALID_LOCATION:"カードが有効な場所にありません",CARD_NOT_ON_FIELD:"カードがフィールドにありません",CARD_NOT_FACE_UP:"カードが表側表示ではありません",NOT_SPELL_CARD:"魔法カードではありません",NOT_SPELL_OR_TRAP_CARD:"魔法または罠カードではありません",NOT_MONSTER_CARD:"モンスターカードではありません",SPELL_TRAP_ZONE_FULL:"魔法・罠ゾーンに空きがありません",MONSTER_ZONE_FULL:"モンスターゾーンに空きがありません",INSUFFICIENT_DECK:"デッキのカードが不足しています",INSUFFICIENT_COUNTERS:"カウンターが不足しています",SUMMON_LIMIT_REACHED:"召喚権がありません",QUICK_PLAY_RESTRICTION:"速攻魔法はセットしたターンに発動できません",ACTIVATION_CONDITIONS_NOT_MET:"発動条件を満たしていません",NO_IGNITION_EFFECT:"このカードには起動効果がありません",PHASE_TRANSITION_NOT_ALLOWED:"フェイズ遷移が許可されていません"},V=()=>({isValid:!0}),g=(n,e)=>({isValid:!1,errorCode:n,errorParams:e}),Fe=n=>{if(n.isValid||!n.errorCode)return"";const e=Yn[n.errorCode];return n.errorParams,e};class Kn{constructor(){j(this,"description");this.description="Advance to next phase"}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);const t=je(e.phase);return Wn(e.phase,t).valid?V():g(_.PHASE_TRANSITION_NOT_ALLOWED)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=je(e.phase),a=ot(r)&&e.pendingEndPhaseEffects.length>0,s={...e,phase:r,activatedIgnitionEffectsThisTurn:ot(r)?new Set:e.activatedIgnitionEffectsThisTurn,activatedOncePerTurnCards:ot(r)?new Set:e.activatedOncePerTurnCards,pendingEndPhaseEffects:a?[]:e.pendingEndPhaseEffects};return ge(s,`Advanced to ${Qn(r)}`,a?[...e.pendingEndPhaseEffects]:void 0)}getNextPhase(e){return je(e.phase)}}function jt(n){return ze(n.phase)?kn(n.zones)?g(_.MONSTER_ZONE_FULL):n.normalSummonUsed>=n.normalSummonLimit?g(_.SUMMON_LIMIT_REACHED):V():g(_.NOT_MAIN_PHASE)}function Bt(n,e,t){const r=ae(n.zones,e),a=_e(n.zones,r,"mainMonsterZone",{position:t==="attack"?"faceUp":"faceDown",battlePosition:t,placedThisTurn:!0});return{...n,zones:a,normalSummonUsed:n.normalSummonUsed+1}}class Nt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Summon monster ${e}`}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);const t=jt(e);if(!t.isValid)return t;const r=ae(e.zones,this.cardInstanceId);return r?zt(r)?r.location!=="hand"?g(_.CARD_NOT_IN_HAND):V():g(_.NOT_MONSTER_CARD):g(_.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=Bt(e,this.cardInstanceId,"attack");return ge(a,`Monster summoned: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class kt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Set monster ${e}`}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);const t=jt(e);if(!t.isValid)return t;const r=ae(e.zones,this.cardInstanceId);return r?zt(r)?r.location!=="hand"?g(_.CARD_NOT_IN_HAND):V():g(_.NOT_MONSTER_CARD):g(_.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=Bt(e,this.cardInstanceId,"defense");return ge(a,`Monster set: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class Dt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Set spell/trap ${e}`}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);if(!ze(e.phase))return g(_.NOT_MAIN_PHASE);const t=ae(e.zones,this.cardInstanceId);return t?t.location!=="hand"?g(_.CARD_NOT_IN_HAND):!Ft(t)&&!xn(t)?g(_.NOT_SPELL_OR_TRAP_CARD):!Qe(t)&&Dn(e.zones)?g(_.SPELL_TRAP_ZONE_FULL):V():g(_.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a={...e,zones:this.moveSetSpellTrapCard(e.zones,r)};return ge(a,`Card set: ${r.jaName}`)}moveSetSpellTrapCard(e,t){const r={position:"faceDown",placedThisTurn:!0};return Qe(t)?(wn(e)&&(e=_e(e,e.fieldZone[0],"graveyard")),_e(e,t,"fieldZone",r)):_e(e,t,"spellTrapZone",r)}getCardInstanceId(){return this.cardInstanceId}}class K{static registerActivation(e,t){const r=this.getOrCreateEntry(e);r.activation=t}static registerIgnition(e,t){this.getOrCreateEntry(e).ignitionEffects.push(t)}static getActivation(e){var t;return(t=this.effects.get(e))==null?void 0:t.activation}static getIgnitionEffects(e){var t;return((t=this.effects.get(e))==null?void 0:t.ignitionEffects)??[]}static hasIgnitionEffects(e){const t=this.effects.get(e);return t!==void 0&&t.ignitionEffects.length>0}static clear(){this.effects.clear()}static getRegisteredCardIds(){return Array.from(this.effects.keys())}static getOrCreateEntry(e){let t=this.effects.get(e);return t||(t={ignitionEffects:[]},this.effects.set(e,t)),t}}j(K,"effects",new Map);class wt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Activate spell card ${e}`}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);const t=ae(e.zones,this.cardInstanceId);if(!t)return g(_.CARD_NOT_FOUND);if(!["hand","spellTrapZone","fieldZone"].includes(t.location))return g(_.CARD_NOT_IN_VALID_LOCATION);if(!Ft(t))return g(_.NOT_SPELL_CARD);if(!Qe(t)&&e.zones.spellTrapZone.length>=5)return g(_.SPELL_TRAP_ZONE_FULL);const r=K.getActivation(t.id);if(r){const a=r.canActivate(e,t);if(!a.isValid)return a}return V()}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=new Set(e.activatedOncePerTurnCards);a.add(r.id);const s={...e,zones:this.moveActivatedSpellCard(e.zones,r),activatedOncePerTurnCards:a};return ge(s,`Spell card activated: ${this.cardInstanceId}`,this.buildEffectSteps(s,r))}moveActivatedSpellCard(e,t){const r={position:"faceUp",placedThisTurn:!0};if(t.location==="hand"){const a=Qe(t)?"fieldZone":"spellTrapZone";return _e(e,t,a,r)}return mt(e,t,r)}buildEffectSteps(e,t){const r=[],a=K.getActivation(t.id);return a&&(r.push(...a.createActivationSteps(e,t)),r.push(...a.createResolutionSteps(e,t))),r}getCardInstanceId(){return this.cardInstanceId}}class Rt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Activate ignition effect of ${e}`}canExecute(e){if(e.result.isGameOver)return g(_.GAME_OVER);const t=ae(e.zones,this.cardInstanceId);if(!t)return g(_.CARD_NOT_FOUND);if(!["fieldZone","spellTrapZone","mainMonsterZone"].includes(t.location))return g(_.CARD_NOT_ON_FIELD);if(!dt(t))return g(_.CARD_NOT_FACE_UP);const a=K.getIgnitionEffects(t.id);return a.length===0?g(_.NO_IGNITION_EFFECT):this.findActivatableEffect(a,e,t)?V():g(_.ACTIVATION_CONDITIONS_NOT_MET)}findActivatableEffect(e,t,r){return e.find(a=>a.canActivate(t,r).isValid)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=K.getIgnitionEffects(r.id),s=this.findActivatableEffect(a,e,r),i=new Set(e.activatedIgnitionEffectsThisTurn);i.add(`${r.instanceId}:${s.effectId}`);const f={...e,activatedIgnitionEffectsThisTurn:i};return ge(f,`Ignition effect activated: ${this.cardInstanceId}`,this.buildEffectSteps(f,r,s))}buildEffectSteps(e,t,r){const a=r.createActivationSteps(e,t),s=r.createResolutionSteps(e,t);return[...a,...s]}getCardInstanceId(){return this.cardInstanceId}}const qt=n=>({id:`${n}-activation-notification`,summary:"カード発動",description:`${bt(n)}を発動します`,notificationLevel:"info",action:e=>({success:!0,updatedState:e,message:`${bt(n)} activated`})}),Qt=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:n.availableCards,_sourceZone:n._sourceZone,_filter:n._filter,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1},action:(e,t)=>!t||t.length===0?n.onSelect(e,[]):n.onSelect(e,t)});function Xn(n){return{id:`emit-spell-activated-${n.instanceId}`,summary:"魔法発動イベント",description:"魔法カード発動をトリガーシステムに通知",notificationLevel:"silent",action:e=>ge(e,void 0,void 0,[{type:"spellActivated",sourceCardId:n.id,sourceInstanceId:n.instanceId}])}}class Je{constructor(e){j(this,"cardId");j(this,"effectId");j(this,"effectCategory","activation");this.cardId=e,this.effectId=`activation-${e}`}canActivate(e,t){const r=this.subTypeConditions(e,t);if(!r.isValid)return r;const a=this.individualConditions(e,t);return a.isValid?V():a}createActivationSteps(e,t){return[qt(this.cardId),Xn(t),...this.subTypePreActivationSteps(e,t),...this.individualActivationSteps(e,t),...this.subTypePostActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.subTypePreResolutionSteps(e,t),...this.individualResolutionSteps(e,t),...this.subTypePostResolutionSteps(e,t)]}}function Jn(n,e){return{id:(e==null?void 0:e.id)??`queue-end-phase-effect-${n.id}`,summary:(e==null?void 0:e.summary)??"エンドフェイズ効果を登録",description:(e==null?void 0:e.description)??"エンドフェイズに処理される効果を登録します",notificationLevel:"silent",action:t=>({success:!0,updatedState:{...t,pendingEndPhaseEffects:[...t.pendingEndPhaseEffects,n]},message:`Added end phase effect: ${n.summary}`})}}const Wt=(n,e)=>({id:`send-${n}-to-graveyard`,summary:"墓地へ送る",description:`《${e}》を墓地に送ります`,notificationLevel:"info",action:t=>{const r=ae(t.zones,n);return{success:!0,updatedState:{...t,zones:_e(t.zones,r,"graveyard")},message:`Sent ${e} to graveyard`}}}),Yt=(n,e)=>{let t=n.zones;for(const r of e){const a=ae(t,r);t=_e(t,a,"graveyard")}return{success:!0,updatedState:{...n,zones:t},message:`Sent ${e.length} card${e.length>1?"s":""} to graveyard`}},$n=n=>{const e=[...n.zones.hand];if(e.length===0)return{success:!0,updatedState:n,message:"No cards in hand to discard"};const t=e.map(r=>r.instanceId);return Yt(n,t)},er=()=>({id:"discard-all-hand",summary:"手札を全て捨てる",description:"手札を全て捨てます",notificationLevel:"info",action:n=>$n(n)}),Kt=()=>Jn(er(),{id:"end-phase-discard-all-hand",summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます"}),gt=(n,e)=>Qt({id:`select-and-discard-${n}-cards`,summary:`手札を${n}枚捨てる`,description:`手札から${n}枚選んで捨てます`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n,maxCards:n,cancelable:!1,onSelect:(t,r)=>r.length!==n?{success:!1,updatedState:t,error:`Must select exactly ${n} cards to discard`}:Yt(t,r)});class de extends Je{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():g(_.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[Wt(r.instanceId,r.jaName)]}}const Xt=(n,e)=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"info",action:t=>{const{drawCount:r,message:a}=n(t);return r===0?{success:!0,updatedState:t,message:a}:t.zones.deck.length<r?{success:!1,updatedState:t,error:`Insufficient deck: needed ${r}, but only ${t.zones.deck.length} remaining.`}:{success:!0,updatedState:{...t,zones:_t(t.zones,r)},message:`${a} (${r} card${r>1?"s":""})`}}}),Ee=n=>Xt(()=>({drawCount:n,message:`Draw ${n} card(s)`}),{id:`draw-${n}`,summary:"カードをドロー",description:`デッキから${n}枚ドローします`}),tr=n=>Xt(e=>{const t=Math.max(0,n-e.zones.hand.length);return{drawCount:t,message:t===0?`Hand already has ${n} or more cards`:`Filled hand to ${n}`}},{id:`fill-hands-${n}`,summary:`手札が${n}枚になるまでドロー`,description:`手札が${n}枚になるまでドローします`});class nr extends de{constructor(){super(55144522)}individualConditions(e,t){return e.zones.deck.length<2?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(2)]}}class rr extends de{constructor(){super(79571449)}individualConditions(e,t){return e.zones.deck.length<3?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(3),gt(2)]}}class ar extends Je{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():g(_.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class sr extends ar{constructor(){super(67616300)}individualConditions(e,t){return V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[]}}const Jt=(n,e,t)=>{const r=t==="player",a=r?"プレイヤー":"相手",s=r?"Player":"Opponent",i=n==="gain"?1:-1,f={gain:{id:"gain-lp",action:"増加",msg:"gained"},damage:{id:"damage",action:"ダメージ",msg:"took"},payment:{id:"pay-lp",action:"支払い",msg:"paid"},loss:{id:"loss-lp",action:"喪失",msg:"lost"}}[n];return{id:`${f.id}-${t}-${e}`,summary:`${a}のLP${f.action}`,description:`${a}に${e}の${f.action}が発生します`,notificationLevel:"info",action:S=>({success:!0,updatedState:{...S,lp:{...S.lp,[t]:S.lp[t]+e*i}},message:`${s} ${f.msg} ${e} LP`})}},ir=(n,e)=>Jt("gain",n,e),$t=(n,e)=>Jt("payment",n,e);class or extends de{constructor(){super(70368879)}individualConditions(e,t){return e.zones.deck.length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),ir(1e3,"opponent")]}}class cr extends de{constructor(){super(33782437)}individualConditions(e,t){return e.zones.deck.length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),{id:"one-day-of-peace-damage-negation",summary:"ダメージ無効化",description:"このターン、全てのダメージは0になります",notificationLevel:"info",action:r=>({success:!0,updatedState:{...r,damageNegation:!0},message:"Damage negation activated for this turn"})}]}}const dr=n=>Qt({id:"select-and-return-to-deck",summary:"手札をデッキに戻す",description:`デッキに戻すカードを選択してください（${n.min}〜${n.max??100}枚）`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n.min,maxCards:n.max??100,cancelable:!1,onSelect:(e,t)=>{if(t.length===0)return{success:!0,updatedState:e,message:"No cards selected"};let r=e.zones;for(const a of t){const s=ae(r,a);r=_e(r,s,"deck")}return r=Ke(r),r=_t(r,t.length),{success:!0,updatedState:{...e,zones:r},message:`${t.length}枚をデッキに戻し、シャッフルして${t.length}枚ドローしました`}}});class lr extends de{constructor(){super(85852291)}individualConditions(e,t){return V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[dr({min:0})]}}class ur extends Je{constructor(){super(...arguments);j(this,"spellSpeed",2)}subTypeConditions(t,r){return En(r)&&r.placedThisTurn?g(_.QUICK_PLAY_RESTRICTION):V()}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[Wt(r.instanceId,r.jaName)]}}class fr extends ur{constructor(){super(74519184)}individualConditions(e,t){return Zt(e.zones,t)<2||e.zones.deck.length<2?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[gt(2),Ee(2)]}}const en=(n,e,t)=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:e,_filter:n.filter},action:(r,a)=>{if((e==="graveyard"?r.zones.graveyard.filter(n.filter):r.zones.deck.filter((h,y)=>n.filter(h,y))).length===0)return{success:!1,updatedState:r,error:`No cards available in ${e} matching the criteria`};if(!a||a.length===0)return{success:!1,updatedState:r,error:"No cards selected"};let i=r.zones;for(const h of a){const y=ae(i,h);i=_e(i,y,"hand")}t&&(i=Ke(i));const f={...r,zones:i},S=t?" and shuffled":"";return{success:!0,updatedState:f,message:`Added ${a.length} card${a.length>1?"s":""} from ${e} to hand${S}`}}}),tn=n=>en(n,"graveyard",!1),nn=n=>en(n,"deck",!0),vr=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:"deck",_filter:(e,t)=>t!==void 0&&t<n.count},action:(e,t)=>{const r=e.zones.deck.slice(0,n.count);if(r.length<n.count)return{success:!1,updatedState:e,error:`Cannot excavate ${n.count} cards. Deck has only ${r.length} cards.`};if(!t||t.length===0)return{success:!1,updatedState:e,error:"No cards selected"};let a=e.zones;for(const i of t){const f=ae(a,i);a=_e(a,f,"hand")}return{success:!0,updatedState:{...e,zones:a},message:`Added ${t.length} card${t.length>1?"s":""} from deck to hand`}}});class mr extends de{constructor(){super(90928333)}individualConditions(e,t){return e.zones.graveyard.filter(a=>a.type==="monster"&&a.frameType==="normal").length<2?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[tn({id:`dark-factory-search-${t.instanceId}`,summary:"通常モンスター2枚をサルベージ",description:"墓地から通常モンスター2枚を選択し、手札に加えます",filter:r=>r.type==="monster"&&r.frameType==="normal",minCards:2,maxCards:2,cancelable:!1})]}}class _r extends de{constructor(){super(73628505)}individualConditions(e,t){return e.zones.deck.filter(a=>a.type==="spell"&&a.spellType==="field").length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[nn({id:`terraforming-search-${t.instanceId}`,summary:"フィールド魔法1枚をサーチ",description:"デッキからフィールド魔法1枚を選択し、手札に加えます",filter:r=>r.type==="spell"&&r.spellType==="field",minCards:1,maxCards:1,cancelable:!1})]}}class gr extends de{constructor(){super(98494543)}individualConditions(e,t){return Zt(e.zones,t)<2||e.zones.graveyard.filter(a=>a.type==="spell").length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[gt(2)]}individualResolutionSteps(e,t){return[tn({id:`magical-stone-excavation-search-${t.instanceId}`,summary:"魔法カード1枚をサルベージ",description:"墓地から魔法カード1枚を選択し、手札に加えます",filter:r=>r.type==="spell",minCards:1,maxCards:1,cancelable:!1})]}}class pr extends de{constructor(){super(93946239)}individualConditions(e,t){return e.zones.hand.length<3||e.zones.deck.length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),Kt()]}}const Cr=()=>({id:"shuffle-deck",summary:"デッキシャッフル",description:"デッキをシャッフルします",notificationLevel:"info",action:n=>({success:!0,updatedState:{...n,zones:Ke(n.zones)},message:"Deck shuffled"})});class hr extends de{constructor(){super(98645731)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)||e.zones.deck.length<3?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[vr({id:`pot-of-duality-search-${t.instanceId}`,summary:"デッキトップ3枚から1枚をサーチ",description:"デッキトップ3枚から1枚を選択し、手札に加えます",count:3,minCards:1,maxCards:1,cancelable:!1}),Cr()]}}class Sr extends de{constructor(){super(59750328)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[tr(3),Kt()]}}class Ir extends de{constructor(){super(89997728)}individualConditions(e,t){return e.zones.deck.filter(a=>a.jaName.includes("トゥーン")).length<1?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[nn({id:`toon-table-search-${t.instanceId}`,summary:"「トゥーン」カード1枚をサーチ",description:"デッキから「トゥーン」カード1枚を選択し、手札に加えます",filter:r=>r.jaName.includes("トゥーン"),minCards:1,maxCards:1,cancelable:!1})]}}class Tr extends Je{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():g(_.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class yr extends Tr{constructor(){super(15259703)}individualConditions(e,t){return e.lp.player<1e3?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[$t(1e3,"player")]}individualResolutionSteps(e,t){return[]}}class rn{constructor(e,t){j(this,"cardId");j(this,"effectId");j(this,"effectCategory","ignition");j(this,"spellSpeed",1);this.cardId=e,this.effectId=`ignition-${e}-${t}`}canActivate(e,t){if(!ze(e.phase))return g(_.NOT_MAIN_PHASE);const r=this.individualConditions(e,t);return r.isValid?V():r}createActivationSteps(e,t){return[qt(t.id),...this.individualActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.individualResolutionSteps(e,t)]}}class Ar extends rn{constructor(){super(67616300,1)}individualConditions(e,t){if(e.lp.player<=1e3)return g(_.ACTIVATION_CONDITIONS_NOT_MET);const r=`${t.instanceId}:${this.effectId}`;return e.activatedIgnitionEffectsThisTurn.has(r)?g(_.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[$t(1e3,"player")]}individualResolutionSteps(e,t){return[Ee(1)]}}function $e(n,e){const t=n.find(r=>r.type===e);return(t==null?void 0:t.count)??0}function an(n,e,t){const r=n.findIndex(a=>a.type===e);if(r>=0){const a=n[r],s=Math.max(0,a.count+t);return s===0?[...n.slice(0,r),...n.slice(r+1)]:[...n.slice(0,r),{type:e,count:s},...n.slice(r+1)]}else if(t>0)return[...n,{type:e,count:t}];return n}const br=(n,e,t,r)=>({id:`add-counter-${e}-${t}-${n}`,summary:"カウンターを置く",description:`魔力カウンターを${t}つ置きます`,notificationLevel:"silent",action:a=>{const s=ae(a.zones,n);if(!s)return ge(a,"カードが見つかりません");const i=$e(s.counters,e);if(i>=r)return ge(a,"カウンターは既に最大数です");const f=Math.min(t,r-i),S=an(s.counters,e,f),h=mt(a.zones,s,{counters:S});return ge({...a,zones:h},`魔力カウンターを${f}つ置きました`)}}),Or=(n,e,t)=>({id:`remove-counter-${e}-${t}-${n}`,summary:"カウンターを取り除く",description:`魔力カウンターを${t}つ取り除きます`,notificationLevel:"info",action:r=>{const a=ae(r.zones,n);if(!a)return xe(r,`Target card not found: ${n}`);const s=$e(a.counters,e);if(s<t)return xe(r,`Insufficient counters: needed ${t}, but only ${s} available.`);const i=an(a.counters,e,-t),f=mt(r.zones,a,{counters:i});return ge({...r,zones:f},`Removed ${t} ${e} counter(s) from card.`)}}),Mt=3;class xr extends rn{constructor(){super(70791313,1)}individualConditions(e,t){return $e(t.counters,"spell")<Mt?g(_.INSUFFICIENT_COUNTERS):V()}individualActivationSteps(e,t){return[Or(t.instanceId,"spell",Mt)]}individualResolutionSteps(e,t){return[Ee(1)]}}function Er(){K.registerActivation(55144522,new nr),K.registerActivation(79571449,new rr),K.registerActivation(67616300,new sr),K.registerActivation(70368879,new or),K.registerActivation(33782437,new cr),K.registerActivation(85852291,new lr),K.registerActivation(74519184,new fr),K.registerActivation(90928333,new mr),K.registerActivation(73628505,new _r),K.registerActivation(98494543,new gr),K.registerActivation(93946239,new pr),K.registerActivation(98645731,new hr),K.registerActivation(59750328,new Sr),K.registerActivation(89997728,new Ir),K.registerActivation(15259703,new yr),K.registerIgnition(67616300,new Ar),K.registerIgnition(70791313,new xr)}class Nr{constructor(){j(this,"isEffect",!0);j(this,"category","ActionPermission")}canApply(e){return e.zones.fieldZone.some(t=>t.id===67616300&&t.position==="faceUp")}checkPermission(e){return!1}}const kr=70791313,Dr=3;class wr{constructor(){j(this,"isEffect",!0);j(this,"category","TriggerRule");j(this,"triggers",["spellActivated"])}canApply(e){return e.zones.mainMonsterZone.some(r=>r.id===kr&&r.position==="faceUp")}createTriggerSteps(e,t){return[br(t.instanceId,"spell",1,Dr)]}}function Rr(){We.register(67616300,new Nr),We.register(70791313,new wr)}Er();Rr();class Mr{canExecuteCommand(e,...t){const r=st();return new e(...t).canExecute(r).isValid}executeCommand(e,...t){const r=st(),s=new e(...t).execute(r);return s.success&&(X.set(s.updatedState),s.effectSteps&&s.effectSteps.length>0&&ke.startProcessing(s.effectSteps)),{success:s.success,message:s.message,error:s.error}}initializeGame(e){Pn(e)}getGameState(){return st()}advancePhase(){return this.executeCommand(Kn)}canSummonMonster(e){return this.canExecuteCommand(Nt,e)}summonMonster(e){return this.executeCommand(Nt,e)}canSetMonster(e){return this.canExecuteCommand(kt,e)}setMonster(e){return this.executeCommand(kt,e)}canSetSpellTrap(e){return this.canExecuteCommand(Dt,e)}setSpellTrap(e){return this.executeCommand(Dt,e)}canActivateSpell(e){return this.canExecuteCommand(wt,e)}activateSpell(e){return this.executeCommand(wt,e)}canActivateIgnitionEffect(e){return this.canExecuteCommand(Rt,e)}activateIgnitionEffect(e){return this.executeCommand(Rt,e)}}const se=new Mr,Pr=({params:n})=>{const{deckId:e}=n,{deckRecipe:t,deckData:r,uniqueCardIds:a}=hn(e);return console.log(`[PageLoad] Initializing game with deck: ${t.name}`),se.initializeGame(t),console.log("[PageLoad] Initial state:",se.getGameState()),{deckId:e,deckName:r.name,uniqueCardIds:a}},is=Object.freeze(Object.defineProperty({__proto__:null,load:Pr},Symbol.toStringTag,{value:"Module"})),Lr=ie(X,n=>n.phase),zr=ie(X,n=>n.turn),Fr=ie(X,n=>n.lp.player),Zr=ie(X,n=>n.lp.opponent),Gr=ie(X,n=>n.zones.hand.length),Vr=ie(X,n=>n.zones.deck.length);ie(X,n=>n.zones.graveyard.length);ie(X,n=>n.zones.mainMonsterZone.length+n.zones.spellTrapZone.length+n.zones.fieldZone.length);const Ur=ie(X,n=>n.result.isGameOver?n.result:Vt(n));ie(X,n=>n.zones.deck.length===0);ie(X,n=>n.zones.hand.length===0);const Hr=ie(X,n=>n.zones.hand);ie(X,n=>[...n.zones.mainMonsterZone,...n.zones.spellTrapZone,...n.zones.fieldZone]);const jr=ie(X,n=>n.zones.graveyard);ie(X,n=>n.zones.banished);const Br=""+new URL("../assets/SpellCounter.pzkYCI1C.png",import.meta.url).href;var qr=O('<div class="absolute bottom-8 right-1 px-1 bg-green-900 text-white rounded-full flex items-center justify-center font-bold border-1 border-green-400 shadow-md z-10" data-testid="spell-counter-badge"><img alt="魔力カウンター" class="w-4 h-4"/> <span class="text-xs" data-testid="spell-counter-count"> </span></div>');function Qr(n,e){const t=k(()=>e.count>0);var r=Oe(),a=ne(r);{var s=i=>{var f=qr(),S=d(f),h=m(S,2),y=d(h,!0);o(h),o(f),re(()=>{Le(f,"title",`魔力カウンター: ${e.count??""}`),Le(S,"src",Br),te(y,e.count)}),I(i,f)};Y(a,i=>{c(t)&&i(s)})}I(n,r)}var Wr=(n,e,t)=>e(c(t)),Yr=O("<button> </button>"),Kr=O('<div class="absolute -bottom-10 md:-bottom-14 left-1/2 -translate-x-1/2 flex flex-wrap justify-center gap-1 md:gap-2 z-10 max-w-[200px]"><!> <button class="btn btn-sm preset-tonal-warning">キャンセル</button></div>'),Xr=O('<div class="relative"><div class="transition-transform duration-300 hover:scale-105"><!> <!></div> <!></div>');function Be(n,e){pe(e,!0);let t=he(e,"size",3,"medium"),r=he(e,"showDetailOnClick",3,!0),a=he(e,"faceDown",3,!1),s=he(e,"rotation",3,0),i=he(e,"spellCounterCount",3,0);function f(){e.onSelect(e.card,e.instanceId)}function S(l){l.onClick(e.card,e.instanceId)}function h(l,p){const b=l||"filled",N=p||"primary";return{filled:{primary:"preset-filled-primary-500",secondary:"preset-filled-secondary-500",tertiary:"preset-filled-tertiary-500",success:"preset-filled-success-500",warning:"preset-filled-warning-500",error:"preset-filled-error-500",surface:"preset-filled-surface-500"},tonal:{primary:"preset-tonal-primary",secondary:"preset-tonal-secondary",tertiary:"preset-tonal-tertiary",success:"preset-tonal-success",warning:"preset-tonal-warning",error:"preset-tonal-error",surface:"preset-tonal-surface"},outlined:{primary:"preset-outlined-primary-500",secondary:"preset-outlined-secondary-500",tertiary:"preset-outlined-tertiary-500",success:"preset-outlined-success-500",warning:"preset-outlined-warning-500",error:"preset-outlined-error-500",surface:"preset-outlined-surface-500"}}[b][N]}var y=Xr(),x=d(y),v=d(x);Se(v,{get card(){return e.card},get size(){return t()},get faceDown(){return a()},get rotation(){return s()},clickable:!0,get isSelected(){return e.isSelected},onClick:f,get showDetailOnClick(){return r()},animate:!1});var U=m(v,2);{var F=l=>{Qr(l,{get count(){return i()}})};Y(U,l=>{i()>0&&l(F)})}o(x);var M=m(x,2);{var G=l=>{var p=Kr(),b=d(p);Te(b,17,()=>e.actionButtons,D=>D.label,(D,z)=>{var C=Yr();C.__click=[Wr,S,z];var u=d(C,!0);o(C),re(T=>{me(C,1,`btn btn-sm w-full border-2 border-gray-200 ${T??""} ${e.isActivatable?"":"opacity-50 cursor-not-allowed"}`),te(u,c(z).label)},[()=>h(c(z).style,c(z).color)]),I(D,C)});var N=m(b,2);N.__click=function(...D){var z;(z=e.onCancel)==null||z.apply(this,D)},o(p),I(l,p)};Y(M,l=>{e.isSelected&&l(G)})}o(y),I(n,y),Ce()}De(["click"]);function Jr(n,e){e.onOpenChange(!1)}function $r(n,e){ee(e,!c(e))}var ea=O('<div class="relative"><div><!></div> <!></div>'),ta=O('<div class="relative"><div><!></div></div>'),na=O('<div class="flex gap-2 flex-wrap"><!></div>'),ra=O('<div class="text-center py-8"><p class="text-gray-500"> </p></div>'),aa=O('<header class="flex justify-between items-center mb-4"><h2 class="text-2xl sm:text-3xl font-bold mx-2"> </h2> <div class="flex items-center gap-2"><button type="button"><!> <span class="text-xs"> </span></button> <button type="button" class="btn preset-tonal rounded-full"><!></button></div></header> <div class="text-sm text-surface-600-300-token mb-2"> </div> <!>',1);function sn(n,e){pe(e,!0);let t=he(e,"emptyMessage",3,"カードがありません"),r=he(e,"borderColor",3,"border-gray-400");const a=k(()=>e.cards.slice().reverse());let s=Ie(!1);const i=k(()=>{const S=new Map;return c(a).forEach(h=>{const y=S.get(h.id);y?y.quantity+=1:S.set(h.id,{card:h,quantity:1})}),Array.from(S.values())});function f(S){e.onOpenChange(S.open)}Ye(n,{get open(){return e.open},onOpenChange:f,contentBase:"card bg-surface-100-900 p-6 mx-auto space-y-4 shadow-xl w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto",backdropClasses:"backdrop-blur-sm",content:h=>{var y=aa(),x=ne(y),v=d(x),U=d(v,!0);o(v);var F=m(v,2),M=d(F);M.__click=[$r,s];var G=d(M);const l=k(()=>c(s)?"mdi:card-multiple":"mdi:cards");Ot(G,{get icon(){return c(l)},class:"size-4"});var p=m(G,2),b=d(p,!0);o(p),o(M);var N=m(M,2);N.__click=[Jr,e];var D=d(N);Ot(D,{icon:"mdi:close",class:"size-4"}),o(N),o(F),o(x);var z=m(x,2),C=d(z);o(z);var u=m(z,2);{var T=H=>{var Q=na(),w=d(Q);{var R=P=>{var Z=Oe(),J=ne(Z);Te(J,17,()=>c(i),({card:W,quantity:$})=>W.id,(W,$)=>{let oe=()=>c($).card,ce=()=>c($).quantity;var le=ea(),ue=d(le),we=d(ue);Se(we,{get card(){return oe()},size:"medium",showDetailOnClick:!0}),o(ue);var Ze=m(ue,2);{var ye=fe=>{Ve(fe,{get count(){return ce()},colorClasses:"bg-primary-200 text-primary-900"})};Y(Ze,fe=>{ce()>1&&fe(ye)})}o(le),re(()=>me(ue,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),I(W,le)}),I(P,Z)},B=P=>{var Z=Oe(),J=ne(Z);Te(J,17,()=>c(a),An,(W,$)=>{var oe=ta(),ce=d(oe),le=d(ce);Se(le,{get card(){return c($)},size:"medium",showDetailOnClick:!0}),o(ce),o(oe),re(()=>me(ce,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),I(W,oe)}),I(P,Z)};Y(w,P=>{c(s)?P(R):P(B,!1)})}o(Q),I(H,Q)},q=H=>{var Q=ra(),w=d(Q),R=d(w,!0);o(w),o(Q),re(()=>te(R,t())),I(H,Q)};Y(u,H=>{e.cards.length>0?H(T):H(q,!1)})}re(()=>{te(U,e.title),me(M,1,`btn btn-sm ${c(s)?"preset-filled-primary-500":"preset-tonal"}`),Le(M,"title",c(s)?"個別表示に切り替え":"集約表示に切り替え"),te(b,c(s)?"集約":"個別"),te(C,`${e.cards.length??""}枚`)}),I(h,y)},$$slots:{content:!0}}),Ce()}De(["click"]);var sa=(n,e)=>n.key==="Enter"&&e(),ia=O('<div class="absolute inset-1"><!></div> <!>',1),oa=O('<div class="h-full flex items-center justify-center p-1 relative" style="filter: grayscale(0.8) brightness(0.7) contrast(1.2);"><img alt="墓地" class="w-full h-full object-cover opacity-30 rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-surface-600-300-token text-center select-none drop-shadow-lg"> </span></div></div> <!>',1),ca=O('<div role="button" tabindex="0"><!></div> <!>',1);function da(n,e){pe(e,!0);let t=he(e,"size",3,"medium");const r=vt();let a=Ie(!1);const s=k(()=>e.cards.length>0?e.cards[e.cards.length-1]:null);function i(){ee(a,!0)}function f(l){ee(a,l,!0)}let S=Ie(!1);function h(){ee(S,!0)}function y(){ee(S,!1)}var x=ca(),v=ne(x);v.__click=i,v.__keydown=[sa,i];var U=d(v);{var F=l=>{var p=ia(),b=ne(p),N=d(b);Se(N,{get card(){return c(s)},get size(){return t()},clickable:!1}),o(b);var D=m(b,2);Ve(D,{get count(){return e.cards.length}}),I(l,p)},M=l=>{var p=oa(),b=ne(p),N=d(b),D=m(N,2),z=d(D),C=d(z,!0);o(z),o(D),o(b);var u=m(b,2);Ve(u,{get count(){return e.cards.length}}),re(()=>{Le(N,"src",ft),te(C,r?"GY":"墓地")}),I(l,p)};Y(U,l=>{c(s)?l(F):l(M,!1)})}o(v);var G=m(v,2);sn(G,{get cards(){return e.cards},get open(){return c(a)},onOpenChange:f,title:"墓地",borderColor:"border-gray-400"}),re(()=>me(v,1,`
    ${ut[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    hover:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700
    ${c(S)?"scale-105 shadow-lg":""}
  `)),qe("mouseenter",v,h),qe("mouseleave",v,y),I(n,x),Ce()}De(["click","keydown"]);var la=(n,e)=>n.key==="Enter"&&e(),ua=O('<div role="button" tabindex="0"><div class="h-full flex items-center justify-center p-1 relative"><img alt="EXデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">EX</span></div></div> <!></div> <!>',1);function fa(n,e){pe(e,!0);let t=he(e,"size",3,"medium"),r=Ie(!1);function a(){ee(r,!0)}function s(M){ee(r,M,!0)}let i=Ie(!1);function f(){ee(i,!0)}function S(){ee(i,!1)}var h=ua(),y=ne(h);y.__click=a,y.__keydown=[la,a];var x=d(y),v=d(x);Lt(2),o(x);var U=m(x,2);Ve(U,{get count(){return e.cards.length}}),o(y);var F=m(y,2);sn(F,{get cards(){return e.cards},get open(){return c(r)},onOpenChange:s,title:"EXデッキ",borderColor:"border-purple-400"}),re(()=>{me(y,1,`
    ${ut[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    ${c(i)?"scale-105 shadow-lg":""}
  `),Le(v,"src",ft)}),qe("mouseenter",y,f),qe("mouseleave",y,S),I(n,h),Ce()}De(["click","keydown"]);var va=O('<div role="img"><div class="h-full flex items-center justify-center p-1 relative"><img alt="メインデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">Deck</span></div></div> <!></div>');function ma(n,e){pe(e,!0);let t=he(e,"size",3,"medium");var r=va(),a=d(r),s=d(a);Lt(2),o(a);var i=m(a,2);Ve(i,{get count(){return e.cardCount}}),o(r),re(()=>{me(r,1,`
    ${ut[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
  `),Le(s,"src",ft)}),I(n,r),Ce()}var _a=O('<div class="relative"><div style="filter: sepia(0.3) hue-rotate(90deg) saturate(1.5) brightness(0.9);"><!></div></div>'),ga=O('<div class="flex justify-center"><!></div>'),pa=O('<div class="relative"><div style="filter: sepia(0.5) hue-rotate(30deg) saturate(1.8) brightness(0.85);"><!></div></div>'),Ca=O('<div class="flex justify-center"><!></div>'),ha=O('<div class="relative"><div style="filter: sepia(0.4) hue-rotate(200deg) saturate(2) brightness(0.8);"><!></div></div>'),Sa=O('<div class="flex justify-center"><!></div>'),Ia=O('<div class="flex justify-center"><!></div>'),Ta=O('<div class="flex justify-center"><!></div>'),ya=O('<div class="flex justify-center"><!></div>'),Aa=O('<div class="grid grid-cols-4 gap-1 mb-2"><!> <!> <!> <!></div> <div class="grid grid-cols-5 gap-1 mb-2"></div> <div class="grid grid-cols-5 gap-1 mb-2"></div>',1),ba=O('<div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div> <div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div>',1),Oa=O('<div class="card p-2 max-w-6xl mx-auto"><div class="transition-all duration-300"><!></div></div>');function xa(n,e){pe(e,!0);const t=(C,u=at)=>{var T=ga(),q=d(T);{var H=w=>{const R=k(()=>e.selectedFieldCardInstanceId===e.fieldCards[0].instanceId),B=k(()=>G(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown).length>0),P=k(()=>G(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown)),Z=k(()=>e.onCancelFieldCardSelection||(()=>{}));Be(w,{get card(){return e.fieldCards[0].card},get instanceId(){return e.fieldCards[0].instanceId},get faceDown(){return e.fieldCards[0].faceDown},get isSelected(){return c(R)},get isActivatable(){return c(B)},onSelect:v,get actionButtons(){return c(P)},get onCancel(){return c(Z)},get size(){return x},showDetailOnClick:!0})},Q=w=>{var R=_a(),B=d(R),P=d(B);Se(P,{placeholder:!0,get placeholderText(){return u()},get size(){return x}}),o(B),o(R),I(w,R)};Y(q,w=>{e.fieldCards.length>0?w(H):w(Q,!1)})}o(T),I(C,T)},r=(C,u=at)=>{var T=Ca(),q=d(T);{var H=w=>{const R=k(()=>e.monsterCards[u()].rotation||0),B=k(()=>e.selectedFieldCardInstanceId===e.monsterCards[u()].instanceId),P=k(()=>l(e.monsterCards[u()].instanceId).length>0),Z=k(()=>l(e.monsterCards[u()].instanceId)),J=k(()=>e.onCancelFieldCardSelection||(()=>{})),W=k(()=>e.monsterCards[u()].spellCounterCount||0);Be(w,{get card(){return e.monsterCards[u()].card},get instanceId(){return e.monsterCards[u()].instanceId},get faceDown(){return e.monsterCards[u()].faceDown},get rotation(){return c(R)},get isSelected(){return c(B)},get isActivatable(){return c(P)},onSelect:v,get actionButtons(){return c(Z)},get onCancel(){return c(J)},get size(){return x},showDetailOnClick:!0,get spellCounterCount(){return c(W)}})},Q=w=>{var R=pa(),B=d(R),P=d(B);const Z=k(()=>u()+1);Se(P,{placeholder:!0,get placeholderText(){return`M${c(Z)??""}`},get size(){return x}}),o(B),o(R),I(w,R)};Y(q,w=>{e.monsterCards[u()]?w(H):w(Q,!1)})}o(T),I(C,T)},a=(C,u=at)=>{var T=Sa(),q=d(T);{var H=w=>{var R=Oe(),B=ne(R);{var P=J=>{const W=k(()=>e.selectedFieldCardInstanceId===e.spellTrapCards[u()].instanceId),$=k(()=>M(e.spellTrapCards[u()].instanceId).length>0),oe=k(()=>M(e.spellTrapCards[u()].instanceId)),ce=k(()=>e.onCancelFieldCardSelection||(()=>{}));Be(J,{get card(){return e.spellTrapCards[u()].card},get instanceId(){return e.spellTrapCards[u()].instanceId},faceDown:!0,get isSelected(){return c(W)},get isActivatable(){return c($)},onSelect:v,get actionButtons(){return c(oe)},get onCancel(){return c(ce)},get size(){return x},showDetailOnClick:!0})},Z=J=>{Se(J,{get card(){return e.spellTrapCards[u()].card},faceDown:!1,get size(){return x},clickable:!0,showDetailOnClick:!0,onClick:()=>e.spellTrapCards[u()]&&v(e.spellTrapCards[u()].card,e.spellTrapCards[u()].instanceId)})};Y(B,J=>{e.spellTrapCards[u()].faceDown?J(P):J(Z,!1)})}I(w,R)},Q=w=>{var R=ha(),B=d(R),P=d(B);const Z=k(()=>u()+1);Se(P,{placeholder:!0,get placeholderText(){return`S${c(Z)??""}`},get size(){return x}}),o(B),o(R),I(w,R)};Y(q,w=>{e.spellTrapCards[u()]?w(H):w(Q,!1)})}o(T),I(C,T)},s=C=>{var u=Ia(),T=d(u);da(T,{get cards(){return e.graveyardCards},get size(){return x}}),o(u),I(C,u)},i=C=>{var u=Ta(),T=d(u);fa(T,{get cards(){return e.extraDeckCards},get size(){return x}}),o(u),I(C,u)},f=C=>{var u=ya(),T=d(u);ma(T,{get cardCount(){return e.deckCards},get size(){return x}}),o(u),I(C,u)},h=[...Array(5).keys()],y=vt(),x=y?"small":"medium";function v(C,u){e.onFieldCardClick&&e.onFieldCardClick(C,u)}function U(C){return se.canActivateSpell(C)}function F(C){return se.canActivateIgnitionEffect(C)}function M(C){return U(C)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]}function G(C,u){return u?U(C)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]:F(C)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}function l(C){return F(C)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}var p=Oa(),b=d(p),N=d(b);{var D=C=>{var u=Aa(),T=ne(u),q=d(T);t(q,()=>"F");var H=m(q,2);i(H);var Q=m(H,2);f(Q);var w=m(Q,2);s(w),o(T);var R=m(T,2);Te(R,20,()=>h,P=>P,(P,Z)=>{r(P,()=>Z)}),o(R);var B=m(R,2);Te(B,20,()=>h,P=>P,(P,Z)=>{a(P,()=>Z)}),o(B),I(C,u)},z=C=>{var u=ba(),T=ne(u),q=d(T);t(q,()=>"フィールド");var H=m(q,2);Te(H,16,()=>h,Z=>Z,(Z,J)=>{r(Z,()=>J)});var Q=m(H,2);s(Q),o(T);var w=m(T,2),R=d(w);i(R);var B=m(R,2);Te(B,16,()=>h,Z=>Z,(Z,J)=>{a(Z,()=>J)});var P=m(B,2);f(P),o(w),I(C,u)};Y(N,C=>{y?C(D):C(z,!1)})}o(b),o(p),I(n,p),Ce()}var Ea=O('<div class="text-center text-sm opacity-50">No cards in hand</div>'),Na=O("<div></div>");function ka(n,e){pe(e,!0);const t=vt(),r=t?"small":"medium";function a(l){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canActivateSpell(l)}function s(l){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSummonMonster(l)}function i(l){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSetMonster(l)}function f(l){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSetSpellTrap(l)}function S(l){const p={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10"};if(l<=0)return"grid-cols-1";if(t){if(l>=5)return"grid-cols-5"}else if(l>=10)return"grid-cols-10";return p[l]}function h(l,p){const b=e.selectedHandCardInstanceId===p?null:p;e.onHandCardSelect(b)}function y(l,p){e.onCardClick(l,p),e.onHandCardSelect(null)}function x(l,p){e.onSummonMonster(l,p),e.onHandCardSelect(null)}function v(l,p){e.onSetMonster(l,p),e.onHandCardSelect(null)}function U(l,p){e.onSetSpellTrap(l,p),e.onHandCardSelect(null)}function F(){e.onHandCardSelect(null)}function M(l,p){const b=[];return l.type==="monster"?(s(p)&&b.push({label:"召喚",style:"filled",color:"primary",onClick:x}),i(p)&&b.push({label:"セット",style:"filled",color:"primary",onClick:v})):(l.type==="spell"||l.type==="trap")&&(a(p)&&b.push({label:"発動",style:"filled",color:"primary",onClick:y}),f(p)&&b.push({label:"セット",style:"filled",color:"primary",onClick:U})),b}var G=Na();Te(G,21,()=>e.cards,({card:l,instanceId:p})=>p,(l,p)=>{let b=()=>c(p).card,N=()=>c(p).instanceId;var D=Oe(),z=ne(D);{var C=T=>{const q=k(()=>e.selectedHandCardInstanceId===N()),H=k(()=>M(b(),N()).length>0),Q=k(()=>M(b(),N()));Be(T,{get card(){return b()},get instanceId(){return N()},get isSelected(){return c(q)},get isActivatable(){return c(H)},onSelect:h,get actionButtons(){return c(Q)},onCancel:F,get size(){return r}})},u=T=>{Se(T,{placeholder:!0,placeholderText:"...",get size(){return r}})};Y(z,T=>{b()?T(C):T(u,!1)})}I(l,D)},l=>{var p=Ea();I(l,p)}),o(G),re(l=>me(G,1,`grid ${l??""} gap-2 mb-16`),[()=>S(e.handCardCount)]),I(n,G),Ce()}function Da(n,e){var t;(t=e.config)==null||t.onConfirm()}var wa=O('<button class="btn variant-ghost">キャンセル</button>'),Ra=O('<header class="text-center"><h2 class="h3 font-bold text-primary-600-300-token"> </h2></header> <article class="text-center"><p class="text-lg"> </p></article> <footer class="flex justify-center gap-3"><!> <button class="btn variant-filled-primary">OK</button></footer>',1);function Ma(n,e){pe(e,!0);const t=k(()=>{var s;return((s=e.config)==null?void 0:s.cancelable)??!1});function r(){var s,i;(i=(s=e.config)==null?void 0:s.onCancel)==null||i.call(s)}function a(s){!s.open&&e.isOpen&&c(t)&&r()}Ye(n,{get open(){return e.isOpen},onOpenChange:a,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-md shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return c(t)},preventScroll:!0,content:i=>{var f=Oe(),S=ne(f);{var h=y=>{var x=Ra(),v=ne(x),U=d(v),F=d(U,!0);o(U),o(v);var M=m(v,2),G=d(M),l=d(G,!0);o(G),o(M);var p=m(M,2),b=d(p);{var N=z=>{var C=wa();C.__click=r,I(z,C)};Y(b,z=>{c(t)&&z(N)})}var D=m(b,2);D.__click=[Da,e],o(p),re(()=>{te(F,e.config.summary),te(l,e.config.description)}),I(y,x)};Y(S,y=>{e.config&&y(h)})}I(i,f)},$$slots:{content:!0}}),Ce()}De(["click"]);function Pa(n,e,t,r){!e.config||!c(t)()||e.config.onConfirm(Array.from(c(r)))}var La=O('<button class="btn btn-sm btn-circle btn-ghost">✕</button>'),za=O("<div><!></div>"),Fa=O('<button class="btn btn-ghost">キャンセル</button>'),Za=O('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg"> </h3> <!></div> <p class="text-sm text-surface-600-300-token mb-4"> </p> <div class="flex justify-between items-center mb-4 p-3 bg-surface-200 dark:bg-surface-800 rounded-lg border border-surface-300 dark:border-surface-600"><span class="text-sm font-semibold"> </span></div> <div class="min-h-[200px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><!> <button class="btn btn-primary">確定</button></div>',1);function Ga(n,e){pe(e,!0);let t=Ie(In(new Set));ct(()=>{e.isOpen&&ee(t,new Set,!0)});const r=k(()=>c(t).size),a=k(()=>{var v;return((v=e.config)==null?void 0:v.cancelable)??!1}),s=k(()=>()=>e.config?c(r)>=e.config.minCards&&c(r)<=e.config.maxCards:!1);function i(v){return c(t).has(v)}function f(v){return e.config?c(t).has(v)?!0:c(t).size<e.config.maxCards:!1}function S(v){!v.open&&e.isOpen&&c(a)&&y()}function h(v){if(!e.config||!e.config.availableCards.some(G=>G.instanceId===v))return;const F=f(v),M=i(v);if(F||M){const G=new Set(c(t));M?G.delete(v):G.add(v),ee(t,G,!0)}}function y(){var v,U;(U=(v=e.config)==null?void 0:v.onCancel)==null||U.call(v)}function x(v){var F;const U=(F=e.config)==null?void 0:F.availableCards.find(M=>M.instanceId===v);if(U)return Pe(U.id)}Ye(n,{get open(){return e.isOpen},onOpenChange:S,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return c(a)},preventScroll:!0,content:U=>{var F=Oe(),M=ne(F);{var G=l=>{var p=Za(),b=ne(p),N=d(b),D=d(N,!0);o(N);var z=m(N,2);{var C=W=>{var $=La();$.__click=y,I(W,$)};Y(z,W=>{c(a)&&W(C)})}o(b);var u=m(b,2),T=d(u,!0);o(u);var q=m(u,2),H=d(q),Q=d(H);o(H),o(q);var w=m(q,2),R=d(w);Te(R,21,()=>e.config.availableCards,W=>W.instanceId,(W,$)=>{var oe=Oe();const ce=k(()=>i(c($).instanceId)),le=k(()=>f(c($).instanceId)),ue=k(()=>x(c($).instanceId));var we=ne(oe);{var Ze=ye=>{var fe=za();let Re;var Ue=d(fe);Se(Ue,{get card(){return c(ue)},size:"small",clickable:!0,selectable:!1,get isSelected(){return c(ce)},animate:!0,onClick:()=>h(c($).instanceId)}),o(fe),re(et=>Re=me(fe,1,"",null,Re,et),[()=>({"opacity-50":!c(le)&&!c(ce)})]),I(ye,fe)};Y(we,ye=>{c(ue)&&ye(Ze)})}I(W,oe)}),o(R),o(w);var B=m(w,2),P=d(B);{var Z=W=>{var $=Fa();$.__click=y,I(W,$)};Y(P,W=>{c(a)&&W(Z)})}var J=m(P,2);J.__click=[Pa,e,s,t],o(B),re(W=>{te(D,e.config.summary),te(T,e.config.description),te(Q,`選択中: ${c(r)??""} / ${e.config.maxCards??""}枚`),J.disabled=W},[()=>!c(s)()]),I(l,p)};Y(M,l=>{e.config&&l(G)})}I(U,F)},$$slots:{content:!0}}),Ce()}De(["click"]);var Va=O('<span class="text-warning-600 dark:text-warning-400">Draw</span>'),Ua=O("Winner: <span> </span>",1),Ha=O('<p class="text-2xl font-bold"><!></p>'),ja=O('<p class="text-base opacity-75"><span class="font-semibold">Reason:</span> </p>'),Ba=O('<p class="text-base"> </p>'),qa=O('<header class="text-center"><h2>Game Over!</h2></header> <article class="space-y-4 text-center"><!> <!> <!></article> <footer class="flex justify-center"><button class="btn variant-filled-primary">閉じる</button></footer>',1);function Qa(n,e){pe(e,!0);function t(){e.onClose()}function r(i){i.open||t()}function a(){return e.winner==="player"?"border-success-500":e.winner==="opponent"?"border-error-500":e.winner==="draw"?"border-warning-500":"border-surface-500"}const s=k(a);Ye(n,{get open(){return e.isOpen},onOpenChange:r,get contentBase(){return`card bg-surface-50 dark:bg-surface-900 p-8 space-y-6 max-w-lg shadow-2xl border-4 ${c(s)??""}`},backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!0,preventScroll:!0,content:f=>{var S=qa(),h=ne(S),y=d(h);o(h);var x=m(h,2),v=d(x);{var U=N=>{var D=Ha(),z=d(D);{var C=T=>{var q=Va();I(T,q)},u=T=>{var q=Ua(),H=m(ne(q)),Q=d(H,!0);o(H),re(()=>{me(H,1,bn(e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400")),te(Q,e.winner==="player"?"You":"Opponent")}),I(T,q)};Y(z,T=>{e.winner==="draw"?T(C):T(u,!1)})}o(D),I(N,D)};Y(v,N=>{e.winner&&N(U)})}var F=m(v,2);{var M=N=>{var D=ja(),z=m(d(D));o(D),re(()=>te(z,` ${e.reason??""}`)),I(N,D)};Y(F,N=>{e.reason&&N(M)})}var G=m(F,2);{var l=N=>{var D=Ba(),z=d(D,!0);o(D),re(()=>te(z,e.message)),I(N,D)};Y(G,N=>{e.message&&N(l)})}o(x);var p=m(x,2),b=d(p);b.__click=t,o(p),re(()=>me(y,1,`h2 font-bold ${e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400"}`)),I(f,S)},$$slots:{content:!0}}),Ce()}De(["click"]);var Wa=O('<div class="container mx-auto p-4"><main class="max-w-4xl mx-auto space-y-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card px-4"><h1 class="text-2xl font-bold"> </h1></div> <div class="card px-4 space-y-4"><div class="space-y-2"><div class="flex justify-start space-x-4"><span>Now:</span> <span class="font-bold" data-testid="current-phase"> </span></div> <div class="flex justify-between"><span>自分 LP:</span> <span class="font-bold text-success-500"> </span> <span>相手 LP:</span> <span class="font-bold text-error-500"> </span></div></div></div></div> <!> <div class="card px-4 space-y-4"><h2 class="text-xl font-bold"> </h2> <!></div> <details class="card p-4"><summary class="cursor-pointer font-bold">Debug Info</summary> <div class="mt-4 space-y-4"><pre class="text-xs overflow-auto"> </pre></div></details></main></div> <!> <!> <!>',1);function os(n,e){pe(e,!0);const[t,r]=yn(),a=()=>ve(zr,"$currentTurn",t),s=()=>ve(Lr,"$currentPhase",t),i=()=>ve(Ur,"$gameResult",t),f=()=>ve(Hr,"$handCardInstances",t),S=()=>ve(jr,"$graveyardCardInstances",t),h=()=>ve(X,"$gameStateStore",t),y=()=>ve(Fr,"$playerLP",t),x=()=>ve(Zr,"$opponentLP",t),v=()=>ve(Vr,"$deckCardCount",t),U=()=>ve(Gr,"$handCardCount",t),F=()=>ve(R,"$effectQueueState",t);Tn(async()=>{await Sn(e.data.uniqueCardIds),ke.registerNotificationHandler({showInfo:(L,E)=>{Ne(E)},showInteractive:()=>{}})});async function M(){for(let L=0;L<2;L++){await new Promise(A=>setTimeout(A,300));const E=se.advancePhase();if(E.success)console.log(`[Simulator] ${E.message}`),E.message&&Ne(E.message);else{be(E.error||"フェーズ移行に失敗しました");break}}}let G=Ie(!1);ct(()=>{a()===1&&s()==="Draw"&&!c(G)&&!i().isGameOver&&(M(),ee(G,!0))});let l=Ie(!1);ct(()=>{i().isGameOver&&ee(l,!0)});function p(){if(i().isGameOver)return"ゲーム終了";function L(E){return{Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ1",End:"エンドフェイズ"}[E]||E}return L(s())}function b(L,E){const A=se.activateSpell(E);A.success||be(A.error||"発動に失敗しました")}function N(L,E){const A=se.summonMonster(E);A.success?Ne(A.message||`${L.name}を召喚しました`):be(A.error||"召喚に失敗しました")}function D(L,E){const A=se.setMonster(E);A.success?Ne(`${L.name}をセットしました`):be(A.error||"セットに失敗しました")}function z(L,E){const A=se.setSpellTrap(E);A.success?Ne(`${L.name}をセットしました`):be(A.error||"セットに失敗しました")}let C=Ie(null),u=Ie(null);function T(L){ee(C,L,!0),ee(u,null)}function q(L,E){const A=se.getGameState();if(![...A.zones.mainMonsterZone,...A.zones.spellTrapZone,...A.zones.fieldZone].find(_n=>_n.instanceId===E)){be("Card not found on field");return}ee(C,null),ee(u,c(u)===E?null:E,!0)}function H(L,E){const A=se.activateSpell(E);A.success?Ne(A.message||`${L.name}を発動しました`):be(A.error||"発動に失敗しました"),ee(u,null)}function Q(L,E){const A=se.activateIgnitionEffect(E);A.success?Ne(A.message||`${L.name}の効果を発動しました`):be(A.error||"効果発動に失敗しました"),ee(u,null)}function w(){ee(u,null)}const R=ke,B=k(()=>f().map(L=>({card:Pe(L.id),instanceId:L.instanceId}))),P=k(()=>S().map(L=>Pe(L.id)).filter(L=>L!==void 0)),Z=k(()=>h().zones.fieldZone.map(E=>{const A=Pe(E.id);return A?{card:A,instanceId:E.instanceId,faceDown:E.position==="faceDown"}:null}).filter(E=>E!==null)),J=k(()=>{const L=h().zones.mainMonsterZone,E=Array(5).fill(null);return L.forEach((A,Ae)=>{if(Ae<5){const Me=Pe(A.id);Me&&(E[Ae]={card:Me,instanceId:A.instanceId,faceDown:A.position==="faceDown",rotation:A.battlePosition==="defense"?270:0,spellCounterCount:$e(A.counters,"spell")})}}),E}),W=k(()=>{const L=h().zones.spellTrapZone,E=Array(5).fill(null);return L.forEach((A,Ae)=>{if(Ae<5){const Me=Pe(A.id);Me&&(E[Ae]={card:Me,instanceId:A.instanceId,faceDown:A.position==="faceDown"})}}),E});var $=Wa(),oe=ne($),ce=d(oe),le=d(ce),ue=d(le),we=d(ue),Ze=d(we);o(we),o(ue);var ye=m(ue,2),fe=d(ye),Re=d(fe),Ue=m(d(Re),2),et=d(Ue,!0);o(Ue),o(Re);var pt=m(Re,2),tt=m(d(pt),2),on=d(tt,!0);o(tt);var Ct=m(tt,4),cn=d(Ct,!0);o(Ct),o(pt),o(fe),o(ye),o(le);var ht=m(le,2);xa(ht,{get deckCards(){return v()},extraDeckCards:[],get graveyardCards(){return c(P)},get fieldCards(){return c(Z)},get monsterCards(){return c(J)},get spellTrapCards(){return c(W)},get selectedFieldCardInstanceId(){return c(u)},onFieldCardClick:q,onActivateSetSpell:H,onActivateIgnitionEffect:Q,onCancelFieldCardSelection:w});var nt=m(ht,2),rt=d(nt),dn=d(rt);o(rt);var ln=m(rt,2);ka(ln,{get cards(){return c(B)},get handCardCount(){return U()},get currentPhase(){return s()},get isGameOver(){return i().isGameOver},get selectedHandCardInstanceId(){return c(C)},onCardClick:b,onSummonMonster:N,onSetMonster:D,onSetSpellTrap:z,onHandCardSelect:T}),o(nt);var St=m(nt,2),It=m(d(St),2),Tt=d(It),un=d(Tt,!0);o(Tt),o(It),o(St),o(ce),o(oe);var yt=m(oe,2);const fn=k(()=>F().confirmationConfig!==null);Ma(yt,{get isOpen(){return c(fn)},get config(){return F().confirmationConfig}});var At=m(yt,2);const vn=k(()=>F().cardSelectionConfig!==null);Ga(At,{get isOpen(){return c(vn)},get config(){return F().cardSelectionConfig}});var mn=m(At,2);Qa(mn,{get isOpen(){return c(l)},get winner(){return i().winner},get reason(){return i().reason},get message(){return i().message},onClose:()=>{ee(l,!1)}}),re((L,E,A,Ae)=>{te(Ze,`Deck: ${e.data.deckName??""}`),te(et,L),te(on,E),te(cn,A),te(dn,`手札 (${U()??""} 枚)`),te(un,Ae)},[p,()=>y().toLocaleString(),()=>x().toLocaleString(),()=>JSON.stringify(se.getGameState(),null,2)]),I(n,$),Ce(),r()}export{os as component,is as universal};
