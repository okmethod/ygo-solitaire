var Dt=Object.defineProperty;var Et=(a,e,t)=>e in a?Dt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var L=(a,e,t)=>Et(a,typeof e!="symbol"?e+"":e,t);import{l as Ot,Y as lt,C as Pt,a as Ye,b as se,c as Re,d as Qe}from"../chunks/Cq5G7GPL.js";import{A as Oe,B as qe,C as Ne,D as De,E as Tt,F as K,G as D,w as Ie,M as je,I as Lt,x as Y,y as ot,H as Me}from"../chunks/BRWGcvtg.js";import{f as A,a as S,c as We}from"../chunks/BzqWM1xr.js";import{j as te,l as ae,k as W,v as o,x as i,u as h,t as Z,q as d,y as I,m as F,aG as ue,A as Xe,W as Mt,D as Je}from"../chunks/CKuk0KJ3.js";import{d as he,s as j,e as Ge}from"../chunks/BtrBAieD.js";import{p as fe,a as ut,s as H}from"../chunks/DQPV5J1y.js";import{d as N}from"../chunks/DwmXK2rF.js";import{i as B}from"../chunks/CiQuYYFI.js";import{e as Ee}from"../chunks/Clij8A-N.js";import{c as ve,b as et,d as Rt}from"../chunks/B9oa_3uL.js";function Pe(a,e){return{success:!0,newState:a,message:e}}function le(a,e){return{success:!1,newState:a,error:e}}function ft(a){const e=[...a];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}function ce(a,e,t,r,n){const s=a[t],c=s.findIndex(C=>C.instanceId===e);if(c===-1)throw new Error(`Card with instanceId ${e} not found in ${t} zone`);const u={...s[c],location:r,...n&&{position:n}};return{...a,[t]:[...s.slice(0,c),...s.slice(c+1)],[r]:[...a[r],u]}}function tt(a,e=1){if(a.deck.length<e)throw new Error(`Cannot draw ${e} cards. Only ${a.deck.length} cards remaining in deck.`);let t=a;for(let r=0;r<e;r++){const n=t.deck[t.deck.length-1];t=ce(t,n.instanceId,"deck","hand")}return t}function we(a,e){const t=[...a.field,...a.hand].find(n=>n.instanceId===e);if(!t)throw new Error(`Card with instanceId ${e} not found in field or hand`);const r=t.location;return ce(a,e,r,"graveyard")}function Gt(a,e){for(const r of e)if(!a.hand.find(s=>s.instanceId===r))throw new Error(`Card with instanceId ${r} not found in hand`);let t=a;for(const r of e)t=ce(t,r,"hand","graveyard");return t}function vt(a){return{...a,deck:ft(a.deck)}}class Nt{constructor(e=1){L(this,"description");this.count=e,this.description=`Draw ${e} card${e>1?"s":""}`}canExecute(e){return e.result.isGameOver?!1:e.zones.deck.length>=this.count}execute(e){if(!this.canExecute(e))return le(e,`Cannot draw ${this.count} cards. Only ${e.zones.deck.length} cards in deck.`);const t=tt(e.zones,this.count),r={...e,zones:t},n=Oe(r),s={...r,result:n};return Pe(s,`Drew ${this.count} card${this.count>1?"s":""}`)}getCount(){return this.count}}const Ue=["Draw","Standby","Main1","End"];function mt(a){const e=Ue.indexOf(a);return e===-1||e===Ue.length-1?"End":Ue[e+1]}function Ve(a){return mt(a)}function jt(a,e){return!(a==="Draw"&&e)}function Ft(a){return{Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ",End:"エンドフェイズ"}[a]}function $t(a,e){const t=mt(a);return e!==t?{valid:!1,error:`Invalid phase transition: ${a} → ${e}. Expected: ${t}`}:{valid:!0}}class Zt{constructor(){L(this,"description");this.description="Advance to next phase"}canExecute(e){if(e.result.isGameOver)return!1;const t=Ve(e.phase);if(!$t(e.phase,t).valid)return!1;const n=e.zones.deck.length===0;return jt(e.phase,n)}execute(e){if(!this.canExecute(e))return le(e,`Cannot advance from ${e.phase} phase`);const t=Ve(e.phase),r={...e,phase:t,activatedIgnitionEffectsThisTurn:t==="End"?new Set:e.activatedIgnitionEffectsThisTurn,activatedOncePerTurnCards:t==="End"?new Set:e.activatedOncePerTurnCards},n=Ft(t);return t==="End"&&e.pendingEndPhaseEffects.length>0?{success:!0,newState:{...r,pendingEndPhaseEffects:[]},message:`Advanced to ${n}. Executing ${e.pendingEndPhaseEffects.length} end phase effect(s).`,effectSteps:[...e.pendingEndPhaseEffects]}:Pe(r,`Advanced to ${n}`)}getNextPhase(e){return Ve(e.phase)}}function Ke(a,e){if(a.phase!=="Main1")return{canActivate:!1,reason:`魔法カードはメインフェイズでのみ発動できます（現在: ${a.phase}）`};const t=a.zones.hand.find(r=>r.instanceId===e);return t?t.type==="trap"?{canActivate:!1,reason:"罠カードは手札から直接発動できません（セットが必要です）"}:{canActivate:!0}:{canActivate:!1,reason:"指定されたカードが手札に見つかりません"}}function Bt(a){return a.phase!=="Main1"?!1:a.zones.hand.length>0}class G{static register(e,t){this.actions.set(e,t)}static get(e){return this.actions.get(e)}static clear(){this.actions.clear()}static getRegisteredCardIds(){return Array.from(this.actions.keys())}}L(G,"actions",new Map);class ht{constructor(e){L(this,"description");this.cardInstanceId=e,this.description=`Activate spell card ${e}`}canExecute(e){if(e.result.isGameOver||!Ke(e,this.cardInstanceId).canActivate)return!1;const r=qe(e,this.cardInstanceId);if(r){const n=r.id,s=G.get(n);if(s&&!s.canActivate(e))return!1}return!0}execute(e){const t=Ke(e,this.cardInstanceId);if(!t.canActivate)return le(e,t.reason||"Cannot activate spell card");const r=qe(e,this.cardInstanceId);if(!r)return le(e,`Card instance ${this.cardInstanceId} not found`);const n=r.id,s=G.get(n);if(s&&!s.canActivate(e))return le(e,"発動条件を満たしていません");const c=ce(e.zones,this.cardInstanceId,"hand","field","faceUp"),l={...e,zones:c};if(s&&s.canActivate(l)){const w=s.createActivationSteps(l),f=s.createResolutionSteps(l,this.cardInstanceId),v=[...w,...f];return{success:!0,newState:l,message:`Spell card activated: ${this.cardInstanceId}`,effectSteps:v}}const u=we(c,this.cardInstanceId),C={...e,zones:u},k=Oe(C),p={...C,result:k};return Pe(p,`Spell card activated (no effect): ${this.cardInstanceId}`)}getCardInstanceId(){return this.cardInstanceId}}class Ht{constructor(){L(this,"description","Shuffle deck")}canExecute(e){return!e.result.isGameOver}execute(e){if(!this.canExecute(e))return le(e,"Cannot shuffle deck: game is already over");try{const t=ft(e.zones.deck),r={...e,zones:{...e.zones,deck:t}};return Pe(r,"デッキをシャッフルしました")}catch(t){return le(e,`デッキのシャッフルに失敗しました: ${t instanceof Error?t.message:String(t)}`)}}}function me(a,e){return{id:(e==null?void 0:e.id)??`draw-${a}`,summary:(e==null?void 0:e.summary)??"カードをドロー",description:(e==null?void 0:e.description)??`デッキから${a}枚ドローします`,notificationLevel:"info",action:t=>{if(t.zones.deck.length<a)return{success:!1,newState:t,error:`Cannot draw ${a} cards. Not enough cards in deck.`};const r=tt(t.zones,a),n={...t,zones:r},s=Oe(n);return{success:!0,newState:{...n,result:s},message:`Drew ${a} card${a>1?"s":""}`}}}}function re(a,e,t){const r=Ne(e);return{id:(t==null?void 0:t.id)??`${a}-graveyard`,summary:"墓地へ送る",description:`${r.jaName}を墓地に送ります`,notificationLevel:"info",action:n=>{const s=we(n.zones,a);return{success:!0,newState:{...n,zones:s},message:`Sent ${r.jaName} to graveyard`}}}}function Fe(a){return{id:a.id,summary:a.summary,description:a.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:a.availableCards,minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable??!1},action:(e,t)=>!t||t.length===0?a.onSelect(e,[]):a.onSelect(e,t)}}function Ut(a,e){const t=e==null?void 0:e.target,r="相手";return{id:(e==null?void 0:e.id)??`gain-lp-${t}-${a}`,summary:(e==null?void 0:e.summary)??`${r}のLPを増加`,description:(e==null?void 0:e.description)??`${r}のLPが${a}増加します`,notificationLevel:"info",action:n=>({success:!0,newState:{...n,lp:{...n.lp,[t]:n.lp[t]+a}},message:`Opponent gained ${a} LP`})}}function Vt(a){return{id:"shuffle-deck",summary:"デッキシャッフル",description:"デッキをシャッフルします",notificationLevel:"info",action:e=>{const t=vt(e.zones);return{success:!0,newState:{...e,zones:t},message:"Deck shuffled"}}}}function qt(a,e){const t=a.length;return{id:`return-to-deck-${t}`,summary:"デッキに戻す",description:`${t}枚のカードをデッキに戻します`,notificationLevel:"info",action:r=>{if(a.length===0)return{success:!0,newState:r,message:"No cards to return"};let n=r.zones;for(const c of a)n=ce(n,c,"hand","deck");return{success:!0,newState:{...r,zones:n},message:`Returned ${t} card${t>1?"s":""} to deck`}}}}function Wt(a){return{id:a.id,summary:a.summary,description:a.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:[],minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable??!1,_sourceZone:"graveyard",_filter:a.filter},action:(e,t)=>{if(e.zones.graveyard.filter(a.filter).length===0)return{success:!1,newState:e,error:"No cards available in graveyard matching the criteria"};if(!t||t.length===0)return{success:!1,newState:e,error:"No cards selected"};let n=e.zones;for(const c of t)n=ce(n,c,"graveyard","hand");return{success:!0,newState:{...e,zones:n},message:`Added ${t.length} card${t.length>1?"s":""} from graveyard to hand`}}}}function Jt(a){return{id:a.id,summary:a.summary,description:a.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:[],minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable??!1,_sourceZone:"deck",_filter:(e,t)=>t!==void 0&&t<a.count},action:(e,t)=>{const r=e.zones.deck.slice(0,a.count);if(r.length<a.count)return{success:!1,newState:e,error:`Cannot excavate ${a.count} cards. Deck has only ${r.length} cards.`};if(!t||t.length===0)return{success:!1,newState:e,error:"No cards selected"};let n=e.zones;for(const c of t)n=ce(n,c,"deck","hand");return{success:!0,newState:{...e,zones:n},message:`Added ${t.length} card${t.length>1?"s":""} from deck to hand`}}}}function gt(a,e){return{id:(e==null?void 0:e.id)??`add-end-phase-effect-${a.id}`,summary:(e==null?void 0:e.summary)??"エンドフェイズ効果を登録",description:(e==null?void 0:e.description)??"エンドフェイズに実行される効果を登録します",notificationLevel:"silent",action:t=>({success:!0,newState:{...t,pendingEndPhaseEffects:[...t.pendingEndPhaseEffects,a]},message:`Added end phase effect: ${a.summary}`})}}function Kt(a,e){return{id:(e==null?void 0:e.id)??`draw-until-${a}`,summary:(e==null?void 0:e.summary)??`手札が${a}枚になるようにドロー`,description:(e==null?void 0:e.description)??`手札が${a}枚になるようにデッキからドローします`,notificationLevel:"info",action:t=>{const r=t.zones.hand.length,n=Math.max(0,a-r);if(n===0)return{success:!0,newState:t,message:`Hand already has ${r} cards (target: ${a})`};if(t.zones.deck.length<n)return{success:!1,newState:t,error:`Cannot draw ${n} cards to reach target. Deck has only ${t.zones.deck.length} cards.`};const s=tt(t.zones,n),c={...t,zones:s},l=Oe(c);return{success:!0,newState:{...c,result:l},message:`Drew ${n} card${n>1?"s":""} (hand now: ${a})`}}}}function Yt(a){return{id:a.id,summary:a.summary,description:a.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:[],minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable??!1,_sourceZone:"deck",_filter:a.filter},action:(e,t)=>{if(e.zones.deck.filter(a.filter).length===0)return{success:!1,newState:e,error:"No cards available in deck matching the criteria"};if(!t||t.length===0)return{success:!1,newState:e,error:"No cards selected"};let n=e.zones;for(const c of t)n=ce(n,c,"deck","hand");return n=vt(n),{success:!0,newState:{...e,zones:n},message:`Added ${t.length} card${t.length>1?"s":""} from deck to hand and shuffled`}}}}function Qt(a,e){const t=(e==null?void 0:e.target)??"player",r=t==="player"?"プレイヤー":"相手";return{id:(e==null?void 0:e.id)??`pay-lp-${t}-${a}`,summary:(e==null?void 0:e.summary)??`${r}がLPを支払う`,description:(e==null?void 0:e.description)??`${r}が${a}LPを支払います`,notificationLevel:"info",action:n=>({success:!0,newState:{...n,lp:{...n.lp,[t]:n.lp[t]-a}},message:`${t==="player"?"Player":"Opponent"} paid ${a} LP`})}}class Xt{constructor(e){L(this,"isCardActivation",!1);L(this,"spellSpeed",1);L(this,"effectId","chicken-game-ignition");this.cardInstanceId=e}canActivate(e){if(e.result.isGameOver||e.phase!=="Main1"||e.lp.player<1e3)return!1;const t=`${this.cardInstanceId}:${this.effectId}`;return!(e.activatedIgnitionEffectsThisTurn.has(t)||!e.zones.field.some(n=>n.instanceId===this.cardInstanceId&&n.id===67616300&&n.position==="faceUp"))}createActivationSteps(e){const t=`${this.cardInstanceId}:${this.effectId}`;return[{id:"chicken-game-pay-lp",summary:"コスト支払い",description:"1000LPを支払います",action:r=>r.lp.player<1e3?{success:!1,newState:r,error:"Cannot pay 1000 LP. Not enough Life Points."}:{success:!0,newState:{...r,lp:{...r.lp,player:r.lp.player-1e3}},message:"Paid 1000 LP"}},{id:"chicken-game-record-activation",summary:"効果発動を記録",description:"1ターンに1度の制限を記録します",action:r=>{const n=new Set(r.activatedIgnitionEffectsThisTurn);return n.add(t),{success:!0,newState:{...r,activatedIgnitionEffectsThisTurn:n},message:"Recorded ignition effect activation"}}}]}createResolutionSteps(e,t){return[me(1,{id:"chicken-game-draw",description:"デッキから1枚ドローします"})]}}class $e{constructor(e){L(this,"cardId");L(this,"isCardActivation",!0);this.cardId=e}canActivate(e){return e.result.isGameOver?!1:this.additionalActivationConditions(e)}createActivationSteps(e){const t=Ne(this.cardId);return[{id:`${this.cardId}-activation`,summary:"カード発動",description:`${De(this.cardId)}を発動します`,notificationLevel:"info",action:r=>({success:!0,newState:r,message:`${t.jaName} activated`})}]}}class ie extends $e{constructor(){super(...arguments);L(this,"spellSpeed",1)}canActivate(t){return!super.canActivate(t)||t.phase!=="Main1"?!1:this.additionalActivationConditions(t)}}class ea extends ie{constructor(){super(55144522)}additionalActivationConditions(e){return e.zones.deck.length>=2}createResolutionSteps(e,t){return[me(2),re(t,this.cardId)]}}class at{constructor(e){L(this,"description");this.instanceIds=e,this.description=`Discard ${e.length} card${e.length>1?"s":""}`}canExecute(e){if(e.result.isGameOver)return!1;for(const t of this.instanceIds)if(!e.zones.hand.find(n=>n.instanceId===t))return!1;return!0}execute(e){if(!this.canExecute(e))return le(e,`Cannot discard ${this.instanceIds.length} cards. Some cards are not in hand.`);const t=Gt(e.zones,this.instanceIds),r={...e,zones:t};return Pe(r,`Discarded ${this.instanceIds.length} card${this.instanceIds.length>1?"s":""}`)}getInstanceIds(){return[...this.instanceIds]}}class ta extends ie{constructor(){super(79571449)}additionalActivationConditions(e){return e.zones.deck.length>=3}createResolutionSteps(e,t){return[me(3),Fe({id:"graceful-charity-discard",summary:"手札を捨てる",description:"手札から2枚選んで捨ててください",availableCards:[],minCards:2,maxCards:2,cancelable:!1,onSelect:(r,n)=>n.length!==2?{success:!1,newState:r,error:"Must select exactly 2 cards to discard"}:new at(n).execute(r)}),re(t,this.cardId)]}}class aa extends $e{constructor(){super(...arguments);L(this,"spellSpeed",1)}canActivate(t){return!super.canActivate(t)||t.phase!=="Main1"?!1:this.additionalActivationConditions(t)}createActivationSteps(t){return[]}}class ra extends aa{constructor(){super(67616300)}additionalActivationConditions(e){return e.zones.field.filter(r=>r.type==="spell"&&r.spellType==="field").length<2}createResolutionSteps(e,t){return[]}}class na extends ie{constructor(){super(70368879)}additionalActivationConditions(e){return e.zones.deck.length>=1}createResolutionSteps(e,t){return[me(1),Ut(1e3,{target:"opponent"}),re(t,this.cardId)]}}class sa extends ie{constructor(){super(33782437)}additionalActivationConditions(e){return e.zones.deck.length>=1}createResolutionSteps(e,t){return[me(1),{id:"one-day-of-peace-draw-opponent",summary:"相手がドロー",description:"相手がデッキから1枚ドローします（内部状態のみ）",notificationLevel:"info",action:r=>({success:!0,newState:r,message:"Opponent drew 1 card (internal)"})},{id:"one-day-of-peace-damage-negation",summary:"ダメージ無効化",description:"このターン、全てのダメージは0になります",notificationLevel:"info",action:r=>({success:!0,newState:{...r,damageNegation:!0},message:"Damage negation activated for this turn"})},re(t,this.cardId)]}}class ca extends ie{constructor(){super(85852291)}additionalActivationConditions(e){return!0}createResolutionSteps(e,t){let r=[];return[Fe({id:"magical-mallet-select",summary:"手札を選択",description:"デッキに戻すカードを選択してください（0枚から全てまで選択可能）",availableCards:[],minCards:0,maxCards:100,cancelable:!1,onSelect:(n,s)=>(r=s,{success:!0,newState:n,message:`Selected ${s.length} cards to return`})}),{id:"magical-mallet-return-shuffle",summary:"デッキに戻してシャッフル",description:"選択したカードをデッキに戻し、デッキをシャッフルします",notificationLevel:"info",action:n=>{if(r.length===0)return{success:!0,newState:n,message:"No cards to return"};const s=qt(r).action(n);return s.success?Vt().action(s.newState):s}},{id:"magical-mallet-draw",summary:"カードをドロー",description:"戻した枚数と同じ枚数をドローします",notificationLevel:"info",action:n=>r.length===0?{success:!0,newState:n,message:"No cards to draw"}:me(r.length).action(n)},re(t,this.cardId)]}}class ia extends $e{constructor(){super(...arguments);L(this,"spellSpeed",2)}canActivate(t){return super.canActivate(t)}}class oa extends ia{constructor(){super(74519184)}additionalActivationConditions(e){return e.zones.hand.length>=3}createResolutionSteps(e,t){return[Fe({id:"card-destruction-discard-player",summary:"手札を捨てる",description:"手札から2枚選んで捨ててください（キャンセル不可）",availableCards:e.zones.hand,minCards:2,maxCards:2,cancelable:!1,onSelect:(r,n)=>n.length!==2?{success:!1,newState:r,error:"Must select exactly 2 cards to discard"}:new at(n).execute(r)}),{id:"card-destruction-discard-opponent",summary:"相手が手札を捨てる",description:"相手が手札から2枚捨てます（内部状態のみ）",notificationLevel:"info",action:r=>({success:!0,newState:r,message:"Opponent discarded 2 cards (internal)"})},me(2,{id:"card-destruction-draw",description:"両プレイヤーがデッキから2枚ドローします"}),re(t,this.cardId)]}}class da{constructor(){L(this,"isCardActivation",!0);L(this,"spellSpeed",1)}canActivate(e){return!(e.result.isGameOver||e.phase!=="Main1"||e.zones.graveyard.filter(r=>r.type==="monster"&&r.frameType==="normal").length<2)}createActivationSteps(e){return[{id:"dark-factory-activation",summary:"カード発動",description:"闇の量産工場を発動します",notificationLevel:"info",action:t=>({success:!0,newState:t,message:"Dark Factory activated"})}]}createResolutionSteps(e,t){return[{id:"dark-factory-select",summary:"モンスターを選択",description:"墓地から通常モンスター2体を選択してください",notificationLevel:"interactive",cardSelectionConfig:{availableCards:e.zones.graveyard.filter(n=>n.type==="monster"&&n.frameType==="normal"),minCards:2,maxCards:2,summary:"モンスターを選択",description:"墓地から通常モンスター2体を選択してください",cancelable:!1},action:(n,s)=>{if(!s||s.length!==2)return{success:!1,newState:n,error:"Must select exactly 2 Normal Monsters from graveyard"};let c=n.zones;for(const u of s)c=ce(c,u,"graveyard","hand");return{success:!0,newState:{...n,zones:c},message:"Added 2 Normal Monsters from graveyard to hand"}}},{id:"dark-factory-graveyard",summary:"墓地へ送る",description:"闇の量産工場を墓地に送ります",notificationLevel:"info",action:n=>{const s=we(n.zones,t);return{success:!0,newState:{...n,zones:s},message:"Sent Dark Factory to graveyard"}}}]}}class la{constructor(){L(this,"isCardActivation",!0);L(this,"spellSpeed",1)}canActivate(e){return!(e.result.isGameOver||e.phase!=="Main1"||e.zones.deck.filter(r=>r.type==="spell"&&r.spellType==="field").length<1)}createActivationSteps(e){return[{id:"terraforming-activation",summary:"カード発動",description:`${De(73628505)}を発動します`,notificationLevel:"info",action:t=>({success:!0,newState:t,message:"Terraforming activated"})}]}createResolutionSteps(e,t){return[{id:"terraforming-select",summary:"フィールド魔法を選択",description:"デッキからフィールド魔法1枚を選択してください",notificationLevel:"interactive",cardSelectionConfig:{availableCards:e.zones.deck.filter(n=>n.type==="spell"&&n.spellType==="field"),minCards:1,maxCards:1,summary:"フィールド魔法を選択",description:"デッキからフィールド魔法1枚を選択してください",cancelable:!1},action:(n,s)=>{if(!s||s.length!==1)return{success:!1,newState:n,error:"Must select exactly 1 Field Spell from deck"};const c=ce(n.zones,s[0],"deck","hand");return{success:!0,newState:{...n,zones:c},message:"Added 1 Field Spell from deck to hand"}}},{id:"terraforming-add-to-hand",summary:"手札に加える",description:"選択したフィールド魔法を手札に加えます",notificationLevel:"info",action:n=>({success:!0,newState:n,message:"Added Field Spell to hand"})},{id:"terraforming-graveyard",summary:"墓地へ送る",description:`${De(73628505)}を墓地に送ります`,notificationLevel:"info",action:n=>{const s=we(n.zones,t);return{success:!0,newState:{...n,zones:s},message:"Sent Terraforming to graveyard"}}}]}}class ua extends ie{constructor(){super(98494543)}additionalActivationConditions(e){return e.zones.graveyard.filter(r=>r.type==="spell").length>=1}createResolutionSteps(e,t){return[Fe({id:"magical-stone-excavation-discard",summary:"手札を捨てる",description:"手札から2枚選んで捨ててください",availableCards:[],minCards:2,maxCards:2,cancelable:!1,onSelect:(r,n)=>n.length!==2?{success:!1,newState:r,error:"Must select exactly 2 cards to discard"}:new at(n).execute(r)}),Wt({id:`magical-stone-excavation-search-${t}`,summary:"墓地から魔法カードを回収",description:"墓地から魔法カードを1枚選んで手札に加えてください",filter:r=>r.type==="spell",minCards:1,maxCards:1,cancelable:!1}),re(t,this.cardId)]}}class fa extends ie{constructor(){super(93946239)}additionalActivationConditions(e){return e.zones.hand.length<2?!1:e.zones.deck.length>=1}createResolutionSteps(e,t){const r={id:`into-the-void-end-phase-discard-${t}`,summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます",notificationLevel:"info",action:n=>{let s=n.zones;const c=[...n.zones.hand];for(const u of c)s=we(s,u.instanceId);return{success:!0,newState:{...n,zones:s},message:`Discarded all ${c.length} cards from hand (Into the Void effect)`}}};return[me(1,{description:"デッキから1枚ドローします"}),gt(r,{summary:"エンドフェイズ効果を登録",description:"エンドフェイズに手札を全て捨てる効果を登録します"}),re(t,this.cardId)]}}class va extends ie{constructor(){super(98645731)}additionalActivationConditions(e){return!(e.zones.deck.length<3||e.activatedOncePerTurnCards.has(this.cardId))}createActivationSteps(e){const t=Ne(this.cardId);return[{id:`${this.cardId}-activation`,summary:"カード発動",description:`${De(this.cardId)}を発動します`,notificationLevel:"info",action:r=>{const n=new Set(r.activatedOncePerTurnCards);return n.add(this.cardId),{success:!0,newState:{...r,activatedOncePerTurnCards:n},message:`${t.jaName} activated`}}}]}createResolutionSteps(e,t){return[Jt({id:`pot-of-duality-search-${t}`,summary:"デッキの上から3枚を確認",description:"デッキの上から3枚を確認し、1枚を選んで手札に加えてください。残りはデッキに戻ります",count:3,minCards:1,maxCards:1,cancelable:!1}),re(t,this.cardId)]}}class ma extends ie{constructor(){super(59750328)}additionalActivationConditions(e){return!e.activatedOncePerTurnCards.has(this.cardId)}createActivationSteps(e){const t=Ne(this.cardId);return[{id:`${this.cardId}-activation`,summary:"カード発動",description:`${De(this.cardId)}を発動します`,notificationLevel:"info",action:r=>{const n=new Set(r.activatedOncePerTurnCards);return n.add(this.cardId),{success:!0,newState:{...r,activatedOncePerTurnCards:n},message:`${t.jaName} activated`}}}]}createResolutionSteps(e,t){const r={id:`card-of-demise-end-phase-discard-${t}`,summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます",notificationLevel:"info",action:n=>{let s=n.zones;const c=[...n.zones.hand];for(const u of c)s=we(s,u.instanceId);return{success:!0,newState:{...n,zones:s},message:`Discarded all ${c.length} cards from hand (Card of Demise effect)`}}};return[Kt(3,{description:"手札が3枚になるようにデッキからドローします"}),gt(r,{summary:"エンドフェイズ効果を登録",description:"エンドフェイズに手札を全て捨てる効果を登録します"}),re(t,this.cardId)]}}class ha extends ie{constructor(){super(89997728)}additionalActivationConditions(e){return e.zones.deck.filter(r=>r.jaName.includes("トゥーン")||r.name&&r.name.includes("Toon")).length>=1}createResolutionSteps(e,t){return[Yt({id:`toon-table-search-${t}`,summary:"デッキからトゥーンカードを検索",description:"デッキから「トゥーン」カード1枚を選んで手札に加えてください",filter:r=>r.jaName.includes("トゥーン")||r.name&&r.name.includes("Toon"),minCards:1,maxCards:1,cancelable:!1}),re(t,this.cardId)]}}class ga extends $e{constructor(){super(...arguments);L(this,"spellSpeed",1)}canActivate(t){return!super.canActivate(t)||t.phase!=="Main1"?!1:this.additionalActivationConditions(t)}createActivationSteps(t){return[]}}class pa extends ga{constructor(){super(15259703)}additionalActivationConditions(e){return e.lp.player>=1e3}createResolutionSteps(e,t){return[Qt(1e3,{id:`toon-world-lp-payment-${t}`,description:"1000LPを払ってトゥーン・ワールドを発動します"})]}}class pt{static register(e,t){const r=this.rules.get(e)||[];this.rules.set(e,[...r,t])}static get(e){return this.rules.get(e)||[]}static getByCategory(e,t){return this.get(e).filter(n=>n.category===t)}static collectActiveRules(e,t,r={}){const n=[];for(const s of e.zones.field){if(s.position!=="faceUp")continue;const c=this.getByCategory(s.id,t);for(const l of c)l.canApply(e,r)&&n.push(l)}return n}static clear(){this.rules.clear()}static getRegisteredCardIds(){return Array.from(this.rules.keys())}}L(pt,"rules",new Map);class ya{constructor(){L(this,"isEffect",!0);L(this,"category","ActionPermission")}canApply(e,t){if(!e.zones.field.some(s=>s.id===67616300&&s.position==="faceUp"))return!1;const n=t.damageTarget||"player";return n==="player"?e.lp.player<e.lp.opponent:n==="opponent"?e.lp.opponent<e.lp.player:!1}checkPermission(e,t){return!1}}function Ca(){G.register(55144522,new ea),G.register(79571449,new ta),G.register(67616300,new ra),G.register(70368879,new na),G.register(33782437,new sa),G.register(85852291,new ca),G.register(74519184,new oa),G.register(90928333,new da),G.register(73628505,new la),G.register(98494543,new ua),G.register(93946239,new fa),G.register(98645731,new va),G.register(59750328,new ma),G.register(89997728,new ha),G.register(15259703,new pa)}function Sa(){pt.register(67616300,new ya)}Ca();Sa();class wa{initializeGame(e){Tt(e)}shuffleDeck(){const e=K(),r=new Ht().execute(e);return r.success&&D.set(r.newState),{success:r.success,message:r.message,error:r.error}}drawCard(e=1){const t=K(),n=new Nt(e).execute(t);return n.success&&D.set(n.newState),{success:n.success,message:n.message,error:n.error}}advancePhase(){const e=K(),r=new Zt().execute(e);return r.success&&D.set(r.newState),{success:r.success,message:r.message,error:r.error}}getCurrentPhase(){return K().phase}getGameState(){return K()}activateSpell(e){const t=K(),n=new ht(e).execute(t);return n.success&&(D.set(n.newState),n.effectSteps&&n.effectSteps.length>0&&Ie.startResolution(n.effectSteps)),{success:n.success,message:n.message,error:n.error}}canActivateCard(e){const t=K();return Ke(t,e).canActivate}activateIgnitionEffect(e){const t=K(),r=qe(t,e);if(!r)return{success:!1,error:"Card not found"};if(r.id!==67616300)return{success:!1,error:"This card has no ignition effect"};const n=new Xt(e);if(!n.canActivate(t))return{success:!1,error:"Cannot activate ignition effect (check phase, LP, or once-per-turn limit)"};const s=n.createActivationSteps(t);let c=t;for(const u of s){const C=u.action(c);if(!C.success)return{success:!1,error:C.error};c=C.newState}D.set(c);const l=n.createResolutionSteps(c,e);return l.length>0&&Ie.startResolution(l),{success:!0,message:"Ignition effect activated"}}checkVictory(){const e=K();return Oe(e)}getCurrentTurn(){return K().turn}getPlayerLP(){return K().lp.player}getOpponentLP(){return K().lp.opponent}}const de=new wa,ba=async({params:a,fetch:e})=>{const{deckId:t}=a,r=await Ot(t),n=[];r.mainDeck.monsters.forEach(l=>{for(let u=0;u<l.quantity;u++)n.push(l.cardData.id)}),r.mainDeck.spells.forEach(l=>{for(let u=0;u<l.quantity;u++)n.push(l.cardData.id)}),r.mainDeck.traps.forEach(l=>{for(let u=0;u<l.quantity;u++)n.push(l.cardData.id)}),console.log(`[PageLoad] Initializing game with ${n.length} cards`),de.initializeGame(n);const s=de.shuffleDeck();s.success||console.error("[PageLoad] Failed to shuffle deck:",s.error);const c=de.drawCard(5);return c.success||console.error("[PageLoad] Failed to draw initial hand:",c.error),console.log("[PageLoad] Initial state:",de.getGameState()),{deckId:t,deckName:r.name}},Nr=Object.freeze(Object.defineProperty({__proto__:null,load:ba},Symbol.toStringTag,{value:"Module"})),xa=N(D,a=>a.phase),_a=N(D,a=>a.turn),ka=N(D,a=>a.lp.player),Aa=N(D,a=>a.lp.opponent),za=N(D,a=>a.zones.hand.length),Ia=N(D,a=>a.zones.deck.length);N(D,a=>a.zones.graveyard.length);N(D,a=>a.zones.field.length);const Da=N(D,a=>a.result.isGameOver),Ea=N(D,a=>a.result),Oa=N(D,a=>Bt(a));N(D,a=>a.zones.deck.length===0);N(D,a=>a.zones.hand.length===0);N(D,a=>a.chainStack.length);const Ze=new lt,Pa=N(D,(a,e)=>{const t=a.zones.hand.map(r=>r.id);if(t.length===0){e([]);return}Ze.getCardsByIds(t).then(r=>{e(r)}).catch(r=>{console.error("[cardDisplayStore] Failed to fetch hand cards:",r),e([])})},[]),Ta=N(D,(a,e)=>{const t=a.zones.field.map(n=>n.id);if(t.length===0){e([]);return}let r=!1;return Ze.getCardsByIds(t).then(n=>{r||e(n)}).catch(n=>{r||(console.error("[cardDisplayStore] Failed to fetch field cards:",n),e([]))}),()=>{r=!0}},[]),La=N(D,(a,e)=>{const t=a.zones.graveyard.map(r=>r.id);if(t.length===0){e([]);return}Ze.getCardsByIds(t).then(r=>{e(r)}).catch(r=>{console.error("[cardDisplayStore] Failed to fetch graveyard cards:",r),e([])})},[]);N(D,(a,e)=>{const t=a.zones.banished.map(r=>r.id);if(t.length===0){e([]);return}Ze.getCardsByIds(t).then(r=>{e(r)}).catch(r=>{console.error("[cardDisplayStore] Failed to fetch banished cards:",r),e([])})},[]);function Ma(a,e){e.onOpenChange(!1)}var Ra=A('<div class="text-center py-8"><p class="text-gray-500"> </p></div>'),Ga=A('<header class="flex justify-between items-center mb-4"><h2 class="text-2xl sm:text-3xl font-bold"> </h2> <button type="button" class="btn preset-tonal rounded-full"><!></button></header> <!>',1);function yt(a,e){te(e,!0);function t(c){e.onOpenChange(c.open)}let r=fe(e,"emptyMessage",3,"カードがありません"),n=fe(e,"borderColor",3,"border-gray-400");const s=I(()=>()=>{const c=new Map;return e.cards.forEach(l=>{const u=c.get(l.id);u?u.quantity+=1:c.set(l.id,{cardData:l,quantity:1})}),Array.from(c.values())});je(a,{get open(){return e.open},onOpenChange:t,contentBase:"card bg-surface-100-900 p-6 mx-auto space-y-4 shadow-xl max-w-4xl max-h-[90vh] overflow-auto",backdropClasses:"backdrop-blur-sm",content:l=>{var u=Ga(),C=W(u),k=o(C),p=o(k,!0);i(k);var w=h(k,2);w.__click=[Ma,e];var f=o(w);Lt(f,{icon:"mdi:close",class:"size-4"}),i(w),i(C);var v=h(C,2);{var y=b=>{const x=I(()=>d(s)());Pt(b,{get cards(){return d(x)},get borderColor(){return n()}})},m=b=>{var x=Ra(),E=o(x),z=o(E,!0);i(E),i(x),Z(()=>j(z,r())),S(b,x)};B(v,b=>{e.cards.length>0?b(y):b(m,!1)})}Z(()=>j(p,e.title)),S(l,u)},$$slots:{content:!0}}),ae()}he(["click"]);var Na=(a,e)=>a.key==="Enter"&&e(),ja=A('<div class="absolute inset-1"><!></div> <!>',1),Fa=A('<div class="h-full flex items-center justify-center p-1 relative" style="filter: grayscale(0.8) brightness(0.7) contrast(1.2);"><img alt="墓地" class="w-full h-full object-cover opacity-30 rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-surface-600-300-token text-center select-none drop-shadow-lg">墓地</span></div></div> <!>',1),$a=A('<div role="button" tabindex="0"><!></div> <!>',1);function Za(a,e){te(e,!0);let t=fe(e,"size",3,"medium"),r=ue(!1);const n=I(()=>e.cards.length>0?e.cards[e.cards.length-1]:null);function s(){F(r,!0)}function c(m){F(r,m,!0)}let l=ue(!1);function u(){F(l,!0)}function C(){F(l,!1)}var k=$a(),p=W(k);p.__click=s,p.__keydown=[Na,s];var w=o(p);{var f=m=>{var b=ja(),x=W(b),E=o(x);se(E,{get card(){return d(n)},get size(){return t()},clickable:!1}),i(x);var z=h(x,2);Re(z,{get count(){return e.cards.length}}),S(m,b)},v=m=>{var b=Fa(),x=W(b),E=o(x);Xe(2),i(x);var z=h(x,2);Re(z,{get count(){return e.cards.length}}),Z(()=>et(E,"src",Qe)),S(m,b)};B(w,m=>{d(n)?m(f):m(v,!1)})}i(p);var y=h(p,2);yt(y,{get cards(){return e.cards},get open(){return d(r)},onOpenChange:c,title:"墓地",borderColor:"border-gray-400"}),Z(()=>ve(p,1,`
    ${Ye[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    hover:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700
    ${d(l)?"scale-105 shadow-lg":""}
  `)),Ge("mouseenter",p,u),Ge("mouseleave",p,C),S(a,k),ae()}he(["click","keydown"]);var Ba=(a,e)=>a.key==="Enter"&&e(),Ha=A('<div role="button" tabindex="0"><div class="h-full flex items-center justify-center p-1 relative"><img alt="エクストラデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">EX</span></div></div> <!></div> <!>',1);function Ua(a,e){te(e,!0);let t=fe(e,"size",3,"medium"),r=ue(!1);function n(){F(r,!0)}function s(y){F(r,y,!0)}let c=ue(!1);function l(){F(c,!0)}function u(){F(c,!1)}var C=Ha(),k=W(C);k.__click=n,k.__keydown=[Ba,n];var p=o(k),w=o(p);Xe(2),i(p);var f=h(p,2);Re(f,{get count(){return e.cards.length}}),i(k);var v=h(k,2);yt(v,{get cards(){return e.cards},get open(){return d(r)},onOpenChange:s,title:"エクストラデッキ",borderColor:"border-purple-400"}),Z(()=>{ve(k,1,`
    ${Ye[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    ${d(c)?"scale-105 shadow-lg":""}
  `),et(w,"src",Qe)}),Ge("mouseenter",k,l),Ge("mouseleave",k,u),S(a,C),ae()}he(["click","keydown"]);var Va=A('<div role="img"><div class="h-full flex items-center justify-center p-1 relative"><img alt="メインデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">Deck</span></div></div> <!></div>');function qa(a,e){te(e,!0);let t=fe(e,"size",3,"medium");var r=Va(),n=o(r),s=o(n);Xe(2),i(n);var c=h(n,2);Re(c,{get count(){return e.cardCount}}),i(r),Z(()=>{ve(r,1,`
    ${Ye[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
  `),et(s,"src",Qe)}),S(a,r),ae()}var Wa=A('<div class="relative"><div style="filter: sepia(0.3) hue-rotate(90deg) saturate(1.5) brightness(0.9);"><!></div></div>'),Ja=A('<div class="relative"><div style="filter: sepia(0.5) hue-rotate(30deg) saturate(1.8) brightness(0.85);"><!></div></div>'),Ka=A('<div class="flex justify-center"><!></div>'),Ya=A('<div class="relative"><div style="filter: sepia(0.4) hue-rotate(200deg) saturate(2) brightness(0.8);"><!></div></div>'),Qa=A('<div class="flex justify-center"><!></div>'),Xa=A('<div class="card p-2 max-w-6xl mx-auto"><div class="transition-all duration-300"><div class="grid grid-cols-7 gap-2 md:gap-2 sm:gap-1 mb-4"><div class="flex justify-center"><!></div> <!> <div class="flex justify-center"><!></div></div> <div class="grid grid-cols-7 gap-2 md:gap-2 sm:gap-1 mb-4"><div class="flex justify-center"><!></div> <!> <div class="flex justify-center"><!></div></div></div></div>');function er(a,e){te(e,!0);const r=[...Array(5).keys()];function n(g){e.onFieldCardClick&&e.onFieldCardClick(g)}var s=Xa(),c=o(s),l=o(c),u=o(l),C=o(u);{var k=g=>{se(g,{get card(){return e.fieldCards[0]},size:"medium",clickable:!0,onClick:n})},p=g=>{var P=Wa(),R=o(P),Q=o(R);se(Q,{placeholder:!0,placeholderText:"フィールド",size:"medium"}),i(R),i(P),S(g,P)};B(C,g=>{e.fieldCards.length>0?g(k):g(p,!1)})}i(u);var w=h(u,2);Ee(w,16,()=>r,g=>g,(g,P)=>{var R=Ka(),Q=o(R);{var $=T=>{se(T,{get card(){return e.monsterCards[P]},size:"medium",clickable:!0,selectable:!0,onClick:n})},J=T=>{var U=Ja(),ne=o(U),X=o(ne);const oe=I(()=>P+1);se(X,{placeholder:!0,get placeholderText(){return`M${d(oe)??""}`},size:"medium"}),i(ne),i(U),S(T,U)};B(Q,T=>{e.monsterCards[P]?T($):T(J,!1)})}i(R),S(g,R)});var f=h(w,2),v=o(f);Za(v,{get cards(){return e.graveyardCards},size:"medium"}),i(f),i(l);var y=h(l,2),m=o(y),b=o(m);Ua(b,{get cards(){return e.extraDeckCards},size:"medium"}),i(m);var x=h(m,2);Ee(x,16,()=>r,g=>g,(g,P)=>{var R=Qa(),Q=o(R);{var $=T=>{se(T,{get card(){return e.spellTrapCards[P]},size:"medium",clickable:!0,onClick:n})},J=T=>{var U=Ya(),ne=o(U),X=o(ne);const oe=I(()=>P+1);se(X,{placeholder:!0,get placeholderText(){return`S${d(oe)??""}`},size:"medium"}),i(ne),i(U),S(T,U)};B(Q,T=>{e.spellTrapCards[P]?T($):T(J,!1)})}i(R),S(g,R)});var E=h(x,2),z=o(E);qa(z,{get cardCount(){return e.deckCards},size:"medium"}),i(E),i(y),i(c),i(s),S(a,s),ae()}var tr=(a,e,t)=>e(d(t)),ar=A("<button> </button>"),rr=A('<div class="absolute -bottom-14 left-0 right-0 flex justify-center gap-2 z-10"><!> <button class="btn btn-sm preset-filled-warning-500">キャンセル</button></div>'),nr=A('<div class="relative"><!> <!></div>');function sr(a,e){te(e,!0);let t=fe(e,"size",3,"medium"),r=fe(e,"showDetailOnClick",3,!0);function n(){e.onSelect(e.card,e.instanceId)}function s(p){p.onClick(e.card,e.instanceId)}function c(p,w){return`preset-${p||"filled"}-${w||"primary"}-500`}var l=nr(),u=o(l);se(u,{get card(){return e.card},get size(){return t()},clickable:!0,get isSelected(){return e.isSelected},onClick:n,get showDetailOnClick(){return r()}});var C=h(u,2);{var k=p=>{var w=rr(),f=o(w);Ee(f,17,()=>e.actions,y=>y.label,(y,m)=>{var b=ar();b.__click=[tr,s,m];var x=o(b,!0);i(b),Z(E=>{ve(b,1,`btn btn-sm ${E??""} ${e.isActivatable?"":"opacity-50 cursor-not-allowed"}`),j(x,d(m).label)},[()=>c(d(m).style,d(m).color)]),S(y,b)});var v=h(f,2);v.__click=function(...y){var m;(m=e.onCancel)==null||m.apply(this,y)},i(w),S(p,w)};B(C,p=>{e.isSelected&&p(k)})}i(l),S(a,l),ae()}he(["click"]);var cr=A('<div class="text-center text-sm opacity-50">No cards in hand</div>'),ir=A("<div></div>");function or(a,e){te(e,!0);const[t,r]=ut(),n=()=>H(D,"$gameStateStore",t);function s(f){return e.isGameOver||e.currentPhase!=="Main1"||!e.canActivateSpells?!1:new ht(f).canExecute(n())}let c=ue(null);function l(f){const v={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10"};return f<=0?"grid-cols-1":f>=10?"grid-cols-10":v[f]}function u(f,v){F(c,d(c)===v?null:v,!0)}function C(f,v){e.onCardClick(f,v),F(c,null)}function k(){F(c,null)}const p=[{label:"発動",style:"filled",color:"primary",onClick:C}];var w=ir();Ee(w,21,()=>e.cards,({card:f,instanceId:v})=>v,(f,v)=>{let y=()=>d(v).card,m=()=>d(v).instanceId;var b=We(),x=W(b);{var E=g=>{const P=I(()=>d(c)===m()),R=I(()=>s(m()));sr(g,{get card(){return y()},get instanceId(){return m()},get isSelected(){return d(P)},get isActivatable(){return d(R)},onSelect:u,get actions(){return p},onCancel:k,size:"medium"})},z=g=>{se(g,{placeholder:!0,placeholderText:"...",size:"medium"})};B(x,g=>{y()?g(E):g(z,!1)})}S(f,b)},f=>{var v=cr();S(f,v)}),i(w),Z(f=>ve(w,1,`grid ${f??""} gap-2 mb-16`),[()=>l(e.handCardCount)]),S(a,w),ae(),r()}function dr(a,e){e.onConfirm()}var lr=A('<button class="btn variant-ghost">キャンセル</button>'),ur=A('<header class="text-center"><h2 class="h3 font-bold text-primary-600-300-token"> </h2></header> <article class="text-center"><p class="text-lg"> </p></article> <footer class="flex justify-end gap-2"><!> <button class="btn variant-filled-primary">OK</button></footer>',1);function fr(a,e){te(e,!0);let t=fe(e,"showCancel",3,!1);function r(){e.onCancel&&e.onCancel()}function n(s){!s.open&&t()&&e.onCancel&&r()}je(a,{get open(){return e.isOpen},onOpenChange:n,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-md shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return t()},preventScroll:!0,content:c=>{var l=ur(),u=W(l),C=o(u),k=o(C,!0);i(C),i(u);var p=h(u,2),w=o(p),f=o(w,!0);i(w),i(p);var v=h(p,2),y=o(v);{var m=x=>{var E=lr();E.__click=r,S(x,E)};B(y,x=>{t()&&x(m)})}var b=h(y,2);b.__click=[dr,e],i(v),Z(()=>{j(k,e.summary),j(f,e.description)}),S(c,l)},$$slots:{content:!0}}),ae()}he(["click"]);function vr(a,e){d(e)&&Y.confirmSelection()}function dt(){Y.cancelSelection()}var mr=A('<button class="btn btn-sm btn-circle btn-ghost">✕</button>'),hr=A("<div><!></div>"),gr=A('<button class="btn btn-ghost">キャンセル</button>'),pr=A('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg"> </h3> <!></div> <p class="text-sm text-surface-600-300-token mb-4"> </p> <div class="flex justify-between items-center mb-4 p-3 bg-surface-200 dark:bg-surface-800 rounded-lg border border-surface-300 dark:border-surface-600"><span class="text-sm font-semibold"> </span></div> <div class="min-h-[200px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><!> <button class="btn btn-primary">確定</button></div>',1);function yr(a,e){te(e,!0);const t=new lt,r=I(()=>Y.isActive),n=I(()=>Y.config),s=I(()=>Y.selectedCount),c=I(()=>Y.isValidSelection),l=I(()=>{var f;return((f=d(n))==null?void 0:f.cancelable)??!0});let u=ue(Mt([]));Je(()=>{var f;if((f=d(n))!=null&&f.availableCards&&d(n).availableCards.length>0){const v=d(n).availableCards.map(y=>y.id);t.getCardsByIds(v).then(y=>{F(u,y,!0)}).catch(y=>{console.error("[CardSelectionModal] Failed to fetch card display data:",y),F(u,[],!0)})}else F(u,[],!0)});function C(f){!f.open&&d(r)&&d(l)&&Y.cancelSelection()}function k(f){const v=Y.canToggleCard(f),y=Y.isSelected(f);(v||y)&&Y.toggleCard(f)}function p(f){return Y.isSelected(f)}function w(f){var y;const v=(y=d(n))==null?void 0:y.availableCards.find(m=>m.instanceId===f);if(v)return d(u).find(m=>m.id===v.id)}je(a,{get open(){return d(r)},onOpenChange:C,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return d(l)},preventScroll:!0,content:v=>{var y=We(),m=W(y);{var b=x=>{var E=pr(),z=W(E),g=o(z),P=o(g,!0);i(g);var R=h(g,2);{var Q=V=>{var q=mr();q.__click=[dt],S(V,q)};B(R,V=>{d(l)&&V(Q)})}i(z);var $=h(z,2),J=o($,!0);i($);var T=h($,2),U=o(T),ne=o(U);i(U),i(T);var X=h(T,2),oe=o(X);Ee(oe,21,()=>d(n).availableCards,V=>V.instanceId,(V,q)=>{var ye=We();const be=I(()=>p(d(q).instanceId)),Be=I(()=>Y.canToggleCard(d(q).instanceId)),xe=I(()=>w(d(q).instanceId));var _e=W(ye);{var He=Ce=>{var Se=hr();let ke;var Ae=o(Se);se(Ae,{get card(){return d(xe)},size:"small",clickable:!0,selectable:!1,get isSelected(){return d(be)},animate:!0,onClick:()=>k(d(q).instanceId)}),i(Se),Z(ze=>ke=ve(Se,1,"",null,ke,ze),[()=>({"opacity-50":!d(Be)&&!d(be)})]),S(Ce,Se)};B(_e,Ce=>{d(xe)&&Ce(He)})}S(V,ye)}),i(oe),i(X);var ge=h(X,2),pe=o(ge);{var Te=V=>{var q=gr();q.__click=[dt],S(V,q)};B(pe,V=>{d(l)&&V(Te)})}var Le=h(pe,2);Le.__click=[vr,c],i(ge),Z(()=>{j(P,d(n).summary),j(J,d(n).description),j(ne,`選択中: ${d(s)??""} / ${d(n).maxCards??""}枚`),Le.disabled=!d(c)}),S(x,E)};B(m,x=>{d(n)&&x(b)})}S(v,y)},$$slots:{content:!0}}),ae()}he(["click"]);var Cr=A('<span class="text-warning-600 dark:text-warning-400">Draw</span>'),Sr=A("Winner: <span> </span>",1),wr=A('<p class="text-2xl font-bold"><!></p>'),br=A('<p class="text-base opacity-75"><span class="font-semibold">Reason:</span> </p>'),xr=A('<p class="text-base"> </p>'),_r=A('<header class="text-center"><h2>Game Over!</h2></header> <article class="space-y-4 text-center"><!> <!> <!></article> <footer class="flex justify-center"><button class="btn variant-filled-primary">閉じる</button></footer>',1);function kr(a,e){te(e,!0);function t(){e.onClose()}function r(c){c.open||t()}function n(){return e.winner==="player"?"border-success-500":e.winner==="opponent"?"border-error-500":e.winner==="draw"?"border-warning-500":"border-surface-500"}const s=I(n);je(a,{get open(){return e.isOpen},onOpenChange:r,get contentBase(){return`card bg-surface-50 dark:bg-surface-900 p-8 space-y-6 max-w-lg shadow-2xl border-4 ${d(s)??""}`},backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!0,preventScroll:!0,content:l=>{var u=_r(),C=W(u),k=o(C);i(C);var p=h(C,2),w=o(p);{var f=z=>{var g=wr(),P=o(g);{var R=$=>{var J=Cr();S($,J)},Q=$=>{var J=Sr(),T=h(W(J)),U=o(T,!0);i(T),Z(()=>{ve(T,1,Rt(e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400")),j(U,e.winner==="player"?"You":"Opponent")}),S($,J)};B(P,$=>{e.winner==="draw"?$(R):$(Q,!1)})}i(g),S(z,g)};B(w,z=>{e.winner&&z(f)})}var v=h(w,2);{var y=z=>{var g=br(),P=h(o(g));i(g),Z(()=>j(P,` ${e.reason??""}`)),S(z,g)};B(v,z=>{e.reason&&z(y)})}var m=h(v,2);{var b=z=>{var g=xr(),P=o(g,!0);i(g),Z(()=>j(P,e.message)),S(z,g)};B(m,z=>{e.message&&z(b)})}i(p);var x=h(p,2),E=o(x);E.__click=t,i(x),Z(()=>ve(k,1,`h2 font-bold ${e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400"}`)),S(l,u)},$$slots:{content:!0}}),ae()}he(["click"]);var Ar=A('<div class="container mx-auto p-4"><main class="max-w-4xl mx-auto space-y-2"><div class="grid grid-cols-2 gap-4"><div class="card p-4"><h1 class="text-2xl font-bold"> </h1></div> <div class="card p-4 space-y-4"><div class="space-y-2"><div class="flex justify-start space-x-4"><span>Now:</span> <span class="font-bold" data-testid="current-phase"> </span></div> <div class="flex justify-between"><span>自分 LP:</span> <span class="font-bold text-success-500"> </span> <span>相手 LP:</span> <span class="font-bold text-error-500"> </span></div></div></div></div> <!> <div class="card px-4 space-y-4"><h2 class="text-xl font-bold"> </h2> <!></div> <details class="card p-4"><summary class="cursor-pointer font-bold">Debug Info</summary> <div class="mt-4 space-y-4"><pre class="text-xs overflow-auto"> </pre></div></details></main></div>  <!> <!> <!>',1);function jr(a,e){te(e,!0);const[t,r]=ut(),n=()=>H(_a,"$currentTurn",t),s=()=>H(xa,"$currentPhase",t),c=()=>H(Da,"$isGameOver",t),l=()=>H(D,"$gameStateStore",t),u=()=>H(Pa,"$handCards",t),C=()=>H(Ta,"$fieldCards",t),k=()=>H(ka,"$playerLP",t),p=()=>H(Aa,"$opponentLP",t),w=()=>H(Ia,"$deckCardCount",t),f=()=>H(La,"$graveyardCards",t),v=()=>H(za,"$handCardCount",t),y=()=>H(Oa,"$canActivateSpells",t),m=()=>H(Q,"$effectResolutionState",t),b=()=>H(Ea,"$gameResult",t);async function x(){for(let _=0;_<2;_++){await new Promise(M=>setTimeout(M,300));const O=de.advancePhase();if(O.success)console.log(`[Simulator] ${O.message}`),O.message&&ot(O.message);else{Me(O.error||"フェーズ移行に失敗しました");break}}}let E=ue(!1);Je(()=>{n()===1&&s()==="Draw"&&!d(E)&&!c()&&(x(),F(E,!0))});let z=ue(!1);Je(()=>{c()&&F(z,!0)});function g(){if(c())return"ゲーム終了";function _(O){return{Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ1",End:"エンドフェイズ"}[O]||O}return _(s())}function P(_,O){const M=de.activateSpell(O);M.success||Me(M.error||"発動に失敗しました")}function R(_){const M=de.getGameState().zones.field.find(It=>It.id===_.id);if(!M){Me("Card not found on field");return}const ee=de.activateIgnitionEffect(M.instanceId);ee.success?ot(ee.message||`${_.name}の効果を発動しました`):Me(ee.error||"効果発動に失敗しました")}const Q=Ie,$=I(()=>l().zones.hand.map((_,O)=>({card:u()[O],instanceId:_.instanceId}))),J=I(()=>C().filter(_=>_.frameType==="field")),T=I(()=>{const _=C().filter(M=>M.type==="monster"),O=Array(5).fill(null);return _.forEach((M,ee)=>{ee<5&&(O[ee]=M)}),O}),U=I(()=>{const _=C().filter(M=>(M.type==="spell"||M.type==="trap")&&M.frameType!=="field"),O=Array(5).fill(null);return _.forEach((M,ee)=>{ee<5&&(O[ee]=M)}),O});var ne=Ar(),X=W(ne),oe=o(X),ge=o(oe),pe=o(ge),Te=o(pe),Le=o(Te);i(Te),i(pe);var V=h(pe,2),q=o(V),ye=o(q),be=h(o(ye),2),Be=o(be,!0);i(be),i(ye);var xe=h(ye,2),_e=h(o(xe),2),He=o(_e,!0);i(_e);var Ce=h(_e,4),Se=o(Ce,!0);i(Ce),i(xe),i(q),i(V),i(ge);var ke=h(ge,2);er(ke,{get deckCards(){return w()},extraDeckCards:[],get graveyardCards(){return f()},get fieldCards(){return d(J)},get monsterCards(){return d(T)},get spellTrapCards(){return d(U)},onFieldCardClick:R});var Ae=h(ke,2),ze=o(Ae),Ct=o(ze);i(ze);var St=h(ze,2);or(St,{get cards(){return d($)},get handCardCount(){return v()},get currentPhase(){return s()},get canActivateSpells(){return y()},get isGameOver(){return c()},onCardClick:P}),i(Ae);var rt=h(Ae,2),nt=h(o(rt),2),st=o(nt),wt=o(st,!0);i(st),i(nt),i(rt),i(oe),i(X);var ct=h(X,2);const bt=I(()=>{var _,O;return m().isActive&&((_=m().currentStep)==null?void 0:_.notificationLevel)==="interactive"&&!((O=m().currentStep)!=null&&O.cardSelectionConfig)}),xt=I(()=>{var _;return((_=m().currentStep)==null?void 0:_.summary)||""}),_t=I(()=>{var _;return((_=m().currentStep)==null?void 0:_.description)||""}),kt=I(()=>{var _;return(_=m().currentStep)!=null&&_.showCancel?Ie.cancelResolution:void 0}),At=I(()=>{var _;return((_=m().currentStep)==null?void 0:_.showCancel)||!1});fr(ct,{get isOpen(){return d(bt)},get summary(){return d(xt)},get description(){return d(_t)},get onConfirm(){return Ie.confirmCurrentStep},get onCancel(){return d(kt)},get showCancel(){return d(At)}});var it=h(ct,2);yr(it,{});var zt=h(it,2);kr(zt,{get isOpen(){return d(z)},get winner(){return b().winner},get reason(){return b().reason},get message(){return b().message},onClose:()=>{console.log("[Simulator] Game result modal closed"),F(z,!1)}}),Z((_,O,M,ee)=>{j(Le,`Deck: ${e.data.deckName??""}`),j(Be,_),j(He,O),j(Se,M),j(Ct,`手札 (${v()??""} 枚)`),j(wt,ee)},[g,()=>k().toLocaleString(),()=>p().toLocaleString(),()=>JSON.stringify(de.getGameState(),null,2)]),S(a,ne),ae(),r()}export{jr as component,Nr as universal};
