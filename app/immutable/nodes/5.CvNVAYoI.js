var gn=Object.defineProperty;var pn=(n,e,t)=>e in n?gn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>pn(n,typeof e!="symbol"?e+"":e,t);import{b as Cn,d as bt,l as hn,C as Se,a as Ve,e as ft,f as vt,g as Pe,i as Sn}from"../chunks/B4eDF3a8.js";import{w as Pt,g as He,d as ie}from"../chunks/C6WtwkGm.js";import{c as Oe,a as I,f as O}from"../chunks/LOn0ekQa.js";import{k as ne,q as d,y as k,v as c,u as _,x as o,t as re,j as pe,l as Ce,ar as Ie,m as ee,as as Lt,L as st,V as In,C as dt,o as Tn}from"../chunks/DKjaHnf_.js";import{s as te,d as De,e as qe}from"../chunks/CXYPiKii.js";import{p as he,a as yn,s as ve}from"../chunks/BFE1hTON.js";import{M as Ke,I as Ot,x as Ne,y as be}from"../chunks/CW7dnaKu.js";import{i as Y}from"../chunks/CZBA5y4x.js";import{e as Te,a as An}from"../chunks/CGD6_aVM.js";import{b as Le,s as me,j as Qe,c as bn}from"../chunks/CyWh9ibf.js";const On=(n,e)=>({...n,...e}),zt=n=>n.type==="monster",Ft=n=>n.type==="spell",We=n=>n.type==="spell"&&n.spellType==="field",xn=n=>n.type==="trap",lt=n=>n.position==="faceUp",En=n=>n.position==="faceDown";function Nn(n){const e=[...n];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}function ae(n,e){return[...n.deck,...n.hand,...n.mainMonsterZone,...n.spellTrapZone,...n.fieldZone,...n.graveyard,...n.banished].find(r=>r.instanceId===e)}function _e(n,e,t,r){const a=e.location,s=n[a],i=s.findIndex(S=>S.instanceId===e.instanceId),u={...e,...r,location:t};return{...n,[a]:[...s.slice(0,i),...s.slice(i+1)],[t]:[...n[t],u]}}function mt(n,e,t){const r=e.location,a=n[r];return{...n,[r]:a.map(s=>s.instanceId===e.instanceId?On(s,t):s)}}function _t(n,e=1){if(n.deck.length<e)throw new Error(`Cannot draw ${e} cards. Only ${n.deck.length} cards remaining in deck.`);let t=n;for(let r=0;r<e;r++){const a=t.deck[t.deck.length-1];t=_e(t,a,"hand")}return t}function Xe(n){return{...n,deck:Nn(n.deck)}}const Zt=(n,e)=>e.location==="hand"?n.hand.filter(t=>t.instanceId!==e.instanceId).length:n.hand.length,kn=(n,e=5)=>n.mainMonsterZone.length>=e,Dn=(n,e=5)=>n.spellTrapZone.length>=e,wn=(n,e=1)=>n.fieldZone.length>=e,xt=8e3;function Gt(n,e){const r={deck:n.mainDeckCardIds.map((s,i)=>({...Cn(s),instanceId:`deck-${i}`,location:"deck",placedThisTurn:!1,counters:[]})),hand:[],mainMonsterZone:[],spellTrapZone:[],fieldZone:[],graveyard:[],banished:[]};let a=e!=null&&e.skipShuffle?r:Xe(r);return e!=null&&e.skipInitialDraw||(a=_t(a,5)),{zones:a,lp:{player:xt,opponent:xt},phase:"Draw",turn:1,result:{isGameOver:!1},normalSummonLimit:1,normalSummonUsed:0,activatedIgnitionEffectsThisTurn:new Set,activatedOncePerTurnCards:new Set,pendingEndPhaseEffects:[],damageNegation:!1}}const Ge=class Ge{constructor(){j(this,"isEffect",!1);j(this,"category","VictoryCondition")}canApply(e){const t=e.zones.hand.map(r=>r.id);return Ge.EXODIA_PIECE_IDS.every(r=>t.includes(r))}checkPermission(e){return!0}static getExodiaPieceIds(){return Ge.EXODIA_PIECE_IDS}};j(Ge,"EXODIA_PIECE_IDS",[33396948,7902349,70903634,8124921,44519536]);let ut=Ge;function Vt(n){const e=new ut;return e.canApply(n,{})&&e.checkPermission(n,{})?{isGameOver:!0,winner:"player",reason:"exodia",message:"5つのエクゾディアパーツが手札に揃いました。勝利です！"}:n.lp.player<=0?{isGameOver:!0,winner:"opponent",reason:"lp0",message:"ライフポイントが0になりました。敗北です。"}:n.lp.opponent<=0?{isGameOver:!0,winner:"player",reason:"lp0",message:"相手のライフポイントが0になりました。勝利です！"}:{isGameOver:!1}}function Ut(){return Gt({mainDeckCardIds:[]},{skipShuffle:!0,skipInitialDraw:!0})}function Et(n){if(n.result.isGameOver||n.turn===0&&n.phase==="Draw")return n;const e=Vt(n);return e.isGameOver?{...n,result:e}:n}function Rn(){const{subscribe:n,set:e,update:t}=Pt(Ut());return{subscribe:n,set:r=>{e(Et(r))},update:r=>{t(a=>Et(r(a)))}}}const X=Rn();function Mn(n){const e=[];n.mainDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)e.push(r.id)});const t=[];return n.extraDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)t.push(r.id)}),{mainDeckCardIds:e,extraDeckCardIds:t}}function Pn(n){const e=Mn(n);X.set(Gt(e))}function it(){let n=Ut();return X.subscribe(t=>{n=t})(),n}function Ln(){return{current:{timestamp:0,events:[]},history:[],nextTimestamp:1}}function zn(n,e){return{...n,current:{...n.current,events:[...n.current.events,e]}}}class Ye{static register(e,t){const r=this.rules.get(e)||[];this.rules.set(e,[...r,t])}static get(e){return this.rules.get(e)||[]}static getByCategory(e,t){return this.get(e).filter(a=>a.category===t)}static collectActiveRules(e,t){const r=[],a=[...e.zones.spellTrapZone,...e.zones.fieldZone];for(const s of a){if(!lt(s))continue;const i=this.getByCategory(s.id,t);for(const u of i)u.canApply(e)&&r.push(u)}return r}static collectTriggerRules(e,t){var s;const r=[],a=[...e.zones.mainMonsterZone,...e.zones.spellTrapZone,...e.zones.fieldZone];for(const i of a){if(!lt(i))continue;const u=this.getByCategory(i.id,"TriggerRule");for(const S of u)(s=S.triggers)!=null&&s.includes(t)&&r.push({rule:S,sourceInstance:i})}return r}static collectTriggerSteps(e,t){const r=this.collectTriggerRules(e,t),a=[];for(const{rule:s,sourceInstance:i}of r)if(s.canApply(e)&&s.createTriggerSteps){const u=s.createTriggerSteps(e,i);a.push(...u)}return a}static clear(){this.rules.clear()}static getRegisteredCardIds(){return Array.from(this.rules.keys())}}j(Ye,"rules",new Map);function Je(n,e,t){const r=n.action(e,t);return r.success?(X.set(r.updatedState),{updatedState:r.updatedState,emittedEvents:r.emittedEvents||[]}):{updatedState:e,emittedEvents:[]}}function Fn(n,e,t,r){const a=[];for(const s of n){const i=Ye.collectTriggerSteps(e,s.type);a.push(...i)}return a.length===0?t:[...t.slice(0,r+1),...a,...t.slice(r+1)]}function Zn(n,e){const t=n.currentIndex+1;return t<n.steps.length?(e(r=>({...r,currentIndex:t,currentStep:r.steps[t]})),!0):(Ht(e),!1)}function Ht(n){n(e=>({...e,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}const Gn=async(n,e)=>({shouldContinue:!0,emittedEvents:Je(n,e).emittedEvents}),Vn=async(n,e,t)=>{const r=Je(n,e);return t.notification&&t.notification.showInfo(n.summary,n.description),{shouldContinue:!0,delay:300,emittedEvents:r.emittedEvents}},Un=async(n,e,t,r)=>{const a=n.cardSelectionConfig;let s;if(a.availableCards!==null)s=a.availableCards;else{if(!a._sourceZone)return console.error("_sourceZone must be specified when availableCards is null"),{shouldContinue:!1};const u=e.zones[a._sourceZone];s=a._filter?u.filter((S,h)=>a._filter(S,h)):u}let i=[];return await new Promise(u=>{r(S=>({...S,cardSelectionConfig:{availableCards:s,minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable,onConfirm:h=>{i=Je(n,e,h).emittedEvents,r(x=>({...x,cardSelectionConfig:null})),u()},onCancel:()=>{r(h=>({...h,cardSelectionConfig:null})),u()}}}))}),{shouldContinue:!0,emittedEvents:i}},Hn=async(n,e,t,r)=>{let a=[];return await new Promise(s=>{r(i=>({...i,confirmationConfig:{summary:n.summary,description:n.description,onConfirm:()=>{a=Je(n,e).emittedEvents,r(S=>({...S,confirmationConfig:null})),s()}}}))}),{shouldContinue:!0,emittedEvents:a}};function jn(n){const e=n.notificationLevel||"info";return e==="silent"?Gn:e==="info"?Vn:n.cardSelectionConfig?Un:Hn}function Bn(){const{subscribe:n,update:e}=Pt({isActive:!1,currentStep:null,steps:[],currentIndex:-1,notificationHandler:null,confirmationConfig:null,cardSelectionConfig:null,eventTimeline:Ln()});return{subscribe:n,registerNotificationHandler:t=>{e(r=>({...r,notificationHandler:t}))},startProcessing:t=>{e(a=>({...a,isActive:!0,steps:t,currentIndex:0,currentStep:t[0]||null}));const r=t[0];if(r){const a=r.notificationLevel||"info";(a==="info"||a==="silent")&&ke.confirmCurrentStep()}},confirmCurrentStep:async()=>{let t=He(ke);if(!t.currentStep)return;const r=He(X),s=await jn(t.currentStep)(t.currentStep,r,{notification:t.notificationHandler},e);if(s.emittedEvents&&s.emittedEvents.length>0){let i=t.eventTimeline;for(const h of s.emittedEvents)i=zn(i,h);const u=He(X),S=Fn(s.emittedEvents,u,t.steps,t.currentIndex);e(h=>({...h,steps:S,eventTimeline:i})),t=He(ke)}s.delay&&await new Promise(i=>setTimeout(i,s.delay)),s.shouldContinue?Zn(t,e)&&ke.confirmCurrentStep():Ht(e)},cancelProcessing:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))},reset:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}}}const ke=Bn(),ge=(n,e,t,r)=>({success:!0,updatedState:n,message:e,effectSteps:t,emittedEvents:r}),xe=(n,e)=>({success:!1,updatedState:n,error:e}),ot=["Draw","Standby","Main1","End"],qn={Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ",End:"エンドフェイズ"},Qn=n=>qn[n],je=n=>{const e=ot.indexOf(n);return e===-1||e===ot.length-1?"End":ot[e+1]},Wn=(n,e)=>{const t=je(n);return e!==t?{valid:!1,error:`Invalid phase transition: ${n} → ${e}. Expected: ${t}`}:{valid:!0}},ze=n=>n==="Main1",ct=n=>n==="End",g={GAME_OVER:"GAME_OVER",NOT_MAIN_PHASE:"NOT_MAIN_PHASE",CARD_NOT_FOUND:"CARD_NOT_FOUND",CARD_NOT_IN_HAND:"CARD_NOT_IN_HAND",CARD_NOT_IN_VALID_LOCATION:"CARD_NOT_IN_VALID_LOCATION",CARD_NOT_ON_FIELD:"CARD_NOT_ON_FIELD",CARD_NOT_FACE_UP:"CARD_NOT_FACE_UP",NOT_SPELL_CARD:"NOT_SPELL_CARD",NOT_SPELL_OR_TRAP_CARD:"NOT_SPELL_OR_TRAP_CARD",NOT_MONSTER_CARD:"NOT_MONSTER_CARD",SPELL_TRAP_ZONE_FULL:"SPELL_TRAP_ZONE_FULL",MONSTER_ZONE_FULL:"MONSTER_ZONE_FULL",INSUFFICIENT_COUNTERS:"INSUFFICIENT_COUNTERS",SUMMON_LIMIT_REACHED:"SUMMON_LIMIT_REACHED",QUICK_PLAY_RESTRICTION:"QUICK_PLAY_RESTRICTION",ACTIVATION_CONDITIONS_NOT_MET:"ACTIVATION_CONDITIONS_NOT_MET",NO_IGNITION_EFFECT:"NO_IGNITION_EFFECT",PHASE_TRANSITION_NOT_ALLOWED:"PHASE_TRANSITION_NOT_ALLOWED"},Yn={GAME_OVER:"ゲームは終了しています",NOT_MAIN_PHASE:"メインフェイズではありません",CARD_NOT_FOUND:"カードが見つかりません",CARD_NOT_IN_HAND:"カードが手札にありません",CARD_NOT_IN_VALID_LOCATION:"カードが有効な場所にありません",CARD_NOT_ON_FIELD:"カードがフィールドにありません",CARD_NOT_FACE_UP:"カードが表側表示ではありません",NOT_SPELL_CARD:"魔法カードではありません",NOT_SPELL_OR_TRAP_CARD:"魔法または罠カードではありません",NOT_MONSTER_CARD:"モンスターカードではありません",SPELL_TRAP_ZONE_FULL:"魔法・罠ゾーンに空きがありません",MONSTER_ZONE_FULL:"モンスターゾーンに空きがありません",INSUFFICIENT_DECK:"デッキのカードが不足しています",INSUFFICIENT_COUNTERS:"カウンターが不足しています",SUMMON_LIMIT_REACHED:"召喚権がありません",QUICK_PLAY_RESTRICTION:"速攻魔法はセットしたターンに発動できません",ACTIVATION_CONDITIONS_NOT_MET:"発動条件を満たしていません",NO_IGNITION_EFFECT:"このカードには起動効果がありません",PHASE_TRANSITION_NOT_ALLOWED:"フェイズ遷移が許可されていません"},V=()=>({isValid:!0}),p=(n,e)=>({isValid:!1,errorCode:n,errorParams:e}),Fe=n=>{if(n.isValid||!n.errorCode)return"";const e=Yn[n.errorCode];return n.errorParams,e};class Kn{constructor(){j(this,"description");this.description="Advance to next phase"}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);const t=je(e.phase);return Wn(e.phase,t).valid?V():p(g.PHASE_TRANSITION_NOT_ALLOWED)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=je(e.phase),a=ct(r)&&e.pendingEndPhaseEffects.length>0,s={...e,phase:r,activatedIgnitionEffectsThisTurn:ct(r)?new Set:e.activatedIgnitionEffectsThisTurn,activatedOncePerTurnCards:ct(r)?new Set:e.activatedOncePerTurnCards,pendingEndPhaseEffects:a?[]:e.pendingEndPhaseEffects};return ge(s,`Advanced to ${Qn(r)}`,a?[...e.pendingEndPhaseEffects]:void 0)}getNextPhase(e){return je(e.phase)}}function jt(n){return ze(n.phase)?kn(n.zones)?p(g.MONSTER_ZONE_FULL):n.normalSummonUsed>=n.normalSummonLimit?p(g.SUMMON_LIMIT_REACHED):V():p(g.NOT_MAIN_PHASE)}function Bt(n,e,t){const r=ae(n.zones,e),a=_e(n.zones,r,"mainMonsterZone",{position:t==="attack"?"faceUp":"faceDown",battlePosition:t,placedThisTurn:!0});return{...n,zones:a,normalSummonUsed:n.normalSummonUsed+1}}class Nt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Summon monster ${e}`}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);const t=jt(e);if(!t.isValid)return t;const r=ae(e.zones,this.cardInstanceId);return r?zt(r)?r.location!=="hand"?p(g.CARD_NOT_IN_HAND):V():p(g.NOT_MONSTER_CARD):p(g.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=Bt(e,this.cardInstanceId,"attack");return ge(a,`Monster summoned: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class kt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Set monster ${e}`}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);const t=jt(e);if(!t.isValid)return t;const r=ae(e.zones,this.cardInstanceId);return r?zt(r)?r.location!=="hand"?p(g.CARD_NOT_IN_HAND):V():p(g.NOT_MONSTER_CARD):p(g.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=Bt(e,this.cardInstanceId,"defense");return ge(a,`Monster set: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class Dt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Set spell/trap ${e}`}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);if(!ze(e.phase))return p(g.NOT_MAIN_PHASE);const t=ae(e.zones,this.cardInstanceId);return t?t.location!=="hand"?p(g.CARD_NOT_IN_HAND):!Ft(t)&&!xn(t)?p(g.NOT_SPELL_OR_TRAP_CARD):!We(t)&&Dn(e.zones)?p(g.SPELL_TRAP_ZONE_FULL):V():p(g.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a={...e,zones:this.moveSetSpellTrapCard(e.zones,r)};return ge(a,`Card set: ${r.jaName}`)}moveSetSpellTrapCard(e,t){const r={position:"faceDown",placedThisTurn:!0};return We(t)?(wn(e)&&(e=_e(e,e.fieldZone[0],"graveyard")),_e(e,t,"fieldZone",r)):_e(e,t,"spellTrapZone",r)}getCardInstanceId(){return this.cardInstanceId}}class K{static registerActivation(e,t){const r=this.getOrCreateEntry(e);r.activation=t}static registerIgnition(e,t){this.getOrCreateEntry(e).ignitionEffects.push(t)}static getActivation(e){var t;return(t=this.effects.get(e))==null?void 0:t.activation}static getIgnitionEffects(e){var t;return((t=this.effects.get(e))==null?void 0:t.ignitionEffects)??[]}static hasIgnitionEffects(e){const t=this.effects.get(e);return t!==void 0&&t.ignitionEffects.length>0}static clear(){this.effects.clear()}static getRegisteredCardIds(){return Array.from(this.effects.keys())}static getOrCreateEntry(e){let t=this.effects.get(e);return t||(t={ignitionEffects:[]},this.effects.set(e,t)),t}}j(K,"effects",new Map);class wt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Activate spell card ${e}`}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);const t=ae(e.zones,this.cardInstanceId);if(!t)return p(g.CARD_NOT_FOUND);if(!["hand","spellTrapZone","fieldZone"].includes(t.location))return p(g.CARD_NOT_IN_VALID_LOCATION);if(!Ft(t))return p(g.NOT_SPELL_CARD);if(!We(t)&&e.zones.spellTrapZone.length>=5)return p(g.SPELL_TRAP_ZONE_FULL);const r=K.getActivation(t.id);if(r){const a=r.canActivate(e,t);if(!a.isValid)return a}return V()}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=new Set(e.activatedOncePerTurnCards);a.add(r.id);const s={...e,zones:this.moveActivatedSpellCard(e.zones,r),activatedOncePerTurnCards:a};return ge(s,`Spell card activated: ${this.cardInstanceId}`,this.buildEffectSteps(s,r))}moveActivatedSpellCard(e,t){const r={position:"faceUp",placedThisTurn:!0};if(t.location==="hand"){const a=We(t)?"fieldZone":"spellTrapZone";return _e(e,t,a,r)}return mt(e,t,r)}buildEffectSteps(e,t){const r=[],a=K.getActivation(t.id);return a&&(r.push(...a.createActivationSteps(e,t)),r.push(...a.createResolutionSteps(e,t))),r}getCardInstanceId(){return this.cardInstanceId}}class Rt{constructor(e){j(this,"description");this.cardInstanceId=e,this.description=`Activate ignition effect of ${e}`}canExecute(e){if(e.result.isGameOver)return p(g.GAME_OVER);const t=ae(e.zones,this.cardInstanceId);if(!t)return p(g.CARD_NOT_FOUND);if(!["fieldZone","spellTrapZone","mainMonsterZone"].includes(t.location))return p(g.CARD_NOT_ON_FIELD);if(!lt(t))return p(g.CARD_NOT_FACE_UP);const a=K.getIgnitionEffects(t.id);return a.length===0?p(g.NO_IGNITION_EFFECT):this.findActivatableEffect(a,e,t)?V():p(g.ACTIVATION_CONDITIONS_NOT_MET)}findActivatableEffect(e,t,r){return e.find(a=>a.canActivate(t,r).isValid)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=ae(e.zones,this.cardInstanceId),a=K.getIgnitionEffects(r.id),s=this.findActivatableEffect(a,e,r),i=new Set(e.activatedIgnitionEffectsThisTurn);i.add(`${r.instanceId}:${s.effectId}`);const u={...e,activatedIgnitionEffectsThisTurn:i};return ge(u,`Ignition effect activated: ${this.cardInstanceId}`,this.buildEffectSteps(u,r,s))}buildEffectSteps(e,t,r){const a=r.createActivationSteps(e,t),s=r.createResolutionSteps(e,t);return[...a,...s]}getCardInstanceId(){return this.cardInstanceId}}const qt=n=>({id:`${n}-activation-notification`,summary:"カード発動",description:`${bt(n)}を発動します`,notificationLevel:"info",action:e=>({success:!0,updatedState:e,message:`${bt(n)} activated`})}),Qt=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:n.availableCards,_sourceZone:n._sourceZone,_filter:n._filter,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1},action:(e,t)=>!t||t.length===0?n.onSelect(e,[]):n.onSelect(e,t)});function Xn(n){return{id:`emit-spell-activated-${n.instanceId}`,summary:"魔法発動イベント",description:"魔法カード発動をトリガーシステムに通知",notificationLevel:"silent",action:e=>ge(e,void 0,void 0,[{type:"spellActivated",sourceCardId:n.id,sourceInstanceId:n.instanceId}])}}class $e{constructor(e){j(this,"cardId");j(this,"effectId");j(this,"effectCategory","activation");this.cardId=e,this.effectId=`activation-${e}`}canActivate(e,t){const r=this.subTypeConditions(e,t);if(!r.isValid)return r;const a=this.individualConditions(e,t);return a.isValid?V():a}createActivationSteps(e,t){return[qt(this.cardId),Xn(t),...this.subTypePreActivationSteps(e,t),...this.individualActivationSteps(e,t),...this.subTypePostActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.subTypePreResolutionSteps(e,t),...this.individualResolutionSteps(e,t),...this.subTypePostResolutionSteps(e,t)]}}function Jn(n,e){return{id:(e==null?void 0:e.id)??`queue-end-phase-effect-${n.id}`,summary:(e==null?void 0:e.summary)??"エンドフェイズ効果を登録",description:(e==null?void 0:e.description)??"エンドフェイズに処理される効果を登録します",notificationLevel:"silent",action:t=>({success:!0,updatedState:{...t,pendingEndPhaseEffects:[...t.pendingEndPhaseEffects,n]},message:`Added end phase effect: ${n.summary}`})}}const Wt=(n,e)=>({id:`send-${n}-to-graveyard`,summary:"墓地へ送る",description:`《${e}》を墓地に送ります`,notificationLevel:"info",action:t=>{const r=ae(t.zones,n);return{success:!0,updatedState:{...t,zones:_e(t.zones,r,"graveyard")},message:`Sent ${e} to graveyard`}}}),Yt=(n,e)=>{let t=n.zones;for(const r of e){const a=ae(t,r);t=_e(t,a,"graveyard")}return{success:!0,updatedState:{...n,zones:t},message:`Sent ${e.length} card${e.length>1?"s":""} to graveyard`}},$n=n=>{const e=[...n.zones.hand];if(e.length===0)return{success:!0,updatedState:n,message:"No cards in hand to discard"};const t=e.map(r=>r.instanceId);return Yt(n,t)},er=()=>({id:"discard-all-hand",summary:"手札を全て捨てる",description:"手札を全て捨てます",notificationLevel:"info",action:n=>$n(n)}),Kt=()=>Jn(er(),{id:"end-phase-discard-all-hand",summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます"}),gt=(n,e)=>Qt({id:`select-and-discard-${n}-cards`,summary:`手札を${n}枚捨てる`,description:`手札から${n}枚選んで捨てます`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n,maxCards:n,cancelable:!1,onSelect:(t,r)=>r.length!==n?{success:!1,updatedState:t,error:`Must select exactly ${n} cards to discard`}:Yt(t,r)});class de extends $e{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():p(g.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[Wt(r.instanceId,r.jaName)]}}const Xt=(n,e)=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"info",action:t=>{const{drawCount:r,message:a}=n(t);return r===0?{success:!0,updatedState:t,message:a}:t.zones.deck.length<r?{success:!1,updatedState:t,error:`Insufficient deck: needed ${r}, but only ${t.zones.deck.length} remaining.`}:{success:!0,updatedState:{...t,zones:_t(t.zones,r)},message:`${a} (${r} card${r>1?"s":""})`}}}),Ee=n=>Xt(()=>({drawCount:n,message:`Draw ${n} card(s)`}),{id:`draw-${n}`,summary:"カードをドロー",description:`デッキから${n}枚ドローします`}),tr=n=>Xt(e=>{const t=Math.max(0,n-e.zones.hand.length);return{drawCount:t,message:t===0?`Hand already has ${n} or more cards`:`Filled hand to ${n}`}},{id:`fill-hands-${n}`,summary:`手札が${n}枚になるまでドロー`,description:`手札が${n}枚になるまでドローします`});class nr extends de{constructor(){super(55144522)}individualConditions(e,t){return e.zones.deck.length<2?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(2)]}}class rr extends de{constructor(){super(79571449)}individualConditions(e,t){return e.zones.deck.length<3?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(3),gt(2)]}}class ar extends $e{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():p(g.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class sr extends ar{constructor(){super(67616300)}individualConditions(e,t){return V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[]}}const Jt=(n,e,t)=>{const r=t==="player",a=r?"プレイヤー":"相手",s=r?"Player":"Opponent",i=n==="gain"?1:-1,u={gain:{id:"gain-lp",action:"増加",msg:"gained"},damage:{id:"damage",action:"ダメージ",msg:"took"},payment:{id:"pay-lp",action:"支払い",msg:"paid"},loss:{id:"loss-lp",action:"喪失",msg:"lost"}}[n];return{id:`${u.id}-${t}-${e}`,summary:`${a}のLP${u.action}`,description:`${a}に${e}の${u.action}が発生します`,notificationLevel:"info",action:S=>({success:!0,updatedState:{...S,lp:{...S.lp,[t]:S.lp[t]+e*i}},message:`${s} ${u.msg} ${e} LP`})}},ir=(n,e)=>Jt("gain",n,e),$t=(n,e)=>Jt("payment",n,e);class or extends de{constructor(){super(70368879)}individualConditions(e,t){return e.zones.deck.length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),ir(1e3,"opponent")]}}class cr extends de{constructor(){super(33782437)}individualConditions(e,t){return e.zones.deck.length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),{id:"one-day-of-peace-damage-negation",summary:"ダメージ無効化",description:"このターン、全てのダメージは0になります",notificationLevel:"info",action:r=>({success:!0,updatedState:{...r,damageNegation:!0},message:"Damage negation activated for this turn"})}]}}const dr=n=>Qt({id:"select-and-return-to-deck",summary:"手札をデッキに戻す",description:`デッキに戻すカードを選択してください（${n.min}〜${n.max??100}枚）`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n.min,maxCards:n.max??100,cancelable:!1,onSelect:(e,t)=>{if(t.length===0)return{success:!0,updatedState:e,message:"No cards selected"};let r=e.zones;for(const a of t){const s=ae(r,a);r=_e(r,s,"deck")}return r=Xe(r),r=_t(r,t.length),{success:!0,updatedState:{...e,zones:r},message:`${t.length}枚をデッキに戻し、シャッフルして${t.length}枚ドローしました`}}});class lr extends de{constructor(){super(85852291)}individualConditions(e,t){return V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[dr({min:0})]}}class ur extends $e{constructor(){super(...arguments);j(this,"spellSpeed",2)}subTypeConditions(t,r){return En(r)&&r.placedThisTurn?p(g.QUICK_PLAY_RESTRICTION):V()}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[Wt(r.instanceId,r.jaName)]}}class fr extends ur{constructor(){super(74519184)}individualConditions(e,t){return Zt(e.zones,t)<2||e.zones.deck.length<2?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[gt(2),Ee(2)]}}const en=(n,e,t)=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:e,_filter:n.filter},action:(r,a)=>{if((e==="graveyard"?r.zones.graveyard.filter(n.filter):r.zones.deck.filter((h,T)=>n.filter(h,T))).length===0)return{success:!1,updatedState:r,error:`No cards available in ${e} matching the criteria`};if(!a||a.length===0)return{success:!1,updatedState:r,error:"No cards selected"};let i=r.zones;for(const h of a){const T=ae(i,h);i=_e(i,T,"hand")}t&&(i=Xe(i));const u={...r,zones:i},S=t?" and shuffled":"";return{success:!0,updatedState:u,message:`Added ${a.length} card${a.length>1?"s":""} from ${e} to hand${S}`}}}),tn=n=>en(n,"graveyard",!1),nn=n=>en(n,"deck",!0),vr=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:"deck",_filter:(e,t)=>t!==void 0&&t<n.count},action:(e,t)=>{const r=e.zones.deck.slice(0,n.count);if(r.length<n.count)return{success:!1,updatedState:e,error:`Cannot excavate ${n.count} cards. Deck has only ${r.length} cards.`};if(!t||t.length===0)return{success:!1,updatedState:e,error:"No cards selected"};let a=e.zones;for(const i of t){const u=ae(a,i);a=_e(a,u,"hand")}return{success:!0,updatedState:{...e,zones:a},message:`Added ${t.length} card${t.length>1?"s":""} from deck to hand`}}});class mr extends de{constructor(){super(90928333)}individualConditions(e,t){return e.zones.graveyard.filter(a=>a.type==="monster"&&a.frameType==="normal").length<2?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[tn({id:`dark-factory-search-${t.instanceId}`,summary:"通常モンスター2枚をサルベージ",description:"墓地から通常モンスター2枚を選択し、手札に加えます",filter:r=>r.type==="monster"&&r.frameType==="normal",minCards:2,maxCards:2,cancelable:!1})]}}class _r extends de{constructor(){super(73628505)}individualConditions(e,t){return e.zones.deck.filter(a=>a.type==="spell"&&a.spellType==="field").length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[nn({id:`terraforming-search-${t.instanceId}`,summary:"フィールド魔法1枚をサーチ",description:"デッキからフィールド魔法1枚を選択し、手札に加えます",filter:r=>r.type==="spell"&&r.spellType==="field",minCards:1,maxCards:1,cancelable:!1})]}}class gr extends de{constructor(){super(98494543)}individualConditions(e,t){return Zt(e.zones,t)<2||e.zones.graveyard.filter(a=>a.type==="spell").length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[gt(2)]}individualResolutionSteps(e,t){return[tn({id:`magical-stone-excavation-search-${t.instanceId}`,summary:"魔法カード1枚をサルベージ",description:"墓地から魔法カード1枚を選択し、手札に加えます",filter:r=>r.type==="spell",minCards:1,maxCards:1,cancelable:!1})]}}class pr extends de{constructor(){super(93946239)}individualConditions(e,t){return e.zones.hand.length<3||e.zones.deck.length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),Kt()]}}const Cr=()=>({id:"shuffle-deck",summary:"デッキシャッフル",description:"デッキをシャッフルします",notificationLevel:"info",action:n=>({success:!0,updatedState:{...n,zones:Xe(n.zones)},message:"Deck shuffled"})});class hr extends de{constructor(){super(98645731)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)||e.zones.deck.length<3?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[vr({id:`pot-of-duality-search-${t.instanceId}`,summary:"デッキトップ3枚から1枚をサーチ",description:"デッキトップ3枚から1枚を選択し、手札に加えます",count:3,minCards:1,maxCards:1,cancelable:!1}),Cr()]}}class Sr extends de{constructor(){super(59750328)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[tr(3),Kt()]}}class Ir extends de{constructor(){super(89997728)}individualConditions(e,t){return e.zones.deck.filter(a=>a.jaName.includes("トゥーン")).length<1?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[nn({id:`toon-table-search-${t.instanceId}`,summary:"「トゥーン」カード1枚をサーチ",description:"デッキから「トゥーン」カード1枚を選択し、手札に加えます",filter:r=>r.jaName.includes("トゥーン"),minCards:1,maxCards:1,cancelable:!1})]}}class Tr extends $e{constructor(){super(...arguments);j(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?V():p(g.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class yr extends Tr{constructor(){super(15259703)}individualConditions(e,t){return e.lp.player<1e3?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[$t(1e3,"player")]}individualResolutionSteps(e,t){return[]}}class rn{constructor(e,t){j(this,"cardId");j(this,"effectId");j(this,"effectCategory","ignition");j(this,"spellSpeed",1);this.cardId=e,this.effectId=`ignition-${e}-${t}`}canActivate(e,t){if(!ze(e.phase))return p(g.NOT_MAIN_PHASE);const r=this.individualConditions(e,t);return r.isValid?V():r}createActivationSteps(e,t){return[qt(t.id),...this.individualActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.individualResolutionSteps(e,t)]}}class Ar extends rn{constructor(){super(67616300,1)}individualConditions(e,t){if(e.lp.player<=1e3)return p(g.ACTIVATION_CONDITIONS_NOT_MET);const r=`${t.instanceId}:${this.effectId}`;return e.activatedIgnitionEffectsThisTurn.has(r)?p(g.ACTIVATION_CONDITIONS_NOT_MET):V()}individualActivationSteps(e,t){return[$t(1e3,"player")]}individualResolutionSteps(e,t){return[Ee(1)]}}function et(n,e){const t=n.find(r=>r.type===e);return(t==null?void 0:t.count)??0}function an(n,e,t){const r=n.findIndex(a=>a.type===e);if(r>=0){const a=n[r],s=Math.max(0,a.count+t);return s===0?[...n.slice(0,r),...n.slice(r+1)]:[...n.slice(0,r),{type:e,count:s},...n.slice(r+1)]}else if(t>0)return[...n,{type:e,count:t}];return n}const br=(n,e,t,r)=>({id:`add-counter-${e}-${t}-${n}`,summary:"カウンターを置く",description:`魔力カウンターを${t}つ置きます`,notificationLevel:"silent",action:a=>{const s=ae(a.zones,n);if(!s)return ge(a,"カードが見つかりません");const i=et(s.counters,e);if(i>=r)return ge(a,"カウンターは既に最大数です");const u=Math.min(t,r-i),S=an(s.counters,e,u),h=mt(a.zones,s,{counters:S});return ge({...a,zones:h},`魔力カウンターを${u}つ置きました`)}}),Or=(n,e,t)=>({id:`remove-counter-${e}-${t}-${n}`,summary:"カウンターを取り除く",description:`魔力カウンターを${t}つ取り除きます`,notificationLevel:"info",action:r=>{const a=ae(r.zones,n);if(!a)return xe(r,`Target card not found: ${n}`);const s=et(a.counters,e);if(s<t)return xe(r,`Insufficient counters: needed ${t}, but only ${s} available.`);const i=an(a.counters,e,-t),u=mt(r.zones,a,{counters:i});return ge({...r,zones:u},`Removed ${t} ${e} counter(s) from card.`)}}),Mt=3;class xr extends rn{constructor(){super(70791313,1)}individualConditions(e,t){return et(t.counters,"spell")<Mt?p(g.INSUFFICIENT_COUNTERS):V()}individualActivationSteps(e,t){return[Or(t.instanceId,"spell",Mt)]}individualResolutionSteps(e,t){return[Ee(1)]}}function Er(){K.registerActivation(55144522,new nr),K.registerActivation(79571449,new rr),K.registerActivation(67616300,new sr),K.registerActivation(70368879,new or),K.registerActivation(33782437,new cr),K.registerActivation(85852291,new lr),K.registerActivation(74519184,new fr),K.registerActivation(90928333,new mr),K.registerActivation(73628505,new _r),K.registerActivation(98494543,new gr),K.registerActivation(93946239,new pr),K.registerActivation(98645731,new hr),K.registerActivation(59750328,new Sr),K.registerActivation(89997728,new Ir),K.registerActivation(15259703,new yr),K.registerIgnition(67616300,new Ar),K.registerIgnition(70791313,new xr)}class Nr{constructor(){j(this,"isEffect",!0);j(this,"category","ActionPermission")}canApply(e){return e.zones.fieldZone.some(t=>t.id===67616300&&t.position==="faceUp")}checkPermission(e){return!1}}const kr=70791313,Dr=3;class wr{constructor(){j(this,"isEffect",!0);j(this,"category","TriggerRule");j(this,"triggers",["spellActivated"])}canApply(e){return e.zones.mainMonsterZone.some(r=>r.id===kr&&r.position==="faceUp")}createTriggerSteps(e,t){return[br(t.instanceId,"spell",1,Dr)]}}function Rr(){Ye.register(67616300,new Nr),Ye.register(70791313,new wr)}Er();Rr();class Mr{canExecuteCommand(e,...t){const r=it();return new e(...t).canExecute(r).isValid}executeCommand(e,...t){const r=it(),s=new e(...t).execute(r);return s.success&&(X.set(s.updatedState),s.effectSteps&&s.effectSteps.length>0&&ke.startProcessing(s.effectSteps)),{success:s.success,message:s.message,error:s.error}}initializeGame(e){Pn(e)}getGameState(){return it()}advancePhase(){return this.executeCommand(Kn)}canSummonMonster(e){return this.canExecuteCommand(Nt,e)}summonMonster(e){return this.executeCommand(Nt,e)}canSetMonster(e){return this.canExecuteCommand(kt,e)}setMonster(e){return this.executeCommand(kt,e)}canSetSpellTrap(e){return this.canExecuteCommand(Dt,e)}setSpellTrap(e){return this.executeCommand(Dt,e)}canActivateSpell(e){return this.canExecuteCommand(wt,e)}activateSpell(e){return this.executeCommand(wt,e)}canActivateIgnitionEffect(e){return this.canExecuteCommand(Rt,e)}activateIgnitionEffect(e){return this.executeCommand(Rt,e)}}const se=new Mr,Pr=({params:n})=>{const{deckId:e}=n,{deckRecipe:t,deckData:r,uniqueCardIds:a}=hn(e);return console.log(`[PageLoad] Initializing game with deck: ${t.name}`),se.initializeGame(t),console.log("[PageLoad] Initial state:",se.getGameState()),{deckId:e,deckName:r.name,uniqueCardIds:a}},is=Object.freeze(Object.defineProperty({__proto__:null,load:Pr},Symbol.toStringTag,{value:"Module"})),Lr=ie(X,n=>n.phase),zr=ie(X,n=>n.turn),Fr=ie(X,n=>n.lp.player),Zr=ie(X,n=>n.lp.opponent),Gr=ie(X,n=>n.zones.hand.length),Vr=ie(X,n=>n.zones.deck.length);ie(X,n=>n.zones.graveyard.length);ie(X,n=>n.zones.mainMonsterZone.length+n.zones.spellTrapZone.length+n.zones.fieldZone.length);const Ur=ie(X,n=>n.result.isGameOver?n.result:Vt(n));ie(X,n=>n.zones.deck.length===0);ie(X,n=>n.zones.hand.length===0);const Hr=ie(X,n=>n.zones.hand);ie(X,n=>[...n.zones.mainMonsterZone,...n.zones.spellTrapZone,...n.zones.fieldZone]);const jr=ie(X,n=>n.zones.graveyard);ie(X,n=>n.zones.banished);const Br=""+new URL("../assets/SpellCounter.pzkYCI1C.png",import.meta.url).href;var qr=O('<div class="absolute bottom-8 right-1 px-1 bg-green-900 text-white rounded-full flex items-center justify-center font-bold border-1 border-green-400 shadow-md z-10" data-testid="spell-counter-badge"><img alt="魔力カウンター" class="w-4 h-4"/> <span class="text-xs" data-testid="spell-counter-count"> </span></div>');function Qr(n,e){const t=k(()=>e.count>0);var r=Oe(),a=ne(r);{var s=i=>{var u=qr(),S=c(u),h=_(S,2),T=c(h,!0);o(h),o(u),re(()=>{Le(u,"title",`魔力カウンター: ${e.count??""}`),Le(S,"src",Br),te(T,e.count)}),I(i,u)};Y(a,i=>{d(t)&&i(s)})}I(n,r)}var Wr=(n,e,t)=>e(d(t)),Yr=O("<button> </button>"),Kr=O('<div class="absolute -bottom-14 left-0 right-0 flex justify-center gap-2 z-10"><!> <button class="btn btn-sm preset-tonal-warning">キャンセル</button></div>'),Xr=O('<div class="relative"><div class="transition-transform duration-300 hover:scale-105"><!> <!></div> <!></div>');function Be(n,e){pe(e,!0);let t=he(e,"size",3,"medium"),r=he(e,"showDetailOnClick",3,!0),a=he(e,"faceDown",3,!1),s=he(e,"rotation",3,0),i=he(e,"spellCounterCount",3,0);function u(){e.onSelect(e.card,e.instanceId)}function S(f){f.onClick(e.card,e.instanceId)}function h(f,y){const P=f||"filled",N=y||"primary";return{filled:{primary:"preset-filled-primary-500",secondary:"preset-filled-secondary-500",tertiary:"preset-filled-tertiary-500",success:"preset-filled-success-500",warning:"preset-filled-warning-500",error:"preset-filled-error-500",surface:"preset-filled-surface-500"},tonal:{primary:"preset-tonal-primary",secondary:"preset-tonal-secondary",tertiary:"preset-tonal-tertiary",success:"preset-tonal-success",warning:"preset-tonal-warning",error:"preset-tonal-error",surface:"preset-tonal-surface"},outlined:{primary:"preset-outlined-primary-500",secondary:"preset-outlined-secondary-500",tertiary:"preset-outlined-tertiary-500",success:"preset-outlined-success-500",warning:"preset-outlined-warning-500",error:"preset-outlined-error-500",surface:"preset-outlined-surface-500"}}[P][N]}var T=Xr(),x=c(T),m=c(x);Se(m,{get card(){return e.card},get size(){return t()},get faceDown(){return a()},get rotation(){return s()},clickable:!0,get isSelected(){return e.isSelected},onClick:u,get showDetailOnClick(){return r()},animate:!1});var U=_(m,2);{var F=f=>{Qr(f,{get count(){return i()}})};Y(U,f=>{i()>0&&f(F)})}o(x);var w=_(x,2);{var v=f=>{var y=Kr(),P=c(y);Te(P,17,()=>e.actionButtons,R=>R.label,(R,Z)=>{var C=Yr();C.__click=[Wr,S,Z];var l=c(C,!0);o(C),re(A=>{me(C,1,`btn btn-sm ${A??""} ${e.isActivatable?"":"opacity-50 cursor-not-allowed"}`),te(l,d(Z).label)},[()=>h(d(Z).style,d(Z).color)]),I(R,C)});var N=_(P,2);N.__click=function(...R){var Z;(Z=e.onCancel)==null||Z.apply(this,R)},o(y),I(f,y)};Y(w,f=>{e.isSelected&&f(v)})}o(T),I(n,T),Ce()}De(["click"]);function Jr(n,e){e.onOpenChange(!1)}function $r(n,e){ee(e,!d(e))}var ea=O('<div class="relative"><div><!></div> <!></div>'),ta=O('<div class="relative"><div><!></div></div>'),na=O('<div class="flex gap-2 flex-wrap"><!></div>'),ra=O('<div class="text-center py-8"><p class="text-gray-500"> </p></div>'),aa=O('<header class="flex justify-between items-center mb-4"><h2 class="text-2xl sm:text-3xl font-bold mx-2"> </h2> <div class="flex items-center gap-2"><button type="button"><!> <span class="text-xs"> </span></button> <button type="button" class="btn preset-tonal rounded-full"><!></button></div></header> <div class="text-sm text-surface-600-300-token mb-2"> </div> <!>',1);function sn(n,e){pe(e,!0);let t=he(e,"emptyMessage",3,"カードがありません"),r=he(e,"borderColor",3,"border-gray-400");const a=e.cards.slice().reverse();let s=Ie(!1);const i=()=>{const S=new Map;return a.forEach(h=>{const T=S.get(h.id);T?T.quantity+=1:S.set(h.id,{card:h,quantity:1})}),Array.from(S.values())};function u(S){e.onOpenChange(S.open)}Ke(n,{get open(){return e.open},onOpenChange:u,contentBase:"card bg-surface-100-900 p-6 mx-auto space-y-4 shadow-xl w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto",backdropClasses:"backdrop-blur-sm",content:h=>{var T=aa(),x=ne(T),m=c(x),U=c(m,!0);o(m);var F=_(m,2),w=c(F);w.__click=[$r,s];var v=c(w);const f=k(()=>d(s)?"mdi:card-multiple":"mdi:cards");Ot(v,{get icon(){return d(f)},class:"size-4"});var y=_(v,2),P=c(y,!0);o(y),o(w);var N=_(w,2);N.__click=[Jr,e];var R=c(N);Ot(R,{icon:"mdi:close",class:"size-4"}),o(N),o(F),o(x);var Z=_(x,2),C=c(Z);o(Z);var l=_(Z,2);{var A=H=>{var W=na(),D=c(W);{var M=L=>{var G=Oe(),J=ne(G);Te(J,17,i,({card:Q,quantity:$})=>Q.id,(Q,$)=>{let oe=()=>d($).card,ce=()=>d($).quantity;var le=ea(),ue=c(le),we=c(ue);Se(we,{get card(){return oe()},size:"medium",showDetailOnClick:!0}),o(ue);var Ze=_(ue,2);{var ye=fe=>{Ve(fe,{get count(){return ce()},colorClasses:"bg-primary-200 text-primary-900"})};Y(Ze,fe=>{ce()>1&&fe(ye)})}o(le),re(()=>me(ue,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),I(Q,le)}),I(L,G)},B=L=>{var G=Oe(),J=ne(G);Te(J,17,()=>a,An,(Q,$)=>{var oe=ta(),ce=c(oe),le=c(ce);Se(le,{get card(){return d($)},size:"medium",showDetailOnClick:!0}),o(ce),o(oe),re(()=>me(ce,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),I(Q,oe)}),I(L,G)};Y(D,L=>{d(s)?L(M):L(B,!1)})}o(W),I(H,W)},q=H=>{var W=ra(),D=c(W),M=c(D,!0);o(D),o(W),re(()=>te(M,t())),I(H,W)};Y(l,H=>{e.cards.length>0?H(A):H(q,!1)})}re(()=>{te(U,e.title),me(w,1,`btn btn-sm ${d(s)?"preset-filled-primary-500":"preset-tonal"}`),Le(w,"title",d(s)?"個別表示に切り替え":"集約表示に切り替え"),te(P,d(s)?"集約":"個別"),te(C,`${e.cards.length??""}枚`)}),I(h,T)},$$slots:{content:!0}}),Ce()}De(["click"]);var sa=(n,e)=>n.key==="Enter"&&e(),ia=O('<div class="absolute inset-1"><!></div> <!>',1),oa=O('<div class="h-full flex items-center justify-center p-1 relative" style="filter: grayscale(0.8) brightness(0.7) contrast(1.2);"><img alt="墓地" class="w-full h-full object-cover opacity-30 rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-surface-600-300-token text-center select-none drop-shadow-lg"> </span></div></div> <!>',1),ca=O('<div role="button" tabindex="0"><!></div> <!>',1);function da(n,e){pe(e,!0);const t=Qe();let r=he(e,"size",3,"medium"),a=Ie(!1);const s=k(()=>e.cards.length>0?e.cards[e.cards.length-1]:null);function i(){ee(a,!0)}function u(f){ee(a,f,!0)}let S=Ie(!1);function h(){ee(S,!0)}function T(){ee(S,!1)}var x=ca(),m=ne(x);m.__click=i,m.__keydown=[sa,i];var U=c(m);{var F=f=>{var y=ia(),P=ne(y),N=c(P);Se(N,{get card(){return d(s)},get size(){return r()},clickable:!1}),o(P);var R=_(P,2);Ve(R,{get count(){return e.cards.length}}),I(f,y)},w=f=>{var y=oa(),P=ne(y),N=c(P),R=_(N,2),Z=c(R),C=c(Z,!0);o(Z),o(R),o(P);var l=_(P,2);Ve(l,{get count(){return e.cards.length}}),re(()=>{Le(N,"src",vt),te(C,t?"GY":"墓地")}),I(f,y)};Y(U,f=>{d(s)?f(F):f(w,!1)})}o(m);var v=_(m,2);sn(v,{get cards(){return e.cards},get open(){return d(a)},onOpenChange:u,title:"墓地",borderColor:"border-gray-400"}),re(()=>me(m,1,`
    ${ft[r()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    hover:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700
    ${d(S)?"scale-105 shadow-lg":""}
  `)),qe("mouseenter",m,h),qe("mouseleave",m,T),I(n,x),Ce()}De(["click","keydown"]);var la=(n,e)=>n.key==="Enter"&&e(),ua=O('<div role="button" tabindex="0"><div class="h-full flex items-center justify-center p-1 relative"><img alt="EXデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">EX</span></div></div> <!></div> <!>',1);function fa(n,e){pe(e,!0);let t=he(e,"size",3,"medium"),r=Ie(!1);function a(){ee(r,!0)}function s(w){ee(r,w,!0)}let i=Ie(!1);function u(){ee(i,!0)}function S(){ee(i,!1)}var h=ua(),T=ne(h);T.__click=a,T.__keydown=[la,a];var x=c(T),m=c(x);Lt(2),o(x);var U=_(x,2);Ve(U,{get count(){return e.cards.length}}),o(T);var F=_(T,2);sn(F,{get cards(){return e.cards},get open(){return d(r)},onOpenChange:s,title:"EXデッキ",borderColor:"border-purple-400"}),re(()=>{me(T,1,`
    ${ft[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    ${d(i)?"scale-105 shadow-lg":""}
  `),Le(m,"src",vt)}),qe("mouseenter",T,u),qe("mouseleave",T,S),I(n,h),Ce()}De(["click","keydown"]);var va=O('<div role="img"><div class="h-full flex items-center justify-center p-1 relative"><img alt="メインデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">Deck</span></div></div> <!></div>');function ma(n,e){pe(e,!0);let t=he(e,"size",3,"medium");var r=va(),a=c(r),s=c(a);Lt(2),o(a);var i=_(a,2);Ve(i,{get count(){return e.cardCount}}),o(r),re(()=>{me(r,1,`
    ${ft[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
  `),Le(s,"src",vt)}),I(n,r),Ce()}var _a=O('<div class="relative"><div style="filter: sepia(0.3) hue-rotate(90deg) saturate(1.5) brightness(0.9);"><!></div></div>'),ga=O('<div class="flex justify-center"><!></div>'),pa=O('<div class="relative"><div style="filter: sepia(0.5) hue-rotate(30deg) saturate(1.8) brightness(0.85);"><!></div></div>'),Ca=O('<div class="flex justify-center"><!></div>'),ha=O('<div class="relative"><div style="filter: sepia(0.4) hue-rotate(200deg) saturate(2) brightness(0.8);"><!></div></div>'),Sa=O('<div class="flex justify-center"><!></div>'),Ia=O('<div class="flex justify-center"><!></div>'),Ta=O('<div class="flex justify-center"><!></div>'),ya=O('<div class="flex justify-center"><!></div>'),Aa=O('<div class="grid grid-cols-4 gap-1 mb-2"><!> <!> <!> <!></div> <div class="grid grid-cols-5 gap-1 mb-2"></div> <div class="grid grid-cols-5 gap-1 mb-2"></div>',1),ba=O('<div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div> <div class="grid grid-cols-7 gap-2 mb-4"><!> <!> <!></div>',1),Oa=O('<div class="card p-2 max-w-6xl mx-auto"><div class="transition-all duration-300"><!></div></div>');function xa(n,e){pe(e,!0);const t=(C,l=st)=>{var A=ga(),q=c(A);{var H=D=>{const M=k(()=>e.selectedFieldCardInstanceId===e.fieldCards[0].instanceId),B=k(()=>v(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown).length>0),L=k(()=>v(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown)),G=k(()=>e.onCancelFieldCardSelection||(()=>{}));Be(D,{get card(){return e.fieldCards[0].card},get instanceId(){return e.fieldCards[0].instanceId},get faceDown(){return e.fieldCards[0].faceDown},get isSelected(){return d(M)},get isActivatable(){return d(B)},onSelect:m,get actionButtons(){return d(L)},get onCancel(){return d(G)},get size(){return x},showDetailOnClick:!0})},W=D=>{var M=_a(),B=c(M),L=c(B);Se(L,{placeholder:!0,get placeholderText(){return l()},get size(){return x}}),o(B),o(M),I(D,M)};Y(q,D=>{e.fieldCards.length>0?D(H):D(W,!1)})}o(A),I(C,A)},r=(C,l=st)=>{var A=Ca(),q=c(A);{var H=D=>{const M=k(()=>e.monsterCards[l()].rotation||0),B=k(()=>e.selectedFieldCardInstanceId===e.monsterCards[l()].instanceId),L=k(()=>f(e.monsterCards[l()].instanceId).length>0),G=k(()=>f(e.monsterCards[l()].instanceId)),J=k(()=>e.onCancelFieldCardSelection||(()=>{})),Q=k(()=>e.monsterCards[l()].spellCounterCount||0);Be(D,{get card(){return e.monsterCards[l()].card},get instanceId(){return e.monsterCards[l()].instanceId},get faceDown(){return e.monsterCards[l()].faceDown},get rotation(){return d(M)},get isSelected(){return d(B)},get isActivatable(){return d(L)},onSelect:m,get actionButtons(){return d(G)},get onCancel(){return d(J)},get size(){return x},showDetailOnClick:!0,get spellCounterCount(){return d(Q)}})},W=D=>{var M=pa(),B=c(M),L=c(B);const G=k(()=>l()+1);Se(L,{placeholder:!0,get placeholderText(){return`M${d(G)??""}`},get size(){return x}}),o(B),o(M),I(D,M)};Y(q,D=>{e.monsterCards[l()]?D(H):D(W,!1)})}o(A),I(C,A)},a=(C,l=st)=>{var A=Sa(),q=c(A);{var H=D=>{var M=Oe(),B=ne(M);{var L=J=>{const Q=k(()=>e.selectedFieldCardInstanceId===e.spellTrapCards[l()].instanceId),$=k(()=>w(e.spellTrapCards[l()].instanceId).length>0),oe=k(()=>w(e.spellTrapCards[l()].instanceId)),ce=k(()=>e.onCancelFieldCardSelection||(()=>{}));Be(J,{get card(){return e.spellTrapCards[l()].card},get instanceId(){return e.spellTrapCards[l()].instanceId},faceDown:!0,get isSelected(){return d(Q)},get isActivatable(){return d($)},onSelect:m,get actionButtons(){return d(oe)},get onCancel(){return d(ce)},get size(){return x},showDetailOnClick:!0})},G=J=>{Se(J,{get card(){return e.spellTrapCards[l()].card},faceDown:!1,get size(){return x},clickable:!0,showDetailOnClick:!0,onClick:()=>e.spellTrapCards[l()]&&m(e.spellTrapCards[l()].card,e.spellTrapCards[l()].instanceId)})};Y(B,J=>{e.spellTrapCards[l()].faceDown?J(L):J(G,!1)})}I(D,M)},W=D=>{var M=ha(),B=c(M),L=c(B);const G=k(()=>l()+1);Se(L,{placeholder:!0,get placeholderText(){return`S${d(G)??""}`},get size(){return x}}),o(B),o(M),I(D,M)};Y(q,D=>{e.spellTrapCards[l()]?D(H):D(W,!1)})}o(A),I(C,A)},s=C=>{var l=Ia(),A=c(l);da(A,{get cards(){return e.graveyardCards},get size(){return x}}),o(l),I(C,l)},i=C=>{var l=Ta(),A=c(l);fa(A,{get cards(){return e.extraDeckCards},get size(){return x}}),o(l),I(C,l)},u=C=>{var l=ya(),A=c(l);ma(A,{get cardCount(){return e.deckCards},get size(){return x}}),o(l),I(C,l)},h=[...Array(5).keys()],T=Qe(),x=T?"small":"medium";function m(C,l){e.onFieldCardClick&&e.onFieldCardClick(C,l)}function U(C){return se.canActivateSpell(C)}function F(C){return se.canActivateIgnitionEffect(C)}function w(C){return U(C)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]}function v(C,l){return l?U(C)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]:F(C)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}function f(C){return F(C)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}var y=Oa(),P=c(y),N=c(P);{var R=C=>{var l=Aa(),A=ne(l),q=c(A);t(q,()=>"F");var H=_(q,2);i(H);var W=_(H,2);u(W);var D=_(W,2);s(D),o(A);var M=_(A,2);Te(M,20,()=>h,L=>L,(L,G)=>{r(L,()=>G)}),o(M);var B=_(M,2);Te(B,20,()=>h,L=>L,(L,G)=>{a(L,()=>G)}),o(B),I(C,l)},Z=C=>{var l=ba(),A=ne(l),q=c(A);t(q,()=>"フィールド");var H=_(q,2);Te(H,16,()=>h,G=>G,(G,J)=>{r(G,()=>J)});var W=_(H,2);s(W),o(A);var D=_(A,2),M=c(D);i(M);var B=_(M,2);Te(B,16,()=>h,G=>G,(G,J)=>{a(G,()=>J)});var L=_(B,2);u(L),o(D),I(C,l)};Y(N,C=>{T?C(R):C(Z,!1)})}o(P),o(y),I(n,y),Ce()}var Ea=O('<div class="text-center text-sm opacity-50">No cards in hand</div>'),Na=O("<div></div>");function ka(n,e){pe(e,!0);const t=Qe()?"small":"medium";function r(v){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canActivateSpell(v)}function a(v){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSummonMonster(v)}function s(v){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSetMonster(v)}function i(v){return e.isGameOver||e.currentPhase!=="Main1"?!1:se.canSetSpellTrap(v)}function u(v){const f={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10"};if(v<=0)return"grid-cols-1";if(Qe()){if(v>=5)return"grid-cols-5"}else if(v>=10)return"grid-cols-10";return f[v]}function S(v,f){const y=e.selectedHandCardInstanceId===f?null:f;e.onHandCardSelect(y)}function h(v,f){e.onCardClick(v,f),e.onHandCardSelect(null)}function T(v,f){e.onSummonMonster(v,f),e.onHandCardSelect(null)}function x(v,f){e.onSetMonster(v,f),e.onHandCardSelect(null)}function m(v,f){e.onSetSpellTrap(v,f),e.onHandCardSelect(null)}function U(){e.onHandCardSelect(null)}function F(v,f){const y=[];return v.type==="monster"?(a(f)&&y.push({label:"召喚",style:"filled",color:"primary",onClick:T}),s(f)&&y.push({label:"セット",style:"filled",color:"primary",onClick:x})):(v.type==="spell"||v.type==="trap")&&(r(f)&&y.push({label:"発動",style:"filled",color:"primary",onClick:h}),i(f)&&y.push({label:"セット",style:"filled",color:"primary",onClick:m})),y}var w=Na();Te(w,21,()=>e.cards,({card:v,instanceId:f})=>f,(v,f)=>{let y=()=>d(f).card,P=()=>d(f).instanceId;var N=Oe(),R=ne(N);{var Z=l=>{const A=k(()=>e.selectedHandCardInstanceId===P()),q=k(()=>F(y(),P()).length>0),H=k(()=>F(y(),P()));Be(l,{get card(){return y()},get instanceId(){return P()},get isSelected(){return d(A)},get isActivatable(){return d(q)},onSelect:S,get actionButtons(){return d(H)},onCancel:U,get size(){return t}})},C=l=>{Se(l,{placeholder:!0,placeholderText:"...",get size(){return t}})};Y(R,l=>{y()?l(Z):l(C,!1)})}I(v,N)},v=>{var f=Ea();I(v,f)}),o(w),re(v=>me(w,1,`grid ${v??""} gap-2 mb-16`),[()=>u(e.handCardCount)]),I(n,w),Ce()}function Da(n,e){var t;(t=e.config)==null||t.onConfirm()}var wa=O('<button class="btn variant-ghost">キャンセル</button>'),Ra=O('<header class="text-center"><h2 class="h3 font-bold text-primary-600-300-token"> </h2></header> <article class="text-center"><p class="text-lg"> </p></article> <footer class="flex justify-center gap-3"><!> <button class="btn variant-filled-primary">OK</button></footer>',1);function Ma(n,e){pe(e,!0);const t=k(()=>{var s;return((s=e.config)==null?void 0:s.cancelable)??!1});function r(){var s,i;(i=(s=e.config)==null?void 0:s.onCancel)==null||i.call(s)}function a(s){!s.open&&e.isOpen&&d(t)&&r()}Ke(n,{get open(){return e.isOpen},onOpenChange:a,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-md shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return d(t)},preventScroll:!0,content:i=>{var u=Oe(),S=ne(u);{var h=T=>{var x=Ra(),m=ne(x),U=c(m),F=c(U,!0);o(U),o(m);var w=_(m,2),v=c(w),f=c(v,!0);o(v),o(w);var y=_(w,2),P=c(y);{var N=Z=>{var C=wa();C.__click=r,I(Z,C)};Y(P,Z=>{d(t)&&Z(N)})}var R=_(P,2);R.__click=[Da,e],o(y),re(()=>{te(F,e.config.summary),te(f,e.config.description)}),I(T,x)};Y(S,T=>{e.config&&T(h)})}I(i,u)},$$slots:{content:!0}}),Ce()}De(["click"]);function Pa(n,e,t,r){!e.config||!d(t)()||e.config.onConfirm(Array.from(d(r)))}var La=O('<button class="btn btn-sm btn-circle btn-ghost">✕</button>'),za=O("<div><!></div>"),Fa=O('<button class="btn btn-ghost">キャンセル</button>'),Za=O('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg"> </h3> <!></div> <p class="text-sm text-surface-600-300-token mb-4"> </p> <div class="flex justify-between items-center mb-4 p-3 bg-surface-200 dark:bg-surface-800 rounded-lg border border-surface-300 dark:border-surface-600"><span class="text-sm font-semibold"> </span></div> <div class="min-h-[200px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><!> <button class="btn btn-primary">確定</button></div>',1);function Ga(n,e){pe(e,!0);let t=Ie(In(new Set));dt(()=>{e.isOpen&&ee(t,new Set,!0)});const r=k(()=>d(t).size),a=k(()=>{var m;return((m=e.config)==null?void 0:m.cancelable)??!1}),s=k(()=>()=>e.config?d(r)>=e.config.minCards&&d(r)<=e.config.maxCards:!1);function i(m){return d(t).has(m)}function u(m){return e.config?d(t).has(m)?!0:d(t).size<e.config.maxCards:!1}function S(m){!m.open&&e.isOpen&&d(a)&&T()}function h(m){if(!e.config||!e.config.availableCards.some(v=>v.instanceId===m))return;const F=u(m),w=i(m);if(F||w){const v=new Set(d(t));w?v.delete(m):v.add(m),ee(t,v,!0)}}function T(){var m,U;(U=(m=e.config)==null?void 0:m.onCancel)==null||U.call(m)}function x(m){var F;const U=(F=e.config)==null?void 0:F.availableCards.find(w=>w.instanceId===m);if(U)return Pe(U.id)}Ke(n,{get open(){return e.isOpen},onOpenChange:S,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 w-[95vw] md:max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return d(a)},preventScroll:!0,content:U=>{var F=Oe(),w=ne(F);{var v=f=>{var y=Za(),P=ne(y),N=c(P),R=c(N,!0);o(N);var Z=_(N,2);{var C=Q=>{var $=La();$.__click=T,I(Q,$)};Y(Z,Q=>{d(a)&&Q(C)})}o(P);var l=_(P,2),A=c(l,!0);o(l);var q=_(l,2),H=c(q),W=c(H);o(H),o(q);var D=_(q,2),M=c(D);Te(M,21,()=>e.config.availableCards,Q=>Q.instanceId,(Q,$)=>{var oe=Oe();const ce=k(()=>i(d($).instanceId)),le=k(()=>u(d($).instanceId)),ue=k(()=>x(d($).instanceId));var we=ne(oe);{var Ze=ye=>{var fe=za();let Re;var Ue=c(fe);Se(Ue,{get card(){return d(ue)},size:"small",clickable:!0,selectable:!1,get isSelected(){return d(ce)},animate:!0,onClick:()=>h(d($).instanceId)}),o(fe),re(tt=>Re=me(fe,1,"",null,Re,tt),[()=>({"opacity-50":!d(le)&&!d(ce)})]),I(ye,fe)};Y(we,ye=>{d(ue)&&ye(Ze)})}I(Q,oe)}),o(M),o(D);var B=_(D,2),L=c(B);{var G=Q=>{var $=Fa();$.__click=T,I(Q,$)};Y(L,Q=>{d(a)&&Q(G)})}var J=_(L,2);J.__click=[Pa,e,s,t],o(B),re(Q=>{te(R,e.config.summary),te(A,e.config.description),te(W,`選択中: ${d(r)??""} / ${e.config.maxCards??""}枚`),J.disabled=Q},[()=>!d(s)()]),I(f,y)};Y(w,f=>{e.config&&f(v)})}I(U,F)},$$slots:{content:!0}}),Ce()}De(["click"]);var Va=O('<span class="text-warning-600 dark:text-warning-400">Draw</span>'),Ua=O("Winner: <span> </span>",1),Ha=O('<p class="text-2xl font-bold"><!></p>'),ja=O('<p class="text-base opacity-75"><span class="font-semibold">Reason:</span> </p>'),Ba=O('<p class="text-base"> </p>'),qa=O('<header class="text-center"><h2>Game Over!</h2></header> <article class="space-y-4 text-center"><!> <!> <!></article> <footer class="flex justify-center"><button class="btn variant-filled-primary">閉じる</button></footer>',1);function Qa(n,e){pe(e,!0);function t(){e.onClose()}function r(i){i.open||t()}function a(){return e.winner==="player"?"border-success-500":e.winner==="opponent"?"border-error-500":e.winner==="draw"?"border-warning-500":"border-surface-500"}const s=k(a);Ke(n,{get open(){return e.isOpen},onOpenChange:r,get contentBase(){return`card bg-surface-50 dark:bg-surface-900 p-8 space-y-6 max-w-lg shadow-2xl border-4 ${d(s)??""}`},backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!0,preventScroll:!0,content:u=>{var S=qa(),h=ne(S),T=c(h);o(h);var x=_(h,2),m=c(x);{var U=N=>{var R=Ha(),Z=c(R);{var C=A=>{var q=Va();I(A,q)},l=A=>{var q=Ua(),H=_(ne(q)),W=c(H,!0);o(H),re(()=>{me(H,1,bn(e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400")),te(W,e.winner==="player"?"You":"Opponent")}),I(A,q)};Y(Z,A=>{e.winner==="draw"?A(C):A(l,!1)})}o(R),I(N,R)};Y(m,N=>{e.winner&&N(U)})}var F=_(m,2);{var w=N=>{var R=ja(),Z=_(c(R));o(R),re(()=>te(Z,` ${e.reason??""}`)),I(N,R)};Y(F,N=>{e.reason&&N(w)})}var v=_(F,2);{var f=N=>{var R=Ba(),Z=c(R,!0);o(R),re(()=>te(Z,e.message)),I(N,R)};Y(v,N=>{e.message&&N(f)})}o(x);var y=_(x,2),P=c(y);P.__click=t,o(y),re(()=>me(T,1,`h2 font-bold ${e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400"}`)),I(u,S)},$$slots:{content:!0}}),Ce()}De(["click"]);var Wa=O('<div class="container mx-auto p-4"><main class="max-w-4xl mx-auto space-y-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card px-4"><h1 class="text-2xl font-bold"> </h1></div> <div class="card px-4 space-y-4"><div class="space-y-2"><div class="flex justify-start space-x-4"><span>Now:</span> <span class="font-bold" data-testid="current-phase"> </span></div> <div class="flex justify-between"><span>自分 LP:</span> <span class="font-bold text-success-500"> </span> <span>相手 LP:</span> <span class="font-bold text-error-500"> </span></div></div></div></div> <!> <div class="card px-4 space-y-4"><h2 class="text-xl font-bold"> </h2> <!></div> <details class="card p-4"><summary class="cursor-pointer font-bold">Debug Info</summary> <div class="mt-4 space-y-4"><pre class="text-xs overflow-auto"> </pre></div></details></main></div> <!> <!> <!>',1);function os(n,e){pe(e,!0);const[t,r]=yn(),a=()=>ve(zr,"$currentTurn",t),s=()=>ve(Lr,"$currentPhase",t),i=()=>ve(Ur,"$gameResult",t),u=()=>ve(Hr,"$handCardInstances",t),S=()=>ve(jr,"$graveyardCardInstances",t),h=()=>ve(X,"$gameStateStore",t),T=()=>ve(Fr,"$playerLP",t),x=()=>ve(Zr,"$opponentLP",t),m=()=>ve(Vr,"$deckCardCount",t),U=()=>ve(Gr,"$handCardCount",t),F=()=>ve(M,"$effectQueueState",t);Tn(async()=>{await Sn(e.data.uniqueCardIds),ke.registerNotificationHandler({showInfo:(z,E)=>{Ne(E)},showInteractive:()=>{}})});async function w(){for(let z=0;z<2;z++){await new Promise(b=>setTimeout(b,300));const E=se.advancePhase();if(E.success)console.log(`[Simulator] ${E.message}`),E.message&&Ne(E.message);else{be(E.error||"フェーズ移行に失敗しました");break}}}let v=Ie(!1);dt(()=>{a()===1&&s()==="Draw"&&!d(v)&&!i().isGameOver&&(w(),ee(v,!0))});let f=Ie(!1);dt(()=>{i().isGameOver&&ee(f,!0)});function y(){if(i().isGameOver)return"ゲーム終了";function z(E){return{Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ1",End:"エンドフェイズ"}[E]||E}return z(s())}function P(z,E){const b=se.activateSpell(E);b.success||be(b.error||"発動に失敗しました")}function N(z,E){const b=se.summonMonster(E);b.success?Ne(b.message||`${z.name}を召喚しました`):be(b.error||"召喚に失敗しました")}function R(z,E){const b=se.setMonster(E);b.success?Ne(`${z.name}をセットしました`):be(b.error||"セットに失敗しました")}function Z(z,E){const b=se.setSpellTrap(E);b.success?Ne(`${z.name}をセットしました`):be(b.error||"セットに失敗しました")}let C=Ie(null),l=Ie(null);function A(z){ee(C,z,!0),ee(l,null)}function q(z,E){const b=se.getGameState();if(![...b.zones.mainMonsterZone,...b.zones.spellTrapZone,...b.zones.fieldZone].find(_n=>_n.instanceId===E)){be("Card not found on field");return}ee(C,null),ee(l,d(l)===E?null:E,!0)}function H(z,E){const b=se.activateSpell(E);b.success?Ne(b.message||`${z.name}を発動しました`):be(b.error||"発動に失敗しました"),ee(l,null)}function W(z,E){const b=se.activateIgnitionEffect(E);b.success?Ne(b.message||`${z.name}の効果を発動しました`):be(b.error||"効果発動に失敗しました"),ee(l,null)}function D(){ee(l,null)}const M=ke,B=k(()=>u().map(z=>({card:Pe(z.id),instanceId:z.instanceId}))),L=k(()=>S().map(z=>Pe(z.id)).filter(z=>z!==void 0)),G=k(()=>h().zones.fieldZone.map(E=>{const b=Pe(E.id);return b?{card:b,instanceId:E.instanceId,faceDown:E.position==="faceDown"}:null}).filter(E=>E!==null)),J=k(()=>{const z=h().zones.mainMonsterZone,E=Array(5).fill(null);return z.forEach((b,Ae)=>{if(Ae<5){const Me=Pe(b.id);Me&&(E[Ae]={card:Me,instanceId:b.instanceId,faceDown:b.position==="faceDown",rotation:b.battlePosition==="defense"?270:0,spellCounterCount:et(b.counters,"spell")})}}),E}),Q=k(()=>{const z=h().zones.spellTrapZone,E=Array(5).fill(null);return z.forEach((b,Ae)=>{if(Ae<5){const Me=Pe(b.id);Me&&(E[Ae]={card:Me,instanceId:b.instanceId,faceDown:b.position==="faceDown"})}}),E});var $=Wa(),oe=ne($),ce=c(oe),le=c(ce),ue=c(le),we=c(ue),Ze=c(we);o(we),o(ue);var ye=_(ue,2),fe=c(ye),Re=c(fe),Ue=_(c(Re),2),tt=c(Ue,!0);o(Ue),o(Re);var pt=_(Re,2),nt=_(c(pt),2),on=c(nt,!0);o(nt);var Ct=_(nt,4),cn=c(Ct,!0);o(Ct),o(pt),o(fe),o(ye),o(le);var ht=_(le,2);xa(ht,{get deckCards(){return m()},extraDeckCards:[],get graveyardCards(){return d(L)},get fieldCards(){return d(G)},get monsterCards(){return d(J)},get spellTrapCards(){return d(Q)},get selectedFieldCardInstanceId(){return d(l)},onFieldCardClick:q,onActivateSetSpell:H,onActivateIgnitionEffect:W,onCancelFieldCardSelection:D});var rt=_(ht,2),at=c(rt),dn=c(at);o(at);var ln=_(at,2);ka(ln,{get cards(){return d(B)},get handCardCount(){return U()},get currentPhase(){return s()},get isGameOver(){return i().isGameOver},get selectedHandCardInstanceId(){return d(C)},onCardClick:P,onSummonMonster:N,onSetMonster:R,onSetSpellTrap:Z,onHandCardSelect:A}),o(rt);var St=_(rt,2),It=_(c(St),2),Tt=c(It),un=c(Tt,!0);o(Tt),o(It),o(St),o(ce),o(oe);var yt=_(oe,2);const fn=k(()=>F().confirmationConfig!==null);Ma(yt,{get isOpen(){return d(fn)},get config(){return F().confirmationConfig}});var At=_(yt,2);const vn=k(()=>F().cardSelectionConfig!==null);Ga(At,{get isOpen(){return d(vn)},get config(){return F().cardSelectionConfig}});var mn=_(At,2);Qa(mn,{get isOpen(){return d(f)},get winner(){return i().winner},get reason(){return i().reason},get message(){return i().message},onClose:()=>{ee(f,!1)}}),re((z,E,b,Ae)=>{te(Ze,`Deck: ${e.data.deckName??""}`),te(tt,z),te(on,E),te(cn,b),te(dn,`手札 (${U()??""} 枚)`),te(un,Ae)},[y,()=>T().toLocaleString(),()=>x().toLocaleString(),()=>JSON.stringify(se.getGameState(),null,2)]),I(n,$),Ce(),r()}export{os as component,is as universal};
