var mn=Object.defineProperty;var _n=(n,e,t)=>e in n?mn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Z=(n,e,t)=>_n(n,typeof e!="symbol"?e+"":e,t);import{b as gn,d as At,l as pn,C as Se,a as Ve,e as lt,f as ut,g as Pe,i as Cn}from"../chunks/B-cDhI6h.js";import{w as Mt,g as He,d as ie}from"../chunks/p-YwO3gO.js";import{c as be,a as T,f as k}from"../chunks/CgSDkuZB.js";import{k as ne,q as c,y as x,v as d,u as C,x as o,t as J,j as ge,l as pe,ar as Ie,m as K,as as ft,V as hn,C as ct,o as Sn}from"../chunks/CgkWd3LX.js";import{s as X,d as we,e as qe}from"../chunks/B6G87KeO.js";import{p as he,a as In,s as fe}from"../chunks/Bnfstjk6.js";import{M as Ye,I as Ot,x as Ne,y as Oe}from"../chunks/B-gl88S7.js";import{i as Q}from"../chunks/BqI-dyKf.js";import{e as De,a as Tn}from"../chunks/DJ7gRJea.js";import{b as Le,s as ve,c as yn}from"../chunks/Ck95-kkn.js";const An=(n,e)=>({...n,...e}),Pt=n=>n.type==="monster",Lt=n=>n.type==="spell",Qe=n=>n.type==="spell"&&n.spellType==="field",On=n=>n.type==="trap",ot=n=>n.position==="faceUp",bn=n=>n.position==="faceDown";function xn(n){const e=[...n];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}function re(n,e){return[...n.deck,...n.hand,...n.mainMonsterZone,...n.spellTrapZone,...n.fieldZone,...n.graveyard,...n.banished].find(r=>r.instanceId===e)}function me(n,e,t,r){const a=e.location,s=n[a],i=s.findIndex(_=>_.instanceId===e.instanceId),l={...e,...r,location:t};return{...n,[a]:[...s.slice(0,i),...s.slice(i+1)],[t]:[...n[t],l]}}function vt(n,e,t){const r=e.location,a=n[r];return{...n,[r]:a.map(s=>s.instanceId===e.instanceId?An(s,t):s)}}function mt(n,e=1){if(n.deck.length<e)throw new Error(`Cannot draw ${e} cards. Only ${n.deck.length} cards remaining in deck.`);let t=n;for(let r=0;r<e;r++){const a=t.deck[t.deck.length-1];t=me(t,a,"hand")}return t}function Ke(n){return{...n,deck:xn(n.deck)}}const zt=(n,e)=>e.location==="hand"?n.hand.filter(t=>t.instanceId!==e.instanceId).length:n.hand.length,En=(n,e=5)=>n.mainMonsterZone.length>=e,Nn=(n,e=5)=>n.spellTrapZone.length>=e,kn=(n,e=1)=>n.fieldZone.length>=e,bt=8e3;function Ft(n,e){const r={deck:n.mainDeckCardIds.map((s,i)=>({...gn(s),instanceId:`deck-${i}`,location:"deck",placedThisTurn:!1,counters:[]})),hand:[],mainMonsterZone:[],spellTrapZone:[],fieldZone:[],graveyard:[],banished:[]};let a=e!=null&&e.skipShuffle?r:Ke(r);return e!=null&&e.skipInitialDraw||(a=mt(a,5)),{zones:a,lp:{player:bt,opponent:bt},phase:"Draw",turn:1,result:{isGameOver:!1},normalSummonLimit:1,normalSummonUsed:0,activatedIgnitionEffectsThisTurn:new Set,activatedOncePerTurnCards:new Set,pendingEndPhaseEffects:[],damageNegation:!1}}const Ge=class Ge{constructor(){Z(this,"isEffect",!1);Z(this,"category","VictoryCondition")}canApply(e){const t=e.zones.hand.map(r=>r.id);return Ge.EXODIA_PIECE_IDS.every(r=>t.includes(r))}checkPermission(e){return!0}static getExodiaPieceIds(){return Ge.EXODIA_PIECE_IDS}};Z(Ge,"EXODIA_PIECE_IDS",[33396948,7902349,70903634,8124921,44519536]);let dt=Ge;function Zt(n){const e=new dt;return e.canApply(n,{})&&e.checkPermission(n,{})?{isGameOver:!0,winner:"player",reason:"exodia",message:"5つのエクゾディアパーツが手札に揃いました。勝利です！"}:n.lp.player<=0?{isGameOver:!0,winner:"opponent",reason:"lp0",message:"ライフポイントが0になりました。敗北です。"}:n.lp.opponent<=0?{isGameOver:!0,winner:"player",reason:"lp0",message:"相手のライフポイントが0になりました。勝利です！"}:{isGameOver:!1}}function Gt(){return Ft({mainDeckCardIds:[]},{skipShuffle:!0,skipInitialDraw:!0})}function xt(n){if(n.result.isGameOver||n.turn===0&&n.phase==="Draw")return n;const e=Zt(n);return e.isGameOver?{...n,result:e}:n}function Dn(){const{subscribe:n,set:e,update:t}=Mt(Gt());return{subscribe:n,set:r=>{e(xt(r))},update:r=>{t(a=>xt(r(a)))}}}const W=Dn();function wn(n){const e=[];n.mainDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)e.push(r.id)});const t=[];return n.extraDeck.forEach(r=>{for(let a=0;a<r.quantity;a++)t.push(r.id)}),{mainDeckCardIds:e,extraDeckCardIds:t}}function Rn(n){const e=wn(n);W.set(Ft(e))}function at(){let n=Gt();return W.subscribe(t=>{n=t})(),n}function Mn(){return{current:{timestamp:0,events:[]},history:[],nextTimestamp:1}}function Pn(n,e){return{...n,current:{...n.current,events:[...n.current.events,e]}}}class We{static register(e,t){const r=this.rules.get(e)||[];this.rules.set(e,[...r,t])}static get(e){return this.rules.get(e)||[]}static getByCategory(e,t){return this.get(e).filter(a=>a.category===t)}static collectActiveRules(e,t){const r=[],a=[...e.zones.spellTrapZone,...e.zones.fieldZone];for(const s of a){if(!ot(s))continue;const i=this.getByCategory(s.id,t);for(const l of i)l.canApply(e)&&r.push(l)}return r}static collectTriggerRules(e,t){var s;const r=[],a=[...e.zones.mainMonsterZone,...e.zones.spellTrapZone,...e.zones.fieldZone];for(const i of a){if(!ot(i))continue;const l=this.getByCategory(i.id,"TriggerRule");for(const _ of l)(s=_.triggers)!=null&&s.includes(t)&&r.push({rule:_,sourceInstance:i})}return r}static collectTriggerSteps(e,t){const r=this.collectTriggerRules(e,t),a=[];for(const{rule:s,sourceInstance:i}of r)if(s.canApply(e)&&s.createTriggerSteps){const l=s.createTriggerSteps(e,i);a.push(...l)}return a}static clear(){this.rules.clear()}static getRegisteredCardIds(){return Array.from(this.rules.keys())}}Z(We,"rules",new Map);function Xe(n,e,t){const r=n.action(e,t);return r.success?(W.set(r.updatedState),{updatedState:r.updatedState,emittedEvents:r.emittedEvents||[]}):{updatedState:e,emittedEvents:[]}}function Ln(n,e,t,r){const a=[];for(const s of n){const i=We.collectTriggerSteps(e,s.type);a.push(...i)}return a.length===0?t:[...t.slice(0,r+1),...a,...t.slice(r+1)]}function zn(n,e){const t=n.currentIndex+1;return t<n.steps.length?(e(r=>({...r,currentIndex:t,currentStep:r.steps[t]})),!0):(Vt(e),!1)}function Vt(n){n(e=>({...e,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}const Fn=async(n,e)=>({shouldContinue:!0,emittedEvents:Xe(n,e).emittedEvents}),Zn=async(n,e,t)=>{const r=Xe(n,e);return t.notification&&t.notification.showInfo(n.summary,n.description),{shouldContinue:!0,delay:300,emittedEvents:r.emittedEvents}},Gn=async(n,e,t,r)=>{const a=n.cardSelectionConfig;let s;if(a.availableCards!==null)s=a.availableCards;else{if(!a._sourceZone)return console.error("_sourceZone must be specified when availableCards is null"),{shouldContinue:!1};const l=e.zones[a._sourceZone];s=a._filter?l.filter((_,g)=>a._filter(_,g)):l}let i=[];return await new Promise(l=>{r(_=>({..._,cardSelectionConfig:{availableCards:s,minCards:a.minCards,maxCards:a.maxCards,summary:a.summary,description:a.description,cancelable:a.cancelable,onConfirm:g=>{i=Xe(n,e,g).emittedEvents,r(b=>({...b,cardSelectionConfig:null})),l()},onCancel:()=>{r(g=>({...g,cardSelectionConfig:null})),l()}}}))}),{shouldContinue:!0,emittedEvents:i}},Vn=async(n,e,t,r)=>{let a=[];return await new Promise(s=>{r(i=>({...i,confirmationConfig:{summary:n.summary,description:n.description,onConfirm:()=>{a=Xe(n,e).emittedEvents,r(_=>({..._,confirmationConfig:null})),s()}}}))}),{shouldContinue:!0,emittedEvents:a}};function Un(n){const e=n.notificationLevel||"info";return e==="silent"?Fn:e==="info"?Zn:n.cardSelectionConfig?Gn:Vn}function Hn(){const{subscribe:n,update:e}=Mt({isActive:!1,currentStep:null,steps:[],currentIndex:-1,notificationHandler:null,confirmationConfig:null,cardSelectionConfig:null,eventTimeline:Mn()});return{subscribe:n,registerNotificationHandler:t=>{e(r=>({...r,notificationHandler:t}))},startProcessing:t=>{e(a=>({...a,isActive:!0,steps:t,currentIndex:0,currentStep:t[0]||null}));const r=t[0];if(r){const a=r.notificationLevel||"info";(a==="info"||a==="silent")&&ke.confirmCurrentStep()}},confirmCurrentStep:async()=>{let t=He(ke);if(!t.currentStep)return;const r=He(W),s=await Un(t.currentStep)(t.currentStep,r,{notification:t.notificationHandler},e);if(s.emittedEvents&&s.emittedEvents.length>0){let i=t.eventTimeline;for(const g of s.emittedEvents)i=Pn(i,g);const l=He(W),_=Ln(s.emittedEvents,l,t.steps,t.currentIndex);e(g=>({...g,steps:_,eventTimeline:i})),t=He(ke)}s.delay&&await new Promise(i=>setTimeout(i,s.delay)),s.shouldContinue?zn(t,e)&&ke.confirmCurrentStep():Vt(e)},cancelProcessing:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))},reset:()=>{e(t=>({...t,isActive:!1,currentStep:null,steps:[],currentIndex:-1}))}}}const ke=Hn(),_e=(n,e,t,r)=>({success:!0,updatedState:n,message:e,effectSteps:t,emittedEvents:r}),xe=(n,e)=>({success:!1,updatedState:n,error:e}),st=["Draw","Standby","Main1","End"],jn={Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ",End:"エンドフェイズ"},Bn=n=>jn[n],je=n=>{const e=st.indexOf(n);return e===-1||e===st.length-1?"End":st[e+1]},qn=(n,e)=>{const t=je(n);return e!==t?{valid:!1,error:`Invalid phase transition: ${n} → ${e}. Expected: ${t}`}:{valid:!0}},ze=n=>n==="Main1",it=n=>n==="End",v={GAME_OVER:"GAME_OVER",NOT_MAIN_PHASE:"NOT_MAIN_PHASE",CARD_NOT_FOUND:"CARD_NOT_FOUND",CARD_NOT_IN_HAND:"CARD_NOT_IN_HAND",CARD_NOT_IN_VALID_LOCATION:"CARD_NOT_IN_VALID_LOCATION",CARD_NOT_ON_FIELD:"CARD_NOT_ON_FIELD",CARD_NOT_FACE_UP:"CARD_NOT_FACE_UP",NOT_SPELL_CARD:"NOT_SPELL_CARD",NOT_SPELL_OR_TRAP_CARD:"NOT_SPELL_OR_TRAP_CARD",NOT_MONSTER_CARD:"NOT_MONSTER_CARD",SPELL_TRAP_ZONE_FULL:"SPELL_TRAP_ZONE_FULL",MONSTER_ZONE_FULL:"MONSTER_ZONE_FULL",INSUFFICIENT_COUNTERS:"INSUFFICIENT_COUNTERS",SUMMON_LIMIT_REACHED:"SUMMON_LIMIT_REACHED",QUICK_PLAY_RESTRICTION:"QUICK_PLAY_RESTRICTION",ACTIVATION_CONDITIONS_NOT_MET:"ACTIVATION_CONDITIONS_NOT_MET",NO_IGNITION_EFFECT:"NO_IGNITION_EFFECT",PHASE_TRANSITION_NOT_ALLOWED:"PHASE_TRANSITION_NOT_ALLOWED"},Qn={GAME_OVER:"ゲームは終了しています",NOT_MAIN_PHASE:"メインフェイズではありません",CARD_NOT_FOUND:"カードが見つかりません",CARD_NOT_IN_HAND:"カードが手札にありません",CARD_NOT_IN_VALID_LOCATION:"カードが有効な場所にありません",CARD_NOT_ON_FIELD:"カードがフィールドにありません",CARD_NOT_FACE_UP:"カードが表側表示ではありません",NOT_SPELL_CARD:"魔法カードではありません",NOT_SPELL_OR_TRAP_CARD:"魔法または罠カードではありません",NOT_MONSTER_CARD:"モンスターカードではありません",SPELL_TRAP_ZONE_FULL:"魔法・罠ゾーンに空きがありません",MONSTER_ZONE_FULL:"モンスターゾーンに空きがありません",INSUFFICIENT_DECK:"デッキのカードが不足しています",INSUFFICIENT_COUNTERS:"カウンターが不足しています",SUMMON_LIMIT_REACHED:"召喚権がありません",QUICK_PLAY_RESTRICTION:"速攻魔法はセットしたターンに発動できません",ACTIVATION_CONDITIONS_NOT_MET:"発動条件を満たしていません",NO_IGNITION_EFFECT:"このカードには起動効果がありません",PHASE_TRANSITION_NOT_ALLOWED:"フェイズ遷移が許可されていません"},P=()=>({isValid:!0}),m=(n,e)=>({isValid:!1,errorCode:n,errorParams:e}),Fe=n=>{if(n.isValid||!n.errorCode)return"";const e=Qn[n.errorCode];return n.errorParams,e};class Wn{constructor(){Z(this,"description");this.description="Advance to next phase"}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);const t=je(e.phase);return qn(e.phase,t).valid?P():m(v.PHASE_TRANSITION_NOT_ALLOWED)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=je(e.phase),a=it(r)&&e.pendingEndPhaseEffects.length>0,s={...e,phase:r,activatedIgnitionEffectsThisTurn:it(r)?new Set:e.activatedIgnitionEffectsThisTurn,activatedOncePerTurnCards:it(r)?new Set:e.activatedOncePerTurnCards,pendingEndPhaseEffects:a?[]:e.pendingEndPhaseEffects};return _e(s,`Advanced to ${Bn(r)}`,a?[...e.pendingEndPhaseEffects]:void 0)}getNextPhase(e){return je(e.phase)}}function Ut(n){return ze(n.phase)?En(n.zones)?m(v.MONSTER_ZONE_FULL):n.normalSummonUsed>=n.normalSummonLimit?m(v.SUMMON_LIMIT_REACHED):P():m(v.NOT_MAIN_PHASE)}function Ht(n,e,t){const r=re(n.zones,e),a=me(n.zones,r,"mainMonsterZone",{position:t==="attack"?"faceUp":"faceDown",battlePosition:t,placedThisTurn:!0});return{...n,zones:a,normalSummonUsed:n.normalSummonUsed+1}}class Et{constructor(e){Z(this,"description");this.cardInstanceId=e,this.description=`Summon monster ${e}`}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);const t=Ut(e);if(!t.isValid)return t;const r=re(e.zones,this.cardInstanceId);return r?Pt(r)?r.location!=="hand"?m(v.CARD_NOT_IN_HAND):P():m(v.NOT_MONSTER_CARD):m(v.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=re(e.zones,this.cardInstanceId),a=Ht(e,this.cardInstanceId,"attack");return _e(a,`Monster summoned: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class Nt{constructor(e){Z(this,"description");this.cardInstanceId=e,this.description=`Set monster ${e}`}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);const t=Ut(e);if(!t.isValid)return t;const r=re(e.zones,this.cardInstanceId);return r?Pt(r)?r.location!=="hand"?m(v.CARD_NOT_IN_HAND):P():m(v.NOT_MONSTER_CARD):m(v.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=re(e.zones,this.cardInstanceId),a=Ht(e,this.cardInstanceId,"defense");return _e(a,`Monster set: ${r.jaName}`)}getCardInstanceId(){return this.cardInstanceId}}class kt{constructor(e){Z(this,"description");this.cardInstanceId=e,this.description=`Set spell/trap ${e}`}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);if(!ze(e.phase))return m(v.NOT_MAIN_PHASE);const t=re(e.zones,this.cardInstanceId);return t?t.location!=="hand"?m(v.CARD_NOT_IN_HAND):!Lt(t)&&!On(t)?m(v.NOT_SPELL_OR_TRAP_CARD):!Qe(t)&&Nn(e.zones)?m(v.SPELL_TRAP_ZONE_FULL):P():m(v.CARD_NOT_FOUND)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=re(e.zones,this.cardInstanceId),a={...e,zones:this.moveSetSpellTrapCard(e.zones,r)};return _e(a,`Card set: ${r.jaName}`)}moveSetSpellTrapCard(e,t){const r={position:"faceDown",placedThisTurn:!0};return Qe(t)?(kn(e)&&(e=me(e,e.fieldZone[0],"graveyard")),me(e,t,"fieldZone",r)):me(e,t,"spellTrapZone",r)}getCardInstanceId(){return this.cardInstanceId}}class q{static registerActivation(e,t){const r=this.getOrCreateEntry(e);r.activation=t}static registerIgnition(e,t){this.getOrCreateEntry(e).ignitionEffects.push(t)}static getActivation(e){var t;return(t=this.effects.get(e))==null?void 0:t.activation}static getIgnitionEffects(e){var t;return((t=this.effects.get(e))==null?void 0:t.ignitionEffects)??[]}static hasIgnitionEffects(e){const t=this.effects.get(e);return t!==void 0&&t.ignitionEffects.length>0}static clear(){this.effects.clear()}static getRegisteredCardIds(){return Array.from(this.effects.keys())}static getOrCreateEntry(e){let t=this.effects.get(e);return t||(t={ignitionEffects:[]},this.effects.set(e,t)),t}}Z(q,"effects",new Map);class Dt{constructor(e){Z(this,"description");this.cardInstanceId=e,this.description=`Activate spell card ${e}`}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);const t=re(e.zones,this.cardInstanceId);if(!t)return m(v.CARD_NOT_FOUND);if(!["hand","spellTrapZone","fieldZone"].includes(t.location))return m(v.CARD_NOT_IN_VALID_LOCATION);if(!Lt(t))return m(v.NOT_SPELL_CARD);if(!Qe(t)&&e.zones.spellTrapZone.length>=5)return m(v.SPELL_TRAP_ZONE_FULL);const r=q.getActivation(t.id);if(r){const a=r.canActivate(e,t);if(!a.isValid)return a}return P()}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=re(e.zones,this.cardInstanceId),a=new Set(e.activatedOncePerTurnCards);a.add(r.id);const s={...e,zones:this.moveActivatedSpellCard(e.zones,r),activatedOncePerTurnCards:a};return _e(s,`Spell card activated: ${this.cardInstanceId}`,this.buildEffectSteps(s,r))}moveActivatedSpellCard(e,t){const r={position:"faceUp",placedThisTurn:!0};if(t.location==="hand"){const a=Qe(t)?"fieldZone":"spellTrapZone";return me(e,t,a,r)}return vt(e,t,r)}buildEffectSteps(e,t){const r=[],a=q.getActivation(t.id);return a&&(r.push(...a.createActivationSteps(e,t)),r.push(...a.createResolutionSteps(e,t))),r}getCardInstanceId(){return this.cardInstanceId}}class wt{constructor(e){Z(this,"description");this.cardInstanceId=e,this.description=`Activate ignition effect of ${e}`}canExecute(e){if(e.result.isGameOver)return m(v.GAME_OVER);const t=re(e.zones,this.cardInstanceId);if(!t)return m(v.CARD_NOT_FOUND);if(!["fieldZone","spellTrapZone","mainMonsterZone"].includes(t.location))return m(v.CARD_NOT_ON_FIELD);if(!ot(t))return m(v.CARD_NOT_FACE_UP);const a=q.getIgnitionEffects(t.id);return a.length===0?m(v.NO_IGNITION_EFFECT):this.findActivatableEffect(a,e,t)?P():m(v.ACTIVATION_CONDITIONS_NOT_MET)}findActivatableEffect(e,t,r){return e.find(a=>a.canActivate(t,r).isValid)}execute(e){const t=this.canExecute(e);if(!t.isValid)return xe(e,Fe(t));const r=re(e.zones,this.cardInstanceId),a=q.getIgnitionEffects(r.id),s=this.findActivatableEffect(a,e,r),i=new Set(e.activatedIgnitionEffectsThisTurn);i.add(`${r.instanceId}:${s.effectId}`);const l={...e,activatedIgnitionEffectsThisTurn:i};return _e(l,`Ignition effect activated: ${this.cardInstanceId}`,this.buildEffectSteps(l,r,s))}buildEffectSteps(e,t,r){const a=r.createActivationSteps(e,t),s=r.createResolutionSteps(e,t);return[...a,...s]}getCardInstanceId(){return this.cardInstanceId}}const jt=n=>({id:`${n}-activation-notification`,summary:"カード発動",description:`${At(n)}を発動します`,notificationLevel:"info",action:e=>({success:!0,updatedState:e,message:`${At(n)} activated`})}),Bt=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:n.availableCards,_sourceZone:n._sourceZone,_filter:n._filter,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1},action:(e,t)=>!t||t.length===0?n.onSelect(e,[]):n.onSelect(e,t)});function Yn(n){return{id:`emit-spell-activated-${n.instanceId}`,summary:"魔法発動イベント",description:"魔法カード発動をトリガーシステムに通知",notificationLevel:"silent",action:e=>_e(e,void 0,void 0,[{type:"spellActivated",sourceCardId:n.id,sourceInstanceId:n.instanceId}])}}class Je{constructor(e){Z(this,"cardId");Z(this,"effectId");Z(this,"effectCategory","activation");this.cardId=e,this.effectId=`activation-${e}`}canActivate(e,t){const r=this.subTypeConditions(e,t);if(!r.isValid)return r;const a=this.individualConditions(e,t);return a.isValid?P():a}createActivationSteps(e,t){return[jt(this.cardId),Yn(t),...this.subTypePreActivationSteps(e,t),...this.individualActivationSteps(e,t),...this.subTypePostActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.subTypePreResolutionSteps(e,t),...this.individualResolutionSteps(e,t),...this.subTypePostResolutionSteps(e,t)]}}function Kn(n,e){return{id:(e==null?void 0:e.id)??`queue-end-phase-effect-${n.id}`,summary:(e==null?void 0:e.summary)??"エンドフェイズ効果を登録",description:(e==null?void 0:e.description)??"エンドフェイズに処理される効果を登録します",notificationLevel:"silent",action:t=>({success:!0,updatedState:{...t,pendingEndPhaseEffects:[...t.pendingEndPhaseEffects,n]},message:`Added end phase effect: ${n.summary}`})}}const qt=(n,e)=>({id:`send-${n}-to-graveyard`,summary:"墓地へ送る",description:`《${e}》を墓地に送ります`,notificationLevel:"info",action:t=>{const r=re(t.zones,n);return{success:!0,updatedState:{...t,zones:me(t.zones,r,"graveyard")},message:`Sent ${e} to graveyard`}}}),Qt=(n,e)=>{let t=n.zones;for(const r of e){const a=re(t,r);t=me(t,a,"graveyard")}return{success:!0,updatedState:{...n,zones:t},message:`Sent ${e.length} card${e.length>1?"s":""} to graveyard`}},Xn=n=>{const e=[...n.zones.hand];if(e.length===0)return{success:!0,updatedState:n,message:"No cards in hand to discard"};const t=e.map(r=>r.instanceId);return Qt(n,t)},Jn=()=>({id:"discard-all-hand",summary:"手札を全て捨てる",description:"手札を全て捨てます",notificationLevel:"info",action:n=>Xn(n)}),Wt=()=>Kn(Jn(),{id:"end-phase-discard-all-hand",summary:"手札を全て捨てる",description:"エンドフェイズに手札を全て捨てます"}),_t=(n,e)=>Bt({id:`select-and-discard-${n}-cards`,summary:`手札を${n}枚捨てる`,description:`手札から${n}枚選んで捨てます`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n,maxCards:n,cancelable:!1,onSelect:(t,r)=>r.length!==n?{success:!1,updatedState:t,error:`Must select exactly ${n} cards to discard`}:Qt(t,r)});class le extends Je{constructor(){super(...arguments);Z(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?P():m(v.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[qt(r.instanceId,r.jaName)]}}const Yt=(n,e)=>({id:e.id,summary:e.summary,description:e.description,notificationLevel:"info",action:t=>{const{drawCount:r,message:a}=n(t);return r===0?{success:!0,updatedState:t,message:a}:t.zones.deck.length<r?{success:!1,updatedState:t,error:`Insufficient deck: needed ${r}, but only ${t.zones.deck.length} remaining.`}:{success:!0,updatedState:{...t,zones:mt(t.zones,r)},message:`${a} (${r} card${r>1?"s":""})`}}}),Ee=n=>Yt(()=>({drawCount:n,message:`Draw ${n} card(s)`}),{id:`draw-${n}`,summary:"カードをドロー",description:`デッキから${n}枚ドローします`}),$n=n=>Yt(e=>{const t=Math.max(0,n-e.zones.hand.length);return{drawCount:t,message:t===0?`Hand already has ${n} or more cards`:`Filled hand to ${n}`}},{id:`fill-hands-${n}`,summary:`手札が${n}枚になるまでドロー`,description:`手札が${n}枚になるまでドローします`});class er extends le{constructor(){super(55144522)}individualConditions(e,t){return e.zones.deck.length<2?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(2)]}}class tr extends le{constructor(){super(79571449)}individualConditions(e,t){return e.zones.deck.length<3?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(3),_t(2)]}}class nr extends Je{constructor(){super(...arguments);Z(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?P():m(v.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class rr extends nr{constructor(){super(67616300)}individualConditions(e,t){return P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[]}}const Kt=(n,e,t)=>{const r=t==="player",a=r?"プレイヤー":"相手",s=r?"Player":"Opponent",i=n==="gain"?1:-1,l={gain:{id:"gain-lp",action:"増加",msg:"gained"},damage:{id:"damage",action:"ダメージ",msg:"took"},payment:{id:"pay-lp",action:"支払い",msg:"paid"},loss:{id:"loss-lp",action:"喪失",msg:"lost"}}[n];return{id:`${l.id}-${t}-${e}`,summary:`${a}のLP${l.action}`,description:`${a}に${e}の${l.action}が発生します`,notificationLevel:"info",action:_=>({success:!0,updatedState:{..._,lp:{..._.lp,[t]:_.lp[t]+e*i}},message:`${s} ${l.msg} ${e} LP`})}},ar=(n,e)=>Kt("gain",n,e),Xt=(n,e)=>Kt("payment",n,e);class sr extends le{constructor(){super(70368879)}individualConditions(e,t){return e.zones.deck.length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),ar(1e3,"opponent")]}}class ir extends le{constructor(){super(33782437)}individualConditions(e,t){return e.zones.deck.length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),{id:"one-day-of-peace-damage-negation",summary:"ダメージ無効化",description:"このターン、全てのダメージは0になります",notificationLevel:"info",action:r=>({success:!0,updatedState:{...r,damageNegation:!0},message:"Damage negation activated for this turn"})}]}}const cr=n=>Bt({id:"select-and-return-to-deck",summary:"手札をデッキに戻す",description:`デッキに戻すカードを選択してください（${n.min}〜${n.max??100}枚）`,availableCards:null,_sourceZone:"hand",_filter:void 0,minCards:n.min,maxCards:n.max??100,cancelable:!1,onSelect:(e,t)=>{if(t.length===0)return{success:!0,updatedState:e,message:"No cards selected"};let r=e.zones;for(const a of t){const s=re(r,a);r=me(r,s,"deck")}return r=Ke(r),r=mt(r,t.length),{success:!0,updatedState:{...e,zones:r},message:`${t.length}枚をデッキに戻し、シャッフルして${t.length}枚ドローしました`}}});class or extends le{constructor(){super(85852291)}individualConditions(e,t){return P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[cr({min:0})]}}class dr extends Je{constructor(){super(...arguments);Z(this,"spellSpeed",2)}subTypeConditions(t,r){return bn(r)&&r.placedThisTurn?m(v.QUICK_PLAY_RESTRICTION):P()}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[qt(r.instanceId,r.jaName)]}}class lr extends dr{constructor(){super(74519184)}individualConditions(e,t){return zt(e.zones,t)<2||e.zones.deck.length<2?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[_t(2),Ee(2)]}}const Jt=(n,e,t)=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:e,_filter:n.filter},action:(r,a)=>{if((e==="graveyard"?r.zones.graveyard.filter(n.filter):r.zones.deck.filter((g,I)=>n.filter(g,I))).length===0)return{success:!1,updatedState:r,error:`No cards available in ${e} matching the criteria`};if(!a||a.length===0)return{success:!1,updatedState:r,error:"No cards selected"};let i=r.zones;for(const g of a){const I=re(i,g);i=me(i,I,"hand")}t&&(i=Ke(i));const l={...r,zones:i},_=t?" and shuffled":"";return{success:!0,updatedState:l,message:`Added ${a.length} card${a.length>1?"s":""} from ${e} to hand${_}`}}}),$t=n=>Jt(n,"graveyard",!1),en=n=>Jt(n,"deck",!0),ur=n=>({id:n.id,summary:n.summary,description:n.description,notificationLevel:"interactive",cardSelectionConfig:{availableCards:null,minCards:n.minCards,maxCards:n.maxCards,summary:n.summary,description:n.description,cancelable:n.cancelable??!1,_sourceZone:"deck",_filter:(e,t)=>t!==void 0&&t<n.count},action:(e,t)=>{const r=e.zones.deck.slice(0,n.count);if(r.length<n.count)return{success:!1,updatedState:e,error:`Cannot excavate ${n.count} cards. Deck has only ${r.length} cards.`};if(!t||t.length===0)return{success:!1,updatedState:e,error:"No cards selected"};let a=e.zones;for(const i of t){const l=re(a,i);a=me(a,l,"hand")}return{success:!0,updatedState:{...e,zones:a},message:`Added ${t.length} card${t.length>1?"s":""} from deck to hand`}}});class fr extends le{constructor(){super(90928333)}individualConditions(e,t){return e.zones.graveyard.filter(a=>a.type==="monster"&&a.frameType==="normal").length<2?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[$t({id:`dark-factory-search-${t.instanceId}`,summary:"通常モンスター2枚をサルベージ",description:"墓地から通常モンスター2枚を選択し、手札に加えます",filter:r=>r.type==="monster"&&r.frameType==="normal",minCards:2,maxCards:2,cancelable:!1})]}}class vr extends le{constructor(){super(73628505)}individualConditions(e,t){return e.zones.deck.filter(a=>a.type==="spell"&&a.spellType==="field").length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[en({id:`terraforming-search-${t.instanceId}`,summary:"フィールド魔法1枚をサーチ",description:"デッキからフィールド魔法1枚を選択し、手札に加えます",filter:r=>r.type==="spell"&&r.spellType==="field",minCards:1,maxCards:1,cancelable:!1})]}}class mr extends le{constructor(){super(98494543)}individualConditions(e,t){return zt(e.zones,t)<2||e.zones.graveyard.filter(a=>a.type==="spell").length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[_t(2)]}individualResolutionSteps(e,t){return[$t({id:`magical-stone-excavation-search-${t.instanceId}`,summary:"魔法カード1枚をサルベージ",description:"墓地から魔法カード1枚を選択し、手札に加えます",filter:r=>r.type==="spell",minCards:1,maxCards:1,cancelable:!1})]}}class _r extends le{constructor(){super(93946239)}individualConditions(e,t){return e.zones.hand.length<3||e.zones.deck.length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[Ee(1),Wt()]}}const gr=()=>({id:"shuffle-deck",summary:"デッキシャッフル",description:"デッキをシャッフルします",notificationLevel:"info",action:n=>({success:!0,updatedState:{...n,zones:Ke(n.zones)},message:"Deck shuffled"})});class pr extends le{constructor(){super(98645731)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)||e.zones.deck.length<3?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[ur({id:`pot-of-duality-search-${t.instanceId}`,summary:"デッキトップ3枚から1枚をサーチ",description:"デッキトップ3枚から1枚を選択し、手札に加えます",count:3,minCards:1,maxCards:1,cancelable:!1}),gr()]}}class Cr extends le{constructor(){super(59750328)}individualConditions(e,t){return e.activatedOncePerTurnCards.has(this.cardId)?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[$n(3),Wt()]}}class hr extends le{constructor(){super(89997728)}individualConditions(e,t){return e.zones.deck.filter(a=>a.jaName.includes("トゥーン")).length<1?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[]}individualResolutionSteps(e,t){return[en({id:`toon-table-search-${t.instanceId}`,summary:"「トゥーン」カード1枚をサーチ",description:"デッキから「トゥーン」カード1枚を選択し、手札に加えます",filter:r=>r.jaName.includes("トゥーン"),minCards:1,maxCards:1,cancelable:!1})]}}class Sr extends Je{constructor(){super(...arguments);Z(this,"spellSpeed",1)}subTypeConditions(t,r){return ze(t.phase)?P():m(v.NOT_MAIN_PHASE)}subTypePreActivationSteps(t,r){return[]}subTypePostActivationSteps(t,r){return[]}subTypePreResolutionSteps(t,r){return[]}subTypePostResolutionSteps(t,r){return[]}}class Ir extends Sr{constructor(){super(15259703)}individualConditions(e,t){return e.lp.player<1e3?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[Xt(1e3,"player")]}individualResolutionSteps(e,t){return[]}}class tn{constructor(e,t){Z(this,"cardId");Z(this,"effectId");Z(this,"effectCategory","ignition");Z(this,"spellSpeed",1);this.cardId=e,this.effectId=`ignition-${e}-${t}`}canActivate(e,t){if(!ze(e.phase))return m(v.NOT_MAIN_PHASE);const r=this.individualConditions(e,t);return r.isValid?P():r}createActivationSteps(e,t){return[jt(t.id),...this.individualActivationSteps(e,t)]}createResolutionSteps(e,t){return[...this.individualResolutionSteps(e,t)]}}class Tr extends tn{constructor(){super(67616300,1)}individualConditions(e,t){if(e.lp.player<=1e3)return m(v.ACTIVATION_CONDITIONS_NOT_MET);const r=`${t.instanceId}:${this.effectId}`;return e.activatedIgnitionEffectsThisTurn.has(r)?m(v.ACTIVATION_CONDITIONS_NOT_MET):P()}individualActivationSteps(e,t){return[Xt(1e3,"player")]}individualResolutionSteps(e,t){return[Ee(1)]}}function $e(n,e){const t=n.find(r=>r.type===e);return(t==null?void 0:t.count)??0}function nn(n,e,t){const r=n.findIndex(a=>a.type===e);if(r>=0){const a=n[r],s=Math.max(0,a.count+t);return s===0?[...n.slice(0,r),...n.slice(r+1)]:[...n.slice(0,r),{type:e,count:s},...n.slice(r+1)]}else if(t>0)return[...n,{type:e,count:t}];return n}const yr=(n,e,t,r)=>({id:`add-counter-${e}-${t}-${n}`,summary:"カウンターを置く",description:`魔力カウンターを${t}つ置きます`,notificationLevel:"silent",action:a=>{const s=re(a.zones,n);if(!s)return _e(a,"カードが見つかりません");const i=$e(s.counters,e);if(i>=r)return _e(a,"カウンターは既に最大数です");const l=Math.min(t,r-i),_=nn(s.counters,e,l),g=vt(a.zones,s,{counters:_});return _e({...a,zones:g},`魔力カウンターを${l}つ置きました`)}}),Ar=(n,e,t)=>({id:`remove-counter-${e}-${t}-${n}`,summary:"カウンターを取り除く",description:`魔力カウンターを${t}つ取り除きます`,notificationLevel:"info",action:r=>{const a=re(r.zones,n);if(!a)return xe(r,`Target card not found: ${n}`);const s=$e(a.counters,e);if(s<t)return xe(r,`Insufficient counters: needed ${t}, but only ${s} available.`);const i=nn(a.counters,e,-t),l=vt(r.zones,a,{counters:i});return _e({...r,zones:l},`Removed ${t} ${e} counter(s) from card.`)}}),Rt=3;class Or extends tn{constructor(){super(70791313,1)}individualConditions(e,t){return $e(t.counters,"spell")<Rt?m(v.INSUFFICIENT_COUNTERS):P()}individualActivationSteps(e,t){return[Ar(t.instanceId,"spell",Rt)]}individualResolutionSteps(e,t){return[Ee(1)]}}function br(){q.registerActivation(55144522,new er),q.registerActivation(79571449,new tr),q.registerActivation(67616300,new rr),q.registerActivation(70368879,new sr),q.registerActivation(33782437,new ir),q.registerActivation(85852291,new or),q.registerActivation(74519184,new lr),q.registerActivation(90928333,new fr),q.registerActivation(73628505,new vr),q.registerActivation(98494543,new mr),q.registerActivation(93946239,new _r),q.registerActivation(98645731,new pr),q.registerActivation(59750328,new Cr),q.registerActivation(89997728,new hr),q.registerActivation(15259703,new Ir),q.registerIgnition(67616300,new Tr),q.registerIgnition(70791313,new Or)}class xr{constructor(){Z(this,"isEffect",!0);Z(this,"category","ActionPermission")}canApply(e){return e.zones.fieldZone.some(t=>t.id===67616300&&t.position==="faceUp")}checkPermission(e){return!1}}const Er=70791313,Nr=3;class kr{constructor(){Z(this,"isEffect",!0);Z(this,"category","TriggerRule");Z(this,"triggers",["spellActivated"])}canApply(e){return e.zones.mainMonsterZone.some(r=>r.id===Er&&r.position==="faceUp")}createTriggerSteps(e,t){return[yr(t.instanceId,"spell",1,Nr)]}}function Dr(){We.register(67616300,new xr),We.register(70791313,new kr)}br();Dr();class wr{canExecuteCommand(e,...t){const r=at();return new e(...t).canExecute(r).isValid}executeCommand(e,...t){const r=at(),s=new e(...t).execute(r);return s.success&&(W.set(s.updatedState),s.effectSteps&&s.effectSteps.length>0&&ke.startProcessing(s.effectSteps)),{success:s.success,message:s.message,error:s.error}}initializeGame(e){Rn(e)}getGameState(){return at()}advancePhase(){return this.executeCommand(Wn)}canSummonMonster(e){return this.canExecuteCommand(Et,e)}summonMonster(e){return this.executeCommand(Et,e)}canSetMonster(e){return this.canExecuteCommand(Nt,e)}setMonster(e){return this.executeCommand(Nt,e)}canSetSpellTrap(e){return this.canExecuteCommand(kt,e)}setSpellTrap(e){return this.executeCommand(kt,e)}canActivateSpell(e){return this.canExecuteCommand(Dt,e)}activateSpell(e){return this.executeCommand(Dt,e)}canActivateIgnitionEffect(e){return this.canExecuteCommand(wt,e)}activateIgnitionEffect(e){return this.executeCommand(wt,e)}}const ae=new wr,Rr=({params:n})=>{const{deckId:e}=n,{deckRecipe:t,deckData:r,uniqueCardIds:a}=pn(e);return console.log(`[PageLoad] Initializing game with deck: ${t.name}`),ae.initializeGame(t),console.log("[PageLoad] Initial state:",ae.getGameState()),{deckId:e,deckName:r.name,uniqueCardIds:a}},Ja=Object.freeze(Object.defineProperty({__proto__:null,load:Rr},Symbol.toStringTag,{value:"Module"})),Mr=ie(W,n=>n.phase),Pr=ie(W,n=>n.turn),Lr=ie(W,n=>n.lp.player),zr=ie(W,n=>n.lp.opponent),Fr=ie(W,n=>n.zones.hand.length),Zr=ie(W,n=>n.zones.deck.length);ie(W,n=>n.zones.graveyard.length);ie(W,n=>n.zones.mainMonsterZone.length+n.zones.spellTrapZone.length+n.zones.fieldZone.length);const Gr=ie(W,n=>n.result.isGameOver?n.result:Zt(n));ie(W,n=>n.zones.deck.length===0);ie(W,n=>n.zones.hand.length===0);const Vr=ie(W,n=>n.zones.hand);ie(W,n=>[...n.zones.mainMonsterZone,...n.zones.spellTrapZone,...n.zones.fieldZone]);const Ur=ie(W,n=>n.zones.graveyard);ie(W,n=>n.zones.banished);const Hr=""+new URL("../assets/SpellCounter.pzkYCI1C.png",import.meta.url).href;var jr=k('<div class="absolute bottom-8 right-1 px-1 bg-green-900 text-white rounded-full flex items-center justify-center font-bold border-1 border-green-400 shadow-md z-10" data-testid="spell-counter-badge"><img alt="魔力カウンター" class="w-4 h-4"/> <span class="text-xs" data-testid="spell-counter-count"> </span></div>');function Br(n,e){const t=x(()=>e.count>0);var r=be(),a=ne(r);{var s=i=>{var l=jr(),_=d(l),g=C(_,2),I=d(g,!0);o(g),o(l),J(()=>{Le(l,"title",`魔力カウンター: ${e.count??""}`),Le(_,"src",Hr),X(I,e.count)}),T(i,l)};Q(a,i=>{c(t)&&i(s)})}T(n,r)}var qr=(n,e,t)=>e(c(t)),Qr=k("<button> </button>"),Wr=k('<div class="absolute -bottom-14 left-0 right-0 flex justify-center gap-2 z-10"><!> <button class="btn btn-sm preset-tonal-warning">キャンセル</button></div>'),Yr=k('<div class="relative"><div class="transition-transform duration-300 hover:scale-105"><!> <!></div> <!></div>');function Be(n,e){ge(e,!0);let t=he(e,"size",3,"medium"),r=he(e,"showDetailOnClick",3,!0),a=he(e,"faceDown",3,!1),s=he(e,"rotation",3,0),i=he(e,"spellCounterCount",3,0);function l(){e.onSelect(e.card,e.instanceId)}function _(S){S.onClick(e.card,e.instanceId)}function g(S,N){const V=S||"filled",E=N||"primary";return{filled:{primary:"preset-filled-primary-500",secondary:"preset-filled-secondary-500",tertiary:"preset-filled-tertiary-500",success:"preset-filled-success-500",warning:"preset-filled-warning-500",error:"preset-filled-error-500",surface:"preset-filled-surface-500"},tonal:{primary:"preset-tonal-primary",secondary:"preset-tonal-secondary",tertiary:"preset-tonal-tertiary",success:"preset-tonal-success",warning:"preset-tonal-warning",error:"preset-tonal-error",surface:"preset-tonal-surface"},outlined:{primary:"preset-outlined-primary-500",secondary:"preset-outlined-secondary-500",tertiary:"preset-outlined-tertiary-500",success:"preset-outlined-success-500",warning:"preset-outlined-warning-500",error:"preset-outlined-error-500",surface:"preset-outlined-surface-500"}}[V][E]}var I=Yr(),b=d(I),h=d(b);Se(h,{get card(){return e.card},get size(){return t()},get faceDown(){return a()},get rotation(){return s()},clickable:!0,get isSelected(){return e.isSelected},onClick:l,get showDetailOnClick(){return r()},animate:!1});var M=C(h,2);{var D=S=>{Br(S,{get count(){return i()}})};Q(M,S=>{i()>0&&S(D)})}o(b);var u=C(b,2);{var f=S=>{var N=Wr(),V=d(N);De(V,17,()=>e.actionButtons,R=>R.label,(R,L)=>{var F=Qr();F.__click=[qr,_,L];var j=d(F,!0);o(F),J($=>{ve(F,1,`btn btn-sm ${$??""} ${e.isActivatable?"":"opacity-50 cursor-not-allowed"}`),X(j,c(L).label)},[()=>g(c(L).style,c(L).color)]),T(R,F)});var E=C(V,2);E.__click=function(...R){var L;(L=e.onCancel)==null||L.apply(this,R)},o(N),T(S,N)};Q(u,S=>{e.isSelected&&S(f)})}o(I),T(n,I),pe()}we(["click"]);function Kr(n,e){e.onOpenChange(!1)}function Xr(n,e){K(e,!c(e))}var Jr=k('<div class="relative"><div><!></div> <!></div>'),$r=k('<div class="relative"><div><!></div></div>'),ea=k('<div class="flex gap-2 flex-wrap"><!></div>'),ta=k('<div class="text-center py-8"><p class="text-gray-500"> </p></div>'),na=k('<header class="flex justify-between items-center mb-4"><h2 class="text-2xl sm:text-3xl font-bold mx-2"> </h2> <div class="flex items-center gap-2"><button type="button"><!> <span class="text-xs"> </span></button> <button type="button" class="btn preset-tonal rounded-full"><!></button></div></header> <div class="text-sm text-surface-600-300-token mb-2"> </div> <!>',1);function rn(n,e){ge(e,!0);let t=he(e,"emptyMessage",3,"カードがありません"),r=he(e,"borderColor",3,"border-gray-400");const a=e.cards.slice().reverse();let s=Ie(!1);const i=()=>{const _=new Map;return a.forEach(g=>{const I=_.get(g.id);I?I.quantity+=1:_.set(g.id,{card:g,quantity:1})}),Array.from(_.values())};function l(_){e.onOpenChange(_.open)}Ye(n,{get open(){return e.open},onOpenChange:l,contentBase:"card bg-surface-100-900 p-6 mx-auto space-y-4 shadow-xl max-w-4xl max-h-[90vh] overflow-auto",backdropClasses:"backdrop-blur-sm",content:g=>{var I=na(),b=ne(I),h=d(b),M=d(h,!0);o(h);var D=C(h,2),u=d(D);u.__click=[Xr,s];var f=d(u);const S=x(()=>c(s)?"mdi:card-multiple":"mdi:cards");Ot(f,{get icon(){return c(S)},class:"size-4"});var N=C(f,2),V=d(N,!0);o(N),o(u);var E=C(u,2);E.__click=[Kr,e];var R=d(E);Ot(R,{icon:"mdi:close",class:"size-4"}),o(E),o(D),o(b);var L=C(b,2),F=d(L);o(L);var j=C(L,2);{var $=p=>{var U=ea(),ee=d(U);{var ce=H=>{var B=be(),te=ne(B);De(te,17,i,({card:z,quantity:G})=>z.id,(z,G)=>{let Y=()=>c(G).card,se=()=>c(G).quantity;var oe=Jr(),de=d(oe),Te=d(de);Se(Te,{get card(){return Y()},size:"medium",showDetailOnClick:!0}),o(de);var Ze=C(de,2);{var ye=ue=>{Ve(ue,{get count(){return se()},colorClasses:"bg-primary-200 text-primary-900"})};Q(Ze,ue=>{se()>1&&ue(ye)})}o(oe),J(()=>ve(de,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),T(z,oe)}),T(H,B)},Ce=H=>{var B=be(),te=ne(B);De(te,17,()=>a,Tn,(z,G)=>{var Y=$r(),se=d(Y),oe=d(se);Se(oe,{get card(){return c(G)},size:"medium",showDetailOnClick:!0}),o(se),o(Y),J(()=>ve(se,1,`border-2 ${r()??""} rounded-lg shadow-md overflow-hidden`)),T(z,Y)}),T(H,B)};Q(ee,H=>{c(s)?H(ce):H(Ce,!1)})}o(U),T(p,U)},y=p=>{var U=ta(),ee=d(U),ce=d(ee,!0);o(ee),o(U),J(()=>X(ce,t())),T(p,U)};Q(j,p=>{e.cards.length>0?p($):p(y,!1)})}J(()=>{X(M,e.title),ve(u,1,`btn btn-sm ${c(s)?"preset-filled-primary-500":"preset-tonal"}`),Le(u,"title",c(s)?"個別表示に切り替え":"集約表示に切り替え"),X(V,c(s)?"集約":"個別"),X(F,`${e.cards.length??""}枚`)}),T(g,I)},$$slots:{content:!0}}),pe()}we(["click"]);var ra=(n,e)=>n.key==="Enter"&&e(),aa=k('<div class="absolute inset-1"><!></div> <!>',1),sa=k('<div class="h-full flex items-center justify-center p-1 relative" style="filter: grayscale(0.8) brightness(0.7) contrast(1.2);"><img alt="墓地" class="w-full h-full object-cover opacity-30 rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-surface-600-300-token text-center select-none drop-shadow-lg">墓地</span></div></div> <!>',1),ia=k('<div role="button" tabindex="0"><!></div> <!>',1);function ca(n,e){ge(e,!0);let t=he(e,"size",3,"medium"),r=Ie(!1);const a=x(()=>e.cards.length>0?e.cards[e.cards.length-1]:null);function s(){K(r,!0)}function i(f){K(r,f,!0)}let l=Ie(!1);function _(){K(l,!0)}function g(){K(l,!1)}var I=ia(),b=ne(I);b.__click=s,b.__keydown=[ra,s];var h=d(b);{var M=f=>{var S=aa(),N=ne(S),V=d(N);Se(V,{get card(){return c(a)},get size(){return t()},clickable:!1}),o(N);var E=C(N,2);Ve(E,{get count(){return e.cards.length}}),T(f,S)},D=f=>{var S=sa(),N=ne(S),V=d(N);ft(2),o(N);var E=C(N,2);Ve(E,{get count(){return e.cards.length}}),J(()=>Le(V,"src",ut)),T(f,S)};Q(h,f=>{c(a)?f(M):f(D,!1)})}o(b);var u=C(b,2);rn(u,{get cards(){return e.cards},get open(){return c(r)},onOpenChange:i,title:"墓地",borderColor:"border-gray-400"}),J(()=>ve(b,1,`
    ${lt[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    hover:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700
    ${c(l)?"scale-105 shadow-lg":""}
  `)),qe("mouseenter",b,_),qe("mouseleave",b,g),T(n,I),pe()}we(["click","keydown"]);var oa=(n,e)=>n.key==="Enter"&&e(),da=k('<div role="button" tabindex="0"><div class="h-full flex items-center justify-center p-1 relative"><img alt="EXデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">EX</span></div></div> <!></div> <!>',1);function la(n,e){ge(e,!0);let t=he(e,"size",3,"medium"),r=Ie(!1);function a(){K(r,!0)}function s(u){K(r,u,!0)}let i=Ie(!1);function l(){K(i,!0)}function _(){K(i,!1)}var g=da(),I=ne(g);I.__click=a,I.__keydown=[oa,a];var b=d(I),h=d(b);ft(2),o(b);var M=C(b,2);Ve(M,{get count(){return e.cards.length}}),o(I);var D=C(I,2);rn(D,{get cards(){return e.cards},get open(){return c(r)},onOpenChange:s,title:"EXデッキ",borderColor:"border-purple-400"}),J(()=>{ve(I,1,`
    ${lt[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
    transition-all duration-300
    cursor-pointer
    ${c(i)?"scale-105 shadow-lg":""}
  `),Le(h,"src",ut)}),qe("mouseenter",I,l),qe("mouseleave",I,_),T(n,g),pe()}we(["click","keydown"]);var ua=k('<div role="img"><div class="h-full flex items-center justify-center p-1 relative"><img alt="メインデッキ" class="w-full h-full object-cover rounded-sm"/> <div class="absolute inset-0 flex items-center justify-center"><span class="text-xs text-white font-bold text-center select-none drop-shadow-lg">Deck</span></div></div> <!></div>');function fa(n,e){ge(e,!0);let t=he(e,"size",3,"medium");var r=ua(),a=d(r),s=d(a);ft(2),o(a);var i=C(a,2);Ve(i,{get count(){return e.cardCount}}),o(r),J(()=>{ve(r,1,`
    ${lt[t()]??""}
    relative
    border-2 border-dashed border-gray-400
    rounded-lg
    bg-gray-100 dark:bg-gray-800
  `),Le(s,"src",ut)}),T(n,r),pe()}var va=k('<div class="relative"><div style="filter: sepia(0.3) hue-rotate(90deg) saturate(1.5) brightness(0.9);"><!></div></div>'),ma=k('<div class="relative"><div style="filter: sepia(0.5) hue-rotate(30deg) saturate(1.8) brightness(0.85);"><!></div></div>'),_a=k('<div class="flex justify-center"><!></div>'),ga=k('<div class="relative"><div style="filter: sepia(0.4) hue-rotate(200deg) saturate(2) brightness(0.8);"><!></div></div>'),pa=k('<div class="flex justify-center"><!></div>'),Ca=k('<div class="card p-2 max-w-6xl mx-auto"><div class="transition-all duration-300"><div class="grid grid-cols-7 gap-2 md:gap-2 sm:gap-1 mb-4"><div class="flex justify-center"><!></div> <!> <div class="flex justify-center"><!></div></div> <div class="grid grid-cols-7 gap-2 md:gap-2 sm:gap-1 mb-4"><div class="flex justify-center"><!></div> <!> <div class="flex justify-center"><!></div></div></div></div>');function ha(n,e){ge(e,!0);const r=[...Array(5).keys()];function a(y,p){e.onFieldCardClick&&e.onFieldCardClick(y,p)}function s(y){return ae.canActivateSpell(y)}function i(y){return ae.canActivateIgnitionEffect(y)}function l(y){return s(y)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]}function _(y,p){return p?s(y)?[{label:"発動",style:"filled",color:"primary",onClick:e.onActivateSetSpell||(()=>{})}]:[]:i(y)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}function g(y){return i(y)?[{label:"効果発動",style:"filled",color:"primary",onClick:e.onActivateIgnitionEffect||(()=>{})}]:[]}var I=Ca(),b=d(I),h=d(b),M=d(h),D=d(M);{var u=y=>{const p=x(()=>e.selectedFieldCardInstanceId===e.fieldCards[0].instanceId),U=x(()=>_(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown).length>0),ee=x(()=>_(e.fieldCards[0].instanceId,e.fieldCards[0].faceDown)),ce=x(()=>e.onCancelFieldCardSelection||(()=>{}));Be(y,{get card(){return e.fieldCards[0].card},get instanceId(){return e.fieldCards[0].instanceId},get faceDown(){return e.fieldCards[0].faceDown},get isSelected(){return c(p)},get isActivatable(){return c(U)},onSelect:a,get actionButtons(){return c(ee)},get onCancel(){return c(ce)},size:"medium",showDetailOnClick:!0})},f=y=>{var p=va(),U=d(p),ee=d(U);Se(ee,{placeholder:!0,placeholderText:"フィールド",size:"medium"}),o(U),o(p),T(y,p)};Q(D,y=>{e.fieldCards.length>0?y(u):y(f,!1)})}o(M);var S=C(M,2);De(S,16,()=>r,y=>y,(y,p)=>{var U=_a(),ee=d(U);{var ce=H=>{const B=x(()=>e.monsterCards[p].rotation||0),te=x(()=>e.selectedFieldCardInstanceId===e.monsterCards[p].instanceId),z=x(()=>g(e.monsterCards[p].instanceId).length>0),G=x(()=>g(e.monsterCards[p].instanceId)),Y=x(()=>e.onCancelFieldCardSelection||(()=>{})),se=x(()=>e.monsterCards[p].spellCounterCount||0);Be(H,{get card(){return e.monsterCards[p].card},get instanceId(){return e.monsterCards[p].instanceId},get faceDown(){return e.monsterCards[p].faceDown},get rotation(){return c(B)},get isSelected(){return c(te)},get isActivatable(){return c(z)},onSelect:a,get actionButtons(){return c(G)},get onCancel(){return c(Y)},size:"medium",showDetailOnClick:!0,get spellCounterCount(){return c(se)}})},Ce=H=>{var B=ma(),te=d(B),z=d(te);const G=x(()=>p+1);Se(z,{placeholder:!0,get placeholderText(){return`M${c(G)??""}`},size:"medium"}),o(te),o(B),T(H,B)};Q(ee,H=>{e.monsterCards[p]?H(ce):H(Ce,!1)})}o(U),T(y,U)});var N=C(S,2),V=d(N);ca(V,{get cards(){return e.graveyardCards},size:"medium"}),o(N),o(h);var E=C(h,2),R=d(E),L=d(R);la(L,{get cards(){return e.extraDeckCards},size:"medium"}),o(R);var F=C(R,2);De(F,16,()=>r,y=>y,(y,p)=>{var U=pa(),ee=d(U);{var ce=H=>{var B=be(),te=ne(B);{var z=Y=>{const se=x(()=>e.selectedFieldCardInstanceId===e.spellTrapCards[p].instanceId),oe=x(()=>l(e.spellTrapCards[p].instanceId).length>0),de=x(()=>l(e.spellTrapCards[p].instanceId)),Te=x(()=>e.onCancelFieldCardSelection||(()=>{}));Be(Y,{get card(){return e.spellTrapCards[p].card},get instanceId(){return e.spellTrapCards[p].instanceId},faceDown:!0,get isSelected(){return c(se)},get isActivatable(){return c(oe)},onSelect:a,get actionButtons(){return c(de)},get onCancel(){return c(Te)},size:"medium",showDetailOnClick:!0})},G=Y=>{Se(Y,{get card(){return e.spellTrapCards[p].card},faceDown:!1,size:"medium",clickable:!0,showDetailOnClick:!0,onClick:()=>e.spellTrapCards[p]&&a(e.spellTrapCards[p].card,e.spellTrapCards[p].instanceId)})};Q(te,Y=>{e.spellTrapCards[p].faceDown?Y(z):Y(G,!1)})}T(H,B)},Ce=H=>{var B=ga(),te=d(B),z=d(te);const G=x(()=>p+1);Se(z,{placeholder:!0,get placeholderText(){return`S${c(G)??""}`},size:"medium"}),o(te),o(B),T(H,B)};Q(ee,H=>{e.spellTrapCards[p]?H(ce):H(Ce,!1)})}o(U),T(y,U)});var j=C(F,2),$=d(j);fa($,{get cardCount(){return e.deckCards},size:"medium"}),o(j),o(E),o(b),o(I),T(n,I),pe()}var Sa=k('<div class="text-center text-sm opacity-50">No cards in hand</div>'),Ia=k("<div></div>");function Ta(n,e){ge(e,!0);function t(u){return e.isGameOver||e.currentPhase!=="Main1"?!1:ae.canActivateSpell(u)}function r(u){return e.isGameOver||e.currentPhase!=="Main1"?!1:ae.canSummonMonster(u)}function a(u){return e.isGameOver||e.currentPhase!=="Main1"?!1:ae.canSetMonster(u)}function s(u){return e.isGameOver||e.currentPhase!=="Main1"?!1:ae.canSetSpellTrap(u)}function i(u){const f={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10"};return u<=0?"grid-cols-1":u>=10?"grid-cols-10":f[u]}function l(u,f){const S=e.selectedHandCardInstanceId===f?null:f;e.onHandCardSelect(S)}function _(u,f){e.onCardClick(u,f),e.onHandCardSelect(null)}function g(u,f){e.onSummonMonster(u,f),e.onHandCardSelect(null)}function I(u,f){e.onSetMonster(u,f),e.onHandCardSelect(null)}function b(u,f){e.onSetSpellTrap(u,f),e.onHandCardSelect(null)}function h(){e.onHandCardSelect(null)}function M(u,f){const S=[];return u.type==="monster"?(r(f)&&S.push({label:"召喚",style:"filled",color:"primary",onClick:g}),a(f)&&S.push({label:"セット",style:"filled",color:"primary",onClick:I})):(u.type==="spell"||u.type==="trap")&&(t(f)&&S.push({label:"発動",style:"filled",color:"primary",onClick:_}),s(f)&&S.push({label:"セット",style:"filled",color:"primary",onClick:b})),S}var D=Ia();De(D,21,()=>e.cards,({card:u,instanceId:f})=>f,(u,f)=>{let S=()=>c(f).card,N=()=>c(f).instanceId;var V=be(),E=ne(V);{var R=F=>{const j=x(()=>e.selectedHandCardInstanceId===N()),$=x(()=>M(S(),N()).length>0),y=x(()=>M(S(),N()));Be(F,{get card(){return S()},get instanceId(){return N()},get isSelected(){return c(j)},get isActivatable(){return c($)},onSelect:l,get actionButtons(){return c(y)},onCancel:h,size:"medium"})},L=F=>{Se(F,{placeholder:!0,placeholderText:"...",size:"medium"})};Q(E,F=>{S()?F(R):F(L,!1)})}T(u,V)},u=>{var f=Sa();T(u,f)}),o(D),J(u=>ve(D,1,`grid ${u??""} gap-2 mb-16`),[()=>i(e.handCardCount)]),T(n,D),pe()}function ya(n,e){var t;(t=e.config)==null||t.onConfirm()}var Aa=k('<button class="btn variant-ghost">キャンセル</button>'),Oa=k('<header class="text-center"><h2 class="h3 font-bold text-primary-600-300-token"> </h2></header> <article class="text-center"><p class="text-lg"> </p></article> <footer class="flex justify-center gap-3"><!> <button class="btn variant-filled-primary">OK</button></footer>',1);function ba(n,e){ge(e,!0);const t=x(()=>{var s;return((s=e.config)==null?void 0:s.cancelable)??!1});function r(){var s,i;(i=(s=e.config)==null?void 0:s.onCancel)==null||i.call(s)}function a(s){!s.open&&e.isOpen&&c(t)&&r()}Ye(n,{get open(){return e.isOpen},onOpenChange:a,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-md shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return c(t)},preventScroll:!0,content:i=>{var l=be(),_=ne(l);{var g=I=>{var b=Oa(),h=ne(b),M=d(h),D=d(M,!0);o(M),o(h);var u=C(h,2),f=d(u),S=d(f,!0);o(f),o(u);var N=C(u,2),V=d(N);{var E=L=>{var F=Aa();F.__click=r,T(L,F)};Q(V,L=>{c(t)&&L(E)})}var R=C(V,2);R.__click=[ya,e],o(N),J(()=>{X(D,e.config.summary),X(S,e.config.description)}),T(I,b)};Q(_,I=>{e.config&&I(g)})}T(i,l)},$$slots:{content:!0}}),pe()}we(["click"]);function xa(n,e,t,r){!e.config||!c(t)()||e.config.onConfirm(Array.from(c(r)))}var Ea=k('<button class="btn btn-sm btn-circle btn-ghost">✕</button>'),Na=k("<div><!></div>"),ka=k('<button class="btn btn-ghost">キャンセル</button>'),Da=k('<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg"> </h3> <!></div> <p class="text-sm text-surface-600-300-token mb-4"> </p> <div class="flex justify-between items-center mb-4 p-3 bg-surface-200 dark:bg-surface-800 rounded-lg border border-surface-300 dark:border-surface-600"><span class="text-sm font-semibold"> </span></div> <div class="min-h-[200px] max-h-[400px] overflow-y-auto mb-6"><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div></div> <div class="flex justify-end gap-3 mt-6"><!> <button class="btn btn-primary">確定</button></div>',1);function wa(n,e){ge(e,!0);let t=Ie(hn(new Set));ct(()=>{e.isOpen&&K(t,new Set,!0)});const r=x(()=>c(t).size),a=x(()=>{var h;return((h=e.config)==null?void 0:h.cancelable)??!1}),s=x(()=>()=>e.config?c(r)>=e.config.minCards&&c(r)<=e.config.maxCards:!1);function i(h){return c(t).has(h)}function l(h){return e.config?c(t).has(h)?!0:c(t).size<e.config.maxCards:!1}function _(h){!h.open&&e.isOpen&&c(a)&&I()}function g(h){if(!e.config||!e.config.availableCards.some(f=>f.instanceId===h))return;const D=l(h),u=i(h);if(D||u){const f=new Set(c(t));u?f.delete(h):f.add(h),K(t,f,!0)}}function I(){var h,M;(M=(h=e.config)==null?void 0:h.onCancel)==null||M.call(h)}function b(h){var D;const M=(D=e.config)==null?void 0:D.availableCards.find(u=>u.instanceId===h);if(M)return Pe(M.id)}Ye(n,{get open(){return e.isOpen},onOpenChange:_,contentBase:"card bg-surface-50 dark:bg-surface-900 p-6 space-y-4 max-w-4xl max-h-[90vh] overflow-auto shadow-2xl border-2 border-surface-300 dark:border-surface-700",backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,get closeOnEscape(){return c(a)},preventScroll:!0,content:M=>{var D=be(),u=ne(D);{var f=S=>{var N=Da(),V=ne(N),E=d(V),R=d(E,!0);o(E);var L=C(E,2);{var F=z=>{var G=Ea();G.__click=I,T(z,G)};Q(L,z=>{c(a)&&z(F)})}o(V);var j=C(V,2),$=d(j,!0);o(j);var y=C(j,2),p=d(y),U=d(p);o(p),o(y);var ee=C(y,2),ce=d(ee);De(ce,21,()=>e.config.availableCards,z=>z.instanceId,(z,G)=>{var Y=be();const se=x(()=>i(c(G).instanceId)),oe=x(()=>l(c(G).instanceId)),de=x(()=>b(c(G).instanceId));var Te=ne(Y);{var Ze=ye=>{var ue=Na();let Re;var Ue=d(ue);Se(Ue,{get card(){return c(de)},size:"small",clickable:!0,selectable:!1,get isSelected(){return c(se)},animate:!0,onClick:()=>g(c(G).instanceId)}),o(ue),J(et=>Re=ve(ue,1,"",null,Re,et),[()=>({"opacity-50":!c(oe)&&!c(se)})]),T(ye,ue)};Q(Te,ye=>{c(de)&&ye(Ze)})}T(z,Y)}),o(ce),o(ee);var Ce=C(ee,2),H=d(Ce);{var B=z=>{var G=ka();G.__click=I,T(z,G)};Q(H,z=>{c(a)&&z(B)})}var te=C(H,2);te.__click=[xa,e,s,t],o(Ce),J(z=>{X(R,e.config.summary),X($,e.config.description),X(U,`選択中: ${c(r)??""} / ${e.config.maxCards??""}枚`),te.disabled=z},[()=>!c(s)()]),T(S,N)};Q(u,S=>{e.config&&S(f)})}T(M,D)},$$slots:{content:!0}}),pe()}we(["click"]);var Ra=k('<span class="text-warning-600 dark:text-warning-400">Draw</span>'),Ma=k("Winner: <span> </span>",1),Pa=k('<p class="text-2xl font-bold"><!></p>'),La=k('<p class="text-base opacity-75"><span class="font-semibold">Reason:</span> </p>'),za=k('<p class="text-base"> </p>'),Fa=k('<header class="text-center"><h2>Game Over!</h2></header> <article class="space-y-4 text-center"><!> <!> <!></article> <footer class="flex justify-center"><button class="btn variant-filled-primary">閉じる</button></footer>',1);function Za(n,e){ge(e,!0);function t(){e.onClose()}function r(i){i.open||t()}function a(){return e.winner==="player"?"border-success-500":e.winner==="opponent"?"border-error-500":e.winner==="draw"?"border-warning-500":"border-surface-500"}const s=x(a);Ye(n,{get open(){return e.isOpen},onOpenChange:r,get contentBase(){return`card bg-surface-50 dark:bg-surface-900 p-8 space-y-6 max-w-lg shadow-2xl border-4 ${c(s)??""}`},backdropClasses:"!bg-black/80 backdrop-blur-md",modal:!0,trapFocus:!0,closeOnEscape:!0,preventScroll:!0,content:l=>{var _=Fa(),g=ne(_),I=d(g);o(g);var b=C(g,2),h=d(b);{var M=E=>{var R=Pa(),L=d(R);{var F=$=>{var y=Ra();T($,y)},j=$=>{var y=Ma(),p=C(ne(y)),U=d(p,!0);o(p),J(()=>{ve(p,1,yn(e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400")),X(U,e.winner==="player"?"You":"Opponent")}),T($,y)};Q(L,$=>{e.winner==="draw"?$(F):$(j,!1)})}o(R),T(E,R)};Q(h,E=>{e.winner&&E(M)})}var D=C(h,2);{var u=E=>{var R=La(),L=C(d(R));o(R),J(()=>X(L,` ${e.reason??""}`)),T(E,R)};Q(D,E=>{e.reason&&E(u)})}var f=C(D,2);{var S=E=>{var R=za(),L=d(R,!0);o(R),J(()=>X(L,e.message)),T(E,R)};Q(f,E=>{e.message&&E(S)})}o(b);var N=C(b,2),V=d(N);V.__click=t,o(N),J(()=>ve(I,1,`h2 font-bold ${e.winner==="player"?"text-success-600 dark:text-success-400":"text-error-600 dark:text-error-400"}`)),T(l,_)},$$slots:{content:!0}}),pe()}we(["click"]);var Ga=k('<div class="container mx-auto p-4"><main class="max-w-4xl mx-auto space-y-2"><div class="grid grid-cols-2 gap-4"><div class="card p-4"><h1 class="text-2xl font-bold"> </h1></div> <div class="card p-4 space-y-4"><div class="space-y-2"><div class="flex justify-start space-x-4"><span>Now:</span> <span class="font-bold" data-testid="current-phase"> </span></div> <div class="flex justify-between"><span>自分 LP:</span> <span class="font-bold text-success-500"> </span> <span>相手 LP:</span> <span class="font-bold text-error-500"> </span></div></div></div></div> <!> <div class="card px-4 space-y-4"><h2 class="text-xl font-bold"> </h2> <!></div> <details class="card p-4"><summary class="cursor-pointer font-bold">Debug Info</summary> <div class="mt-4 space-y-4"><pre class="text-xs overflow-auto"> </pre></div></details></main></div> <!> <!> <!>',1);function $a(n,e){ge(e,!0);const[t,r]=In(),a=()=>fe(Pr,"$currentTurn",t),s=()=>fe(Mr,"$currentPhase",t),i=()=>fe(Gr,"$gameResult",t),l=()=>fe(Vr,"$handCardInstances",t),_=()=>fe(Ur,"$graveyardCardInstances",t),g=()=>fe(W,"$gameStateStore",t),I=()=>fe(Lr,"$playerLP",t),b=()=>fe(zr,"$opponentLP",t),h=()=>fe(Zr,"$deckCardCount",t),M=()=>fe(Fr,"$handCardCount",t),D=()=>fe(ce,"$effectQueueState",t);Sn(async()=>{await Cn(e.data.uniqueCardIds),ke.registerNotificationHandler({showInfo:(w,O)=>{Ne(O)},showInteractive:()=>{}})});async function u(){for(let w=0;w<2;w++){await new Promise(A=>setTimeout(A,300));const O=ae.advancePhase();if(O.success)console.log(`[Simulator] ${O.message}`),O.message&&Ne(O.message);else{Oe(O.error||"フェーズ移行に失敗しました");break}}}let f=Ie(!1);ct(()=>{a()===1&&s()==="Draw"&&!c(f)&&!i().isGameOver&&(u(),K(f,!0))});let S=Ie(!1);ct(()=>{i().isGameOver&&K(S,!0)});function N(){if(i().isGameOver)return"ゲーム終了";function w(O){return{Draw:"ドローフェイズ",Standby:"スタンバイフェイズ",Main1:"メインフェイズ1",End:"エンドフェイズ"}[O]||O}return w(s())}function V(w,O){const A=ae.activateSpell(O);A.success||Oe(A.error||"発動に失敗しました")}function E(w,O){const A=ae.summonMonster(O);A.success?Ne(A.message||`${w.name}を召喚しました`):Oe(A.error||"召喚に失敗しました")}function R(w,O){const A=ae.setMonster(O);A.success?Ne(`${w.name}をセットしました`):Oe(A.error||"セットに失敗しました")}function L(w,O){const A=ae.setSpellTrap(O);A.success?Ne(`${w.name}をセットしました`):Oe(A.error||"セットに失敗しました")}let F=Ie(null),j=Ie(null);function $(w){K(F,w,!0),K(j,null)}function y(w,O){const A=ae.getGameState();if(![...A.zones.mainMonsterZone,...A.zones.spellTrapZone,...A.zones.fieldZone].find(vn=>vn.instanceId===O)){Oe("Card not found on field");return}K(F,null),K(j,c(j)===O?null:O,!0)}function p(w,O){const A=ae.activateSpell(O);A.success?Ne(A.message||`${w.name}を発動しました`):Oe(A.error||"発動に失敗しました"),K(j,null)}function U(w,O){const A=ae.activateIgnitionEffect(O);A.success?Ne(A.message||`${w.name}の効果を発動しました`):Oe(A.error||"効果発動に失敗しました"),K(j,null)}function ee(){K(j,null)}const ce=ke,Ce=x(()=>l().map(w=>({card:Pe(w.id),instanceId:w.instanceId}))),H=x(()=>_().map(w=>Pe(w.id)).filter(w=>w!==void 0)),B=x(()=>g().zones.fieldZone.map(O=>{const A=Pe(O.id);return A?{card:A,instanceId:O.instanceId,faceDown:O.position==="faceDown"}:null}).filter(O=>O!==null)),te=x(()=>{const w=g().zones.mainMonsterZone,O=Array(5).fill(null);return w.forEach((A,Ae)=>{if(Ae<5){const Me=Pe(A.id);Me&&(O[Ae]={card:Me,instanceId:A.instanceId,faceDown:A.position==="faceDown",rotation:A.battlePosition==="defense"?270:0,spellCounterCount:$e(A.counters,"spell")})}}),O}),z=x(()=>{const w=g().zones.spellTrapZone,O=Array(5).fill(null);return w.forEach((A,Ae)=>{if(Ae<5){const Me=Pe(A.id);Me&&(O[Ae]={card:Me,instanceId:A.instanceId,faceDown:A.position==="faceDown"})}}),O});var G=Ga(),Y=ne(G),se=d(Y),oe=d(se),de=d(oe),Te=d(de),Ze=d(Te);o(Te),o(de);var ye=C(de,2),ue=d(ye),Re=d(ue),Ue=C(d(Re),2),et=d(Ue,!0);o(Ue),o(Re);var gt=C(Re,2),tt=C(d(gt),2),an=d(tt,!0);o(tt);var pt=C(tt,4),sn=d(pt,!0);o(pt),o(gt),o(ue),o(ye),o(oe);var Ct=C(oe,2);ha(Ct,{get deckCards(){return h()},extraDeckCards:[],get graveyardCards(){return c(H)},get fieldCards(){return c(B)},get monsterCards(){return c(te)},get spellTrapCards(){return c(z)},get selectedFieldCardInstanceId(){return c(j)},onFieldCardClick:y,onActivateSetSpell:p,onActivateIgnitionEffect:U,onCancelFieldCardSelection:ee});var nt=C(Ct,2),rt=d(nt),cn=d(rt);o(rt);var on=C(rt,2);Ta(on,{get cards(){return c(Ce)},get handCardCount(){return M()},get currentPhase(){return s()},get isGameOver(){return i().isGameOver},get selectedHandCardInstanceId(){return c(F)},onCardClick:V,onSummonMonster:E,onSetMonster:R,onSetSpellTrap:L,onHandCardSelect:$}),o(nt);var ht=C(nt,2),St=C(d(ht),2),It=d(St),dn=d(It,!0);o(It),o(St),o(ht),o(se),o(Y);var Tt=C(Y,2);const ln=x(()=>D().confirmationConfig!==null);ba(Tt,{get isOpen(){return c(ln)},get config(){return D().confirmationConfig}});var yt=C(Tt,2);const un=x(()=>D().cardSelectionConfig!==null);wa(yt,{get isOpen(){return c(un)},get config(){return D().cardSelectionConfig}});var fn=C(yt,2);Za(fn,{get isOpen(){return c(S)},get winner(){return i().winner},get reason(){return i().reason},get message(){return i().message},onClose:()=>{K(S,!1)}}),J((w,O,A,Ae)=>{X(Ze,`Deck: ${e.data.deckName??""}`),X(et,w),X(an,O),X(sn,A),X(cn,`手札 (${M()??""} 枚)`),X(dn,Ae)},[N,()=>I().toLocaleString(),()=>b().toLocaleString(),()=>JSON.stringify(ae.getGameState(),null,2)]),T(n,G),pe(),r()}export{$a as component,Ja as universal};
