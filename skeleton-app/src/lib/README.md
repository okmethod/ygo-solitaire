# TypeScript Comment Guide

## 大原則: TPOに応じて効果的なコメントを書き、効果的でないコメントを書かない

根幹部分と枝葉部分では、コメントの目的・粒度が大きく異なることに留意する。  
これにより冗長なコメントを避け、人間の認知負荷と、コーディングエージェントのトークン消費を最適化する。

- **根幹部分**
  - コメントの目的:
    - 規約（何をするか、どう使うか）を示す
    - 重要事項をリマインドする
  - コメントの粒度:
    - JSDocで体系的なコメントを書く
  - 根幹部分の例:
    - Model層のインターフェース定義
    - 共通基底クラス
    - Facade層などの公開 API
    - Registry層、index.ts などのハブとなる場所
- **枝葉部分**
  - コメントの目的:
    - 意図（なぜそうしたか）を補足する
    - 特異な挙動や負債について警告する
  - コメントの粒度:
    - 簡潔な `//` コメントを優先する
  - 根幹部分の例:
    - Baseクラスを継承して書く個別実装部分
    - プライベートなメソッド
    - メソッド内の処理

なお、本プロジェクトのコメントは、日本語文を基本とする。  
（英文であることが自然な箇所についてはその限りではない。）

---

## 根幹部分のコメント方針

- **JSDoc は　1 行要約（Summary Fragment）を基本とする**:
  - ほとんどのメソッドは 1 行の要約で十分なはず。それ以上のコメントを書いている場合、冗長な説明になっている可能性がある。ダラダラと説明せず、エディタのホバーで見やすい簡潔さを維持する。
  - 紙面を割く価値のある重要事項についてはその限りではないが、集中的に記載し、コメントが分散しないようにする。
- **型と重複する情報をコメントに書かない**:
  - TypeScript の型システムは、それ自体がドキュメントとして機能するため、冗長なコメントにならないようにする。
  - `{string}` や `{number}` などの型情報は書かない。TS が定義している。
  - 自明な `@param` や `@returns` は書かない。引数名と型で十分に説明的にすることで、タグ自体を省略する。
  - `@type` タグは使わない。TSの型定義が Single Source of Truth である。
- **重要な方針をリマインドする**:
  - 重要な方針が忘れ去られてしまわないよう、目につきやすい場所にコメントしておく。
  - ストック情報等と重複しても構わないが、目的は説明ではなくリマインドであることに留意し、ごく簡潔に書く。

---

## 枝葉部分のコメント方針

- **簡潔な `//` コメントを優先する**:
  - JSDoc (`/\*_ ... _/`) を書き始めると、コメントが肥大化するリスクがある。
  - 通常のコメント (`// ...`) を使い、簡潔に書く。
- **定型文を排除する**:
  - 何度も登場する定型フレーズは根幹側に任せなどして、枝葉部分からは削る。
    - 定型フレーズの例: 「成功・失敗の結果を返します」
- **インラインリンクを活用する**:
  - 関連するクラスや型がある場合、テキストで説明せず `{@link ...}` で誘導する。
- **「何（What）」ではなく「なぜ（Why）」を書く**:
  - 実装の詳細はコードが語る。コメントは「なぜこの実装が必要なのか」「どのような仕様に基づいているのか」に絞る。
- **ブロックとフローを説明する**
  - コードの量が多い場合、ブロック単位で説明を書き、フローを追いやすくするコメントは有用。ステップを番号付きリストで書くなどで箇条書きにすると、論理構造を理解しやすくなる。
  - または、そのブロック自体を内部関数として切り出し、メイン関数が番号つきリストのように見えるように書くと尚良い。
- **専門用語を活用する**:
  - 技術用語（`O(n)$`）やドメイン知識の用語など、情報量の多い言葉を選ぶ。
- **特異な挙動や副作用について警告する**:
  - 「副作用としてグローバル状態を変更する」「ループ内での呼び出し禁止」など、コードから読み取りにくい制約は必ず明記する。
- **負債や仮実装を明示する**:
  - エッジケースが未実装な場合などは、`// TODO:` や `// FIXME:` を使い、将来の負債を可視化する。

---

## コメントの具体例

### ❌ 悪い例（冗長・重複）

```typescript
/**
 * デッキからカードを引く関数です。
 * @param count 引く枚数（数値型）
 * @returns 成功したかどうかの結果を返します
 */
drawCard(count: number): CommandResult;

```

### ✅ 良い例（Google Style + 普遍ガイド準拠）

```typescript
/** デッキから指定枚数のカードをドローし、GameState を更新します。 */
drawCard(count: number): CommandResult;

```

_要点：型からわかる枚数や戻り値の説明を省き、1 行で役割を要約している。_

### ✅ 良い例（複雑な意図がある場合）

```typescript
/**
 * 魔法カードを発動します。
 * 解決にユーザーの選択が必要な場合は {@link effectResolutionStore} に制御を移譲します。
 * @see ADR-0008 (効果解決モデルの導入)
 */
activateSpell(cardInstanceId: string): GameStateUpdateResult;

```

_要点：ストアへの委譲という「振る舞い」と、設計根拠への「リンク」に絞って記述している。_

### ChainableAction実装クラスのコメントフォーマット

```typescript
/**
 * [クラス名] - 《日本語カード名》([英語カード名])
 *
 * Card ID: [カードID] | Type: [type] | Subtype: [subtype]
 *
 * Implementation using ChainableAction model:
 * - CONDITIONS: [発動条件の要約]
 * - ACTIVATION: [発動時処理の要約]
 * - RESOLUTION: [解決時処理の要約]
 *
 * @module domain/effects/actions/spell/[クラス名]
 */
```

---

## 参考リンク

- [Okmethod - コーディングの心得](https://github.com/okmethod/okmethod/blob/main/docs/development-domains/coding-principles/assets/01-code.md)
- [TypeScript - JSDocリファレンス](https://www.typescriptlang.org/ja/docs/handbook/jsdoc-supported-types.html)
- [Google - TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html)
